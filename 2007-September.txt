From ivop at mail.berlios.de  Sat Sep  1 11:38:52 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 1 Sep 2007 11:38:52 +0200
Subject: [Hmgen-svnlog] r49 - trunk
Message-ID: <200709010938.l819cqTb024319@sheep.berlios.de>

Author: ivop
Date: 2007-09-01 11:38:51 +0200 (Sat, 01 Sep 2007)
New Revision: 49

Modified:
   trunk/gui_interface.c
Log:
start centered


Modified: trunk/gui_interface.c
===================================================================
--- trunk/gui_interface.c	2007-08-31 21:19:06 UTC (rev 48)
+++ trunk/gui_interface.c	2007-09-01 09:38:51 UTC (rev 49)
@@ -80,6 +80,7 @@
   hmgengui = gtk_window_new (GTK_WINDOW_TOPLEVEL);
 //  gtk_widget_set_size_request (hmgengui, 800, -1);
   gtk_window_set_title (GTK_WINDOW (hmgengui), "hmgengui");
+  gtk_window_set_position (GTK_WINDOW (hmgengui), GTK_WIN_POS_CENTER);
 
   vbox1 = gtk_vbox_new (FALSE, 0);
   gtk_widget_show (vbox1);



From ivop at mail.berlios.de  Sat Sep  1 11:39:41 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 1 Sep 2007 11:39:41 +0200
Subject: [Hmgen-svnlog] r50 - trunk/assist
Message-ID: <200709010939.l819dfEa024470@sheep.berlios.de>

Author: ivop
Date: 2007-09-01 11:39:41 +0200 (Sat, 01 Sep 2007)
New Revision: 50

Modified:
   trunk/assist/hmgengui.glade
Log:
update


Modified: trunk/assist/hmgengui.glade
===================================================================
--- trunk/assist/hmgengui.glade	2007-09-01 09:38:51 UTC (rev 49)
+++ trunk/assist/hmgengui.glade	2007-09-01 09:39:41 UTC (rev 50)
@@ -8,7 +8,7 @@
   <property name="visible">True</property>
   <property name="title" translatable="yes">hmgengui</property>
   <property name="type">GTK_WINDOW_TOPLEVEL</property>
-  <property name="window_position">GTK_WIN_POS_NONE</property>
+  <property name="window_position">GTK_WIN_POS_CENTER</property>
   <property name="modal">False</property>
   <property name="resizable">True</property>
   <property name="destroy_with_parent">False</property>
@@ -2526,7 +2526,7 @@
 		      <property name="right_padding">0</property>
 
 		      <child>
-			<widget class="GtkHScale" id="hscale19">
+			<widget class="GtkHScale" id="colormap_scale6">
 			  <property name="visible">True</property>
 			  <property name="can_focus">True</property>
 			  <property name="draw_value">True</property>
@@ -2549,11 +2549,12 @@
 		  </child>
 
 		  <child>
-		    <widget class="GtkColorButton" id="colorbutton1">
+		    <widget class="GtkColorButton" id="colormap_colorbutton1">
 		      <property name="visible">True</property>
 		      <property name="can_focus">True</property>
 		      <property name="use_alpha">False</property>
 		      <property name="focus_on_click">True</property>
+		      <signal name="color_set" handler="on_colormap_colorbutton1_color_set" last_modification_time="Fri, 31 Aug 2007 21:12:45 GMT"/>
 		    </widget>
 		    <packing>
 		      <property name="left_attach">0</property>
@@ -2566,7 +2567,7 @@
 		  </child>
 
 		  <child>
-		    <widget class="GtkColorButton" id="colorbutton2">
+		    <widget class="GtkColorButton" id="colormap_colorbutton2">
 		      <property name="visible">True</property>
 		      <property name="can_focus">True</property>
 		      <property name="use_alpha">False</property>
@@ -2583,7 +2584,7 @@
 		  </child>
 
 		  <child>
-		    <widget class="GtkColorButton" id="colorbutton3">
+		    <widget class="GtkColorButton" id="colormap_colorbutton3">
 		      <property name="visible">True</property>
 		      <property name="can_focus">True</property>
 		      <property name="use_alpha">False</property>
@@ -2600,7 +2601,7 @@
 		  </child>
 
 		  <child>
-		    <widget class="GtkColorButton" id="colorbutton4">
+		    <widget class="GtkColorButton" id="colormap_colorbutton4">
 		      <property name="visible">True</property>
 		      <property name="can_focus">True</property>
 		      <property name="use_alpha">False</property>
@@ -2617,7 +2618,7 @@
 		  </child>
 
 		  <child>
-		    <widget class="GtkColorButton" id="colorbutton5">
+		    <widget class="GtkColorButton" id="colormap_colorbutton5">
 		      <property name="visible">True</property>
 		      <property name="can_focus">True</property>
 		      <property name="use_alpha">False</property>
@@ -2634,7 +2635,7 @@
 		  </child>
 
 		  <child>
-		    <widget class="GtkColorButton" id="colorbutton6">
+		    <widget class="GtkColorButton" id="colormap_colorbutton6">
 		      <property name="visible">True</property>
 		      <property name="can_focus">True</property>
 		      <property name="use_alpha">False</property>
@@ -2651,7 +2652,7 @@
 		  </child>
 
 		  <child>
-		    <widget class="GtkColorButton" id="colorbutton7">
+		    <widget class="GtkColorButton" id="colormap_colorbutton7">
 		      <property name="visible">True</property>
 		      <property name="can_focus">True</property>
 		      <property name="use_alpha">False</property>
@@ -2668,7 +2669,7 @@
 		  </child>
 
 		  <child>
-		    <widget class="GtkColorButton" id="colorbutton8">
+		    <widget class="GtkColorButton" id="colormap_colorbutton8">
 		      <property name="visible">True</property>
 		      <property name="can_focus">True</property>
 		      <property name="use_alpha">False</property>
@@ -2685,7 +2686,7 @@
 		  </child>
 
 		  <child>
-		    <widget class="GtkHScale" id="hscale15">
+		    <widget class="GtkHScale" id="colormap_scale2">
 		      <property name="visible">True</property>
 		      <property name="can_focus">True</property>
 		      <property name="draw_value">True</property>
@@ -2706,7 +2707,7 @@
 		  </child>
 
 		  <child>
-		    <widget class="GtkHScale" id="hscale16">
+		    <widget class="GtkHScale" id="colormap_scale3">
 		      <property name="visible">True</property>
 		      <property name="can_focus">True</property>
 		      <property name="draw_value">True</property>
@@ -2727,7 +2728,7 @@
 		  </child>
 
 		  <child>
-		    <widget class="GtkHScale" id="hscale17">
+		    <widget class="GtkHScale" id="colormap_scale4">
 		      <property name="visible">True</property>
 		      <property name="can_focus">True</property>
 		      <property name="draw_value">True</property>
@@ -2748,7 +2749,7 @@
 		  </child>
 
 		  <child>
-		    <widget class="GtkHScale" id="hscale18">
+		    <widget class="GtkHScale" id="colormap_scale5">
 		      <property name="visible">True</property>
 		      <property name="can_focus">True</property>
 		      <property name="draw_value">True</property>
@@ -2769,7 +2770,7 @@
 		  </child>
 
 		  <child>
-		    <widget class="GtkHScale" id="hscale20">
+		    <widget class="GtkHScale" id="colormap_scale7">
 		      <property name="visible">True</property>
 		      <property name="can_focus">True</property>
 		      <property name="draw_value">True</property>
@@ -2790,7 +2791,7 @@
 		  </child>
 
 		  <child>
-		    <widget class="GtkHScale" id="hscale21">
+		    <widget class="GtkHScale" id="colormap_scale8">
 		      <property name="visible">True</property>
 		      <property name="can_focus">True</property>
 		      <property name="draw_value">True</property>
@@ -2811,7 +2812,7 @@
 		  </child>
 
 		  <child>
-		    <widget class="GtkHScale" id="hscale8">
+		    <widget class="GtkHScale" id="colormap_scale1">
 		      <property name="width_request">300</property>
 		      <property name="visible">True</property>
 		      <property name="can_focus">True</property>
@@ -2821,6 +2822,7 @@
 		      <property name="update_policy">GTK_UPDATE_CONTINUOUS</property>
 		      <property name="inverted">False</property>
 		      <property name="adjustment">0 0 255 0 0 0</property>
+		      <signal name="value_changed" handler="on_colormap_scale1_value_changed" last_modification_time="Fri, 31 Aug 2007 14:50:37 GMT"/>
 		    </widget>
 		    <packing>
 		      <property name="left_attach">1</property>
@@ -2859,6 +2861,7 @@
 		      <property name="active">False</property>
 		      <property name="inconsistent">False</property>
 		      <property name="draw_indicator">True</property>
+		      <signal name="toggled" handler="on_colormap_auto_update_checkbutton_toggled" last_modification_time="Fri, 31 Aug 2007 21:01:33 GMT"/>
 		    </widget>
 		    <packing>
 		      <property name="left_attach">0</property>
@@ -2987,7 +2990,7 @@
 	      <property name="border_width">8</property>
 	      <property name="visible">True</property>
 	      <property name="n_rows">3</property>
-	      <property name="n_columns">3</property>
+	      <property name="n_columns">4</property>
 	      <property name="homogeneous">False</property>
 	      <property name="row_spacing">8</property>
 	      <property name="column_spacing">8</property>
@@ -3053,77 +3056,15 @@
 		  <property name="visible">True</property>
 		  <property name="sensitive">False</property>
 		  <property name="can_focus">True</property>
+		  <property name="label">gtk-save</property>
+		  <property name="use_stock">True</property>
 		  <property name="relief">GTK_RELIEF_NORMAL</property>
 		  <property name="focus_on_click">True</property>
 		  <signal name="clicked" handler="on_pgm_save_as_button_clicked" last_modification_time="Tue, 21 Aug 2007 13:31:07 GMT"/>
-
-		  <child>
-		    <widget class="GtkAlignment" id="alignment4">
-		      <property name="visible">True</property>
-		      <property name="xalign">0.5</property>
-		      <property name="yalign">0.5</property>
-		      <property name="xscale">0</property>
-		      <property name="yscale">0</property>
-		      <property name="top_padding">0</property>
-		      <property name="bottom_padding">0</property>
-		      <property name="left_padding">0</property>
-		      <property name="right_padding">0</property>
-
-		      <child>
-			<widget class="GtkHBox" id="hbox3">
-			  <property name="visible">True</property>
-			  <property name="homogeneous">False</property>
-			  <property name="spacing">2</property>
-
-			  <child>
-			    <widget class="GtkImage" id="image1">
-			      <property name="visible">True</property>
-			      <property name="stock">gtk-save-as</property>
-			      <property name="icon_size">4</property>
-			      <property name="xalign">0.5</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			    </widget>
-			    <packing>
-			      <property name="padding">0</property>
-			      <property name="expand">False</property>
-			      <property name="fill">False</property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkLabel" id="label33">
-			      <property name="visible">True</property>
-			      <property name="label" translatable="yes">Save As...</property>
-			      <property name="use_underline">True</property>
-			      <property name="use_markup">False</property>
-			      <property name="justify">GTK_JUSTIFY_LEFT</property>
-			      <property name="wrap">False</property>
-			      <property name="selectable">False</property>
-			      <property name="xalign">0.5</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			      <property name="width_chars">-1</property>
-			      <property name="single_line_mode">False</property>
-			      <property name="angle">0</property>
-			    </widget>
-			    <packing>
-			      <property name="padding">0</property>
-			      <property name="expand">False</property>
-			      <property name="fill">False</property>
-			    </packing>
-			  </child>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
 		</widget>
 		<packing>
-		  <property name="left_attach">1</property>
-		  <property name="right_attach">2</property>
+		  <property name="left_attach">2</property>
+		  <property name="right_attach">3</property>
 		  <property name="top_attach">0</property>
 		  <property name="bottom_attach">1</property>
 		  <property name="x_options">fill</property>
@@ -3136,73 +3077,51 @@
 		  <property name="visible">True</property>
 		  <property name="sensitive">False</property>
 		  <property name="can_focus">True</property>
+		  <property name="label">gtk-save</property>
+		  <property name="use_stock">True</property>
 		  <property name="relief">GTK_RELIEF_NORMAL</property>
 		  <property name="focus_on_click">True</property>
 		  <signal name="clicked" handler="on_ppm_save_as_button_clicked" last_modification_time="Tue, 21 Aug 2007 13:30:57 GMT"/>
+		</widget>
+		<packing>
+		  <property name="left_attach">2</property>
+		  <property name="right_attach">3</property>
+		  <property name="top_attach">1</property>
+		  <property name="bottom_attach">2</property>
+		  <property name="x_options">fill</property>
+		  <property name="y_options"></property>
+		</packing>
+	      </child>
 
-		  <child>
-		    <widget class="GtkAlignment" id="alignment5">
-		      <property name="visible">True</property>
-		      <property name="xalign">0.5</property>
-		      <property name="yalign">0.5</property>
-		      <property name="xscale">0</property>
-		      <property name="yscale">0</property>
-		      <property name="top_padding">0</property>
-		      <property name="bottom_padding">0</property>
-		      <property name="left_padding">0</property>
-		      <property name="right_padding">0</property>
+	      <child>
+		<widget class="GtkFileChooserButton" id="filechooserbutton1">
+		  <property name="visible">True</property>
+		  <property name="title" translatable="yes">Select A File</property>
+		  <property name="action">GTK_FILE_CHOOSER_ACTION_OPEN</property>
+		  <property name="local_only">True</property>
+		  <property name="show_hidden">True</property>
+		  <property name="do_overwrite_confirmation">False</property>
+		  <property name="width_chars">32</property>
+		</widget>
+		<packing>
+		  <property name="left_attach">1</property>
+		  <property name="right_attach">2</property>
+		  <property name="top_attach">0</property>
+		  <property name="bottom_attach">1</property>
+		  <property name="x_options">fill</property>
+		  <property name="y_options">fill</property>
+		</packing>
+	      </child>
 
-		      <child>
-			<widget class="GtkHBox" id="hbox4">
-			  <property name="visible">True</property>
-			  <property name="homogeneous">False</property>
-			  <property name="spacing">2</property>
-
-			  <child>
-			    <widget class="GtkImage" id="image2">
-			      <property name="visible">True</property>
-			      <property name="stock">gtk-save-as</property>
-			      <property name="icon_size">4</property>
-			      <property name="xalign">0.5</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			    </widget>
-			    <packing>
-			      <property name="padding">0</property>
-			      <property name="expand">False</property>
-			      <property name="fill">False</property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkLabel" id="label34">
-			      <property name="visible">True</property>
-			      <property name="label" translatable="yes">Save As...</property>
-			      <property name="use_underline">True</property>
-			      <property name="use_markup">False</property>
-			      <property name="justify">GTK_JUSTIFY_LEFT</property>
-			      <property name="wrap">False</property>
-			      <property name="selectable">False</property>
-			      <property name="xalign">0.5</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			      <property name="width_chars">-1</property>
-			      <property name="single_line_mode">False</property>
-			      <property name="angle">0</property>
-			    </widget>
-			    <packing>
-			      <property name="padding">0</property>
-			      <property name="expand">False</property>
-			      <property name="fill">False</property>
-			    </packing>
-			  </child>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
+	      <child>
+		<widget class="GtkFileChooserButton" id="filechooserbutton2">
+		  <property name="visible">True</property>
+		  <property name="title" translatable="yes">Select A File</property>
+		  <property name="action">GTK_FILE_CHOOSER_ACTION_OPEN</property>
+		  <property name="local_only">True</property>
+		  <property name="show_hidden">False</property>
+		  <property name="do_overwrite_confirmation">False</property>
+		  <property name="width_chars">32</property>
 		</widget>
 		<packing>
 		  <property name="left_attach">1</property>
@@ -3210,7 +3129,7 @@
 		  <property name="top_attach">1</property>
 		  <property name="bottom_attach">2</property>
 		  <property name="x_options">fill</property>
-		  <property name="y_options"></property>
+		  <property name="y_options">fill</property>
 		</packing>
 	      </child>
 	    </widget>



From ivop at mail.berlios.de  Tue Sep  4 01:00:41 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 4 Sep 2007 01:00:41 +0200
Subject: [Hmgen-svnlog] r51 - trunk
Message-ID: <200709032300.l83N0fqH029370@sheep.berlios.de>

Author: ivop
Date: 2007-09-04 01:00:40 +0200 (Tue, 04 Sep 2007)
New Revision: 51

Added:
   trunk/lib_export.c
Modified:
   trunk/Makefile
   trunk/cli_main.c
   trunk/lib_hmgen.h
Log:
move writing of pgm/ppm to its own file


Modified: trunk/Makefile
===================================================================
--- trunk/Makefile	2007-09-01 09:39:41 UTC (rev 50)
+++ trunk/Makefile	2007-09-03 23:00:40 UTC (rev 51)
@@ -54,7 +54,7 @@
 
 LIBHMGEN = libhmgen.a
 LIBHMGEN_BASENAMES = lib_algo_ff lib_algo_mpd lib_algo_forge \
-					 lib_postproc lib_util lib_hmgen
+					 lib_postproc lib_util lib_hmgen lib_export
 LIBHMGEN_OBJS = $(addsuffix $(OBJSUF), $(LIBHMGEN_BASENAMES))
 LIBHMGEN_SRCS = $(addsuffix .c, $(LIBHMGEN_BASENAMES))
 

Modified: trunk/cli_main.c
===================================================================
--- trunk/cli_main.c	2007-09-01 09:39:41 UTC (rev 50)
+++ trunk/cli_main.c	2007-09-03 23:00:40 UTC (rev 51)
@@ -174,8 +174,6 @@
 }
 
 int main(int argc, char **argv) {
-    FILE *fp1, *fp2 = NULL;
-
     if (!parse_command_line(argc, argv)) {
         fprintf(stderr, "error, parsing command line\n");
         exit(1);
@@ -185,21 +183,6 @@
         exit(1);
     }
 
-    fp1 = fopen(outfile, "wb");
-    if (!fp1) {
-        fprintf(stderr, "error, cannot open %s for writing\n", outfile);
-        exit(1);
-    }
-
-    if (outputcol) {
-        fp2 = fopen(colfile, "wb");
-        if (!fp2) {
-            fprintf(stderr, "error, cannot open %s for writing\n", colfile);
-            fclose(fp1);
-            exit(1);
-        }
-    }
-
     w = h = exp2(size) + 1;
 
     fprintf(stderr, "Dimensions: %i x %i\n", w, h);
@@ -235,21 +218,15 @@
 
     fprintf(stderr, "Saving to %s\n", outfile);
 
-    fprintf(fp1, "P5\n# Generated by HMGEN\n%i %i\n255\n", w, h);
-    fwrite(map, w, h, fp1);
-    fclose(fp1);
+    if (!hmg_export_pgm(outfile, map, w, h))
+        fprintf(stderr, "error during saving\n");
 
     if (outputcol) {
-        unsigned int i;
         fprintf(stderr, "Saving colorized version to %s\n", colfile);
 
-        fprintf(fp2, "P6\n# Generated by HMGEN\n%i %i\n255\n", w, h);
-
         hmg_init_colormap(NULL);
-        for (i=0; i<w*h; i++)
-            fwrite(hmg_colormap[map[i]], 1, 3, fp2);
-
-        fclose(fp2);
+        if (!hmg_export_ppm(colfile, map, w, h))
+            fprintf(stderr, "error during saving\n");
     }
 
     free(tempmap);

Added: trunk/lib_export.c
===================================================================
--- trunk/lib_export.c	2007-09-01 09:39:41 UTC (rev 50)
+++ trunk/lib_export.c	2007-09-03 23:00:40 UTC (rev 51)
@@ -0,0 +1,75 @@
+#include <stdio.h>
+#include "lib_hmgen.h"
+
+#define HMGEN_MODULE "Export"
+
+static int write_pnm_header(FILE *fp, unsigned int n,
+                            unsigned int w, unsigned int h) {
+    const char *gen_by = "Generated by hmgen";
+
+    if (fprintf(fp, "P%i\n# %s\n%i %i\n255\n", n, gen_by, w, h) < 0 )
+        return 0;
+
+    return 1;
+}
+
+unsigned int hmg_export_pgm(const char *filename, unsigned char *map,
+                            unsigned int width, unsigned int height) {
+    FILE *fp;
+    unsigned int y;
+
+    fp = fopen(filename, "wb");
+
+    if (!fp)
+        return 0;
+
+    if (!write_pnm_header(fp, 5, width, height))
+        goto err_out;
+
+    for (y=0; y<height; y++) {
+        progress_meter(y*100.0/height);
+        if (fwrite(map+y*width, width, 1, fp) != 1)
+            goto err_out;
+    }
+
+    progress_meter(-1);
+
+    return !fclose(fp);
+
+err_out:
+    fclose(fp);
+    progress_meter(-1);
+    return 0;
+}
+
+unsigned int hmg_export_ppm(const char *filename, unsigned char *map,
+                            unsigned int width, unsigned int height) {
+    FILE *fp;
+    unsigned int x, y;
+
+    fp = fopen(filename, "wb");
+
+    if (!fp)
+        return 0;
+
+    if (!write_pnm_header(fp, 6, width, height))
+        goto err_out;
+
+    for (y=0; y<height; y++) {
+        progress_meter(y*100.0/height);
+        for (x=0; x<width; x++) {
+            if (fwrite(hmg_colormap[map[y*width+x]], 1, 3, fp) != 3)
+                goto err_out;
+        }
+    }
+
+    progress_meter(-1);
+
+    return !fclose(fp);
+
+err_out:
+    fclose(fp);
+    progress_meter(-1);
+    return 0;
+}
+

Modified: trunk/lib_hmgen.h
===================================================================
--- trunk/lib_hmgen.h	2007-09-01 09:39:41 UTC (rev 50)
+++ trunk/lib_hmgen.h	2007-09-03 23:00:40 UTC (rev 51)
@@ -49,6 +49,11 @@
 void hmg_rng_initgauss(unsigned int seed);
 double hmg_rng_gauss(void);
 
+unsigned int hmg_export_pgm(const char *filename, unsigned char *map,
+                            unsigned int width, unsigned int height);
+unsigned int hmg_export_ppm(const char *filename, unsigned char *map,
+                            unsigned int width, unsigned int height);
+
 #ifdef __GNUC__
 #define HMG_ATTR_UNUSED     __attribute__((unused))
 #else



From ivop at mail.berlios.de  Tue Sep  4 01:01:31 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 4 Sep 2007 01:01:31 +0200
Subject: [Hmgen-svnlog] r52 - trunk
Message-ID: <200709032301.l83N1VsS029901@sheep.berlios.de>

Author: ivop
Date: 2007-09-04 01:01:30 +0200 (Tue, 04 Sep 2007)
New Revision: 52

Modified:
   trunk/Makefile
Log:
cosmetics


Modified: trunk/Makefile
===================================================================
--- trunk/Makefile	2007-09-03 23:00:40 UTC (rev 51)
+++ trunk/Makefile	2007-09-03 23:01:30 UTC (rev 52)
@@ -54,7 +54,7 @@
 
 LIBHMGEN = libhmgen.a
 LIBHMGEN_BASENAMES = lib_algo_ff lib_algo_mpd lib_algo_forge \
-					 lib_postproc lib_util lib_hmgen lib_export
+                     lib_postproc lib_util lib_hmgen lib_export
 LIBHMGEN_OBJS = $(addsuffix $(OBJSUF), $(LIBHMGEN_BASENAMES))
 LIBHMGEN_SRCS = $(addsuffix .c, $(LIBHMGEN_BASENAMES))
 



From ivop at mail.berlios.de  Tue Sep  4 14:20:29 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 4 Sep 2007 14:20:29 +0200
Subject: [Hmgen-svnlog] r53 - in trunk: . assist
Message-ID: <200709041220.l84CKTgA013260@sheep.berlios.de>

Author: ivop
Date: 2007-09-04 14:20:29 +0200 (Tue, 04 Sep 2007)
New Revision: 53

Modified:
   trunk/assist/hmgengui.glade
   trunk/gui_callbacks.c
   trunk/gui_callbacks.h
   trunk/gui_interface.c
Log:
new export look


Modified: trunk/assist/hmgengui.glade
===================================================================
--- trunk/assist/hmgengui.glade	2007-09-03 23:01:30 UTC (rev 52)
+++ trunk/assist/hmgengui.glade	2007-09-04 12:20:29 UTC (rev 53)
@@ -2949,7 +2949,6 @@
 
 	  <child>
 	    <widget class="GtkTable" id="table13">
-	      <property name="visible">True</property>
 	      <property name="n_rows">3</property>
 	      <property name="n_columns">3</property>
 	      <property name="homogeneous">False</property>
@@ -2986,53 +2985,126 @@
 	  </child>
 
 	  <child>
-	    <widget class="GtkTable" id="table8">
-	      <property name="border_width">8</property>
+	    <widget class="GtkHPaned" id="hpaned1">
 	      <property name="visible">True</property>
-	      <property name="n_rows">3</property>
-	      <property name="n_columns">4</property>
-	      <property name="homogeneous">False</property>
-	      <property name="row_spacing">8</property>
-	      <property name="column_spacing">8</property>
+	      <property name="can_focus">True</property>
+	      <property name="position">1000</property>
 
 	      <child>
-		<widget class="GtkLabel" id="label31">
+		<widget class="GtkTable" id="table8">
+		  <property name="border_width">8</property>
 		  <property name="visible">True</property>
-		  <property name="label" translatable="yes">PGM</property>
-		  <property name="use_underline">False</property>
-		  <property name="use_markup">False</property>
-		  <property name="justify">GTK_JUSTIFY_LEFT</property>
-		  <property name="wrap">False</property>
-		  <property name="selectable">False</property>
-		  <property name="xalign">0</property>
-		  <property name="yalign">0.5</property>
-		  <property name="xpad">0</property>
-		  <property name="ypad">0</property>
-		  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-		  <property name="width_chars">-1</property>
-		  <property name="single_line_mode">False</property>
-		  <property name="angle">0</property>
+		  <property name="n_rows">3</property>
+		  <property name="n_columns">2</property>
+		  <property name="homogeneous">False</property>
+		  <property name="row_spacing">8</property>
+		  <property name="column_spacing">8</property>
+
+		  <child>
+		    <widget class="GtkHBox" id="hbox8">
+		      <property name="visible">True</property>
+		      <property name="homogeneous">False</property>
+		      <property name="spacing">8</property>
+
+		      <child>
+			<widget class="GtkLabel" id="label50">
+			  <property name="visible">True</property>
+			  <property name="label" translatable="yes"></property>
+			  <property name="use_underline">False</property>
+			  <property name="use_markup">False</property>
+			  <property name="justify">GTK_JUSTIFY_LEFT</property>
+			  <property name="wrap">False</property>
+			  <property name="selectable">False</property>
+			  <property name="xalign">0.5</property>
+			  <property name="yalign">0.5</property>
+			  <property name="xpad">0</property>
+			  <property name="ypad">0</property>
+			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			  <property name="width_chars">-1</property>
+			  <property name="single_line_mode">False</property>
+			  <property name="angle">0</property>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">True</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkComboBox" id="export_format_combobox">
+			  <property name="visible">True</property>
+			  <property name="items" translatable="yes">PGM
+PPM
+</property>
+			  <property name="add_tearoffs">False</property>
+			  <property name="focus_on_click">True</property>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">False</property>
+			  <property name="fill">True</property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkButton" id="export_save_button">
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="label">gtk-save</property>
+			  <property name="use_stock">True</property>
+			  <property name="relief">GTK_RELIEF_NORMAL</property>
+			  <property name="focus_on_click">True</property>
+			</widget>
+			<packing>
+			  <property name="padding">0</property>
+			  <property name="expand">False</property>
+			  <property name="fill">False</property>
+			</packing>
+		      </child>
+		    </widget>
+		    <packing>
+		      <property name="left_attach">0</property>
+		      <property name="right_attach">1</property>
+		      <property name="top_attach">0</property>
+		      <property name="bottom_attach">1</property>
+		      <property name="x_options">fill</property>
+		      <property name="y_options">fill</property>
+		    </packing>
+		  </child>
+
+		  <child>
+		    <widget class="GtkFileChooserWidget" id="export_filechooserwidget">
+		      <property name="visible">True</property>
+		      <property name="action">GTK_FILE_CHOOSER_ACTION_SAVE</property>
+		      <property name="local_only">True</property>
+		      <property name="select_multiple">False</property>
+		      <property name="show_hidden">False</property>
+		    </widget>
+		    <packing>
+		      <property name="left_attach">0</property>
+		      <property name="right_attach">1</property>
+		      <property name="top_attach">1</property>
+		      <property name="bottom_attach">2</property>
+		    </packing>
+		  </child>
 		</widget>
 		<packing>
-		  <property name="left_attach">0</property>
-		  <property name="right_attach">1</property>
-		  <property name="top_attach">0</property>
-		  <property name="bottom_attach">1</property>
-		  <property name="x_options">fill</property>
-		  <property name="y_options"></property>
+		  <property name="shrink">True</property>
+		  <property name="resize">False</property>
 		</packing>
 	      </child>
 
 	      <child>
-		<widget class="GtkLabel" id="label32">
+		<widget class="GtkLabel" id="label51">
 		  <property name="visible">True</property>
-		  <property name="label" translatable="yes">PPM</property>
+		  <property name="label" translatable="yes"></property>
 		  <property name="use_underline">False</property>
 		  <property name="use_markup">False</property>
 		  <property name="justify">GTK_JUSTIFY_LEFT</property>
 		  <property name="wrap">False</property>
 		  <property name="selectable">False</property>
-		  <property name="xalign">0</property>
+		  <property name="xalign">0.5</property>
 		  <property name="yalign">0.5</property>
 		  <property name="xpad">0</property>
 		  <property name="ypad">0</property>
@@ -3042,96 +3114,10 @@
 		  <property name="angle">0</property>
 		</widget>
 		<packing>
-		  <property name="left_attach">0</property>
-		  <property name="right_attach">1</property>
-		  <property name="top_attach">1</property>
-		  <property name="bottom_attach">2</property>
-		  <property name="x_options">fill</property>
-		  <property name="y_options"></property>
+		  <property name="shrink">True</property>
+		  <property name="resize">True</property>
 		</packing>
 	      </child>
-
-	      <child>
-		<widget class="GtkButton" id="pgm_save_as_button">
-		  <property name="visible">True</property>
-		  <property name="sensitive">False</property>
-		  <property name="can_focus">True</property>
-		  <property name="label">gtk-save</property>
-		  <property name="use_stock">True</property>
-		  <property name="relief">GTK_RELIEF_NORMAL</property>
-		  <property name="focus_on_click">True</property>
-		  <signal name="clicked" handler="on_pgm_save_as_button_clicked" last_modification_time="Tue, 21 Aug 2007 13:31:07 GMT"/>
-		</widget>
-		<packing>
-		  <property name="left_attach">2</property>
-		  <property name="right_attach">3</property>
-		  <property name="top_attach">0</property>
-		  <property name="bottom_attach">1</property>
-		  <property name="x_options">fill</property>
-		  <property name="y_options"></property>
-		</packing>
-	      </child>
-
-	      <child>
-		<widget class="GtkButton" id="ppm_save_as_button">
-		  <property name="visible">True</property>
-		  <property name="sensitive">False</property>
-		  <property name="can_focus">True</property>
-		  <property name="label">gtk-save</property>
-		  <property name="use_stock">True</property>
-		  <property name="relief">GTK_RELIEF_NORMAL</property>
-		  <property name="focus_on_click">True</property>
-		  <signal name="clicked" handler="on_ppm_save_as_button_clicked" last_modification_time="Tue, 21 Aug 2007 13:30:57 GMT"/>
-		</widget>
-		<packing>
-		  <property name="left_attach">2</property>
-		  <property name="right_attach">3</property>
-		  <property name="top_attach">1</property>
-		  <property name="bottom_attach">2</property>
-		  <property name="x_options">fill</property>
-		  <property name="y_options"></property>
-		</packing>
-	      </child>
-
-	      <child>
-		<widget class="GtkFileChooserButton" id="filechooserbutton1">
-		  <property name="visible">True</property>
-		  <property name="title" translatable="yes">Select A File</property>
-		  <property name="action">GTK_FILE_CHOOSER_ACTION_OPEN</property>
-		  <property name="local_only">True</property>
-		  <property name="show_hidden">True</property>
-		  <property name="do_overwrite_confirmation">False</property>
-		  <property name="width_chars">32</property>
-		</widget>
-		<packing>
-		  <property name="left_attach">1</property>
-		  <property name="right_attach">2</property>
-		  <property name="top_attach">0</property>
-		  <property name="bottom_attach">1</property>
-		  <property name="x_options">fill</property>
-		  <property name="y_options">fill</property>
-		</packing>
-	      </child>
-
-	      <child>
-		<widget class="GtkFileChooserButton" id="filechooserbutton2">
-		  <property name="visible">True</property>
-		  <property name="title" translatable="yes">Select A File</property>
-		  <property name="action">GTK_FILE_CHOOSER_ACTION_OPEN</property>
-		  <property name="local_only">True</property>
-		  <property name="show_hidden">False</property>
-		  <property name="do_overwrite_confirmation">False</property>
-		  <property name="width_chars">32</property>
-		</widget>
-		<packing>
-		  <property name="left_attach">1</property>
-		  <property name="right_attach">2</property>
-		  <property name="top_attach">1</property>
-		  <property name="bottom_attach">2</property>
-		  <property name="x_options">fill</property>
-		  <property name="y_options">fill</property>
-		</packing>
-	      </child>
 	    </widget>
 	    <packing>
 	      <property name="tab_expand">False</property>

Modified: trunk/gui_callbacks.c
===================================================================
--- trunk/gui_callbacks.c	2007-09-03 23:01:30 UTC (rev 52)
+++ trunk/gui_callbacks.c	2007-09-04 12:20:29 UTC (rev 53)
@@ -199,10 +199,8 @@
     GtkWidget *widget;
 
     gdk_threads_enter();
-        widget = lookup_widget(GTK_WIDGET(args), "pgm_save_as_button");
+        widget = lookup_widget(GTK_WIDGET(args), "export_save_button");
         gtk_widget_set_sensitive (widget, TRUE);
-        widget = lookup_widget(GTK_WIDGET(args), "ppm_save_as_button");
-        gtk_widget_set_sensitive (widget, TRUE);
     gdk_threads_leave();
 }
 
@@ -312,15 +310,6 @@
     g_thread_create(generate_thread, button, FALSE, NULL);
 }
 
-void on_pgm_save_as_button_clicked(GtkButton *button,
-                                   gpointer user_data HMG_ATTR_UNUSED) {
-}
-
-
-void on_ppm_save_as_button_clicked(GtkButton *button,
-                                   gpointer user_data HMG_ATTR_UNUSED) {
-}
-
 gboolean on_view_drawingarea_expose_event(GtkWidget *widget,
                                           GdkEventExpose *event HMG_ATTR_UNUSED,
                                           gpointer user_data HMG_ATTR_UNUSED) {

Modified: trunk/gui_callbacks.h
===================================================================
--- trunk/gui_callbacks.h	2007-09-03 23:01:30 UTC (rev 52)
+++ trunk/gui_callbacks.h	2007-09-04 12:20:29 UTC (rev 53)
@@ -9,8 +9,6 @@
 void on_size_combobox_changed     (GtkComboBox *combobox, gpointer user_data);
 
 void on_generate_button_clicked   (GtkButton *button, gpointer user_data);
-void on_pgm_save_as_button_clicked(GtkButton *button, gpointer user_data);
-void on_ppm_save_as_button_clicked(GtkButton *button, gpointer user_data);
 void on_new_create_button_clicked (GtkButton *button, gpointer user_data);
 void on_norm2_button_clicked      (GtkButton *button, gpointer user_data);
 void on_blur2_button_clicked      (GtkButton *button, gpointer user_data);

Modified: trunk/gui_interface.c
===================================================================
--- trunk/gui_interface.c	2007-09-03 23:01:30 UTC (rev 52)
+++ trunk/gui_interface.c	2007-09-04 12:20:29 UTC (rev 53)
@@ -40,8 +40,7 @@
   GtkWidget *mpd_seed_spinbutton, *mpd_label, *table4, *label23, *label24;
   GtkWidget *label25, *forge_seed_spinbutton, *forge_fracdim_spinbutton;
   GtkWidget *forge_powscale_spinbutton, *forge_label, *label8, *generate_label;
-  GtkWidget *table8, *label31, *label32, *pgm_save_as_button;
-  GtkWidget *ppm_save_as_button, *save_label, *vbox4, *image3;
+  GtkWidget *table8, *save_label, *vbox4, *image3;
   GtkWidget *about_message, *about_label, *main_progressbar;
   GtkWidget *hbox5, *view_sidepanel_notebook, *table9, *label39, *label40;
   GtkWidget *new_width_spinbutton, *new_height_spinbutton, *new_create_button;
@@ -60,7 +59,8 @@
   GtkWidget *colormap_scale4, *colormap_scale5, *colormap_scale7;
   GtkWidget *colormap_scale8, *table15, *colormap_auto_update_checkbutton;
   GtkWidget *colormap_update_button, *colormap_redraw_2dview_button;
-  GtkWidget *filechooserbutton1, *filechooserbutton2;
+  GtkWidget *hpaned1, *hbox8, *label50, *export_format_combobox;
+  GtkWidget *export_save_button, *export_filechooserwidget, *label51;
 
   GtkObject *norm_min_spinbutton_adj, *norm_max_spinbutton_adj;
   GtkObject *blur_sigma_spinbutton_adj, *blur_yradius_spinbutton_adj;
@@ -945,54 +945,49 @@
   gtk_widget_show (label42);
   gtk_notebook_set_tab_label (GTK_NOTEBOOK (main_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (main_notebook), 3), label42);
 
-  table8 = gtk_table_new (3, 4, FALSE);
+  hpaned1 = gtk_hpaned_new ();
+  gtk_widget_show (hpaned1);
+  gtk_container_add (GTK_CONTAINER (main_notebook), hpaned1);
+  gtk_paned_set_position (GTK_PANED (hpaned1), 1000);
+
+  table8 = gtk_table_new (3, 2, FALSE);
   gtk_widget_show (table8);
-  gtk_container_add (GTK_CONTAINER (main_notebook), table8);
+  gtk_paned_pack1 (GTK_PANED (hpaned1), table8, FALSE, TRUE);
   gtk_container_set_border_width (GTK_CONTAINER (table8), 8);
   gtk_table_set_row_spacings (GTK_TABLE (table8), 8);
   gtk_table_set_col_spacings (GTK_TABLE (table8), 8);
 
-  label31 = gtk_label_new ("PGM");
-  gtk_widget_show (label31);
-  gtk_table_attach (GTK_TABLE (table8), label31, 0, 1, 0, 1,
+  hbox8 = gtk_hbox_new (FALSE, 8);
+  gtk_widget_show (hbox8);
+  gtk_table_attach (GTK_TABLE (table8), hbox8, 0, 1, 0, 1,
                     (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label31), 0, 0.5);
+                    (GtkAttachOptions) (GTK_FILL), 0, 0);
 
-  label32 = gtk_label_new ("PPM");
-  gtk_widget_show (label32);
-  gtk_table_attach (GTK_TABLE (table8), label32, 0, 1, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_misc_set_alignment (GTK_MISC (label32), 0, 0.5);
+  label50 = gtk_label_new ("");
+  gtk_widget_show (label50);
+  gtk_box_pack_start (GTK_BOX (hbox8), label50, TRUE, TRUE, 0);
 
-  pgm_save_as_button = gtk_button_new_from_stock ("gtk-save");
-  gtk_widget_show (pgm_save_as_button);
-  gtk_table_attach (GTK_TABLE (table8), pgm_save_as_button, 2, 3, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_widget_set_sensitive (pgm_save_as_button, FALSE);
+  export_format_combobox = gtk_combo_box_new_text ();
+  gtk_widget_show (export_format_combobox);
+  gtk_box_pack_start (GTK_BOX (hbox8), export_format_combobox, FALSE, TRUE, 0);
+  gtk_combo_box_append_text (GTK_COMBO_BOX (export_format_combobox), "PGM");
+  gtk_combo_box_append_text (GTK_COMBO_BOX (export_format_combobox), "PPM");
+  gtk_combo_box_set_active(GTK_COMBO_BOX(export_format_combobox), 0);
 
-  ppm_save_as_button = gtk_button_new_from_stock ("gtk-save");
-  gtk_widget_show (ppm_save_as_button);
-  gtk_table_attach (GTK_TABLE (table8), ppm_save_as_button, 2, 3, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (0), 0, 0);
-  gtk_widget_set_sensitive (ppm_save_as_button, FALSE);
+  export_save_button = gtk_button_new_from_stock ("gtk-save");
+  gtk_widget_show (export_save_button);
+  gtk_box_pack_start (GTK_BOX (hbox8), export_save_button, FALSE, FALSE, 0);
+  gtk_widget_set_sensitive (export_save_button, FALSE);
 
-  filechooserbutton1 = gtk_file_chooser_button_new ("Select A File", GTK_FILE_CHOOSER_ACTION_OPEN);
-  gtk_widget_show (filechooserbutton1);
-  gtk_table_attach (GTK_TABLE (table8), filechooserbutton1, 1, 2, 0, 1,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (GTK_FILL), 0, 0);
-  g_object_set (filechooserbutton1, "show-hidden", TRUE, "width-chars", 32, NULL);
+  export_filechooserwidget = gtk_file_chooser_widget_new (GTK_FILE_CHOOSER_ACTION_SAVE);
+  gtk_widget_show (export_filechooserwidget);
+  gtk_table_attach (GTK_TABLE (table8), export_filechooserwidget, 0, 1, 1, 2,
+                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),
+                    (GtkAttachOptions) (GTK_EXPAND | GTK_FILL), 0, 0);
 
-  filechooserbutton2 = gtk_file_chooser_button_new ("Select A File", GTK_FILE_CHOOSER_ACTION_OPEN);
-  gtk_widget_show (filechooserbutton2);
-  gtk_table_attach (GTK_TABLE (table8), filechooserbutton2, 1, 2, 1, 2,
-                    (GtkAttachOptions) (GTK_FILL),
-                    (GtkAttachOptions) (GTK_FILL), 0, 0);
-  g_object_set (filechooserbutton2, "show-hidden", TRUE, "width-chars", 32, NULL);
+  label51 = gtk_label_new ("");
+  gtk_widget_show (label51);
+  gtk_paned_pack2 (GTK_PANED (hpaned1), label51, TRUE, TRUE);
 
   save_label = gtk_label_new ("Export");
   gtk_widget_show (save_label);
@@ -1035,12 +1030,6 @@
   g_signal_connect ((gpointer) generate_button, "clicked",
                     G_CALLBACK (on_generate_button_clicked),
                     NULL);
-  g_signal_connect ((gpointer) pgm_save_as_button, "clicked",
-                    G_CALLBACK (on_pgm_save_as_button_clicked),
-                    NULL);
-  g_signal_connect ((gpointer) ppm_save_as_button, "clicked",
-                    G_CALLBACK (on_ppm_save_as_button_clicked),
-                    NULL);
   g_signal_connect ((gpointer) new_create_button, "clicked",
                     G_CALLBACK (on_new_create_button_clicked),
                     NULL);
@@ -1148,8 +1137,6 @@
   GLADE_HOOKUP_OBJECT (hmgengui, forge_powscale_spinbutton, "forge_powscale_spinbutton");
   GLADE_HOOKUP_OBJECT (hmgengui, forge_label, "forge_label");
   GLADE_HOOKUP_OBJECT (hmgengui, generate_label, "generate_label");
-  GLADE_HOOKUP_OBJECT (hmgengui, pgm_save_as_button, "pgm_save_as_button");
-  GLADE_HOOKUP_OBJECT (hmgengui, ppm_save_as_button, "ppm_save_as_button");
   GLADE_HOOKUP_OBJECT (hmgengui, save_label, "save_label");
   GLADE_HOOKUP_OBJECT (hmgengui, about_message, "about_message");
   GLADE_HOOKUP_OBJECT (hmgengui, about_label, "about_label");
@@ -1188,8 +1175,9 @@
   GLADE_HOOKUP_OBJECT (hmgengui, colormap_auto_update_checkbutton, "colormap_auto_update_checkbutton");
   GLADE_HOOKUP_OBJECT (hmgengui, colormap_update_button, "colormap_update_button");
   GLADE_HOOKUP_OBJECT (hmgengui, colormap_redraw_2dview_button, "colormap_redraw_2dview_button");
-  GLADE_HOOKUP_OBJECT (hmgengui, filechooserbutton1, "filechooserbutton1");
-  GLADE_HOOKUP_OBJECT (hmgengui, filechooserbutton2, "filechooserbutton2");
+  GLADE_HOOKUP_OBJECT (hmgengui, export_format_combobox, "export_format_combobox");
+  GLADE_HOOKUP_OBJECT (hmgengui, export_save_button, "export_save_button");
+  GLADE_HOOKUP_OBJECT (hmgengui, export_filechooserwidget, "export_filechooserwidget");
 
   gtk_notebook_set_current_page(GTK_NOTEBOOK(main_notebook), 1);
 



From ivop at mail.berlios.de  Tue Sep  4 14:20:47 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 4 Sep 2007 14:20:47 +0200
Subject: [Hmgen-svnlog] r54 - trunk
Message-ID: <200709041220.l84CKlAh013291@sheep.berlios.de>

Author: ivop
Date: 2007-09-04 14:20:47 +0200 (Tue, 04 Sep 2007)
New Revision: 54

Modified:
   trunk/gui_interface.c
Log:
do not show import tab


Modified: trunk/gui_interface.c
===================================================================
--- trunk/gui_interface.c	2007-09-04 12:20:29 UTC (rev 53)
+++ trunk/gui_interface.c	2007-09-04 12:20:47 UTC (rev 54)
@@ -938,7 +938,7 @@
   gtk_notebook_set_tab_label (GTK_NOTEBOOK (main_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (main_notebook), 2), label49);
 
   table13 = gtk_table_new (3, 3, FALSE);
-  gtk_widget_show (table13);
+//  gtk_widget_show (table13);
   gtk_container_add (GTK_CONTAINER (main_notebook), table13);
 
   label42 = gtk_label_new ("Import");



From ivop at mail.berlios.de  Tue Sep  4 14:22:49 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 4 Sep 2007 14:22:49 +0200
Subject: [Hmgen-svnlog] r55 - trunk
Message-ID: <200709041222.l84CMnIo013383@sheep.berlios.de>

Author: ivop
Date: 2007-09-04 14:22:49 +0200 (Tue, 04 Sep 2007)
New Revision: 55

Modified:
   trunk/gui_interface.c
Log:
set algorithm combobox to fault formation after creating the widget


Modified: trunk/gui_interface.c
===================================================================
--- trunk/gui_interface.c	2007-09-04 12:20:47 UTC (rev 54)
+++ trunk/gui_interface.c	2007-09-04 12:22:49 UTC (rev 55)
@@ -332,6 +332,7 @@
   gtk_combo_box_append_text (GTK_COMBO_BOX (algorithm_combobox), "Fault Formation");
   gtk_combo_box_append_text (GTK_COMBO_BOX (algorithm_combobox), "Midpoint Displacement (plasma)");
   gtk_combo_box_append_text (GTK_COMBO_BOX (algorithm_combobox), "Forge (ppmforge/gforge/fft'd noise)");
+  gtk_combo_box_set_active(GTK_COMBO_BOX(algorithm_combobox), 0);
 
   label10 = gtk_label_new ("Size");
   gtk_widget_show (label10);



From ivop at mail.berlios.de  Tue Sep  4 14:32:20 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 4 Sep 2007 14:32:20 +0200
Subject: [Hmgen-svnlog] r56 - trunk
Message-ID: <200709041232.l84CWK9M013844@sheep.berlios.de>

Author: ivop
Date: 2007-09-04 14:32:19 +0200 (Tue, 04 Sep 2007)
New Revision: 56

Modified:
   trunk/gui_callbacks.c
   trunk/gui_callbacks.h
   trunk/gui_interface.c
Log:
default size to 513x513 on creation of widget
generate button does not have to be unsensitive anymore


Modified: trunk/gui_callbacks.c
===================================================================
--- trunk/gui_callbacks.c	2007-09-04 12:22:49 UTC (rev 55)
+++ trunk/gui_callbacks.c	2007-09-04 12:32:19 UTC (rev 56)
@@ -14,7 +14,6 @@
 static GdkPixbuf *map_pixbuf = NULL;
 static unsigned int map_width = 0, map_height = 0;
 static GtkProgressBar *main_progressbar = NULL;
-static unsigned int algo_combo_set = 0, size_combo_set = 0;
 static unsigned int colormap_auto_update = 0;
 
 static void gui_progress_meter(char *context, int p) {
@@ -84,35 +83,17 @@
     gui_progress_meter("", -1);
 }
 
-static void generate_button_sensitivity(GtkComboBox *cb) {
-    GtkWidget *w;
-
-    if (algo_combo_set && size_combo_set) {
-        w = lookup_widget(GTK_WIDGET(cb), "generate_button");
-        gtk_widget_set_sensitive (w, TRUE);
-    }
-}
-
 void on_algorithm_combobox_changed(GtkComboBox *combobox,
                                    gpointer user_data HMG_ATTR_UNUSED) {
     gint active;
     GtkWidget *w;
 
-    algo_combo_set = 1;
-    generate_button_sensitivity(combobox);
-
     w = lookup_widget(GTK_WIDGET(combobox), "algosettings_notebook");
     active = gtk_combo_box_get_active(combobox);
 
     gtk_notebook_set_current_page(GTK_NOTEBOOK(w), active);
 }
 
-void on_size_combobox_changed(GtkComboBox *combobox,
-                              gpointer user_data HMG_ATTR_UNUSED) {
-    size_combo_set = 1;
-    generate_button_sensitivity(combobox);
-}
-
 /* not thread safe; wrap it yourself */
 static int get_spin_button_int(void *widget, const char *name) {
     GtkWidget *w;

Modified: trunk/gui_callbacks.h
===================================================================
--- trunk/gui_callbacks.h	2007-09-04 12:22:49 UTC (rev 55)
+++ trunk/gui_callbacks.h	2007-09-04 12:32:19 UTC (rev 56)
@@ -6,7 +6,6 @@
 void gui_quit(GtkWidget *widget, gpointer user_data);
 
 void on_algorithm_combobox_changed(GtkComboBox *combobox, gpointer user_data);
-void on_size_combobox_changed     (GtkComboBox *combobox, gpointer user_data);
 
 void on_generate_button_clicked   (GtkButton *button, gpointer user_data);
 void on_new_create_button_clicked (GtkButton *button, gpointer user_data);

Modified: trunk/gui_interface.c
===================================================================
--- trunk/gui_interface.c	2007-09-04 12:22:49 UTC (rev 55)
+++ trunk/gui_interface.c	2007-09-04 12:32:19 UTC (rev 56)
@@ -355,11 +355,11 @@
   gtk_combo_box_append_text (GTK_COMBO_BOX (size_combobox), "4097 x 4097");
   gtk_combo_box_append_text (GTK_COMBO_BOX (size_combobox), "8193 x 8193");
   gtk_combo_box_append_text (GTK_COMBO_BOX (size_combobox), "16385 x 16384");
+  gtk_combo_box_set_active(GTK_COMBO_BOX(size_combobox), 8);
 
   generate_button = gtk_button_new_with_mnemonic ("Generate!");
   gtk_widget_show (generate_button);
   gtk_box_pack_start (GTK_BOX (hbox1), generate_button, FALSE, FALSE, 0);
-  gtk_widget_set_sensitive (generate_button, FALSE);
 
   label6 = gtk_label_new ("Main");
   gtk_widget_show (label6);
@@ -1025,9 +1025,6 @@
   g_signal_connect ((gpointer) algorithm_combobox, "changed",
                     G_CALLBACK (on_algorithm_combobox_changed),
                     NULL);
-  g_signal_connect ((gpointer) size_combobox, "changed",
-                    G_CALLBACK (on_size_combobox_changed),
-                    NULL);
   g_signal_connect ((gpointer) generate_button, "clicked",
                     G_CALLBACK (on_generate_button_clicked),
                     NULL);



From ivop at mail.berlios.de  Thu Sep  6 00:31:35 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 6 Sep 2007 00:31:35 +0200
Subject: [Hmgen-svnlog] r57 - trunk
Message-ID: <200709052231.l85MVZp5026986@sheep.berlios.de>

Author: ivop
Date: 2007-09-06 00:31:35 +0200 (Thu, 06 Sep 2007)
New Revision: 57

Modified:
   trunk/gui_callbacks.c
   trunk/gui_callbacks.h
   trunk/gui_interface.c
Log:
gui export functionality


Modified: trunk/gui_callbacks.c
===================================================================
--- trunk/gui_callbacks.c	2007-09-04 12:32:19 UTC (rev 56)
+++ trunk/gui_callbacks.c	2007-09-05 22:31:35 UTC (rev 57)
@@ -585,3 +585,38 @@
     if (colormap_auto_update)
         on_colormap_update_button_clicked(GTK_BUTTON(colorbutton), NULL);
 }
+
+static void *export_thread(void *args) {
+    GtkWidget *w;
+    int format;
+    char *filename;
+
+    set_main_progressbar(args);
+    hmg_progress_meter = gui_progress_meter;
+
+    w = lookup_widget(GTK_WIDGET(args), "export_format_combobox");
+    format = gtk_combo_box_get_active(GTK_COMBO_BOX(w));
+    w = lookup_widget(GTK_WIDGET(args), "export_filechooserwidget");
+    filename = gtk_file_chooser_get_filename(GTK_FILE_CHOOSER(w));
+
+    switch (format) {
+    case 0:
+        hmg_export_pgm(filename, map, map_width, map_height);
+        break;
+    case 1:
+        hmg_export_ppm(filename, map, map_width, map_height);
+        break;
+    default:
+        assert(0);
+        break;
+    }
+
+    activate_main_notebook(args);
+    return NULL;
+}
+
+void on_export_save_button_clicked(GtkButton *button,
+                                   gpointer user_data HMG_ATTR_UNUSED) {
+    deactivate_main_notebook(button);
+    g_thread_create(export_thread, button, FALSE, NULL);
+}

Modified: trunk/gui_callbacks.h
===================================================================
--- trunk/gui_callbacks.h	2007-09-04 12:32:19 UTC (rev 56)
+++ trunk/gui_callbacks.h	2007-09-05 22:31:35 UTC (rev 57)
@@ -12,6 +12,7 @@
 void on_norm2_button_clicked      (GtkButton *button, gpointer user_data);
 void on_blur2_button_clicked      (GtkButton *button, gpointer user_data);
 void on_invert2_button_clicked    (GtkButton *button, gpointer user_data);
+void on_export_save_button_clicked(GtkButton *button, gpointer user_data);
 void on_colormap_update_button_clicked(GtkButton *button, gpointer user_data);
 void on_colormap_redraw_2dview_button_clicked(GtkButton *button,
                                               gpointer user_data);

Modified: trunk/gui_interface.c
===================================================================
--- trunk/gui_interface.c	2007-09-04 12:32:19 UTC (rev 56)
+++ trunk/gui_interface.c	2007-09-05 22:31:35 UTC (rev 57)
@@ -971,8 +971,10 @@
   export_format_combobox = gtk_combo_box_new_text ();
   gtk_widget_show (export_format_combobox);
   gtk_box_pack_start (GTK_BOX (hbox8), export_format_combobox, FALSE, TRUE, 0);
-  gtk_combo_box_append_text (GTK_COMBO_BOX (export_format_combobox), "PGM");
-  gtk_combo_box_append_text (GTK_COMBO_BOX (export_format_combobox), "PPM");
+  gtk_combo_box_append_text (GTK_COMBO_BOX (export_format_combobox),
+          "Heightmap as PGM image (grayscale)");
+  gtk_combo_box_append_text (GTK_COMBO_BOX (export_format_combobox),
+          "Heightmap as PPM image (color)");
   gtk_combo_box_set_active(GTK_COMBO_BOX(export_format_combobox), 0);
 
   export_save_button = gtk_button_new_from_stock ("gtk-save");
@@ -1040,6 +1042,9 @@
   g_signal_connect ((gpointer) invert2_button, "clicked",
                     G_CALLBACK (on_invert2_button_clicked),
                     NULL);
+  g_signal_connect ((gpointer) export_save_button, "clicked",
+                    G_CALLBACK (on_export_save_button_clicked),
+                    NULL);
   g_signal_connect ((gpointer) colormap_display, "expose_event",
                     G_CALLBACK (on_colormap_display_expose_event),
                     NULL);



From ivop at mail.berlios.de  Thu Sep  6 00:32:34 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 6 Sep 2007 00:32:34 +0200
Subject: [Hmgen-svnlog] r58 - trunk
Message-ID: <200709052232.l85MWYPM030746@sheep.berlios.de>

Author: ivop
Date: 2007-09-06 00:32:33 +0200 (Thu, 06 Sep 2007)
New Revision: 58

Modified:
   trunk/gui_callbacks.c
Log:
fourth argument is error function, not args (which is the second argument)


Modified: trunk/gui_callbacks.c
===================================================================
--- trunk/gui_callbacks.c	2007-09-05 22:31:35 UTC (rev 57)
+++ trunk/gui_callbacks.c	2007-09-05 22:32:33 UTC (rev 58)
@@ -568,7 +568,7 @@
                                               gpointer user_data
                                               HMG_ATTR_UNUSED) {
     deactivate_main_notebook(button);
-    g_thread_create(rerender_thread, button, FALSE, (void*)button);
+    g_thread_create(rerender_thread, button, FALSE, NULL);
 }
 
 void on_colormap_auto_update_checkbutton_toggled(GtkToggleButton *togglebutton,



From ivop at mail.berlios.de  Thu Sep  6 00:35:48 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 6 Sep 2007 00:35:48 +0200
Subject: [Hmgen-svnlog] r59 - trunk
Message-ID: <200709052235.l85MZmjj008004@sheep.berlios.de>

Author: ivop
Date: 2007-09-06 00:35:47 +0200 (Thu, 06 Sep 2007)
New Revision: 59

Modified:
   trunk/gui_callbacks.c
Log:
do not always switch to 2d view after main_notebook (re)activation


Modified: trunk/gui_callbacks.c
===================================================================
--- trunk/gui_callbacks.c	2007-09-05 22:32:33 UTC (rev 58)
+++ trunk/gui_callbacks.c	2007-09-05 22:35:47 UTC (rev 59)
@@ -185,12 +185,13 @@
     gdk_threads_leave();
 }
 
-static void activate_main_notebook(void *args) {
+static void activate_main_notebook(void *args, int to_2dview) {
     GtkWidget *widget;
 
     gdk_threads_enter();
         widget = lookup_widget(GTK_WIDGET(args), "main_notebook");
         gtk_widget_set_sensitive (widget, TRUE);
+        if (to_2dview)
         gtk_notebook_set_current_page(GTK_NOTEBOOK(widget), 0);
     gdk_threads_leave();
 }
@@ -275,7 +276,7 @@
     activate_save_buttons(args);
 
 stopit:
-    activate_main_notebook(args);
+    activate_main_notebook(args, 1);
     return NULL;
 }
 
@@ -350,7 +351,7 @@
     }
 
     activate_save_buttons(args);
-    activate_main_notebook(args);
+    activate_main_notebook(args, 1);
     return NULL;
 }
 
@@ -361,7 +362,7 @@
     hmg_invert(map, map_width, map_height);
     render_map(args);
 
-    activate_main_notebook(args);
+    activate_main_notebook(args, 1);
     return NULL;
 }
 
@@ -379,7 +380,7 @@
     hmg_normalize(map, normmin, normmax, map_width, map_height);
     render_map(args);
 
-    activate_main_notebook(args);
+    activate_main_notebook(args, 1);
     return NULL;
 }
 
@@ -400,7 +401,7 @@
                                                                 map_height);
     render_map(args);
 
-    activate_main_notebook(args);
+    activate_main_notebook(args, 1);
     return NULL;
 }
 
@@ -560,7 +561,7 @@
 
     render_map(args);
 
-    activate_main_notebook(args);
+    activate_main_notebook(args, 1);
     return NULL;
 }
 
@@ -611,7 +612,7 @@
         break;
     }
 
-    activate_main_notebook(args);
+    activate_main_notebook(args, 0);
     return NULL;
 }
 



From ivop at mail.berlios.de  Thu Sep  6 00:42:30 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 6 Sep 2007 00:42:30 +0200
Subject: [Hmgen-svnlog] r60 - trunk
Message-ID: <200709052242.l85MgUrZ024654@sheep.berlios.de>

Author: ivop
Date: 2007-09-06 00:42:29 +0200 (Thu, 06 Sep 2007)
New Revision: 60

Modified:
   trunk/gui_callbacks.c
Log:
display error on failure


Modified: trunk/gui_callbacks.c
===================================================================
--- trunk/gui_callbacks.c	2007-09-05 22:35:47 UTC (rev 59)
+++ trunk/gui_callbacks.c	2007-09-05 22:42:29 UTC (rev 60)
@@ -589,7 +589,7 @@
 
 static void *export_thread(void *args) {
     GtkWidget *w;
-    int format;
+    unsigned int format, ret;
     char *filename;
 
     set_main_progressbar(args);
@@ -602,16 +602,20 @@
 
     switch (format) {
     case 0:
-        hmg_export_pgm(filename, map, map_width, map_height);
+        ret = hmg_export_pgm(filename, map, map_width, map_height);
         break;
     case 1:
-        hmg_export_ppm(filename, map, map_width, map_height);
+        ret = hmg_export_ppm(filename, map, map_width, map_height);
         break;
     default:
         assert(0);
         break;
     }
 
+    // FIXME: add some sort of hmg_errno and hmg_strerror or similar
+    if (!ret)
+        hmg_progress_meter("Error! Could not export to file!", 42);
+
     activate_main_notebook(args, 0);
     return NULL;
 }



From ivop at mail.berlios.de  Thu Sep  6 00:44:22 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 6 Sep 2007 00:44:22 +0200
Subject: [Hmgen-svnlog] r61 - trunk
Message-ID: <200709052244.l85MiMSX027281@sheep.berlios.de>

Author: ivop
Date: 2007-09-06 00:44:22 +0200 (Thu, 06 Sep 2007)
New Revision: 61

Modified:
   trunk/Makefile
Log:
accept kernel style V=1 to enable verbose mode


Modified: trunk/Makefile
===================================================================
--- trunk/Makefile	2007-09-05 22:42:29 UTC (rev 60)
+++ trunk/Makefile	2007-09-05 22:44:22 UTC (rev 61)
@@ -2,6 +2,10 @@
 # Makefile with built-in configure experiment
 # Needs GNU Make to run properly
 
+ifeq ($(V),1)
+SILENT=no
+endif
+
 # ---------- COLORS ----------
 
 ifneq ($(colors),no)



From ivop at mail.berlios.de  Thu Sep  6 00:56:26 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 6 Sep 2007 00:56:26 +0200
Subject: [Hmgen-svnlog] r62 - trunk
Message-ID: <200709052256.l85MuQAm005879@sheep.berlios.de>

Author: ivop
Date: 2007-09-06 00:56:25 +0200 (Thu, 06 Sep 2007)
New Revision: 62

Modified:
   trunk/Makefile
Log:
-o and -c compiler flags configure dependent


Modified: trunk/Makefile
===================================================================
--- trunk/Makefile	2007-09-05 22:44:22 UTC (rev 61)
+++ trunk/Makefile	2007-09-05 22:56:25 UTC (rev 62)
@@ -81,7 +81,8 @@
 $(CLIg): CFLAGS = $(DEF_CFLAGS)
 $(CLIg): LDFLAGS = $(DEF_LDFLAGS)
 $(CLIg): $(LIBHMGEN) $(CLI_OBJS)
-	$(call SILENT_EXEC,$(CC) -o $@ $(CLI_OBJS) $(LIBHMGEN) $(LDFLAGS),link,$@)
+	$(call SILENT_EXEC,$(CC) $(OBJ_OUT_FLAG) $@ $(CLI_OBJS) $(LIBHMGEN) \
+		$(LDFLAGS),link,$@)
 
 $(GUI)-verbose: SILENT=no
 $(GUI)-verbose: $(GUI)
@@ -92,7 +93,8 @@
 $(GUIg): CFLAGS = $(GTK_CFLAGS) $(GTHREAD_CFLAGS) $(DEF_CFLAGS)
 $(GUIg): LDFLAGS = $(GTK_LDFLAGS) $(GTHREAD_LDFLAGS) $(DEF_LDFLAGS)
 $(GUIg): $(LIBHMGEN) $(GUI_OBJS)
-	$(call SILENT_EXEC,$(CC) -o $@ $(GUI_OBJS) $(LIBHMGEN) $(LDFLAGS),link,$@)
+	$(call SILENT_EXEC,$(CC) $(OBJ_OUT_FLAG) $@ $(GUI_OBJS) $(LIBHMGEN) \
+		$(LDFLAGS),link,$@)
 
 $(LIBHMGEN)-verbose: SILENT=no
 $(LIBHMGEN)-verbose: $(LIBHMGEN)
@@ -103,7 +105,8 @@
 	$(call SILENT_EXEC,$(RANLIB) $@,ranlib,$@)
 
 .c.o:
-	$(call SILENT_EXEC,$(CC) -c -o $@ $< $(CFLAGS),compile,$<)
+	$(call SILENT_EXEC,$(CC) $(DONT_LINK_FLAG) $(OBJ_OUT_FLAG) $@ $< $(CFLAGS)\
+		,compile,$<)
 
 depend-verbose dep-verbose: SILENT=no
 depend-verbose dep-verbose: dep
@@ -188,6 +191,8 @@
 			STD_FLAGS="-std=c99" ; \
 			DEBUG_FLAGS="-g" ; \
 			DEP_FLAGS="-MM" ; \
+			OBJ_OUT_FLAG="-o" ; \
+			DONT_LINK_FLAG="-c" ; \
 			;; \
 		sun) \
 			WARN_FLAGS= ; \
@@ -195,6 +200,8 @@
 			STD_FLAGS="-Xc" ; \
 			DEBUG_FLAGS="-g" ; \
 			DEP_FLAGS="-xM" ; \
+			OBJ_OUT_FLAG="-o" ; \
+			DONT_LINK_FLAG="-c" ; \
 			;; \
 	esac ; \
 	echo WARN_FLAGS=$$WARN_FLAGS >> config.mak ; \
@@ -202,11 +209,15 @@
 	echo STD_FLAGS=$$STD_FLAGS >> config.mak ; \
 	echo DEBUG_FLAGS=$$DEBUG_FLAGS >> config.mak ; \
 	echo DEP_FLAGS=$$DEP_FLAGS >> config.mak ; \
+	echo OBJ_OUT_FLAG=$$OBJ_OUT_FLAG >> config.mak ; \
+	echo DONT_LINK_FLAG=$$DONT_LINK_FLAG >> config.mak ; \
 	$(call config-print-result,warnings,$$WARN_FLAGS) ; \
 	$(call config-print-result,optimize,$$OPT_FLAGS) ; \
 	$(call config-print-result,standards,$$STD_FLAGS) ; \
 	$(call config-print-result,debug,$$DEBUG_FLAGS) ; \
-	$(call config-print-result,dependencies,$$DEP_FLAGS) ;
+	$(call config-print-result,dependencies,$$DEP_FLAGS) ; \
+	$(call config-print-result,object out,$$OBJ_OUT_FLAG) ; \
+	$(call config-print-result,do not link,$$DONT_LINK_FLAG) ;
 
 config-pkg-config:
 	@TMP=`pkg-config --version 2>/dev/null 1>&2 && echo yes || echo no` ; \



From ivop at mail.berlios.de  Thu Sep  6 12:19:35 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 6 Sep 2007 12:19:35 +0200
Subject: [Hmgen-svnlog] r63 - trunk
Message-ID: <200709061019.l86AJZKw023941@sheep.berlios.de>

Author: ivop
Date: 2007-09-06 12:19:35 +0200 (Thu, 06 Sep 2007)
New Revision: 63

Modified:
   trunk/gui_callbacks.c
   trunk/gui_interface.c
   trunk/lib_export.c
   trunk/lib_hmgen.h
Log:
export to BMP files


Modified: trunk/gui_callbacks.c
===================================================================
--- trunk/gui_callbacks.c	2007-09-05 22:56:25 UTC (rev 62)
+++ trunk/gui_callbacks.c	2007-09-06 10:19:35 UTC (rev 63)
@@ -607,6 +607,9 @@
     case 1:
         ret = hmg_export_ppm(filename, map, map_width, map_height);
         break;
+    case 2:
+        ret = hmg_export_bmp(filename, map, map_width, map_height);
+        break;
     default:
         assert(0);
         break;

Modified: trunk/gui_interface.c
===================================================================
--- trunk/gui_interface.c	2007-09-05 22:56:25 UTC (rev 62)
+++ trunk/gui_interface.c	2007-09-06 10:19:35 UTC (rev 63)
@@ -975,6 +975,8 @@
           "Heightmap as PGM image (grayscale)");
   gtk_combo_box_append_text (GTK_COMBO_BOX (export_format_combobox),
           "Heightmap as PPM image (color)");
+  gtk_combo_box_append_text (GTK_COMBO_BOX (export_format_combobox),
+          "Heightmap as BMP image (8-bit palette, uncompressed)");
   gtk_combo_box_set_active(GTK_COMBO_BOX(export_format_combobox), 0);
 
   export_save_button = gtk_button_new_from_stock ("gtk-save");

Modified: trunk/lib_export.c
===================================================================
--- trunk/lib_export.c	2007-09-05 22:56:25 UTC (rev 62)
+++ trunk/lib_export.c	2007-09-06 10:19:35 UTC (rev 63)
@@ -73,3 +73,61 @@
     return 0;
 }
 
+#define S16(a)  (a)&0xff, (a>>8)&0xff
+#define S32(a)  (a)&0xff, (a>>8)&0xff, (a>>16)&0xff, (a>>24)&0xff
+#define C32     "%c%c%c%c"
+#define C16     "%c%c"
+#define C8      "%c"
+
+unsigned int hmg_export_bmp(const char *filename, unsigned char *map,
+                            unsigned int width, unsigned int height) {
+    FILE *fp;
+    unsigned int x, wr, fsize;
+    int y, ret;
+
+    wr = width & ~3;
+    if (wr != width)
+        wr += 4;
+
+    fsize = 14 + 40 + 1024 + height * wr;
+
+    fp = fopen(filename, "wb");
+
+    if (!fp)
+        return 0;
+
+    ret = fprintf(fp, "%2s" C32 C32 C32, "BM", S32(fsize), S32(0), S32(1078));
+    if (ret < 0)
+        goto err_out;
+
+    ret = fprintf(fp, C32 C32 C32 C16 C16 C32 C32 C32 C32 C32 C32,
+            S32(40), S32(width), S32(height), S16(1), S16(8), S32(0), S32(0),
+            S32(0), S32(0), S32(0), S32(0));
+    if (ret < 0)
+        goto err_out;
+
+    for (x=0; x<256; x++) {
+        ret = fprintf(fp, C32, hmg_colormap[x][2], hmg_colormap[x][1],
+                                                        hmg_colormap[x][0], 0);
+        if (ret < 0)
+            goto err_out;
+    }
+
+    for (y=height-1; y>=0; y--) {
+        progress_meter((height-y)*100.0/height);
+        if (fwrite(map+y*width, width, 1, fp) != 1)
+            goto err_out;
+        for (x=0; x<(wr-width); x++)
+            if (fputc(0, fp) < 0)
+                goto err_out;
+    }
+
+    progress_meter(-1);
+
+    return !fclose(fp);
+
+err_out:
+    fclose(fp);
+    progress_meter(-1);
+    return 0;
+}

Modified: trunk/lib_hmgen.h
===================================================================
--- trunk/lib_hmgen.h	2007-09-05 22:56:25 UTC (rev 62)
+++ trunk/lib_hmgen.h	2007-09-06 10:19:35 UTC (rev 63)
@@ -53,6 +53,8 @@
                             unsigned int width, unsigned int height);
 unsigned int hmg_export_ppm(const char *filename, unsigned char *map,
                             unsigned int width, unsigned int height);
+unsigned int hmg_export_bmp(const char *filename, unsigned char *map,
+                            unsigned int width, unsigned int height);
 
 #ifdef __GNUC__
 #define HMG_ATTR_UNUSED     __attribute__((unused))



From ivop at mail.berlios.de  Thu Sep  6 13:35:37 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 6 Sep 2007 13:35:37 +0200
Subject: [Hmgen-svnlog] r64 - trunk
Message-ID: <200709061135.l86BZb2G012209@sheep.berlios.de>

Author: ivop
Date: 2007-09-06 13:35:37 +0200 (Thu, 06 Sep 2007)
New Revision: 64

Modified:
   trunk/cli_main.c
Log:
export to bmp file


Modified: trunk/cli_main.c
===================================================================
--- trunk/cli_main.c	2007-09-06 10:19:35 UTC (rev 63)
+++ trunk/cli_main.c	2007-09-06 11:35:37 UTC (rev 64)
@@ -23,6 +23,7 @@
 static unsigned int w, h;
 static char *outfile = (char *) defoutfile;
 static char *colfile = (char *) defcolfile;
+static char *bmpfile = NULL;
 static unsigned int outputcol = 0;
 static const char *params = NULL;
 
@@ -36,6 +37,7 @@
 "-o FILE        output filename [default: output.pgm]\n"
 "-c             enable output of colorized version\n"
 "-cfile FILE    output file name of colorized version [default: output.ppm]\n"
+"-bmp FILE      output map to BMP file\n"
 "-p STRING      algorithm parameters (param:param:param...)\n"
 "-a INT         algorithm [default: 0]\n"
 "                   0 - Fault Formation\n"
@@ -102,6 +104,9 @@
         } else if (!strcmp(argv[a], "-cfile")) {
             if (!test_argument(a, argc, argv)) return 0;
             colfile = argv[++a];
+        } else if (!strcmp(argv[a], "-bmp")) {
+            if (!test_argument(a, argc, argv)) return 0;
+            bmpfile = argv[++a];
         } else if (!strcmp(argv[a], "-p")) {
             if (!test_argument(a, argc, argv)) return 0;
             params = argv[++a];
@@ -229,6 +234,14 @@
             fprintf(stderr, "error during saving\n");
     }
 
+    if (bmpfile) {
+        fprintf(stderr, "Saving BMP file to %s\n", bmpfile);
+
+        hmg_init_colormap(NULL);
+        if (!hmg_export_bmp(bmpfile, map, w, h))
+            fprintf(stderr, "error during saving\n");
+    }
+
     free(tempmap);
     free(map);
     return 0;



From ivop at mail.berlios.de  Thu Sep  6 13:38:22 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 6 Sep 2007 13:38:22 +0200
Subject: [Hmgen-svnlog] r65 - trunk
Message-ID: <200709061138.l86BcMfn012340@sheep.berlios.de>

Author: ivop
Date: 2007-09-06 13:38:22 +0200 (Thu, 06 Sep 2007)
New Revision: 65

Modified:
   trunk/cli_main.c
Log:
simpler ppm export


Modified: trunk/cli_main.c
===================================================================
--- trunk/cli_main.c	2007-09-06 11:35:37 UTC (rev 64)
+++ trunk/cli_main.c	2007-09-06 11:38:22 UTC (rev 65)
@@ -14,7 +14,6 @@
 #define DEF_NORMMAX     255
 
 static const char defoutfile[] = "output.pgm";
-static const char defcolfile[] = "output.ppm";
 
 static int size = 8, algo = 0, blur = 0, blurx = DEF_BLURX, blury = DEF_BLURY;
 static double blursigma = DEF_BLURSIGMA;
@@ -22,9 +21,8 @@
            normfirst = 0, normlast = 0, inv = 0;
 static unsigned int w, h;
 static char *outfile = (char *) defoutfile;
-static char *colfile = (char *) defcolfile;
+static char *colfile = NULL;
 static char *bmpfile = NULL;
-static unsigned int outputcol = 0;
 static const char *params = NULL;
 
 static unsigned char *map, *tempmap;
@@ -35,8 +33,7 @@
 "usage: %s [options]\n\n"
 "-s INT         size, 2^VAL+1 [default: 8]\n"
 "-o FILE        output filename [default: output.pgm]\n"
-"-c             enable output of colorized version\n"
-"-cfile FILE    output file name of colorized version [default: output.ppm]\n"
+"-ppm FILE      output colorized version to PPM file\n"
 "-bmp FILE      output map to BMP file\n"
 "-p STRING      algorithm parameters (param:param:param...)\n"
 "-a INT         algorithm [default: 0]\n"
@@ -99,9 +96,7 @@
         } else if (!strcmp(argv[a], "-o")) {
             if (!test_argument(a, argc, argv)) return 0;
             outfile = argv[++a];
-        } else if (!strcmp(argv[a], "-c")) {
-            outputcol = 1;
-        } else if (!strcmp(argv[a], "-cfile")) {
+        } else if (!strcmp(argv[a], "-ppm")) {
             if (!test_argument(a, argc, argv)) return 0;
             colfile = argv[++a];
         } else if (!strcmp(argv[a], "-bmp")) {
@@ -226,8 +221,8 @@
     if (!hmg_export_pgm(outfile, map, w, h))
         fprintf(stderr, "error during saving\n");
 
-    if (outputcol) {
-        fprintf(stderr, "Saving colorized version to %s\n", colfile);
+    if (colfile) {
+        fprintf(stderr, "Saving PPM file to %s\n", colfile);
 
         hmg_init_colormap(NULL);
         if (!hmg_export_ppm(colfile, map, w, h))



From ivop at mail.berlios.de  Thu Sep  6 13:40:41 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 6 Sep 2007 13:40:41 +0200
Subject: [Hmgen-svnlog] r66 - trunk
Message-ID: <200709061140.l86BefZR012522@sheep.berlios.de>

Author: ivop
Date: 2007-09-06 13:40:41 +0200 (Thu, 06 Sep 2007)
New Revision: 66

Modified:
   trunk/cli_main.c
Log:
only output if -o FILE is specified


Modified: trunk/cli_main.c
===================================================================
--- trunk/cli_main.c	2007-09-06 11:38:22 UTC (rev 65)
+++ trunk/cli_main.c	2007-09-06 11:40:41 UTC (rev 66)
@@ -13,14 +13,12 @@
 #define DEF_NORMMIN     0
 #define DEF_NORMMAX     255
 
-static const char defoutfile[] = "output.pgm";
-
 static int size = 8, algo = 0, blur = 0, blurx = DEF_BLURX, blury = DEF_BLURY;
 static double blursigma = DEF_BLURSIGMA;
 static int normmin = DEF_NORMMIN, normmax = DEF_NORMMAX,
            normfirst = 0, normlast = 0, inv = 0;
 static unsigned int w, h;
-static char *outfile = (char *) defoutfile;
+static char *outfile = NULL;
 static char *colfile = NULL;
 static char *bmpfile = NULL;
 static const char *params = NULL;
@@ -32,7 +30,7 @@
 "\nHeight Map Generator - %s - %s\n\n"
 "usage: %s [options]\n\n"
 "-s INT         size, 2^VAL+1 [default: 8]\n"
-"-o FILE        output filename [default: output.pgm]\n"
+"-o FILE        output heightmap to PGM file\n"
 "-ppm FILE      output colorized version to PPM file\n"
 "-bmp FILE      output map to BMP file\n"
 "-p STRING      algorithm parameters (param:param:param...)\n"
@@ -216,10 +214,12 @@
     if (inv)
         hmg_invert(map, w, h);
 
+    if (outfile) {
     fprintf(stderr, "Saving to %s\n", outfile);
 
     if (!hmg_export_pgm(outfile, map, w, h))
         fprintf(stderr, "error during saving\n");
+    }
 
     if (colfile) {
         fprintf(stderr, "Saving PPM file to %s\n", colfile);



From ivop at mail.berlios.de  Thu Sep  6 13:41:12 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 6 Sep 2007 13:41:12 +0200
Subject: [Hmgen-svnlog] r67 - trunk
Message-ID: <200709061141.l86BfCxq012580@sheep.berlios.de>

Author: ivop
Date: 2007-09-06 13:41:12 +0200 (Thu, 06 Sep 2007)
New Revision: 67

Modified:
   trunk/cli_main.c
Log:
cosmetics, indentation


Modified: trunk/cli_main.c
===================================================================
--- trunk/cli_main.c	2007-09-06 11:40:41 UTC (rev 66)
+++ trunk/cli_main.c	2007-09-06 11:41:12 UTC (rev 67)
@@ -215,15 +215,13 @@
         hmg_invert(map, w, h);
 
     if (outfile) {
-    fprintf(stderr, "Saving to %s\n", outfile);
-
-    if (!hmg_export_pgm(outfile, map, w, h))
-        fprintf(stderr, "error during saving\n");
+        fprintf(stderr, "Saving to %s\n", outfile);
+        if (!hmg_export_pgm(outfile, map, w, h))
+            fprintf(stderr, "error during saving\n");
     }
 
     if (colfile) {
         fprintf(stderr, "Saving PPM file to %s\n", colfile);
-
         hmg_init_colormap(NULL);
         if (!hmg_export_ppm(colfile, map, w, h))
             fprintf(stderr, "error during saving\n");
@@ -231,7 +229,6 @@
 
     if (bmpfile) {
         fprintf(stderr, "Saving BMP file to %s\n", bmpfile);
-
         hmg_init_colormap(NULL);
         if (!hmg_export_bmp(bmpfile, map, w, h))
             fprintf(stderr, "error during saving\n");



From ivop at mail.berlios.de  Fri Sep  7 13:11:45 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 7 Sep 2007 13:11:45 +0200
Subject: [Hmgen-svnlog] r68 - trunk
Message-ID: <200709071111.l87BBjFJ027007@sheep.berlios.de>

Author: ivop
Date: 2007-09-07 13:11:44 +0200 (Fri, 07 Sep 2007)
New Revision: 68

Modified:
   trunk/cli_main.c
   trunk/lib_hmgen.h
   trunk/lib_postproc.c
Log:
postprocess, clipping


Modified: trunk/cli_main.c
===================================================================
--- trunk/cli_main.c	2007-09-06 11:41:12 UTC (rev 67)
+++ trunk/cli_main.c	2007-09-07 11:11:44 UTC (rev 68)
@@ -13,10 +13,14 @@
 #define DEF_NORMMIN     0
 #define DEF_NORMMAX     255
 
+#define DEF_CLIPMIN     96
+#define DEF_CLIPMAX     160
+
 static int size = 8, algo = 0, blur = 0, blurx = DEF_BLURX, blury = DEF_BLURY;
 static double blursigma = DEF_BLURSIGMA;
 static int normmin = DEF_NORMMIN, normmax = DEF_NORMMAX,
-           normfirst = 0, normlast = 0, inv = 0;
+           normfirst = 0, normlast = 0, inv = 0, clip = 0,
+           clipmin = DEF_CLIPMIN, clipmax = DEF_CLIPMAX;
 static unsigned int w, h;
 static char *outfile = NULL;
 static char *colfile = NULL;
@@ -64,10 +68,15 @@
 "-bxy INT       blur xy-radius\n"
 "-bs FLOAT      blur sigma [default: %0.2f]\n"
 "-i             postprocess, invert heightmap [default: no]\n"
+"-clip          postprocess, clip [default: no]\n"
+"-clipmin INT   clip minimum (0-255) [default: %i]\n"
+"-clipmax INT   clip maximum (0-255) [default: %i]\n"
 "\n",
         HMG_VERSION_STRING, HMG_COPYRIGHT_STRING, argv[0],
         DEF_NORMMIN, DEF_NORMMAX,
-        DEF_BLURX, DEF_BLURY, DEF_BLURSIGMA);
+        DEF_BLURX, DEF_BLURY, DEF_BLURSIGMA,
+        DEF_CLIPMIN, DEF_CLIPMAX
+            );
     exit(0);
 }
 
@@ -131,6 +140,14 @@
             normmax = atoi(argv[++a]);
         } else if (!strcmp(argv[a], "-i")) {
             inv = 1;
+        } else if (!strcmp(argv[a], "-clip")) {
+            clip = 1;
+        } else if (!strcmp(argv[a], "-clipmin")) {
+            if (!test_argument(a, argc, argv)) return 0;
+            clipmin = atoi(argv[++a]);
+        } else if (!strcmp(argv[a], "-clipmax")) {
+            if (!test_argument(a, argc, argv)) return 0;
+            clipmax = atoi(argv[++a]);
         } else {
             fprintf(stderr, "unknown option: %s\n", argv[a]);
             return 0;
@@ -167,7 +184,14 @@
         fprintf(stderr, "normmax is larger than 255\n");
         return 0;
     }
-
+    if (clipmin < 0) {
+        fprintf(stderr, "clipmin is smaller than 0\n");
+        return 0;
+    }
+    if (clipmax > 255) {
+        fprintf(stderr, "clipmax is larger than 255\n");
+        return 0;
+    }
     return 1;
 }
 
@@ -213,6 +237,8 @@
         hmg_normalize(map, normmin, normmax, w, h);
     if (inv)
         hmg_invert(map, w, h);
+    if (clip)
+        hmg_clip(map, clipmin, clipmax, w, h);
 
     if (outfile) {
         fprintf(stderr, "Saving to %s\n", outfile);

Modified: trunk/lib_hmgen.h
===================================================================
--- trunk/lib_hmgen.h	2007-09-06 11:41:12 UTC (rev 67)
+++ trunk/lib_hmgen.h	2007-09-07 11:11:44 UTC (rev 68)
@@ -37,6 +37,10 @@
 
 void hmg_invert(unsigned char *map, unsigned int w, unsigned int h);
 
+void hmg_clip(unsigned char *map,
+              unsigned int clipmin, unsigned int clipmax,
+              unsigned int w, unsigned int h);
+
 extern unsigned char hmg_colormap[256][3];
 
 typedef struct hmg_colormap_settings_s {

Modified: trunk/lib_postproc.c
===================================================================
--- trunk/lib_postproc.c	2007-09-06 11:41:12 UTC (rev 67)
+++ trunk/lib_postproc.c	2007-09-07 11:11:44 UTC (rev 68)
@@ -107,3 +107,24 @@
     }
     progress_meter(-1);
 }
+
+#undef  HMGEN_MODULE
+#define HMGEN_MODULE "Clip"
+
+void hmg_clip(unsigned char *map,
+              unsigned int clipmin, unsigned int clipmax,
+              unsigned int w, unsigned int h) {
+    unsigned int x, y;
+    unsigned char v;
+
+    for (y=0; y<h; y++) {
+        progress_meter((int)round(y*100.0/(h-1)));
+        for (x=0; x<w; x++) {
+            v = map[x];
+            v = v > clipmax ? clipmax : v;
+            map[x] = v < clipmin ? clipmin : v;
+        }
+        map += w;
+    }
+    progress_meter(-1);
+}



From ivop at mail.berlios.de  Fri Sep  7 13:14:18 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 7 Sep 2007 13:14:18 +0200
Subject: [Hmgen-svnlog] r69 - trunk
Message-ID: <200709071114.l87BEIUZ029739@sheep.berlios.de>

Author: ivop
Date: 2007-09-07 13:14:17 +0200 (Fri, 07 Sep 2007)
New Revision: 69

Modified:
   trunk/cli_main.c
   trunk/gui_callbacks.c
Log:
normlast really the last postproc


Modified: trunk/cli_main.c
===================================================================
--- trunk/cli_main.c	2007-09-07 11:11:44 UTC (rev 68)
+++ trunk/cli_main.c	2007-09-07 11:14:17 UTC (rev 69)
@@ -233,12 +233,12 @@
         hmg_normalize(map, normmin, normmax, w, h);
     if (blur)
         hmg_gaussian_blur(map, tempmap, blurx, blury, blursigma, w, h);
-    if (normlast)
-        hmg_normalize(map, normmin, normmax, w, h);
     if (inv)
         hmg_invert(map, w, h);
     if (clip)
         hmg_clip(map, clipmin, clipmax, w, h);
+    if (normlast)
+        hmg_normalize(map, normmin, normmax, w, h);
 
     if (outfile) {
         fprintf(stderr, "Saving to %s\n", outfile);

Modified: trunk/gui_callbacks.c
===================================================================
--- trunk/gui_callbacks.c	2007-09-07 11:11:44 UTC (rev 68)
+++ trunk/gui_callbacks.c	2007-09-07 11:14:17 UTC (rev 69)
@@ -254,16 +254,14 @@
 
     if (normfirst)
         hmg_normalize(map, normmin, normmax, map_width, map_height);
-
     if (blur)
         hmg_gaussian_blur(map, tempmap, blurx, blury, blursigma, map_width,
                                                                 map_height);
+    if (inv)
+        hmg_invert(map, map_width, map_height);
     if (normlast)
         hmg_normalize(map, normmin, normmax, map_width, map_height);
 
-    if (inv)
-        hmg_invert(map, map_width, map_height);
-
 /* hmmm, some "sidebar" commands may need tempmap, like gaussian blur
  * FIXME increases memory requirements
     if (tempmap)



From ivop at mail.berlios.de  Fri Sep  7 13:19:10 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 7 Sep 2007 13:19:10 +0200
Subject: [Hmgen-svnlog] r70 - trunk
Message-ID: <200709071119.l87BJA42010643@sheep.berlios.de>

Author: ivop
Date: 2007-09-07 13:19:09 +0200 (Fri, 07 Sep 2007)
New Revision: 70

Modified:
   trunk/Makefile
Log:
fairly decent defaults which probably will work for unknown compilers
no deps, but do not fail on make dep either


Modified: trunk/Makefile
===================================================================
--- trunk/Makefile	2007-09-07 11:14:17 UTC (rev 69)
+++ trunk/Makefile	2007-09-07 11:19:09 UTC (rev 70)
@@ -160,6 +160,7 @@
 			CC_VERSION=`echo | $(CC) -E - | grep ident | cut -d ' ' -f 5` ; \
 		else \
 			CC_VENDOR=unknown; \
+			echo CC_DEP=true >> config.mak; \
 		fi ; \
 	fi ; \
 	echo CC_VENDOR=$$CC_VENDOR >> config.mak ; \
@@ -203,6 +204,15 @@
 			OBJ_OUT_FLAG="-o" ; \
 			DONT_LINK_FLAG="-c" ; \
 			;; \
+		unknown) \
+			WARN_FLAGS= ; \
+			OPT_FLAGS="-O" ; \
+			STD_FLAGS= ; \
+			DEBUG_FLAGS="-g" ; \
+			DEP_FLAGS= ; \
+			OBJ_OUT_FLAG="-o" ; \
+			DONT_LINK_FLAG="-c" ; \
+			;; \
 	esac ; \
 	echo WARN_FLAGS=$$WARN_FLAGS >> config.mak ; \
 	echo OPT_FLAGS=$$OPT_FLAGS >> config.mak ; \



From ivop at mail.berlios.de  Fri Sep  7 13:53:42 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 7 Sep 2007 13:53:42 +0200
Subject: [Hmgen-svnlog] r71 - trunk
Message-ID: <200709071153.l87BrgqZ019238@sheep.berlios.de>

Author: ivop
Date: 2007-09-07 13:53:41 +0200 (Fri, 07 Sep 2007)
New Revision: 71

Modified:
   trunk/lib_postproc.c
Log:
use calloc to allocate array of doubles; this is more portable accross compilers


Modified: trunk/lib_postproc.c
===================================================================
--- trunk/lib_postproc.c	2007-09-07 11:19:09 UTC (rev 70)
+++ trunk/lib_postproc.c	2007-09-07 11:53:41 UTC (rev 71)
@@ -40,11 +40,13 @@
                        int blurx, int blury,
                        double blursigma,
                        unsigned int w, unsigned int h) {
-    double mask[blurx*blury];
+    double *mask;
     double cx = 0, cy = 0, r = 0, m = 0, nv;
     int x, y, a, b, v;
     double cr = -1.0/(2.0*blursigma*blursigma);
 
+    mask = calloc(blurx*blury, sizeof(double));
+
     memcpy(tempmap, map, w*h);
 
     for (y=0; y<blury; y++) {
@@ -91,6 +93,7 @@
         }
     }
     progress_meter(-1);
+    free(mask);
 }
 
 



From ivop at mail.berlios.de  Fri Sep  7 17:52:17 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 7 Sep 2007 17:52:17 +0200
Subject: [Hmgen-svnlog] r72 - trunk
Message-ID: <200709071552.l87FqH2x007294@sheep.berlios.de>

Author: ivop
Date: 2007-09-07 17:52:16 +0200 (Fri, 07 Sep 2007)
New Revision: 72

Modified:
   trunk/cli_main.c
   trunk/lib_hmgen.h
   trunk/lib_postproc.c
Log:
postprocessing, cropping


Modified: trunk/cli_main.c
===================================================================
--- trunk/cli_main.c	2007-09-07 11:53:41 UTC (rev 71)
+++ trunk/cli_main.c	2007-09-07 15:52:16 UTC (rev 72)
@@ -20,7 +20,8 @@
 static double blursigma = DEF_BLURSIGMA;
 static int normmin = DEF_NORMMIN, normmax = DEF_NORMMAX,
            normfirst = 0, normlast = 0, inv = 0, clip = 0,
-           clipmin = DEF_CLIPMIN, clipmax = DEF_CLIPMAX;
+           clipmin = DEF_CLIPMIN, clipmax = DEF_CLIPMAX,
+           crop = 0, cropleft = 0, cropright = 0, croptop = 0, cropbottom = 0;
 static unsigned int w, h;
 static char *outfile = NULL;
 static char *colfile = NULL;
@@ -71,6 +72,11 @@
 "-clip          postprocess, clip [default: no]\n"
 "-clipmin INT   clip minimum (0-255) [default: %i]\n"
 "-clipmax INT   clip maximum (0-255) [default: %i]\n"
+"-crop              postprocess, crop [default: no]\n"
+"-cropleft INT      crop left margin (0-..) [default: 0]\n"
+"-cropright INT     crop right margin (0-..) [default: 0]\n"
+"-croptop INT       crop top margin (0-..) [default: 0]\n"
+"-cropbottom INT    crop bottom margin (0-..) [default: 0]\n"
 "\n",
         HMG_VERSION_STRING, HMG_COPYRIGHT_STRING, argv[0],
         DEF_NORMMIN, DEF_NORMMAX,
@@ -148,6 +154,20 @@
         } else if (!strcmp(argv[a], "-clipmax")) {
             if (!test_argument(a, argc, argv)) return 0;
             clipmax = atoi(argv[++a]);
+        } else if (!strcmp(argv[a], "-crop")) {
+            crop = 1;
+        } else if (!strcmp(argv[a], "-cropleft")) {
+            if (!test_argument(a, argc, argv)) return 0;
+            cropleft = atoi(argv[++a]);
+        } else if (!strcmp(argv[a], "-cropright")) {
+            if (!test_argument(a, argc, argv)) return 0;
+            cropright = atoi(argv[++a]);
+        } else if (!strcmp(argv[a], "-croptop")) {
+            if (!test_argument(a, argc, argv)) return 0;
+            croptop = atoi(argv[++a]);
+        } else if (!strcmp(argv[a], "-cropbottom")) {
+            if (!test_argument(a, argc, argv)) return 0;
+            cropbottom = atoi(argv[++a]);
         } else {
             fprintf(stderr, "unknown option: %s\n", argv[a]);
             return 0;
@@ -163,6 +183,7 @@
         fprintf(stderr, "size is smaller than 1 or larger than 16\n");
         return 0;
     }
+    w = h = exp2(size) + 1;
     if (algo<ALGO_FF || algo>=ALGO_LAST) {
         fprintf(stderr, "algo is smaller then %i or larger than %i\n",
                 ALGO_FF, ALGO_LAST-1);
@@ -192,6 +213,14 @@
         fprintf(stderr, "clipmax is larger than 255\n");
         return 0;
     }
+    if ((croptop + cropbottom + 3U) > h) {
+        fprintf(stderr, "vertical cropping beyond width\n");
+        return 0;
+    }
+    if ((cropleft + cropright + 3U) > w) {
+        fprintf(stderr, "horizontal cropping beyond width\n");
+        return 0;
+    }
     return 1;
 }
 
@@ -229,6 +258,8 @@
 
     hmg_algorithms[algo]->func(map, tempmap, w, h);
 
+    if (crop)
+        hmg_crop(map, &w, &h, cropleft, cropright, croptop, cropbottom);
     if (normfirst)
         hmg_normalize(map, normmin, normmax, w, h);
     if (blur)

Modified: trunk/lib_hmgen.h
===================================================================
--- trunk/lib_hmgen.h	2007-09-07 11:53:41 UTC (rev 71)
+++ trunk/lib_hmgen.h	2007-09-07 15:52:16 UTC (rev 72)
@@ -41,6 +41,11 @@
               unsigned int clipmin, unsigned int clipmax,
               unsigned int w, unsigned int h);
 
+void hmg_crop(unsigned char *map,
+              unsigned int *width, unsigned int *height,
+              unsigned int left, unsigned int right,
+              unsigned int top, unsigned int bottom);
+
 extern unsigned char hmg_colormap[256][3];
 
 typedef struct hmg_colormap_settings_s {

Modified: trunk/lib_postproc.c
===================================================================
--- trunk/lib_postproc.c	2007-09-07 11:53:41 UTC (rev 71)
+++ trunk/lib_postproc.c	2007-09-07 15:52:16 UTC (rev 72)
@@ -131,3 +131,28 @@
     }
     progress_meter(-1);
 }
+
+#undef  HMGEN_MODULE
+#define HMGEN_MODULE "Crop"
+
+void hmg_crop(unsigned char *map,
+              unsigned int *width, unsigned int *height,
+              unsigned int left, unsigned int right,
+              unsigned int top, unsigned int bottom) {
+    unsigned int y, w = *width, h = *height;
+    unsigned char *src = map;
+
+    src += left;
+    src += top * w;
+
+    for (y=0; y<(h-top-bottom); y++) {
+        progress_meter((int)round(y*100.0/(h-1-top-bottom)));
+        memcpy(map, src, w-left-right);
+        map += w-left-right;
+        src += w;
+    }
+
+    *width = w-left-right;
+    *height = h-top-bottom;
+    progress_meter(-1);
+}



From ivop at mail.berlios.de  Fri Sep  7 18:04:01 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 7 Sep 2007 18:04:01 +0200
Subject: [Hmgen-svnlog] r73 - trunk
Message-ID: <200709071604.l87G412W008134@sheep.berlios.de>

Author: ivop
Date: 2007-09-07 18:04:01 +0200 (Fri, 07 Sep 2007)
New Revision: 73

Modified:
   trunk/cli_main.c
   trunk/lib_hmgen.h
   trunk/lib_postproc.c
Log:
realloc after crop, saves memory


Modified: trunk/cli_main.c
===================================================================
--- trunk/cli_main.c	2007-09-07 15:52:16 UTC (rev 72)
+++ trunk/cli_main.c	2007-09-07 16:04:01 UTC (rev 73)
@@ -259,7 +259,7 @@
     hmg_algorithms[algo]->func(map, tempmap, w, h);
 
     if (crop)
-        hmg_crop(map, &w, &h, cropleft, cropright, croptop, cropbottom);
+        hmg_crop(&map, &w, &h, cropleft, cropright, croptop, cropbottom);
     if (normfirst)
         hmg_normalize(map, normmin, normmax, w, h);
     if (blur)

Modified: trunk/lib_hmgen.h
===================================================================
--- trunk/lib_hmgen.h	2007-09-07 15:52:16 UTC (rev 72)
+++ trunk/lib_hmgen.h	2007-09-07 16:04:01 UTC (rev 73)
@@ -41,7 +41,8 @@
               unsigned int clipmin, unsigned int clipmax,
               unsigned int w, unsigned int h);
 
-void hmg_crop(unsigned char *map,
+/* the pointer pmap points to MUST be previously allocated with *alloc */
+void hmg_crop(unsigned char **pmap,
               unsigned int *width, unsigned int *height,
               unsigned int left, unsigned int right,
               unsigned int top, unsigned int bottom);

Modified: trunk/lib_postproc.c
===================================================================
--- trunk/lib_postproc.c	2007-09-07 15:52:16 UTC (rev 72)
+++ trunk/lib_postproc.c	2007-09-07 16:04:01 UTC (rev 73)
@@ -135,12 +135,12 @@
 #undef  HMGEN_MODULE
 #define HMGEN_MODULE "Crop"
 
-void hmg_crop(unsigned char *map,
+void hmg_crop(unsigned char **pmap,
               unsigned int *width, unsigned int *height,
               unsigned int left, unsigned int right,
               unsigned int top, unsigned int bottom) {
     unsigned int y, w = *width, h = *height;
-    unsigned char *src = map;
+    unsigned char *map = *pmap, *src = map;
 
     src += left;
     src += top * w;
@@ -154,5 +154,6 @@
 
     *width = w-left-right;
     *height = h-top-bottom;
+    *pmap = realloc(*pmap, *width * *height);
     progress_meter(-1);
 }



From ivop at mail.berlios.de  Fri Sep  7 18:10:34 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 7 Sep 2007 18:10:34 +0200
Subject: [Hmgen-svnlog] r74 - trunk
Message-ID: <200709071610.l87GAYlM008696@sheep.berlios.de>

Author: ivop
Date: 2007-09-07 18:10:34 +0200 (Fri, 07 Sep 2007)
New Revision: 74

Modified:
   trunk/cli_main.c
Log:
cosmetics, indentation


Modified: trunk/cli_main.c
===================================================================
--- trunk/cli_main.c	2007-09-07 16:04:01 UTC (rev 73)
+++ trunk/cli_main.c	2007-09-07 16:10:34 UTC (rev 74)
@@ -34,44 +34,44 @@
     fprintf(stderr,
 "\nHeight Map Generator - %s - %s\n\n"
 "usage: %s [options]\n\n"
-"-s INT         size, 2^VAL+1 [default: 8]\n"
-"-o FILE        output heightmap to PGM file\n"
-"-ppm FILE      output colorized version to PPM file\n"
-"-bmp FILE      output map to BMP file\n"
-"-p STRING      algorithm parameters (param:param:param...)\n"
-"-a INT         algorithm [default: 0]\n"
-"                   0 - Fault Formation\n"
-"                       seed=INT        random seed\n"
-"                       init=INT        initial height (0-255)\n"
-"                       n=INT           number of tectonic plates\n"
-"                       up=INT          move up factor\n"
-"                       down=INT        move down factor\n"
-"                   1 - Midpoint Displacement (plasma)\n"
-"                       seed=INT        random seed\n"
-"                       tl=INT          top-left initial height\n"
-"                       tr=INT          top-right initial height\n"
-"                       bl=INT          bottom-left initial height\n"
-"                       br=INT          bottom-right initial height\n"
-"                       d=INT           initial displacement\n"
-"                       r=FLOAT         roughness factor\n"
-"                   2 - ppmforge/gforge Algorithm\n"
-"                       seed=INT        random seed\n"
-"                       fracdim=FLOAT   fractal dimension\n"
-"                       powscale=FLOAT  power scale\n"
+"-s INT             size, 2^VAL+1 [default: 8]\n"
+"-o FILE            output heightmap to PGM file\n"
+"-ppm FILE          output colorized version to PPM file\n"
+"-bmp FILE          output map to BMP file\n"
+"-p STRING          algorithm parameters (param:param:param...)\n"
+"-a INT             algorithm [default: 0]\n"
+"                       0 - Fault Formation\n"
+"                           seed=INT        random seed\n"
+"                           init=INT        initial height (0-255)\n"
+"                           n=INT           number of tectonic plates\n"
+"                           up=INT          move up factor\n"
+"                           down=INT        move down factor\n"
+"                       1 - Midpoint Displacement (plasma)\n"
+"                           seed=INT        random seed\n"
+"                           tl=INT          top-left initial height\n"
+"                           tr=INT          top-right initial height\n"
+"                           bl=INT          bottom-left initial height\n"
+"                           br=INT          bottom-right initial height\n"
+"                           d=INT           initial displacement\n"
+"                           r=FLOAT         roughness factor\n"
+"                       2 - ppmforge/gforge Algorithm\n"
+"                           seed=INT        random seed\n"
+"                           fracdim=FLOAT   fractal dimension\n"
+"                           powscale=FLOAT  power scale\n"
 "\n"
-"-nf            postprocess, normalize first [default: no]\n"
-"-nl            postprocess, normalize last [default: no]\n"
-"-nmin INT      normalize minimum (0-255) [default: %i]\n"
-"-nmax INT      normalize maximum (0-255) [default: %i]\n"
-"-b             postprocess, gaussian blur [default: no]\n"
-"-bx INT        blur x-radius [default: %i]\n"
-"-by INT        blur y-radius [default: %i]\n"
-"-bxy INT       blur xy-radius\n"
-"-bs FLOAT      blur sigma [default: %0.2f]\n"
-"-i             postprocess, invert heightmap [default: no]\n"
-"-clip          postprocess, clip [default: no]\n"
-"-clipmin INT   clip minimum (0-255) [default: %i]\n"
-"-clipmax INT   clip maximum (0-255) [default: %i]\n"
+"-nf                postprocess, normalize first [default: no]\n"
+"-nl                postprocess, normalize last [default: no]\n"
+"-nmin INT          normalize minimum (0-255) [default: %i]\n"
+"-nmax INT          normalize maximum (0-255) [default: %i]\n"
+"-b                 postprocess, gaussian blur [default: no]\n"
+"-bx INT            blur x-radius [default: %i]\n"
+"-by INT            blur y-radius [default: %i]\n"
+"-bxy INT           blur xy-radius\n"
+"-bs FLOAT          blur sigma [default: %0.2f]\n"
+"-i                 postprocess, invert heightmap [default: no]\n"
+"-clip              postprocess, clip [default: no]\n"
+"-clipmin INT       clip minimum (0-255) [default: %i]\n"
+"-clipmax INT       clip maximum (0-255) [default: %i]\n"
 "-crop              postprocess, crop [default: no]\n"
 "-cropleft INT      crop left margin (0-..) [default: 0]\n"
 "-cropright INT     crop right margin (0-..) [default: 0]\n"



From ivop at mail.berlios.de  Fri Sep  7 22:48:20 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 7 Sep 2007 22:48:20 +0200
Subject: [Hmgen-svnlog] r75 - in trunk: . assist
Message-ID: <200709072048.l87KmKQo004860@sheep.berlios.de>

Author: ivop
Date: 2007-09-07 22:48:18 +0200 (Fri, 07 Sep 2007)
New Revision: 75

Modified:
   trunk/assist/hmgengui.glade
   trunk/gui_callbacks.c
   trunk/gui_callbacks.h
   trunk/gui_interface.c
Log:
add GUI parts of crop and clip (not connected to libhmgen yet)


Modified: trunk/assist/hmgengui.glade
===================================================================
--- trunk/assist/hmgengui.glade	2007-09-07 16:10:34 UTC (rev 74)
+++ trunk/assist/hmgengui.glade	2007-09-07 20:48:18 UTC (rev 75)
@@ -707,6 +707,424 @@
 		      <property name="type">tab</property>
 		    </packing>
 		  </child>
+
+		  <child>
+		    <widget class="GtkTable" id="table18">
+		      <property name="border_width">8</property>
+		      <property name="visible">True</property>
+		      <property name="n_rows">4</property>
+		      <property name="n_columns">3</property>
+		      <property name="homogeneous">False</property>
+		      <property name="row_spacing">8</property>
+		      <property name="column_spacing">8</property>
+
+		      <child>
+			<widget class="GtkLabel" id="label59">
+			  <property name="visible">True</property>
+			  <property name="label" translatable="yes">Minimum</property>
+			  <property name="use_underline">False</property>
+			  <property name="use_markup">False</property>
+			  <property name="justify">GTK_JUSTIFY_LEFT</property>
+			  <property name="wrap">False</property>
+			  <property name="selectable">False</property>
+			  <property name="xalign">0</property>
+			  <property name="yalign">0.5</property>
+			  <property name="xpad">0</property>
+			  <property name="ypad">0</property>
+			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			  <property name="width_chars">-1</property>
+			  <property name="single_line_mode">False</property>
+			  <property name="angle">0</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">0</property>
+			  <property name="right_attach">1</property>
+			  <property name="top_attach">0</property>
+			  <property name="bottom_attach">1</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options"></property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkLabel" id="label60">
+			  <property name="visible">True</property>
+			  <property name="label" translatable="yes">Maximum</property>
+			  <property name="use_underline">False</property>
+			  <property name="use_markup">False</property>
+			  <property name="justify">GTK_JUSTIFY_LEFT</property>
+			  <property name="wrap">False</property>
+			  <property name="selectable">False</property>
+			  <property name="xalign">0</property>
+			  <property name="yalign">0.5</property>
+			  <property name="xpad">0</property>
+			  <property name="ypad">0</property>
+			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			  <property name="width_chars">-1</property>
+			  <property name="single_line_mode">False</property>
+			  <property name="angle">0</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">0</property>
+			  <property name="right_attach">1</property>
+			  <property name="top_attach">1</property>
+			  <property name="bottom_attach">2</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options"></property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkSpinButton" id="clip2_min_spinbutton">
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="climb_rate">1</property>
+			  <property name="digits">0</property>
+			  <property name="numeric">False</property>
+			  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			  <property name="snap_to_ticks">False</property>
+			  <property name="wrap">False</property>
+			  <property name="adjustment">0 0 255 1 10 10</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">1</property>
+			  <property name="right_attach">2</property>
+			  <property name="top_attach">0</property>
+			  <property name="bottom_attach">1</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options"></property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkSpinButton" id="clip2_max_spinbutton">
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="climb_rate">1</property>
+			  <property name="digits">0</property>
+			  <property name="numeric">False</property>
+			  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			  <property name="snap_to_ticks">False</property>
+			  <property name="wrap">False</property>
+			  <property name="adjustment">255 0 255 1 10 10</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">1</property>
+			  <property name="right_attach">2</property>
+			  <property name="top_attach">1</property>
+			  <property name="bottom_attach">2</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options"></property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkButton" id="clip_button">
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="label" translatable="yes">Clip</property>
+			  <property name="use_underline">True</property>
+			  <property name="relief">GTK_RELIEF_NORMAL</property>
+			  <property name="focus_on_click">True</property>
+			  <signal name="clicked" handler="on_clip_button_clicked" last_modification_time="Fri, 07 Sep 2007 18:32:15 GMT"/>
+			</widget>
+			<packing>
+			  <property name="left_attach">1</property>
+			  <property name="right_attach">2</property>
+			  <property name="top_attach">2</property>
+			  <property name="bottom_attach">3</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options"></property>
+			</packing>
+		      </child>
+		    </widget>
+		    <packing>
+		      <property name="tab_expand">False</property>
+		      <property name="tab_fill">True</property>
+		    </packing>
+		  </child>
+
+		  <child>
+		    <widget class="GtkLabel" id="label55">
+		      <property name="visible">True</property>
+		      <property name="label" translatable="yes">Clip</property>
+		      <property name="use_underline">False</property>
+		      <property name="use_markup">False</property>
+		      <property name="justify">GTK_JUSTIFY_LEFT</property>
+		      <property name="wrap">False</property>
+		      <property name="selectable">False</property>
+		      <property name="xalign">0.5</property>
+		      <property name="yalign">0.5</property>
+		      <property name="xpad">0</property>
+		      <property name="ypad">0</property>
+		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+		      <property name="width_chars">-1</property>
+		      <property name="single_line_mode">False</property>
+		      <property name="angle">0</property>
+		    </widget>
+		    <packing>
+		      <property name="type">tab</property>
+		    </packing>
+		  </child>
+
+		  <child>
+		    <widget class="GtkTable" id="table19">
+		      <property name="border_width">8</property>
+		      <property name="visible">True</property>
+		      <property name="n_rows">6</property>
+		      <property name="n_columns">3</property>
+		      <property name="homogeneous">False</property>
+		      <property name="row_spacing">8</property>
+		      <property name="column_spacing">8</property>
+
+		      <child>
+			<widget class="GtkLabel" id="label65">
+			  <property name="visible">True</property>
+			  <property name="label" translatable="yes">Left</property>
+			  <property name="use_underline">False</property>
+			  <property name="use_markup">False</property>
+			  <property name="justify">GTK_JUSTIFY_LEFT</property>
+			  <property name="wrap">False</property>
+			  <property name="selectable">False</property>
+			  <property name="xalign">0</property>
+			  <property name="yalign">0.5</property>
+			  <property name="xpad">0</property>
+			  <property name="ypad">0</property>
+			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			  <property name="width_chars">-1</property>
+			  <property name="single_line_mode">False</property>
+			  <property name="angle">0</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">0</property>
+			  <property name="right_attach">1</property>
+			  <property name="top_attach">0</property>
+			  <property name="bottom_attach">1</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options"></property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkLabel" id="label66">
+			  <property name="visible">True</property>
+			  <property name="label" translatable="yes">Right</property>
+			  <property name="use_underline">False</property>
+			  <property name="use_markup">False</property>
+			  <property name="justify">GTK_JUSTIFY_LEFT</property>
+			  <property name="wrap">False</property>
+			  <property name="selectable">False</property>
+			  <property name="xalign">0</property>
+			  <property name="yalign">0.5</property>
+			  <property name="xpad">0</property>
+			  <property name="ypad">0</property>
+			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			  <property name="width_chars">-1</property>
+			  <property name="single_line_mode">False</property>
+			  <property name="angle">0</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">0</property>
+			  <property name="right_attach">1</property>
+			  <property name="top_attach">1</property>
+			  <property name="bottom_attach">2</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options"></property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkLabel" id="label67">
+			  <property name="visible">True</property>
+			  <property name="label" translatable="yes">Top</property>
+			  <property name="use_underline">False</property>
+			  <property name="use_markup">False</property>
+			  <property name="justify">GTK_JUSTIFY_LEFT</property>
+			  <property name="wrap">False</property>
+			  <property name="selectable">False</property>
+			  <property name="xalign">0</property>
+			  <property name="yalign">0.5</property>
+			  <property name="xpad">0</property>
+			  <property name="ypad">0</property>
+			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			  <property name="width_chars">-1</property>
+			  <property name="single_line_mode">False</property>
+			  <property name="angle">0</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">0</property>
+			  <property name="right_attach">1</property>
+			  <property name="top_attach">2</property>
+			  <property name="bottom_attach">3</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options"></property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkLabel" id="label68">
+			  <property name="visible">True</property>
+			  <property name="label" translatable="yes">Bottom</property>
+			  <property name="use_underline">False</property>
+			  <property name="use_markup">False</property>
+			  <property name="justify">GTK_JUSTIFY_LEFT</property>
+			  <property name="wrap">False</property>
+			  <property name="selectable">False</property>
+			  <property name="xalign">0</property>
+			  <property name="yalign">0.5</property>
+			  <property name="xpad">0</property>
+			  <property name="ypad">0</property>
+			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			  <property name="width_chars">-1</property>
+			  <property name="single_line_mode">False</property>
+			  <property name="angle">0</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">0</property>
+			  <property name="right_attach">1</property>
+			  <property name="top_attach">3</property>
+			  <property name="bottom_attach">4</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options"></property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkSpinButton" id="crop2_left_spinbutton">
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="climb_rate">1</property>
+			  <property name="digits">0</property>
+			  <property name="numeric">False</property>
+			  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			  <property name="snap_to_ticks">False</property>
+			  <property name="wrap">False</property>
+			  <property name="adjustment">0 0 65536 1 10 10</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">1</property>
+			  <property name="right_attach">2</property>
+			  <property name="top_attach">0</property>
+			  <property name="bottom_attach">1</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options"></property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkSpinButton" id="crop2_right_spinbutton">
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="climb_rate">1</property>
+			  <property name="digits">0</property>
+			  <property name="numeric">False</property>
+			  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			  <property name="snap_to_ticks">False</property>
+			  <property name="wrap">False</property>
+			  <property name="adjustment">0 0 65536 1 10 10</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">1</property>
+			  <property name="right_attach">2</property>
+			  <property name="top_attach">1</property>
+			  <property name="bottom_attach">2</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options"></property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkSpinButton" id="crop2_top_spinbutton">
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="climb_rate">1</property>
+			  <property name="digits">0</property>
+			  <property name="numeric">False</property>
+			  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			  <property name="snap_to_ticks">False</property>
+			  <property name="wrap">False</property>
+			  <property name="adjustment">0 0 65536 1 10 10</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">1</property>
+			  <property name="right_attach">2</property>
+			  <property name="top_attach">2</property>
+			  <property name="bottom_attach">3</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options"></property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkSpinButton" id="crop2_bottom_spinbutton">
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="climb_rate">1</property>
+			  <property name="digits">0</property>
+			  <property name="numeric">False</property>
+			  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			  <property name="snap_to_ticks">False</property>
+			  <property name="wrap">False</property>
+			  <property name="adjustment">0 0 65536 1 10 10</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">1</property>
+			  <property name="right_attach">2</property>
+			  <property name="top_attach">3</property>
+			  <property name="bottom_attach">4</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options"></property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkButton" id="crop_button">
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="label" translatable="yes">Crop</property>
+			  <property name="use_underline">True</property>
+			  <property name="relief">GTK_RELIEF_NORMAL</property>
+			  <property name="focus_on_click">True</property>
+			  <signal name="clicked" handler="on_crop_button_clicked" last_modification_time="Fri, 07 Sep 2007 18:32:28 GMT"/>
+			</widget>
+			<packing>
+			  <property name="left_attach">1</property>
+			  <property name="right_attach">2</property>
+			  <property name="top_attach">4</property>
+			  <property name="bottom_attach">5</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options"></property>
+			</packing>
+		      </child>
+		    </widget>
+		    <packing>
+		      <property name="tab_expand">False</property>
+		      <property name="tab_fill">True</property>
+		    </packing>
+		  </child>
+
+		  <child>
+		    <widget class="GtkLabel" id="label54">
+		      <property name="visible">True</property>
+		      <property name="label" translatable="yes">Crop</property>
+		      <property name="use_underline">False</property>
+		      <property name="use_markup">False</property>
+		      <property name="justify">GTK_JUSTIFY_LEFT</property>
+		      <property name="wrap">False</property>
+		      <property name="selectable">False</property>
+		      <property name="xalign">0.5</property>
+		      <property name="yalign">0.5</property>
+		      <property name="xpad">0</property>
+		      <property name="ypad">0</property>
+		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+		      <property name="width_chars">-1</property>
+		      <property name="single_line_mode">False</property>
+		      <property name="angle">0</property>
+		    </widget>
+		    <packing>
+		      <property name="type">tab</property>
+		    </packing>
+		  </child>
 		</widget>
 		<packing>
 		  <property name="padding">0</property>
@@ -992,6 +1410,245 @@
 			  <property name="enable_popup">False</property>
 
 			  <child>
+			    <widget class="GtkTable" id="table17">
+			      <property name="border_width">8</property>
+			      <property name="visible">True</property>
+			      <property name="n_rows">5</property>
+			      <property name="n_columns">3</property>
+			      <property name="homogeneous">False</property>
+			      <property name="row_spacing">8</property>
+			      <property name="column_spacing">8</property>
+
+			      <child>
+				<widget class="GtkLabel" id="label61">
+				  <property name="visible">True</property>
+				  <property name="label" translatable="yes">Left</property>
+				  <property name="use_underline">False</property>
+				  <property name="use_markup">False</property>
+				  <property name="justify">GTK_JUSTIFY_LEFT</property>
+				  <property name="wrap">False</property>
+				  <property name="selectable">False</property>
+				  <property name="xalign">0</property>
+				  <property name="yalign">0.5</property>
+				  <property name="xpad">0</property>
+				  <property name="ypad">0</property>
+				  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+				  <property name="width_chars">-1</property>
+				  <property name="single_line_mode">False</property>
+				  <property name="angle">0</property>
+				</widget>
+				<packing>
+				  <property name="left_attach">0</property>
+				  <property name="right_attach">1</property>
+				  <property name="top_attach">0</property>
+				  <property name="bottom_attach">1</property>
+				  <property name="x_options">fill</property>
+				  <property name="y_options"></property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkLabel" id="label62">
+				  <property name="visible">True</property>
+				  <property name="label" translatable="yes">Right</property>
+				  <property name="use_underline">False</property>
+				  <property name="use_markup">False</property>
+				  <property name="justify">GTK_JUSTIFY_LEFT</property>
+				  <property name="wrap">False</property>
+				  <property name="selectable">False</property>
+				  <property name="xalign">0</property>
+				  <property name="yalign">0.5</property>
+				  <property name="xpad">0</property>
+				  <property name="ypad">0</property>
+				  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+				  <property name="width_chars">-1</property>
+				  <property name="single_line_mode">False</property>
+				  <property name="angle">0</property>
+				</widget>
+				<packing>
+				  <property name="left_attach">0</property>
+				  <property name="right_attach">1</property>
+				  <property name="top_attach">1</property>
+				  <property name="bottom_attach">2</property>
+				  <property name="x_options">fill</property>
+				  <property name="y_options"></property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkLabel" id="label63">
+				  <property name="visible">True</property>
+				  <property name="label" translatable="yes">Top</property>
+				  <property name="use_underline">False</property>
+				  <property name="use_markup">False</property>
+				  <property name="justify">GTK_JUSTIFY_LEFT</property>
+				  <property name="wrap">False</property>
+				  <property name="selectable">False</property>
+				  <property name="xalign">0</property>
+				  <property name="yalign">0.5</property>
+				  <property name="xpad">0</property>
+				  <property name="ypad">0</property>
+				  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+				  <property name="width_chars">-1</property>
+				  <property name="single_line_mode">False</property>
+				  <property name="angle">0</property>
+				</widget>
+				<packing>
+				  <property name="left_attach">0</property>
+				  <property name="right_attach">1</property>
+				  <property name="top_attach">2</property>
+				  <property name="bottom_attach">3</property>
+				  <property name="x_options">fill</property>
+				  <property name="y_options"></property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkLabel" id="label64">
+				  <property name="visible">True</property>
+				  <property name="label" translatable="yes">Bottom</property>
+				  <property name="use_underline">False</property>
+				  <property name="use_markup">False</property>
+				  <property name="justify">GTK_JUSTIFY_LEFT</property>
+				  <property name="wrap">False</property>
+				  <property name="selectable">False</property>
+				  <property name="xalign">0</property>
+				  <property name="yalign">0.5</property>
+				  <property name="xpad">0</property>
+				  <property name="ypad">0</property>
+				  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+				  <property name="width_chars">-1</property>
+				  <property name="single_line_mode">False</property>
+				  <property name="angle">0</property>
+				</widget>
+				<packing>
+				  <property name="left_attach">0</property>
+				  <property name="right_attach">1</property>
+				  <property name="top_attach">3</property>
+				  <property name="bottom_attach">4</property>
+				  <property name="x_options">fill</property>
+				  <property name="y_options"></property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkSpinButton" id="crop_left_spinbutton">
+				  <property name="visible">True</property>
+				  <property name="can_focus">True</property>
+				  <property name="climb_rate">1</property>
+				  <property name="digits">0</property>
+				  <property name="numeric">False</property>
+				  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+				  <property name="snap_to_ticks">False</property>
+				  <property name="wrap">False</property>
+				  <property name="adjustment">0 0 65536 1 10 10</property>
+				</widget>
+				<packing>
+				  <property name="left_attach">1</property>
+				  <property name="right_attach">2</property>
+				  <property name="top_attach">0</property>
+				  <property name="bottom_attach">1</property>
+				  <property name="x_options">fill</property>
+				  <property name="y_options"></property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkSpinButton" id="crop_right_spinbutton">
+				  <property name="visible">True</property>
+				  <property name="can_focus">True</property>
+				  <property name="climb_rate">1</property>
+				  <property name="digits">0</property>
+				  <property name="numeric">False</property>
+				  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+				  <property name="snap_to_ticks">False</property>
+				  <property name="wrap">False</property>
+				  <property name="adjustment">0 0 65536 1 10 10</property>
+				</widget>
+				<packing>
+				  <property name="left_attach">1</property>
+				  <property name="right_attach">2</property>
+				  <property name="top_attach">1</property>
+				  <property name="bottom_attach">2</property>
+				  <property name="x_options">fill</property>
+				  <property name="y_options"></property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkSpinButton" id="crop_top_spinbutton">
+				  <property name="visible">True</property>
+				  <property name="can_focus">True</property>
+				  <property name="climb_rate">1</property>
+				  <property name="digits">0</property>
+				  <property name="numeric">False</property>
+				  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+				  <property name="snap_to_ticks">False</property>
+				  <property name="wrap">False</property>
+				  <property name="adjustment">0 0 65536 1 10 10</property>
+				</widget>
+				<packing>
+				  <property name="left_attach">1</property>
+				  <property name="right_attach">2</property>
+				  <property name="top_attach">2</property>
+				  <property name="bottom_attach">3</property>
+				  <property name="x_options">fill</property>
+				  <property name="y_options"></property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkSpinButton" id="crop_bottom_spinbutton">
+				  <property name="visible">True</property>
+				  <property name="can_focus">True</property>
+				  <property name="climb_rate">1</property>
+				  <property name="digits">0</property>
+				  <property name="numeric">False</property>
+				  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+				  <property name="snap_to_ticks">False</property>
+				  <property name="wrap">False</property>
+				  <property name="adjustment">0 0 65536 1 10 10</property>
+				</widget>
+				<packing>
+				  <property name="left_attach">1</property>
+				  <property name="right_attach">2</property>
+				  <property name="top_attach">3</property>
+				  <property name="bottom_attach">4</property>
+				  <property name="x_options">fill</property>
+				  <property name="y_options"></property>
+				</packing>
+			      </child>
+			    </widget>
+			    <packing>
+			      <property name="tab_expand">False</property>
+			      <property name="tab_fill">True</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkLabel" id="label52">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">Crop</property>
+			      <property name="use_underline">False</property>
+			      <property name="use_markup">False</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="type">tab</property>
+			    </packing>
+			  </child>
+
+			  <child>
 			    <widget class="GtkTable" id="table7">
 			      <property name="border_width">8</property>
 			      <property name="visible">True</property>
@@ -1467,6 +2124,145 @@
 			      <property name="type">tab</property>
 			    </packing>
 			  </child>
+
+			  <child>
+			    <widget class="GtkTable" id="table16">
+			      <property name="border_width">8</property>
+			      <property name="visible">True</property>
+			      <property name="n_rows">3</property>
+			      <property name="n_columns">3</property>
+			      <property name="homogeneous">False</property>
+			      <property name="row_spacing">8</property>
+			      <property name="column_spacing">8</property>
+
+			      <child>
+				<widget class="GtkLabel" id="label56">
+				  <property name="visible">True</property>
+				  <property name="label" translatable="yes">Minimum</property>
+				  <property name="use_underline">False</property>
+				  <property name="use_markup">False</property>
+				  <property name="justify">GTK_JUSTIFY_LEFT</property>
+				  <property name="wrap">False</property>
+				  <property name="selectable">False</property>
+				  <property name="xalign">0</property>
+				  <property name="yalign">0.5</property>
+				  <property name="xpad">0</property>
+				  <property name="ypad">0</property>
+				  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+				  <property name="width_chars">-1</property>
+				  <property name="single_line_mode">False</property>
+				  <property name="angle">0</property>
+				</widget>
+				<packing>
+				  <property name="left_attach">0</property>
+				  <property name="right_attach">1</property>
+				  <property name="top_attach">0</property>
+				  <property name="bottom_attach">1</property>
+				  <property name="x_options">fill</property>
+				  <property name="y_options"></property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkLabel" id="label57">
+				  <property name="visible">True</property>
+				  <property name="label" translatable="yes">Maximum</property>
+				  <property name="use_underline">False</property>
+				  <property name="use_markup">False</property>
+				  <property name="justify">GTK_JUSTIFY_LEFT</property>
+				  <property name="wrap">False</property>
+				  <property name="selectable">False</property>
+				  <property name="xalign">0</property>
+				  <property name="yalign">0.5</property>
+				  <property name="xpad">0</property>
+				  <property name="ypad">0</property>
+				  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+				  <property name="width_chars">-1</property>
+				  <property name="single_line_mode">False</property>
+				  <property name="angle">0</property>
+				</widget>
+				<packing>
+				  <property name="left_attach">0</property>
+				  <property name="right_attach">1</property>
+				  <property name="top_attach">1</property>
+				  <property name="bottom_attach">2</property>
+				  <property name="x_options">fill</property>
+				  <property name="y_options"></property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkSpinButton" id="clip_min_spinbutton">
+				  <property name="visible">True</property>
+				  <property name="can_focus">True</property>
+				  <property name="climb_rate">1</property>
+				  <property name="digits">0</property>
+				  <property name="numeric">False</property>
+				  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+				  <property name="snap_to_ticks">False</property>
+				  <property name="wrap">False</property>
+				  <property name="adjustment">0 0 255 1 10 10</property>
+				</widget>
+				<packing>
+				  <property name="left_attach">1</property>
+				  <property name="right_attach">2</property>
+				  <property name="top_attach">0</property>
+				  <property name="bottom_attach">1</property>
+				  <property name="x_options">fill</property>
+				  <property name="y_options"></property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkSpinButton" id="clip_max_spinbutton">
+				  <property name="visible">True</property>
+				  <property name="can_focus">True</property>
+				  <property name="climb_rate">1</property>
+				  <property name="digits">0</property>
+				  <property name="numeric">False</property>
+				  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+				  <property name="snap_to_ticks">False</property>
+				  <property name="wrap">False</property>
+				  <property name="adjustment">255 0 255 1 10 10</property>
+				</widget>
+				<packing>
+				  <property name="left_attach">1</property>
+				  <property name="right_attach">2</property>
+				  <property name="top_attach">1</property>
+				  <property name="bottom_attach">2</property>
+				  <property name="x_options">fill</property>
+				  <property name="y_options"></property>
+				</packing>
+			      </child>
+			    </widget>
+			    <packing>
+			      <property name="tab_expand">False</property>
+			      <property name="tab_fill">True</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkLabel" id="label53">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">Clip</property>
+			      <property name="use_underline">False</property>
+			      <property name="use_markup">False</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="type">tab</property>
+			    </packing>
+			  </child>
 			</widget>
 		      </child>
 		    </widget>

Modified: trunk/gui_callbacks.c
===================================================================
--- trunk/gui_callbacks.c	2007-09-07 16:10:34 UTC (rev 74)
+++ trunk/gui_callbacks.c	2007-09-07 20:48:18 UTC (rev 75)
@@ -626,3 +626,11 @@
     deactivate_main_notebook(button);
     g_thread_create(export_thread, button, FALSE, NULL);
 }
+
+void on_clip_button_clicked(GtkButton *button,
+                                   gpointer user_data HMG_ATTR_UNUSED) {
+}
+
+void on_crop_button_clicked(GtkButton *button,
+                                   gpointer user_data HMG_ATTR_UNUSED) {
+}

Modified: trunk/gui_callbacks.h
===================================================================
--- trunk/gui_callbacks.h	2007-09-07 16:10:34 UTC (rev 74)
+++ trunk/gui_callbacks.h	2007-09-07 20:48:18 UTC (rev 75)
@@ -12,6 +12,8 @@
 void on_norm2_button_clicked      (GtkButton *button, gpointer user_data);
 void on_blur2_button_clicked      (GtkButton *button, gpointer user_data);
 void on_invert2_button_clicked    (GtkButton *button, gpointer user_data);
+void on_clip_button_clicked       (GtkButton *button, gpointer user_data);
+void on_crop_button_clicked       (GtkButton *button, gpointer user_data);
 void on_export_save_button_clicked(GtkButton *button, gpointer user_data);
 void on_colormap_update_button_clicked(GtkButton *button, gpointer user_data);
 void on_colormap_redraw_2dview_button_clicked(GtkButton *button,

Modified: trunk/gui_interface.c
===================================================================
--- trunk/gui_interface.c	2007-09-07 16:10:34 UTC (rev 74)
+++ trunk/gui_interface.c	2007-09-07 20:48:18 UTC (rev 75)
@@ -61,6 +61,15 @@
   GtkWidget *colormap_update_button, *colormap_redraw_2dview_button;
   GtkWidget *hpaned1, *hbox8, *label50, *export_format_combobox;
   GtkWidget *export_save_button, *export_filechooserwidget, *label51;
+  GtkWidget *table18, *label59, *label60, *clip2_min_spinbutton;
+  GtkWidget *clip2_max_spinbutton, *clip_button, *label55, *table19;
+  GtkWidget *label65, *label66, *label67, *label68, *crop2_left_spinbutton;
+  GtkWidget *crop2_right_spinbutton, *crop2_top_spinbutton;
+  GtkWidget *crop2_bottom_spinbutton, *crop_button, *label54, *table17;
+  GtkWidget *label61, *label62, *label63, *label64, *crop_left_spinbutton;
+  GtkWidget *crop_right_spinbutton, *crop_top_spinbutton;
+  GtkWidget *crop_bottom_spinbutton, *label52, *table16, *label56, *label57;
+  GtkWidget *clip_min_spinbutton, *clip_max_spinbutton, *label53;
 
   GtkObject *norm_min_spinbutton_adj, *norm_max_spinbutton_adj;
   GtkObject *blur_sigma_spinbutton_adj, *blur_yradius_spinbutton_adj;
@@ -76,6 +85,12 @@
   GtkObject *new_level_spinbutton_adj, *norm2_min_spinbutton_adj;
   GtkObject *norm2_max_spinbutton_adj, *blur2_xrad_spinbutton_adj;
   GtkObject *blur2_yrad_spinbutton_adj, *blur2_sigma_spinbutton_adj;
+  GtkObject *clip2_min_spinbutton_adj, *clip2_max_spinbutton_adj;
+  GtkObject *crop2_left_spinbutton_adj, *crop2_right_spinbutton_adj;
+  GtkObject *crop2_top_spinbutton_adj, *crop2_bottom_spinbutton_adj;
+  GtkObject *crop_left_spinbutton_adj, *crop_right_spinbutton_adj;
+  GtkObject *crop_top_spinbutton_adj, *crop_bottom_spinbutton_adj;
+  GtkObject *clip_min_spinbutton_adj, *clip_max_spinbutton_adj;
 
   hmgengui = gtk_window_new (GTK_WINDOW_TOPLEVEL);
 //  gtk_widget_set_size_request (hmgengui, 800, -1);
@@ -287,6 +302,123 @@
   gtk_widget_show (label38);
   gtk_notebook_set_tab_label (GTK_NOTEBOOK (view_sidepanel_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (view_sidepanel_notebook), 3), label38);
 
+  table18 = gtk_table_new (4, 3, FALSE);
+  gtk_widget_show (table18);
+  gtk_container_add (GTK_CONTAINER (view_sidepanel_notebook), table18);
+  gtk_container_set_border_width (GTK_CONTAINER (table18), 8);
+  gtk_table_set_row_spacings (GTK_TABLE (table18), 8);
+  gtk_table_set_col_spacings (GTK_TABLE (table18), 8);
+
+  label59 = gtk_label_new ("Minimum");
+  gtk_widget_show (label59);
+  gtk_table_attach (GTK_TABLE (table18), label59, 0, 1, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_misc_set_alignment (GTK_MISC (label59), 0, 0.5);
+
+  label60 = gtk_label_new ("Maximum");
+  gtk_widget_show (label60);
+  gtk_table_attach (GTK_TABLE (table18), label60, 0, 1, 1, 2,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_misc_set_alignment (GTK_MISC (label60), 0, 0.5);
+
+  clip2_min_spinbutton_adj = gtk_adjustment_new (0, 0, 255, 1, 10, 10);
+  clip2_min_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (clip2_min_spinbutton_adj), 1, 0);
+  gtk_widget_show (clip2_min_spinbutton);
+  gtk_table_attach (GTK_TABLE (table18), clip2_min_spinbutton, 1, 2, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  clip2_max_spinbutton_adj = gtk_adjustment_new (255, 0, 255, 1, 10, 10);
+  clip2_max_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (clip2_max_spinbutton_adj), 1, 0);
+  gtk_widget_show (clip2_max_spinbutton);
+  gtk_table_attach (GTK_TABLE (table18), clip2_max_spinbutton, 1, 2, 1, 2,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  clip_button = gtk_button_new_with_mnemonic ("Clip");
+  gtk_widget_show (clip_button);
+  gtk_table_attach (GTK_TABLE (table18), clip_button, 1, 2, 2, 3,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  label55 = gtk_label_new ("Clip");
+  gtk_widget_show (label55);
+  gtk_notebook_set_tab_label (GTK_NOTEBOOK (view_sidepanel_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (view_sidepanel_notebook), 4), label55);
+
+  table19 = gtk_table_new (6, 3, FALSE);
+  gtk_widget_show (table19);
+  gtk_container_add (GTK_CONTAINER (view_sidepanel_notebook), table19);
+  gtk_container_set_border_width (GTK_CONTAINER (table19), 8);
+  gtk_table_set_row_spacings (GTK_TABLE (table19), 8);
+  gtk_table_set_col_spacings (GTK_TABLE (table19), 8);
+
+  label65 = gtk_label_new ("Left");
+  gtk_widget_show (label65);
+  gtk_table_attach (GTK_TABLE (table19), label65, 0, 1, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_misc_set_alignment (GTK_MISC (label65), 0, 0.5);
+
+  label66 = gtk_label_new ("Right");
+  gtk_widget_show (label66);
+  gtk_table_attach (GTK_TABLE (table19), label66, 0, 1, 1, 2,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_misc_set_alignment (GTK_MISC (label66), 0, 0.5);
+
+  label67 = gtk_label_new ("Top");
+  gtk_widget_show (label67);
+  gtk_table_attach (GTK_TABLE (table19), label67, 0, 1, 2, 3,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_misc_set_alignment (GTK_MISC (label67), 0, 0.5);
+
+  label68 = gtk_label_new ("Bottom");
+  gtk_widget_show (label68);
+  gtk_table_attach (GTK_TABLE (table19), label68, 0, 1, 3, 4,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_misc_set_alignment (GTK_MISC (label68), 0, 0.5);
+
+  crop2_left_spinbutton_adj = gtk_adjustment_new (0, 0, 65536, 1, 10, 10);
+  crop2_left_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (crop2_left_spinbutton_adj), 1, 0);
+  gtk_widget_show (crop2_left_spinbutton);
+  gtk_table_attach (GTK_TABLE (table19), crop2_left_spinbutton, 1, 2, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  crop2_right_spinbutton_adj = gtk_adjustment_new (0, 0, 65536, 1, 10, 10);
+  crop2_right_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (crop2_right_spinbutton_adj), 1, 0);
+  gtk_widget_show (crop2_right_spinbutton);
+  gtk_table_attach (GTK_TABLE (table19), crop2_right_spinbutton, 1, 2, 1, 2,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  crop2_top_spinbutton_adj = gtk_adjustment_new (0, 0, 65536, 1, 10, 10);
+  crop2_top_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (crop2_top_spinbutton_adj), 1, 0);
+  gtk_widget_show (crop2_top_spinbutton);
+  gtk_table_attach (GTK_TABLE (table19), crop2_top_spinbutton, 1, 2, 2, 3,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  crop2_bottom_spinbutton_adj = gtk_adjustment_new (0, 0, 65536, 1, 10, 10);
+  crop2_bottom_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (crop2_bottom_spinbutton_adj), 1, 0);
+  gtk_widget_show (crop2_bottom_spinbutton);
+  gtk_table_attach (GTK_TABLE (table19), crop2_bottom_spinbutton, 1, 2, 3, 4,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  crop_button = gtk_button_new_with_mnemonic ("Crop");
+  gtk_widget_show (crop_button);
+  gtk_table_attach (GTK_TABLE (table19), crop_button, 1, 2, 4, 5,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  label54 = gtk_label_new ("Crop");
+  gtk_widget_show (label54);
+  gtk_notebook_set_tab_label (GTK_NOTEBOOK (view_sidepanel_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (view_sidepanel_notebook), 5), label54);
+
   view_scrolledwindow = gtk_scrolled_window_new (NULL, NULL);
   gtk_widget_show (view_scrolledwindow);
   gtk_box_pack_start (GTK_BOX (hbox5), view_scrolledwindow, TRUE, TRUE, 0);
@@ -381,6 +513,73 @@
   gtk_widget_show (postprocessing_notebook);
   gtk_container_add (GTK_CONTAINER (alignment2), postprocessing_notebook);
 
+  table17 = gtk_table_new (5, 3, FALSE);
+  gtk_widget_show (table17);
+  gtk_container_add (GTK_CONTAINER (postprocessing_notebook), table17);
+  gtk_container_set_border_width (GTK_CONTAINER (table17), 8);
+  gtk_table_set_row_spacings (GTK_TABLE (table17), 8);
+  gtk_table_set_col_spacings (GTK_TABLE (table17), 8);
+
+  label61 = gtk_label_new ("Left");
+  gtk_widget_show (label61);
+  gtk_table_attach (GTK_TABLE (table17), label61, 0, 1, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_misc_set_alignment (GTK_MISC (label61), 0, 0.5);
+
+  label62 = gtk_label_new ("Right");
+  gtk_widget_show (label62);
+  gtk_table_attach (GTK_TABLE (table17), label62, 0, 1, 1, 2,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_misc_set_alignment (GTK_MISC (label62), 0, 0.5);
+
+  label63 = gtk_label_new ("Top");
+  gtk_widget_show (label63);
+  gtk_table_attach (GTK_TABLE (table17), label63, 0, 1, 2, 3,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_misc_set_alignment (GTK_MISC (label63), 0, 0.5);
+
+  label64 = gtk_label_new ("Bottom");
+  gtk_widget_show (label64);
+  gtk_table_attach (GTK_TABLE (table17), label64, 0, 1, 3, 4,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_misc_set_alignment (GTK_MISC (label64), 0, 0.5);
+
+  crop_left_spinbutton_adj = gtk_adjustment_new (0, 0, 65536, 1, 10, 10);
+  crop_left_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (crop_left_spinbutton_adj), 1, 0);
+  gtk_widget_show (crop_left_spinbutton);
+  gtk_table_attach (GTK_TABLE (table17), crop_left_spinbutton, 1, 2, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  crop_right_spinbutton_adj = gtk_adjustment_new (0, 0, 65536, 1, 10, 10);
+  crop_right_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (crop_right_spinbutton_adj), 1, 0);
+  gtk_widget_show (crop_right_spinbutton);
+  gtk_table_attach (GTK_TABLE (table17), crop_right_spinbutton, 1, 2, 1, 2,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  crop_top_spinbutton_adj = gtk_adjustment_new (0, 0, 65536, 1, 10, 10);
+  crop_top_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (crop_top_spinbutton_adj), 1, 0);
+  gtk_widget_show (crop_top_spinbutton);
+  gtk_table_attach (GTK_TABLE (table17), crop_top_spinbutton, 1, 2, 2, 3,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  crop_bottom_spinbutton_adj = gtk_adjustment_new (0, 0, 65536, 1, 10, 10);
+  crop_bottom_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (crop_bottom_spinbutton_adj), 1, 0);
+  gtk_widget_show (crop_bottom_spinbutton);
+  gtk_table_attach (GTK_TABLE (table17), crop_bottom_spinbutton, 1, 2, 3, 4,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  label52 = gtk_label_new ("Crop");
+  gtk_widget_show (label52);
+  gtk_notebook_set_tab_label (GTK_NOTEBOOK (postprocessing_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (postprocessing_notebook), 0), label52);
+
   table7 = gtk_table_new (4, 4, FALSE);
   gtk_widget_show (table7);
   gtk_container_add (GTK_CONTAINER (postprocessing_notebook), table7);
@@ -430,7 +629,7 @@
 
   normalize_label = gtk_label_new ("Normalize");
   gtk_widget_show (normalize_label);
-  gtk_notebook_set_tab_label (GTK_NOTEBOOK (postprocessing_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (postprocessing_notebook), 0), normalize_label);
+  gtk_notebook_set_tab_label (GTK_NOTEBOOK (postprocessing_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (postprocessing_notebook), 1), normalize_label);
 
   table5 = gtk_table_new (5, 3, FALSE);
   gtk_widget_show (table5);
@@ -489,7 +688,7 @@
 
   blur_label = gtk_label_new ("Blur");
   gtk_widget_show (blur_label);
-  gtk_notebook_set_tab_label (GTK_NOTEBOOK (postprocessing_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (postprocessing_notebook), 1), blur_label);
+  gtk_notebook_set_tab_label (GTK_NOTEBOOK (postprocessing_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (postprocessing_notebook), 2), blur_label);
 
   table6 = gtk_table_new (2, 2, FALSE);
   gtk_widget_show (table6);
@@ -506,8 +705,47 @@
 
   invert_label = gtk_label_new ("Invert");
   gtk_widget_show (invert_label);
-  gtk_notebook_set_tab_label (GTK_NOTEBOOK (postprocessing_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (postprocessing_notebook), 2), invert_label);
+  gtk_notebook_set_tab_label (GTK_NOTEBOOK (postprocessing_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (postprocessing_notebook), 3), invert_label);
 
+  table16 = gtk_table_new (3, 3, FALSE);
+  gtk_widget_show (table16);
+  gtk_container_add (GTK_CONTAINER (postprocessing_notebook), table16);
+  gtk_container_set_border_width (GTK_CONTAINER (table16), 8);
+  gtk_table_set_row_spacings (GTK_TABLE (table16), 8);
+  gtk_table_set_col_spacings (GTK_TABLE (table16), 8);
+
+  label56 = gtk_label_new ("Minimum");
+  gtk_widget_show (label56);
+  gtk_table_attach (GTK_TABLE (table16), label56, 0, 1, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_misc_set_alignment (GTK_MISC (label56), 0, 0.5);
+
+  label57 = gtk_label_new ("Maximum");
+  gtk_widget_show (label57);
+  gtk_table_attach (GTK_TABLE (table16), label57, 0, 1, 1, 2,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_misc_set_alignment (GTK_MISC (label57), 0, 0.5);
+
+  clip_min_spinbutton_adj = gtk_adjustment_new (0, 0, 255, 1, 10, 10);
+  clip_min_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (clip_min_spinbutton_adj), 1, 0);
+  gtk_widget_show (clip_min_spinbutton);
+  gtk_table_attach (GTK_TABLE (table16), clip_min_spinbutton, 1, 2, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  clip_max_spinbutton_adj = gtk_adjustment_new (255, 0, 255, 1, 10, 10);
+  clip_max_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (clip_max_spinbutton_adj), 1, 0);
+  gtk_widget_show (clip_max_spinbutton);
+  gtk_table_attach (GTK_TABLE (table16), clip_max_spinbutton, 1, 2, 1, 2,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  label53 = gtk_label_new ("Clip");
+  gtk_widget_show (label53);
+  gtk_notebook_set_tab_label (GTK_NOTEBOOK (postprocessing_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (postprocessing_notebook), 4), label53);
+
   label7 = gtk_label_new ("Postprocessing");
   gtk_widget_show (label7);
   gtk_frame_set_label_widget (GTK_FRAME (frame2), label7);
@@ -1099,6 +1337,10 @@
                     G_CALLBACK (on_colormap_colorbutton_color_set), NULL);
   g_signal_connect ((gpointer) colormap_colorbutton8, "color_set",
                     G_CALLBACK (on_colormap_colorbutton_color_set), NULL);
+  g_signal_connect ((gpointer) clip_button, "clicked",
+                    G_CALLBACK (on_clip_button_clicked), NULL);
+  g_signal_connect ((gpointer) crop_button, "clicked",
+                    G_CALLBACK (on_crop_button_clicked), NULL);
 
   /* Store pointers to all widgets, for use by lookup_widget(). */
   GLADE_HOOKUP_OBJECT_NO_REF (hmgengui, hmgengui, "hmgengui");
@@ -1183,6 +1425,20 @@
   GLADE_HOOKUP_OBJECT (hmgengui, export_format_combobox, "export_format_combobox");
   GLADE_HOOKUP_OBJECT (hmgengui, export_save_button, "export_save_button");
   GLADE_HOOKUP_OBJECT (hmgengui, export_filechooserwidget, "export_filechooserwidget");
+  GLADE_HOOKUP_OBJECT (hmgengui, clip2_min_spinbutton, "clip2_min_spinbutton");
+  GLADE_HOOKUP_OBJECT (hmgengui, clip2_max_spinbutton, "clip2_max_spinbutton");
+  GLADE_HOOKUP_OBJECT (hmgengui, clip_button, "clip_button");
+  GLADE_HOOKUP_OBJECT (hmgengui, crop2_left_spinbutton, "crop2_left_spinbutton");
+  GLADE_HOOKUP_OBJECT (hmgengui, crop2_right_spinbutton, "crop2_right_spinbutton");
+  GLADE_HOOKUP_OBJECT (hmgengui, crop2_top_spinbutton, "crop2_top_spinbutton");
+  GLADE_HOOKUP_OBJECT (hmgengui, crop2_bottom_spinbutton, "crop2_bottom_spinbutton");
+  GLADE_HOOKUP_OBJECT (hmgengui, crop_button, "crop_button");
+  GLADE_HOOKUP_OBJECT (hmgengui, crop_left_spinbutton, "crop_left_spinbutton");
+  GLADE_HOOKUP_OBJECT (hmgengui, crop_right_spinbutton, "crop_right_spinbutton");
+  GLADE_HOOKUP_OBJECT (hmgengui, crop_top_spinbutton, "crop_top_spinbutton");
+  GLADE_HOOKUP_OBJECT (hmgengui, crop_bottom_spinbutton, "crop_bottom_spinbutton");
+  GLADE_HOOKUP_OBJECT (hmgengui, clip_min_spinbutton, "clip_min_spinbutton");
+  GLADE_HOOKUP_OBJECT (hmgengui, clip_max_spinbutton, "clip_max_spinbutton");
 
   gtk_notebook_set_current_page(GTK_NOTEBOOK(main_notebook), 1);
 



From ivop at mail.berlios.de  Fri Sep  7 23:01:40 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 7 Sep 2007 23:01:40 +0200
Subject: [Hmgen-svnlog] r76 - in trunk: . assist
Message-ID: <200709072101.l87L1ePA006530@sheep.berlios.de>

Author: ivop
Date: 2007-09-07 23:01:39 +0200 (Fri, 07 Sep 2007)
New Revision: 76

Modified:
   trunk/assist/hmgengui.glade
   trunk/gui_interface.c
Log:
forgot enable checkbuttons for postprocessing settings


Modified: trunk/assist/hmgengui.glade
===================================================================
--- trunk/assist/hmgengui.glade	2007-09-07 20:48:18 UTC (rev 75)
+++ trunk/assist/hmgengui.glade	2007-09-07 21:01:39 UTC (rev 76)
@@ -1413,7 +1413,7 @@
 			    <widget class="GtkTable" id="table17">
 			      <property name="border_width">8</property>
 			      <property name="visible">True</property>
-			      <property name="n_rows">5</property>
+			      <property name="n_rows">6</property>
 			      <property name="n_columns">3</property>
 			      <property name="homogeneous">False</property>
 			      <property name="row_spacing">8</property>
@@ -1440,8 +1440,8 @@
 				<packing>
 				  <property name="left_attach">0</property>
 				  <property name="right_attach">1</property>
-				  <property name="top_attach">0</property>
-				  <property name="bottom_attach">1</property>
+				  <property name="top_attach">1</property>
+				  <property name="bottom_attach">2</property>
 				  <property name="x_options">fill</property>
 				  <property name="y_options"></property>
 				</packing>
@@ -1468,8 +1468,8 @@
 				<packing>
 				  <property name="left_attach">0</property>
 				  <property name="right_attach">1</property>
-				  <property name="top_attach">1</property>
-				  <property name="bottom_attach">2</property>
+				  <property name="top_attach">2</property>
+				  <property name="bottom_attach">3</property>
 				  <property name="x_options">fill</property>
 				  <property name="y_options"></property>
 				</packing>
@@ -1496,8 +1496,8 @@
 				<packing>
 				  <property name="left_attach">0</property>
 				  <property name="right_attach">1</property>
-				  <property name="top_attach">2</property>
-				  <property name="bottom_attach">3</property>
+				  <property name="top_attach">3</property>
+				  <property name="bottom_attach">4</property>
 				  <property name="x_options">fill</property>
 				  <property name="y_options"></property>
 				</packing>
@@ -1524,8 +1524,8 @@
 				<packing>
 				  <property name="left_attach">0</property>
 				  <property name="right_attach">1</property>
-				  <property name="top_attach">3</property>
-				  <property name="bottom_attach">4</property>
+				  <property name="top_attach">4</property>
+				  <property name="bottom_attach">5</property>
 				  <property name="x_options">fill</property>
 				  <property name="y_options"></property>
 				</packing>
@@ -1546,8 +1546,8 @@
 				<packing>
 				  <property name="left_attach">1</property>
 				  <property name="right_attach">2</property>
-				  <property name="top_attach">0</property>
-				  <property name="bottom_attach">1</property>
+				  <property name="top_attach">1</property>
+				  <property name="bottom_attach">2</property>
 				  <property name="x_options">fill</property>
 				  <property name="y_options"></property>
 				</packing>
@@ -1568,8 +1568,8 @@
 				<packing>
 				  <property name="left_attach">1</property>
 				  <property name="right_attach">2</property>
-				  <property name="top_attach">1</property>
-				  <property name="bottom_attach">2</property>
+				  <property name="top_attach">2</property>
+				  <property name="bottom_attach">3</property>
 				  <property name="x_options">fill</property>
 				  <property name="y_options"></property>
 				</packing>
@@ -1590,8 +1590,8 @@
 				<packing>
 				  <property name="left_attach">1</property>
 				  <property name="right_attach">2</property>
-				  <property name="top_attach">2</property>
-				  <property name="bottom_attach">3</property>
+				  <property name="top_attach">3</property>
+				  <property name="bottom_attach">4</property>
 				  <property name="x_options">fill</property>
 				  <property name="y_options"></property>
 				</packing>
@@ -1612,12 +1612,34 @@
 				<packing>
 				  <property name="left_attach">1</property>
 				  <property name="right_attach">2</property>
-				  <property name="top_attach">3</property>
-				  <property name="bottom_attach">4</property>
+				  <property name="top_attach">4</property>
+				  <property name="bottom_attach">5</property>
 				  <property name="x_options">fill</property>
 				  <property name="y_options"></property>
 				</packing>
 			      </child>
+
+			      <child>
+				<widget class="GtkCheckButton" id="crop_enable_checkbutton">
+				  <property name="visible">True</property>
+				  <property name="can_focus">True</property>
+				  <property name="label" translatable="yes">Enable</property>
+				  <property name="use_underline">True</property>
+				  <property name="relief">GTK_RELIEF_NORMAL</property>
+				  <property name="focus_on_click">True</property>
+				  <property name="active">False</property>
+				  <property name="inconsistent">False</property>
+				  <property name="draw_indicator">True</property>
+				</widget>
+				<packing>
+				  <property name="left_attach">0</property>
+				  <property name="right_attach">1</property>
+				  <property name="top_attach">0</property>
+				  <property name="bottom_attach">1</property>
+				  <property name="x_options">fill</property>
+				  <property name="y_options"></property>
+				</packing>
+			      </child>
 			    </widget>
 			    <packing>
 			      <property name="tab_expand">False</property>
@@ -2129,7 +2151,7 @@
 			    <widget class="GtkTable" id="table16">
 			      <property name="border_width">8</property>
 			      <property name="visible">True</property>
-			      <property name="n_rows">3</property>
+			      <property name="n_rows">4</property>
 			      <property name="n_columns">3</property>
 			      <property name="homogeneous">False</property>
 			      <property name="row_spacing">8</property>
@@ -2156,8 +2178,8 @@
 				<packing>
 				  <property name="left_attach">0</property>
 				  <property name="right_attach">1</property>
-				  <property name="top_attach">0</property>
-				  <property name="bottom_attach">1</property>
+				  <property name="top_attach">1</property>
+				  <property name="bottom_attach">2</property>
 				  <property name="x_options">fill</property>
 				  <property name="y_options"></property>
 				</packing>
@@ -2184,8 +2206,8 @@
 				<packing>
 				  <property name="left_attach">0</property>
 				  <property name="right_attach">1</property>
-				  <property name="top_attach">1</property>
-				  <property name="bottom_attach">2</property>
+				  <property name="top_attach">2</property>
+				  <property name="bottom_attach">3</property>
 				  <property name="x_options">fill</property>
 				  <property name="y_options"></property>
 				</packing>
@@ -2206,8 +2228,8 @@
 				<packing>
 				  <property name="left_attach">1</property>
 				  <property name="right_attach">2</property>
-				  <property name="top_attach">0</property>
-				  <property name="bottom_attach">1</property>
+				  <property name="top_attach">1</property>
+				  <property name="bottom_attach">2</property>
 				  <property name="x_options">fill</property>
 				  <property name="y_options"></property>
 				</packing>
@@ -2228,12 +2250,34 @@
 				<packing>
 				  <property name="left_attach">1</property>
 				  <property name="right_attach">2</property>
-				  <property name="top_attach">1</property>
-				  <property name="bottom_attach">2</property>
+				  <property name="top_attach">2</property>
+				  <property name="bottom_attach">3</property>
 				  <property name="x_options">fill</property>
 				  <property name="y_options"></property>
 				</packing>
 			      </child>
+
+			      <child>
+				<widget class="GtkCheckButton" id="clip_enable_checkbutton">
+				  <property name="visible">True</property>
+				  <property name="can_focus">True</property>
+				  <property name="label" translatable="yes">Enable</property>
+				  <property name="use_underline">True</property>
+				  <property name="relief">GTK_RELIEF_NORMAL</property>
+				  <property name="focus_on_click">True</property>
+				  <property name="active">False</property>
+				  <property name="inconsistent">False</property>
+				  <property name="draw_indicator">True</property>
+				</widget>
+				<packing>
+				  <property name="left_attach">0</property>
+				  <property name="right_attach">1</property>
+				  <property name="top_attach">0</property>
+				  <property name="bottom_attach">1</property>
+				  <property name="x_options">fill</property>
+				  <property name="y_options"></property>
+				</packing>
+			      </child>
 			    </widget>
 			    <packing>
 			      <property name="tab_expand">False</property>

Modified: trunk/gui_interface.c
===================================================================
--- trunk/gui_interface.c	2007-09-07 20:48:18 UTC (rev 75)
+++ trunk/gui_interface.c	2007-09-07 21:01:39 UTC (rev 76)
@@ -70,6 +70,7 @@
   GtkWidget *crop_right_spinbutton, *crop_top_spinbutton;
   GtkWidget *crop_bottom_spinbutton, *label52, *table16, *label56, *label57;
   GtkWidget *clip_min_spinbutton, *clip_max_spinbutton, *label53;
+  GtkWidget *crop_enable_checkbutton, *clip_enable_checkbutton;
 
   GtkObject *norm_min_spinbutton_adj, *norm_max_spinbutton_adj;
   GtkObject *blur_sigma_spinbutton_adj, *blur_yradius_spinbutton_adj;
@@ -513,7 +514,7 @@
   gtk_widget_show (postprocessing_notebook);
   gtk_container_add (GTK_CONTAINER (alignment2), postprocessing_notebook);
 
-  table17 = gtk_table_new (5, 3, FALSE);
+  table17 = gtk_table_new (6, 3, FALSE);
   gtk_widget_show (table17);
   gtk_container_add (GTK_CONTAINER (postprocessing_notebook), table17);
   gtk_container_set_border_width (GTK_CONTAINER (table17), 8);
@@ -522,28 +523,28 @@
 
   label61 = gtk_label_new ("Left");
   gtk_widget_show (label61);
-  gtk_table_attach (GTK_TABLE (table17), label61, 0, 1, 0, 1,
+  gtk_table_attach (GTK_TABLE (table17), label61, 0, 1, 1, 2,
                     (GtkAttachOptions) (GTK_FILL),
                     (GtkAttachOptions) (0), 0, 0);
   gtk_misc_set_alignment (GTK_MISC (label61), 0, 0.5);
 
   label62 = gtk_label_new ("Right");
   gtk_widget_show (label62);
-  gtk_table_attach (GTK_TABLE (table17), label62, 0, 1, 1, 2,
+  gtk_table_attach (GTK_TABLE (table17), label62, 0, 1, 2, 3,
                     (GtkAttachOptions) (GTK_FILL),
                     (GtkAttachOptions) (0), 0, 0);
   gtk_misc_set_alignment (GTK_MISC (label62), 0, 0.5);
 
   label63 = gtk_label_new ("Top");
   gtk_widget_show (label63);
-  gtk_table_attach (GTK_TABLE (table17), label63, 0, 1, 2, 3,
+  gtk_table_attach (GTK_TABLE (table17), label63, 0, 1, 3, 4,
                     (GtkAttachOptions) (GTK_FILL),
                     (GtkAttachOptions) (0), 0, 0);
   gtk_misc_set_alignment (GTK_MISC (label63), 0, 0.5);
 
   label64 = gtk_label_new ("Bottom");
   gtk_widget_show (label64);
-  gtk_table_attach (GTK_TABLE (table17), label64, 0, 1, 3, 4,
+  gtk_table_attach (GTK_TABLE (table17), label64, 0, 1, 4, 5,
                     (GtkAttachOptions) (GTK_FILL),
                     (GtkAttachOptions) (0), 0, 0);
   gtk_misc_set_alignment (GTK_MISC (label64), 0, 0.5);
@@ -551,31 +552,37 @@
   crop_left_spinbutton_adj = gtk_adjustment_new (0, 0, 65536, 1, 10, 10);
   crop_left_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (crop_left_spinbutton_adj), 1, 0);
   gtk_widget_show (crop_left_spinbutton);
-  gtk_table_attach (GTK_TABLE (table17), crop_left_spinbutton, 1, 2, 0, 1,
+  gtk_table_attach (GTK_TABLE (table17), crop_left_spinbutton, 1, 2, 1, 2,
                     (GtkAttachOptions) (GTK_FILL),
                     (GtkAttachOptions) (0), 0, 0);
 
   crop_right_spinbutton_adj = gtk_adjustment_new (0, 0, 65536, 1, 10, 10);
   crop_right_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (crop_right_spinbutton_adj), 1, 0);
   gtk_widget_show (crop_right_spinbutton);
-  gtk_table_attach (GTK_TABLE (table17), crop_right_spinbutton, 1, 2, 1, 2,
+  gtk_table_attach (GTK_TABLE (table17), crop_right_spinbutton, 1, 2, 2, 3,
                     (GtkAttachOptions) (GTK_FILL),
                     (GtkAttachOptions) (0), 0, 0);
 
   crop_top_spinbutton_adj = gtk_adjustment_new (0, 0, 65536, 1, 10, 10);
   crop_top_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (crop_top_spinbutton_adj), 1, 0);
   gtk_widget_show (crop_top_spinbutton);
-  gtk_table_attach (GTK_TABLE (table17), crop_top_spinbutton, 1, 2, 2, 3,
+  gtk_table_attach (GTK_TABLE (table17), crop_top_spinbutton, 1, 2, 3, 4,
                     (GtkAttachOptions) (GTK_FILL),
                     (GtkAttachOptions) (0), 0, 0);
 
   crop_bottom_spinbutton_adj = gtk_adjustment_new (0, 0, 65536, 1, 10, 10);
   crop_bottom_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (crop_bottom_spinbutton_adj), 1, 0);
   gtk_widget_show (crop_bottom_spinbutton);
-  gtk_table_attach (GTK_TABLE (table17), crop_bottom_spinbutton, 1, 2, 3, 4,
+  gtk_table_attach (GTK_TABLE (table17), crop_bottom_spinbutton, 1, 2, 4, 5,
                     (GtkAttachOptions) (GTK_FILL),
                     (GtkAttachOptions) (0), 0, 0);
 
+  crop_enable_checkbutton = gtk_check_button_new_with_mnemonic ("Enable");
+  gtk_widget_show (crop_enable_checkbutton);
+  gtk_table_attach (GTK_TABLE (table17), crop_enable_checkbutton, 0, 1, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
   label52 = gtk_label_new ("Crop");
   gtk_widget_show (label52);
   gtk_notebook_set_tab_label (GTK_NOTEBOOK (postprocessing_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (postprocessing_notebook), 0), label52);
@@ -707,7 +714,7 @@
   gtk_widget_show (invert_label);
   gtk_notebook_set_tab_label (GTK_NOTEBOOK (postprocessing_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (postprocessing_notebook), 3), invert_label);
 
-  table16 = gtk_table_new (3, 3, FALSE);
+  table16 = gtk_table_new (4, 3, FALSE);
   gtk_widget_show (table16);
   gtk_container_add (GTK_CONTAINER (postprocessing_notebook), table16);
   gtk_container_set_border_width (GTK_CONTAINER (table16), 8);
@@ -716,14 +723,14 @@
 
   label56 = gtk_label_new ("Minimum");
   gtk_widget_show (label56);
-  gtk_table_attach (GTK_TABLE (table16), label56, 0, 1, 0, 1,
+  gtk_table_attach (GTK_TABLE (table16), label56, 0, 1, 1, 2,
                     (GtkAttachOptions) (GTK_FILL),
                     (GtkAttachOptions) (0), 0, 0);
   gtk_misc_set_alignment (GTK_MISC (label56), 0, 0.5);
 
   label57 = gtk_label_new ("Maximum");
   gtk_widget_show (label57);
-  gtk_table_attach (GTK_TABLE (table16), label57, 0, 1, 1, 2,
+  gtk_table_attach (GTK_TABLE (table16), label57, 0, 1, 2, 3,
                     (GtkAttachOptions) (GTK_FILL),
                     (GtkAttachOptions) (0), 0, 0);
   gtk_misc_set_alignment (GTK_MISC (label57), 0, 0.5);
@@ -731,17 +738,23 @@
   clip_min_spinbutton_adj = gtk_adjustment_new (0, 0, 255, 1, 10, 10);
   clip_min_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (clip_min_spinbutton_adj), 1, 0);
   gtk_widget_show (clip_min_spinbutton);
-  gtk_table_attach (GTK_TABLE (table16), clip_min_spinbutton, 1, 2, 0, 1,
+  gtk_table_attach (GTK_TABLE (table16), clip_min_spinbutton, 1, 2, 1, 2,
                     (GtkAttachOptions) (GTK_FILL),
                     (GtkAttachOptions) (0), 0, 0);
 
   clip_max_spinbutton_adj = gtk_adjustment_new (255, 0, 255, 1, 10, 10);
   clip_max_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (clip_max_spinbutton_adj), 1, 0);
   gtk_widget_show (clip_max_spinbutton);
-  gtk_table_attach (GTK_TABLE (table16), clip_max_spinbutton, 1, 2, 1, 2,
+  gtk_table_attach (GTK_TABLE (table16), clip_max_spinbutton, 1, 2, 2, 3,
                     (GtkAttachOptions) (GTK_FILL),
                     (GtkAttachOptions) (0), 0, 0);
 
+  clip_enable_checkbutton = gtk_check_button_new_with_mnemonic ("Enable");
+  gtk_widget_show (clip_enable_checkbutton);
+  gtk_table_attach (GTK_TABLE (table16), clip_enable_checkbutton, 0, 1, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
   label53 = gtk_label_new ("Clip");
   gtk_widget_show (label53);
   gtk_notebook_set_tab_label (GTK_NOTEBOOK (postprocessing_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (postprocessing_notebook), 4), label53);
@@ -1439,7 +1452,10 @@
   GLADE_HOOKUP_OBJECT (hmgengui, crop_bottom_spinbutton, "crop_bottom_spinbutton");
   GLADE_HOOKUP_OBJECT (hmgengui, clip_min_spinbutton, "clip_min_spinbutton");
   GLADE_HOOKUP_OBJECT (hmgengui, clip_max_spinbutton, "clip_max_spinbutton");
+  GLADE_HOOKUP_OBJECT (hmgengui, crop_enable_checkbutton, "crop_enable_checkbutton");
+  GLADE_HOOKUP_OBJECT (hmgengui, clip_enable_checkbutton, "clip_enable_checkbutton");
 
+
   gtk_notebook_set_current_page(GTK_NOTEBOOK(main_notebook), 1);
 
   return hmgengui;



From ivop at mail.berlios.de  Fri Sep  7 23:02:45 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 7 Sep 2007 23:02:45 +0200
Subject: [Hmgen-svnlog] r77 - trunk/assist
Message-ID: <200709072102.l87L2jKa006579@sheep.berlios.de>

Author: ivop
Date: 2007-09-07 23:02:45 +0200 (Fri, 07 Sep 2007)
New Revision: 77

Modified:
   trunk/assist/README
Log:
clarify


Modified: trunk/assist/README
===================================================================
--- trunk/assist/README	2007-09-07 21:01:39 UTC (rev 76)
+++ trunk/assist/README	2007-09-07 21:02:45 UTC (rev 77)
@@ -1,3 +1,4 @@
 This file and glade-2.0 was used to bootstrap the GUI. However, I do not use
 any of the buildtools or libglade. Current interface/callbacks/etc. files
-are modified versions.
+are modified versions, so even though this .glade file gets updated everytime
+the GUI changes, it's not a 100% one-on-one mapping.



From ivop at mail.berlios.de  Sat Sep  8 00:15:10 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 8 Sep 2007 00:15:10 +0200
Subject: [Hmgen-svnlog] r78 - trunk
Message-ID: <200709072215.l87MFArY012778@sheep.berlios.de>

Author: ivop
Date: 2007-09-08 00:15:10 +0200 (Sat, 08 Sep 2007)
New Revision: 78

Modified:
   trunk/gui_callbacks.c
Log:
extract clip and crop settings


Modified: trunk/gui_callbacks.c
===================================================================
--- trunk/gui_callbacks.c	2007-09-07 21:02:45 UTC (rev 77)
+++ trunk/gui_callbacks.c	2007-09-07 22:15:10 UTC (rev 78)
@@ -201,7 +201,8 @@
     gint active;
     unsigned int dims[] = { 3, 5, 9, 17, 33, 65, 129, 257, 513, 1025, 2049, 4097, 8193, 16385 };
     unsigned int normmin, normmax, normfirst, normlast, inv, blurx, blury;
-    unsigned int blur;
+    unsigned int blur, crop, cropleft, cropright, croptop, cropbottom;
+    unsigned int clip, clipmin, clipmax;
     double blursigma;
     char *settings;
  
@@ -250,6 +251,16 @@
         blurx     = get_spin_button_int  (args, "blur_xradius_spinbutton");
         blury     = get_spin_button_int  (args, "blur_yradius_spinbutton");
         blursigma = get_spin_button_float(args, "blur_sigma_spinbutton");
+        widget      = lookup_widget(GTK_WIDGET(args),"crop_enable_checkbutton");
+        crop        = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(widget));
+        cropleft    = get_spin_button_int(args, "crop_left_spinbutton");
+        cropright   = get_spin_button_int(args, "crop_right_spinbutton");
+        croptop     = get_spin_button_int(args, "crop_top_spinbutton");
+        cropbottom  = get_spin_button_int(args, "crop_bottom_spinbutton");
+        widget      = lookup_widget(GTK_WIDGET(args),"clip_enable_checkbutton");
+        clip        = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(widget));
+        clipmin     = get_spin_button_int(args, "clip_min_spinbutton");
+        clipmax     = get_spin_button_int(args, "clip_max_spinbutton");
     gdk_threads_leave();
 
     if (normfirst)



From ivop at mail.berlios.de  Sat Sep  8 00:36:58 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 8 Sep 2007 00:36:58 +0200
Subject: [Hmgen-svnlog] r79 - trunk
Message-ID: <200709072236.l87MawoC006262@sheep.berlios.de>

Author: ivop
Date: 2007-09-08 00:36:58 +0200 (Sat, 08 Sep 2007)
New Revision: 79

Modified:
   trunk/gui_callbacks.c
Log:
function to poll state of check_button's


Modified: trunk/gui_callbacks.c
===================================================================
--- trunk/gui_callbacks.c	2007-09-07 22:15:10 UTC (rev 78)
+++ trunk/gui_callbacks.c	2007-09-07 22:36:58 UTC (rev 79)
@@ -105,6 +105,11 @@
     w = lookup_widget(GTK_WIDGET(widget), name);
     return gtk_spin_button_get_value_as_float(GTK_SPIN_BUTTON(w));
 }
+static int get_check_button_active(void *widget, const char *name) {
+    GtkWidget *w;
+    w = lookup_widget(GTK_WIDGET(widget), name);
+    return gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(w));
+}
 
 static void retrieve_settings_ff(GtkWidget *widget, char *buf, int len) {
     unsigned int seed, init, nplates, up, down;
@@ -238,27 +243,21 @@
     // post-processing
 
     gdk_threads_enter();
-        widget = lookup_widget(GTK_WIDGET(args), "norm_first_checkbutton");
-        normfirst = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(widget));
-        widget = lookup_widget(GTK_WIDGET(args), "norm_last_checkbutton");
-        normlast = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(widget));
+        normfirst   = get_check_button_active(args, "norm_first_checkbutton");
+        normlast    = get_check_button_active(args, "norm_last_checkbutton");
         normmin = get_spin_button_int(args, "norm_min_spinbutton");
         normmax = get_spin_button_int(args, "norm_max_spinbutton");
-        widget = lookup_widget(GTK_WIDGET(args), "invert_checkbutton");
-        inv = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(widget));
-        widget = lookup_widget(GTK_WIDGET(args), "blur_checkbutton");
-        blur = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(widget));
+        inv         = get_check_button_active(args, "invert_checkbutton");
+        blur        = get_check_button_active(args, "blur_checkbutton");
         blurx     = get_spin_button_int  (args, "blur_xradius_spinbutton");
         blury     = get_spin_button_int  (args, "blur_yradius_spinbutton");
         blursigma = get_spin_button_float(args, "blur_sigma_spinbutton");
-        widget      = lookup_widget(GTK_WIDGET(args),"crop_enable_checkbutton");
-        crop        = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(widget));
+        crop        = get_check_button_active(args, "crop_enable_checkbutton");
         cropleft    = get_spin_button_int(args, "crop_left_spinbutton");
         cropright   = get_spin_button_int(args, "crop_right_spinbutton");
         croptop     = get_spin_button_int(args, "crop_top_spinbutton");
         cropbottom  = get_spin_button_int(args, "crop_bottom_spinbutton");
-        widget      = lookup_widget(GTK_WIDGET(args),"clip_enable_checkbutton");
-        clip        = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(widget));
+        clip        = get_check_button_active(args, "clip_enable_checkbutton");
         clipmin     = get_spin_button_int(args, "clip_min_spinbutton");
         clipmax     = get_spin_button_int(args, "clip_max_spinbutton");
     gdk_threads_leave();



From ivop at mail.berlios.de  Sat Sep  8 00:38:12 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 8 Sep 2007 00:38:12 +0200
Subject: [Hmgen-svnlog] r80 - trunk
Message-ID: <200709072238.l87McCcZ008184@sheep.berlios.de>

Author: ivop
Date: 2007-09-08 00:38:11 +0200 (Sat, 08 Sep 2007)
New Revision: 80

Modified:
   trunk/gui_callbacks.c
Log:
cosmetics, alignment


Modified: trunk/gui_callbacks.c
===================================================================
--- trunk/gui_callbacks.c	2007-09-07 22:36:58 UTC (rev 79)
+++ trunk/gui_callbacks.c	2007-09-07 22:38:11 UTC (rev 80)
@@ -245,21 +245,21 @@
     gdk_threads_enter();
         normfirst   = get_check_button_active(args, "norm_first_checkbutton");
         normlast    = get_check_button_active(args, "norm_last_checkbutton");
-        normmin = get_spin_button_int(args, "norm_min_spinbutton");
-        normmax = get_spin_button_int(args, "norm_max_spinbutton");
+        normmin     = get_spin_button_int    (args, "norm_min_spinbutton");
+        normmax     = get_spin_button_int    (args, "norm_max_spinbutton");
         inv         = get_check_button_active(args, "invert_checkbutton");
         blur        = get_check_button_active(args, "blur_checkbutton");
-        blurx     = get_spin_button_int  (args, "blur_xradius_spinbutton");
-        blury     = get_spin_button_int  (args, "blur_yradius_spinbutton");
-        blursigma = get_spin_button_float(args, "blur_sigma_spinbutton");
+        blurx       = get_spin_button_int    (args, "blur_xradius_spinbutton");
+        blury       = get_spin_button_int    (args, "blur_yradius_spinbutton");
+        blursigma   = get_spin_button_float  (args, "blur_sigma_spinbutton");
         crop        = get_check_button_active(args, "crop_enable_checkbutton");
-        cropleft    = get_spin_button_int(args, "crop_left_spinbutton");
-        cropright   = get_spin_button_int(args, "crop_right_spinbutton");
-        croptop     = get_spin_button_int(args, "crop_top_spinbutton");
-        cropbottom  = get_spin_button_int(args, "crop_bottom_spinbutton");
+        cropleft    = get_spin_button_int    (args, "crop_left_spinbutton");
+        cropright   = get_spin_button_int    (args, "crop_right_spinbutton");
+        croptop     = get_spin_button_int    (args, "crop_top_spinbutton");
+        cropbottom  = get_spin_button_int    (args, "crop_bottom_spinbutton");
         clip        = get_check_button_active(args, "clip_enable_checkbutton");
-        clipmin     = get_spin_button_int(args, "clip_min_spinbutton");
-        clipmax     = get_spin_button_int(args, "clip_max_spinbutton");
+        clipmin     = get_spin_button_int    (args, "clip_min_spinbutton");
+        clipmax     = get_spin_button_int    (args, "clip_max_spinbutton");
     gdk_threads_leave();
 
     if (normfirst)



From ivop at mail.berlios.de  Sat Sep  8 00:50:15 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 8 Sep 2007 00:50:15 +0200
Subject: [Hmgen-svnlog] r81 - trunk
Message-ID: <200709072250.l87MoFNH020728@sheep.berlios.de>

Author: ivop
Date: 2007-09-08 00:50:14 +0200 (Sat, 08 Sep 2007)
New Revision: 81

Modified:
   trunk/gui_callbacks.c
Log:
enable postprocessing crop and clip


Modified: trunk/gui_callbacks.c
===================================================================
--- trunk/gui_callbacks.c	2007-09-07 22:38:11 UTC (rev 80)
+++ trunk/gui_callbacks.c	2007-09-07 22:50:14 UTC (rev 81)
@@ -262,6 +262,27 @@
         clipmax     = get_spin_button_int    (args, "clip_max_spinbutton");
     gdk_threads_leave();
 
+    if (crop) {
+        /* sanitize crop settings if necessary */
+        if (cropleft > map_width-3)
+            cropleft = map_width-3;
+        if (cropright > map_width-3)
+            cropright = map_width-3;
+        if ((cropright+cropleft) > map_width-3) {
+            cropright = 0;
+            cropleft = map_width-3;
+        }
+        if (croptop > map_height-3)
+            croptop = map_height-3;
+        if (cropbottom > map_height-3)
+            cropbottom = map_height-3;
+        if ((cropbottom+croptop) > map_height-3) {
+            cropbottom = 0;
+            croptop = map_height-3;
+        }
+        hmg_crop(&map, &map_width, &map_height, cropleft, cropright,
+                croptop, cropbottom);
+    }
     if (normfirst)
         hmg_normalize(map, normmin, normmax, map_width, map_height);
     if (blur)
@@ -269,6 +290,8 @@
                                                                 map_height);
     if (inv)
         hmg_invert(map, map_width, map_height);
+    if (clip)
+        hmg_clip(map, clipmin, clipmax, map_width, map_height);
     if (normlast)
         hmg_normalize(map, normmin, normmax, map_width, map_height);
 



From ivop at mail.berlios.de  Sat Sep  8 11:32:59 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 8 Sep 2007 11:32:59 +0200
Subject: [Hmgen-svnlog] r82 - trunk
Message-ID: <200709080932.l889Wx5p025359@sheep.berlios.de>

Author: ivop
Date: 2007-09-08 11:32:58 +0200 (Sat, 08 Sep 2007)
New Revision: 82

Modified:
   trunk/gui_callbacks.c
Log:
enable sidepanel crop and clip


Modified: trunk/gui_callbacks.c
===================================================================
--- trunk/gui_callbacks.c	2007-09-07 22:50:14 UTC (rev 81)
+++ trunk/gui_callbacks.c	2007-09-08 09:32:58 UTC (rev 82)
@@ -201,6 +201,29 @@
     gdk_threads_leave();
 }
 
+static void sanitize_crop_settings(unsigned int *cropleft,
+                                   unsigned int *cropright,
+                                   unsigned int *croptop,
+                                   unsigned int *cropbottom) {
+    /* sanitize crop settings if necessary */
+    if (*cropleft > map_width-3)
+        *cropleft = map_width-3;
+    if (*cropright > map_width-3)
+        *cropright = map_width-3;
+    if ((*cropright + *cropleft) > map_width-3) {
+        *cropright = 0;
+        *cropleft = map_width-3;
+    }
+    if (*croptop > map_height-3)
+        *croptop = map_height-3;
+    if (*cropbottom > map_height-3)
+        *cropbottom = map_height-3;
+    if ((*cropbottom + *croptop) > map_height-3) {
+        *cropbottom = 0;
+        *croptop = map_height-3;
+    }
+}
+
 static void *generate_thread(void *args) {
     GtkWidget *widget;
     gint active;
@@ -263,23 +286,7 @@
     gdk_threads_leave();
 
     if (crop) {
-        /* sanitize crop settings if necessary */
-        if (cropleft > map_width-3)
-            cropleft = map_width-3;
-        if (cropright > map_width-3)
-            cropright = map_width-3;
-        if ((cropright+cropleft) > map_width-3) {
-            cropright = 0;
-            cropleft = map_width-3;
-        }
-        if (croptop > map_height-3)
-            croptop = map_height-3;
-        if (cropbottom > map_height-3)
-            cropbottom = map_height-3;
-        if ((cropbottom+croptop) > map_height-3) {
-            cropbottom = 0;
-            croptop = map_height-3;
-        }
+        sanitize_crop_settings(&cropleft, &cropright, &croptop, &cropbottom);
         hmg_crop(&map, &map_width, &map_height, cropleft, cropright,
                 croptop, cropbottom);
     }
@@ -660,10 +667,53 @@
     g_thread_create(export_thread, button, FALSE, NULL);
 }
 
+static void *clip2_thread(void *args) {
+    unsigned int clipmin, clipmax;
+
+    set_main_progressbar(args);
+    hmg_progress_meter = gui_progress_meter;
+
+    gdk_threads_enter();
+        clipmin = get_spin_button_int  (args, "clip2_min_spinbutton");
+        clipmax = get_spin_button_int  (args, "clip2_max_spinbutton");
+    gdk_threads_leave();
+
+    hmg_clip(map, clipmin, clipmax, map_width, map_height);
+    render_map(args);
+
+    activate_main_notebook(args, 1);
+    return NULL;
+}
+
 void on_clip_button_clicked(GtkButton *button,
                                    gpointer user_data HMG_ATTR_UNUSED) {
+    deactivate_main_notebook(button);
+    g_thread_create(clip2_thread, button, FALSE, NULL);
 }
 
+static void *crop2_thread(void *args) {
+    unsigned int cropleft, cropright, croptop, cropbottom;
+
+    set_main_progressbar(args);
+    hmg_progress_meter = gui_progress_meter;
+
+    gdk_threads_enter();
+        cropleft   = get_spin_button_int  (args, "crop2_left_spinbutton");
+        cropright  = get_spin_button_int  (args, "crop2_right_spinbutton");
+        croptop    = get_spin_button_int  (args, "crop2_top_spinbutton");
+        cropbottom = get_spin_button_int  (args, "crop2_bottom_spinbutton");
+    gdk_threads_leave();
+
+    sanitize_crop_settings(&cropleft, &cropright, &croptop, &cropbottom);
+    hmg_crop(&map, &map_width, &map_height, cropleft, cropright, croptop, cropbottom);
+    render_map(args);
+
+    activate_main_notebook(args, 1);
+    return NULL;
+}
+
 void on_crop_button_clicked(GtkButton *button,
                                    gpointer user_data HMG_ATTR_UNUSED) {
+    deactivate_main_notebook(button);
+    g_thread_create(crop2_thread, button, FALSE, NULL);
 }



From ivop at mail.berlios.de  Sat Sep  8 11:34:48 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 8 Sep 2007 11:34:48 +0200
Subject: [Hmgen-svnlog] r83 - trunk
Message-ID: <200709080934.l889YmmS029715@sheep.berlios.de>

Author: ivop
Date: 2007-09-08 11:34:45 +0200 (Sat, 08 Sep 2007)
New Revision: 83

Modified:
   trunk/gui_callbacks.c
Log:
cosmetics, line length


Modified: trunk/gui_callbacks.c
===================================================================
--- trunk/gui_callbacks.c	2007-09-08 09:32:58 UTC (rev 82)
+++ trunk/gui_callbacks.c	2007-09-08 09:34:45 UTC (rev 83)
@@ -705,7 +705,8 @@
     gdk_threads_leave();
 
     sanitize_crop_settings(&cropleft, &cropright, &croptop, &cropbottom);
-    hmg_crop(&map, &map_width, &map_height, cropleft, cropright, croptop, cropbottom);
+    hmg_crop(&map, &map_width, &map_height, cropleft, cropright, croptop,
+                                                                cropbottom);
     render_map(args);
 
     activate_main_notebook(args, 1);



From ivop at mail.berlios.de  Sat Sep  8 13:41:22 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 8 Sep 2007 13:41:22 +0200
Subject: [Hmgen-svnlog] r84 - trunk
Message-ID: <200709081141.l88BfMXv017841@sheep.berlios.de>

Author: ivop
Date: 2007-09-08 13:41:11 +0200 (Sat, 08 Sep 2007)
New Revision: 84

Modified:
   trunk/cli_main.c
   trunk/lib_hmgen.h
   trunk/lib_postproc.c
Log:
lib: global level adjustment, cli: enable level adjustment


Modified: trunk/cli_main.c
===================================================================
--- trunk/cli_main.c	2007-09-08 09:34:45 UTC (rev 83)
+++ trunk/cli_main.c	2007-09-08 11:41:11 UTC (rev 84)
@@ -21,7 +21,8 @@
 static int normmin = DEF_NORMMIN, normmax = DEF_NORMMAX,
            normfirst = 0, normlast = 0, inv = 0, clip = 0,
            clipmin = DEF_CLIPMIN, clipmax = DEF_CLIPMAX,
-           crop = 0, cropleft = 0, cropright = 0, croptop = 0, cropbottom = 0;
+           crop = 0, cropleft = 0, cropright = 0, croptop = 0, cropbottom = 0,
+           level = 0;
 static unsigned int w, h;
 static char *outfile = NULL;
 static char *colfile = NULL;
@@ -77,6 +78,7 @@
 "-cropright INT     crop right margin (0-..) [default: 0]\n"
 "-croptop INT       crop top margin (0-..) [default: 0]\n"
 "-cropbottom INT    crop bottom margin (0-..) [default: 0]\n"
+"-level INT         posprocess, in/decrease level (-255-255) [default: 0]\n"
 "\n",
         HMG_VERSION_STRING, HMG_COPYRIGHT_STRING, argv[0],
         DEF_NORMMIN, DEF_NORMMAX,
@@ -168,6 +170,9 @@
         } else if (!strcmp(argv[a], "-cropbottom")) {
             if (!test_argument(a, argc, argv)) return 0;
             cropbottom = atoi(argv[++a]);
+        } else if (!strcmp(argv[a], "-level")) {
+            if (!test_argument(a, argc, argv)) return 0;
+            level = atoi(argv[++a]);
         } else {
             fprintf(stderr, "unknown option: %s\n", argv[a]);
             return 0;
@@ -221,6 +226,10 @@
         fprintf(stderr, "horizontal cropping beyond width\n");
         return 0;
     }
+    if (level < -255 || level > 255) {
+        fprintf(stderr, "level out of range [-255,255]\n");
+        return 0;
+    }
     return 1;
 }
 
@@ -268,6 +277,8 @@
         hmg_invert(map, w, h);
     if (clip)
         hmg_clip(map, clipmin, clipmax, w, h);
+    if (level)
+        hmg_level(map, level, w, h);
     if (normlast)
         hmg_normalize(map, normmin, normmax, w, h);
 

Modified: trunk/lib_hmgen.h
===================================================================
--- trunk/lib_hmgen.h	2007-09-08 09:34:45 UTC (rev 83)
+++ trunk/lib_hmgen.h	2007-09-08 11:41:11 UTC (rev 84)
@@ -47,6 +47,8 @@
               unsigned int left, unsigned int right,
               unsigned int top, unsigned int bottom);
 
+void hmg_level(unsigned char *map, int adjust, unsigned int w, unsigned int h);
+
 extern unsigned char hmg_colormap[256][3];
 
 typedef struct hmg_colormap_settings_s {

Modified: trunk/lib_postproc.c
===================================================================
--- trunk/lib_postproc.c	2007-09-08 09:34:45 UTC (rev 83)
+++ trunk/lib_postproc.c	2007-09-08 11:41:11 UTC (rev 84)
@@ -157,3 +157,22 @@
     *pmap = realloc(*pmap, *width * *height);
     progress_meter(-1);
 }
+
+#undef  HMGEN_MODULE
+#define HMGEN_MODULE "Level"
+
+void hmg_level(unsigned char *map, int adjust, unsigned int w, unsigned int h){
+    unsigned int x, y;
+    int v;
+
+    for (y=0; y<h; y++) {
+        progress_meter((int)round(y*100.0/(h-1)));
+        for (x=0; x<w; x++) {
+            v = map[x] + adjust;
+            v = v > 255 ? 255 : v;
+            map[x] = v < 0 ? 0 : v;
+        }
+        map += w;
+    }
+    progress_meter(-1);
+}



From ivop at mail.berlios.de  Sat Sep  8 13:46:34 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 8 Sep 2007 13:46:34 +0200
Subject: [Hmgen-svnlog] r85 - trunk
Message-ID: <200709081146.l88BkYOY019729@sheep.berlios.de>

Author: ivop
Date: 2007-09-08 13:46:33 +0200 (Sat, 08 Sep 2007)
New Revision: 85

Modified:
   trunk/gui_interface.c
Log:
cosmetics


Modified: trunk/gui_interface.c
===================================================================
--- trunk/gui_interface.c	2007-09-08 11:41:11 UTC (rev 84)
+++ trunk/gui_interface.c	2007-09-08 11:46:33 UTC (rev 85)
@@ -1455,7 +1455,6 @@
   GLADE_HOOKUP_OBJECT (hmgengui, crop_enable_checkbutton, "crop_enable_checkbutton");
   GLADE_HOOKUP_OBJECT (hmgengui, clip_enable_checkbutton, "clip_enable_checkbutton");
 
-
   gtk_notebook_set_current_page(GTK_NOTEBOOK(main_notebook), 1);
 
   return hmgengui;



From ivop at mail.berlios.de  Sat Sep  8 13:52:27 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 8 Sep 2007 13:52:27 +0200
Subject: [Hmgen-svnlog] r86 - in trunk: . assist
Message-ID: <200709081152.l88BqR2S021550@sheep.berlios.de>

Author: ivop
Date: 2007-09-08 13:52:26 +0200 (Sat, 08 Sep 2007)
New Revision: 86

Modified:
   trunk/assist/hmgengui.glade
   trunk/gui_interface.c
Log:
level adjustment GUI components


Modified: trunk/assist/hmgengui.glade
===================================================================
--- trunk/assist/hmgengui.glade	2007-09-08 11:46:33 UTC (rev 85)
+++ trunk/assist/hmgengui.glade	2007-09-08 11:52:26 UTC (rev 86)
@@ -1125,6 +1125,114 @@
 		      <property name="type">tab</property>
 		    </packing>
 		  </child>
+
+		  <child>
+		    <widget class="GtkTable" id="table21">
+		      <property name="border_width">8</property>
+		      <property name="visible">True</property>
+		      <property name="n_rows">3</property>
+		      <property name="n_columns">3</property>
+		      <property name="homogeneous">False</property>
+		      <property name="row_spacing">8</property>
+		      <property name="column_spacing">8</property>
+
+		      <child>
+			<widget class="GtkLabel" id="label72">
+			  <property name="visible">True</property>
+			  <property name="label" translatable="yes">Adjustment +/-</property>
+			  <property name="use_underline">False</property>
+			  <property name="use_markup">False</property>
+			  <property name="justify">GTK_JUSTIFY_LEFT</property>
+			  <property name="wrap">False</property>
+			  <property name="selectable">False</property>
+			  <property name="xalign">0</property>
+			  <property name="yalign">0.5</property>
+			  <property name="xpad">0</property>
+			  <property name="ypad">0</property>
+			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			  <property name="width_chars">-1</property>
+			  <property name="single_line_mode">False</property>
+			  <property name="angle">0</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">0</property>
+			  <property name="right_attach">1</property>
+			  <property name="top_attach">0</property>
+			  <property name="bottom_attach">1</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options"></property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkSpinButton" id="level2_adjust_spinbutton">
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="climb_rate">1</property>
+			  <property name="digits">0</property>
+			  <property name="numeric">False</property>
+			  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+			  <property name="snap_to_ticks">False</property>
+			  <property name="wrap">False</property>
+			  <property name="adjustment">0 -255 255 1 10 10</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">1</property>
+			  <property name="right_attach">2</property>
+			  <property name="top_attach">0</property>
+			  <property name="bottom_attach">1</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options"></property>
+			</packing>
+		      </child>
+
+		      <child>
+			<widget class="GtkButton" id="level2_adjust_button">
+			  <property name="visible">True</property>
+			  <property name="can_focus">True</property>
+			  <property name="label" translatable="yes">Adjust</property>
+			  <property name="use_underline">True</property>
+			  <property name="relief">GTK_RELIEF_NORMAL</property>
+			  <property name="focus_on_click">True</property>
+			</widget>
+			<packing>
+			  <property name="left_attach">1</property>
+			  <property name="right_attach">2</property>
+			  <property name="top_attach">1</property>
+			  <property name="bottom_attach">2</property>
+			  <property name="x_options">fill</property>
+			  <property name="y_options"></property>
+			</packing>
+		      </child>
+		    </widget>
+		    <packing>
+		      <property name="tab_expand">False</property>
+		      <property name="tab_fill">True</property>
+		    </packing>
+		  </child>
+
+		  <child>
+		    <widget class="GtkLabel" id="label71">
+		      <property name="visible">True</property>
+		      <property name="label" translatable="yes">Level</property>
+		      <property name="use_underline">False</property>
+		      <property name="use_markup">False</property>
+		      <property name="justify">GTK_JUSTIFY_LEFT</property>
+		      <property name="wrap">False</property>
+		      <property name="selectable">False</property>
+		      <property name="xalign">0.5</property>
+		      <property name="yalign">0.5</property>
+		      <property name="xpad">0</property>
+		      <property name="ypad">0</property>
+		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+		      <property name="width_chars">-1</property>
+		      <property name="single_line_mode">False</property>
+		      <property name="angle">0</property>
+		    </widget>
+		    <packing>
+		      <property name="type">tab</property>
+		    </packing>
+		  </child>
 		</widget>
 		<packing>
 		  <property name="padding">0</property>
@@ -2307,6 +2415,117 @@
 			      <property name="type">tab</property>
 			    </packing>
 			  </child>
+
+			  <child>
+			    <widget class="GtkTable" id="table20">
+			      <property name="border_width">8</property>
+			      <property name="visible">True</property>
+			      <property name="n_rows">3</property>
+			      <property name="n_columns">3</property>
+			      <property name="homogeneous">False</property>
+			      <property name="row_spacing">8</property>
+			      <property name="column_spacing">8</property>
+
+			      <child>
+				<widget class="GtkCheckButton" id="level_enable_checkbutton">
+				  <property name="visible">True</property>
+				  <property name="can_focus">True</property>
+				  <property name="label" translatable="yes">Enable</property>
+				  <property name="use_underline">True</property>
+				  <property name="relief">GTK_RELIEF_NORMAL</property>
+				  <property name="focus_on_click">True</property>
+				  <property name="active">False</property>
+				  <property name="inconsistent">False</property>
+				  <property name="draw_indicator">True</property>
+				</widget>
+				<packing>
+				  <property name="left_attach">0</property>
+				  <property name="right_attach">1</property>
+				  <property name="top_attach">0</property>
+				  <property name="bottom_attach">1</property>
+				  <property name="x_options">fill</property>
+				  <property name="y_options"></property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkLabel" id="label70">
+				  <property name="visible">True</property>
+				  <property name="label" translatable="yes">Adjustment +/-</property>
+				  <property name="use_underline">False</property>
+				  <property name="use_markup">False</property>
+				  <property name="justify">GTK_JUSTIFY_LEFT</property>
+				  <property name="wrap">False</property>
+				  <property name="selectable">False</property>
+				  <property name="xalign">0</property>
+				  <property name="yalign">0.5</property>
+				  <property name="xpad">0</property>
+				  <property name="ypad">0</property>
+				  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+				  <property name="width_chars">-1</property>
+				  <property name="single_line_mode">False</property>
+				  <property name="angle">0</property>
+				</widget>
+				<packing>
+				  <property name="left_attach">0</property>
+				  <property name="right_attach">1</property>
+				  <property name="top_attach">1</property>
+				  <property name="bottom_attach">2</property>
+				  <property name="x_options">fill</property>
+				  <property name="y_options"></property>
+				</packing>
+			      </child>
+
+			      <child>
+				<widget class="GtkSpinButton" id="level_adjustment_spinbutton">
+				  <property name="visible">True</property>
+				  <property name="can_focus">True</property>
+				  <property name="climb_rate">1</property>
+				  <property name="digits">0</property>
+				  <property name="numeric">False</property>
+				  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
+				  <property name="snap_to_ticks">False</property>
+				  <property name="wrap">False</property>
+				  <property name="adjustment">0 -255 255 1 10 10</property>
+				</widget>
+				<packing>
+				  <property name="left_attach">1</property>
+				  <property name="right_attach">2</property>
+				  <property name="top_attach">1</property>
+				  <property name="bottom_attach">2</property>
+				  <property name="x_options">fill</property>
+				  <property name="y_options"></property>
+				</packing>
+			      </child>
+			    </widget>
+			    <packing>
+			      <property name="tab_expand">False</property>
+			      <property name="tab_fill">True</property>
+			    </packing>
+			  </child>
+
+			  <child>
+			    <widget class="GtkLabel" id="label69">
+			      <property name="visible">True</property>
+			      <property name="label" translatable="yes">Level</property>
+			      <property name="use_underline">False</property>
+			      <property name="use_markup">False</property>
+			      <property name="justify">GTK_JUSTIFY_LEFT</property>
+			      <property name="wrap">False</property>
+			      <property name="selectable">False</property>
+			      <property name="xalign">0.5</property>
+			      <property name="yalign">0.5</property>
+			      <property name="xpad">0</property>
+			      <property name="ypad">0</property>
+			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
+			      <property name="width_chars">-1</property>
+			      <property name="single_line_mode">False</property>
+			      <property name="angle">0</property>
+			    </widget>
+			    <packing>
+			      <property name="type">tab</property>
+			    </packing>
+			  </child>
 			</widget>
 		      </child>
 		    </widget>

Modified: trunk/gui_interface.c
===================================================================
--- trunk/gui_interface.c	2007-09-08 11:46:33 UTC (rev 85)
+++ trunk/gui_interface.c	2007-09-08 11:52:26 UTC (rev 86)
@@ -70,7 +70,10 @@
   GtkWidget *crop_right_spinbutton, *crop_top_spinbutton;
   GtkWidget *crop_bottom_spinbutton, *label52, *table16, *label56, *label57;
   GtkWidget *clip_min_spinbutton, *clip_max_spinbutton, *label53;
-  GtkWidget *crop_enable_checkbutton, *clip_enable_checkbutton;
+  GtkWidget *crop_enable_checkbutton, *clip_enable_checkbutton, *table21;
+  GtkWidget *label72, *level2_adjust_spinbutton, *level2_adjust_button;
+  GtkWidget *label71, *table20, *level_enable_checkbutton, *label70;
+  GtkWidget *level_adjustment_spinbutton, *label69;
 
   GtkObject *norm_min_spinbutton_adj, *norm_max_spinbutton_adj;
   GtkObject *blur_sigma_spinbutton_adj, *blur_yradius_spinbutton_adj;
@@ -92,6 +95,7 @@
   GtkObject *crop_left_spinbutton_adj, *crop_right_spinbutton_adj;
   GtkObject *crop_top_spinbutton_adj, *crop_bottom_spinbutton_adj;
   GtkObject *clip_min_spinbutton_adj, *clip_max_spinbutton_adj;
+  GtkObject *level2_adjust_spinbutton_adj, *level_adjustment_spinbutton_adj;
 
   hmgengui = gtk_window_new (GTK_WINDOW_TOPLEVEL);
 //  gtk_widget_set_size_request (hmgengui, 800, -1);
@@ -420,6 +424,37 @@
   gtk_widget_show (label54);
   gtk_notebook_set_tab_label (GTK_NOTEBOOK (view_sidepanel_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (view_sidepanel_notebook), 5), label54);
 
+  table21 = gtk_table_new (3, 3, FALSE);
+  gtk_widget_show (table21);
+  gtk_container_add (GTK_CONTAINER (view_sidepanel_notebook), table21);
+  gtk_container_set_border_width (GTK_CONTAINER (table21), 8);
+  gtk_table_set_row_spacings (GTK_TABLE (table21), 8);
+  gtk_table_set_col_spacings (GTK_TABLE (table21), 8);
+
+  label72 = gtk_label_new ("Adjustment +/-");
+  gtk_widget_show (label72);
+  gtk_table_attach (GTK_TABLE (table21), label72, 0, 1, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_misc_set_alignment (GTK_MISC (label72), 0, 0.5);
+
+  level2_adjust_spinbutton_adj = gtk_adjustment_new (0, -255, 255, 1, 10, 10);
+  level2_adjust_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (level2_adjust_spinbutton_adj), 1, 0);
+  gtk_widget_show (level2_adjust_spinbutton);
+  gtk_table_attach (GTK_TABLE (table21), level2_adjust_spinbutton, 1, 2, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  level2_adjust_button = gtk_button_new_with_mnemonic ("Adjust");
+  gtk_widget_show (level2_adjust_button);
+  gtk_table_attach (GTK_TABLE (table21), level2_adjust_button, 1, 2, 1, 2,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  label71 = gtk_label_new ("Level");
+  gtk_widget_show (label71);
+  gtk_notebook_set_tab_label (GTK_NOTEBOOK (view_sidepanel_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (view_sidepanel_notebook), 6), label71);
+
   view_scrolledwindow = gtk_scrolled_window_new (NULL, NULL);
   gtk_widget_show (view_scrolledwindow);
   gtk_box_pack_start (GTK_BOX (hbox5), view_scrolledwindow, TRUE, TRUE, 0);
@@ -759,6 +794,37 @@
   gtk_widget_show (label53);
   gtk_notebook_set_tab_label (GTK_NOTEBOOK (postprocessing_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (postprocessing_notebook), 4), label53);
 
+  table20 = gtk_table_new (3, 3, FALSE);
+  gtk_widget_show (table20);
+  gtk_container_add (GTK_CONTAINER (postprocessing_notebook), table20);
+  gtk_container_set_border_width (GTK_CONTAINER (table20), 8);
+  gtk_table_set_row_spacings (GTK_TABLE (table20), 8);
+  gtk_table_set_col_spacings (GTK_TABLE (table20), 8);
+
+  level_enable_checkbutton = gtk_check_button_new_with_mnemonic ("Enable");
+  gtk_widget_show (level_enable_checkbutton);
+  gtk_table_attach (GTK_TABLE (table20), level_enable_checkbutton, 0, 1, 0, 1,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  label70 = gtk_label_new ("Adjustment +/-");
+  gtk_widget_show (label70);
+  gtk_table_attach (GTK_TABLE (table20), label70, 0, 1, 1, 2,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+  gtk_misc_set_alignment (GTK_MISC (label70), 0, 0.5);
+
+  level_adjustment_spinbutton_adj = gtk_adjustment_new (0, -255, 255, 1, 10, 10);
+  level_adjustment_spinbutton = gtk_spin_button_new (GTK_ADJUSTMENT (level_adjustment_spinbutton_adj), 1, 0);
+  gtk_widget_show (level_adjustment_spinbutton);
+  gtk_table_attach (GTK_TABLE (table20), level_adjustment_spinbutton, 1, 2, 1, 2,
+                    (GtkAttachOptions) (GTK_FILL),
+                    (GtkAttachOptions) (0), 0, 0);
+
+  label69 = gtk_label_new ("Level");
+  gtk_widget_show (label69);
+  gtk_notebook_set_tab_label (GTK_NOTEBOOK (postprocessing_notebook), gtk_notebook_get_nth_page (GTK_NOTEBOOK (postprocessing_notebook), 5), label69);
+
   label7 = gtk_label_new ("Postprocessing");
   gtk_widget_show (label7);
   gtk_frame_set_label_widget (GTK_FRAME (frame2), label7);
@@ -1454,6 +1520,10 @@
   GLADE_HOOKUP_OBJECT (hmgengui, clip_max_spinbutton, "clip_max_spinbutton");
   GLADE_HOOKUP_OBJECT (hmgengui, crop_enable_checkbutton, "crop_enable_checkbutton");
   GLADE_HOOKUP_OBJECT (hmgengui, clip_enable_checkbutton, "clip_enable_checkbutton");
+  GLADE_HOOKUP_OBJECT (hmgengui, level2_adjust_spinbutton, "level2_adjust_spinbutton");
+  GLADE_HOOKUP_OBJECT (hmgengui, level2_adjust_button, "level2_adjust_button");
+  GLADE_HOOKUP_OBJECT (hmgengui, level_enable_checkbutton, "level_enable_checkbutton");
+  GLADE_HOOKUP_OBJECT (hmgengui, level_adjustment_spinbutton, "level_adjustment_spinbutton");
 
   gtk_notebook_set_current_page(GTK_NOTEBOOK(main_notebook), 1);
 



From ivop at mail.berlios.de  Sat Sep  8 14:21:12 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 8 Sep 2007 14:21:12 +0200
Subject: [Hmgen-svnlog] r87 - trunk
Message-ID: <200709081221.l88CLCtg029470@sheep.berlios.de>

Author: ivop
Date: 2007-09-08 14:21:11 +0200 (Sat, 08 Sep 2007)
New Revision: 87

Modified:
   trunk/gui_callbacks.c
   trunk/gui_callbacks.h
   trunk/gui_interface.c
Log:
enable gui level adjustment


Modified: trunk/gui_callbacks.c
===================================================================
--- trunk/gui_callbacks.c	2007-09-08 11:52:26 UTC (rev 86)
+++ trunk/gui_callbacks.c	2007-09-08 12:21:11 UTC (rev 87)
@@ -230,7 +230,8 @@
     unsigned int dims[] = { 3, 5, 9, 17, 33, 65, 129, 257, 513, 1025, 2049, 4097, 8193, 16385 };
     unsigned int normmin, normmax, normfirst, normlast, inv, blurx, blury;
     unsigned int blur, crop, cropleft, cropright, croptop, cropbottom;
-    unsigned int clip, clipmin, clipmax;
+    unsigned int clip, clipmin, clipmax, level;
+    int adjust;
     double blursigma;
     char *settings;
  
@@ -283,6 +284,8 @@
         clip        = get_check_button_active(args, "clip_enable_checkbutton");
         clipmin     = get_spin_button_int    (args, "clip_min_spinbutton");
         clipmax     = get_spin_button_int    (args, "clip_max_spinbutton");
+        level       = get_check_button_active(args, "level_enable_checkbutton");
+        adjust      = get_spin_button_int    (args, "level_adjust_spinbutton");
     gdk_threads_leave();
 
     if (crop) {
@@ -299,6 +302,8 @@
         hmg_invert(map, map_width, map_height);
     if (clip)
         hmg_clip(map, clipmin, clipmax, map_width, map_height);
+    if (level)
+        hmg_level(map, adjust, map_width, map_height);
     if (normlast)
         hmg_normalize(map, normmin, normmax, map_width, map_height);
 
@@ -718,3 +723,26 @@
     deactivate_main_notebook(button);
     g_thread_create(crop2_thread, button, FALSE, NULL);
 }
+
+static void *level2_thread(void *args) {
+    int adjust;
+
+    set_main_progressbar(args);
+    hmg_progress_meter = gui_progress_meter;
+
+    gdk_threads_enter();
+        adjust = get_spin_button_int  (args, "level2_adjust_spinbutton");
+    gdk_threads_leave();
+
+    hmg_level(map, adjust, map_width, map_height);
+    render_map(args);
+
+    activate_main_notebook(args, 1);
+    return NULL;
+}
+
+void on_level2_button_clicked(GtkButton *button,
+                                   gpointer user_data HMG_ATTR_UNUSED) {
+    deactivate_main_notebook(button);
+    g_thread_create(level2_thread, button, FALSE, NULL);
+}

Modified: trunk/gui_callbacks.h
===================================================================
--- trunk/gui_callbacks.h	2007-09-08 11:52:26 UTC (rev 86)
+++ trunk/gui_callbacks.h	2007-09-08 12:21:11 UTC (rev 87)
@@ -14,6 +14,7 @@
 void on_invert2_button_clicked    (GtkButton *button, gpointer user_data);
 void on_clip_button_clicked       (GtkButton *button, gpointer user_data);
 void on_crop_button_clicked       (GtkButton *button, gpointer user_data);
+void on_level2_button_clicked     (GtkButton *button, gpointer user_data);
 void on_export_save_button_clicked(GtkButton *button, gpointer user_data);
 void on_colormap_update_button_clicked(GtkButton *button, gpointer user_data);
 void on_colormap_redraw_2dview_button_clicked(GtkButton *button,

Modified: trunk/gui_interface.c
===================================================================
--- trunk/gui_interface.c	2007-09-08 11:52:26 UTC (rev 86)
+++ trunk/gui_interface.c	2007-09-08 12:21:11 UTC (rev 87)
@@ -1420,6 +1420,8 @@
                     G_CALLBACK (on_clip_button_clicked), NULL);
   g_signal_connect ((gpointer) crop_button, "clicked",
                     G_CALLBACK (on_crop_button_clicked), NULL);
+  g_signal_connect ((gpointer) level2_adjust_button, "clicked",
+                    G_CALLBACK (on_level2_button_clicked), NULL);
 
   /* Store pointers to all widgets, for use by lookup_widget(). */
   GLADE_HOOKUP_OBJECT_NO_REF (hmgengui, hmgengui, "hmgengui");
@@ -1523,7 +1525,7 @@
   GLADE_HOOKUP_OBJECT (hmgengui, level2_adjust_spinbutton, "level2_adjust_spinbutton");
   GLADE_HOOKUP_OBJECT (hmgengui, level2_adjust_button, "level2_adjust_button");
   GLADE_HOOKUP_OBJECT (hmgengui, level_enable_checkbutton, "level_enable_checkbutton");
-  GLADE_HOOKUP_OBJECT (hmgengui, level_adjustment_spinbutton, "level_adjustment_spinbutton");
+  GLADE_HOOKUP_OBJECT (hmgengui, level_adjustment_spinbutton, "level_adjust_spinbutton");
 
   gtk_notebook_set_current_page(GTK_NOTEBOOK(main_notebook), 1);
 



From ivop at mail.berlios.de  Sat Sep  8 14:28:44 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 8 Sep 2007 14:28:44 +0200
Subject: [Hmgen-svnlog] r88 - trunk
Message-ID: <200709081228.l88CSiae029874@sheep.berlios.de>

Author: ivop
Date: 2007-09-08 14:28:44 +0200 (Sat, 08 Sep 2007)
New Revision: 88

Added:
   trunk/license.h
Log:
license header, to be prepended to every (future) file


Added: trunk/license.h
===================================================================
--- trunk/license.h	2007-09-08 12:21:11 UTC (rev 87)
+++ trunk/license.h	2007-09-08 12:28:44 UTC (rev 88)
@@ -0,0 +1,19 @@
+/*
+ * hmgen - Height Map Generator
+ * Copyright (C) 2007 Ivo van Poorten
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *                                   
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+ *
+ */



From ivop at mail.berlios.de  Sat Sep  8 14:36:03 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 8 Sep 2007 14:36:03 +0200
Subject: [Hmgen-svnlog] r89 - trunk
Message-ID: <200709081236.l88Ca35g030373@sheep.berlios.de>

Author: ivop
Date: 2007-09-08 14:36:03 +0200 (Sat, 08 Sep 2007)
New Revision: 89

Modified:
   trunk/license.h
Log:
change layout


Modified: trunk/license.h
===================================================================
--- trunk/license.h	2007-09-08 12:28:44 UTC (rev 88)
+++ trunk/license.h	2007-09-08 12:36:03 UTC (rev 89)
@@ -1,19 +1,21 @@
 /*
- * hmgen - Height Map Generator
- * Copyright (C) 2007 Ivo van Poorten
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *                                   
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
- *
+
+    hmgen - Height Map Generator
+    Copyright (C) 2007 Ivo van Poorten
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+
  */
+



From ivop at mail.berlios.de  Sat Sep  8 14:40:38 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 8 Sep 2007 14:40:38 +0200
Subject: [Hmgen-svnlog] r90 - trunk
Message-ID: <200709081240.l88Cecqj030575@sheep.berlios.de>

Author: ivop
Date: 2007-09-08 14:40:37 +0200 (Sat, 08 Sep 2007)
New Revision: 90

Modified:
   trunk/cli_main.c
   trunk/gui_callbacks.c
   trunk/gui_callbacks.h
   trunk/gui_interface.c
   trunk/gui_interface.h
   trunk/gui_main.c
   trunk/gui_support.c
   trunk/gui_support.h
   trunk/lib_algo_ff.c
   trunk/lib_algo_mpd.c
   trunk/lib_export.c
   trunk/lib_hmgen.c
   trunk/lib_hmgen.h
   trunk/lib_postproc.c
   trunk/lib_util.c
Log:
proper license headings


Modified: trunk/cli_main.c
===================================================================
--- trunk/cli_main.c	2007-09-08 12:36:03 UTC (rev 89)
+++ trunk/cli_main.c	2007-09-08 12:40:37 UTC (rev 90)
@@ -1,3 +1,24 @@
+/*
+
+    hmgen - Height Map Generator
+    Copyright (C) 2007 Ivo van Poorten
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+
+ */
+
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>

Modified: trunk/gui_callbacks.c
===================================================================
--- trunk/gui_callbacks.c	2007-09-08 12:36:03 UTC (rev 89)
+++ trunk/gui_callbacks.c	2007-09-08 12:40:37 UTC (rev 90)
@@ -1,3 +1,24 @@
+/*
+
+    hmgen - Height Map Generator
+    Copyright (C) 2007 Ivo van Poorten
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+
+ */
+
 #include <gtk/gtk.h>
 #include <string.h>
 #include <assert.h>

Modified: trunk/gui_callbacks.h
===================================================================
--- trunk/gui_callbacks.h	2007-09-08 12:36:03 UTC (rev 89)
+++ trunk/gui_callbacks.h	2007-09-08 12:40:37 UTC (rev 90)
@@ -1,3 +1,24 @@
+/*
+
+    hmgen - Height Map Generator
+    Copyright (C) 2007 Ivo van Poorten
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+
+ */
+
 #ifndef HMG_GUI_CALLBACKS_H
 #define HMG_GUI_CALLBACKS_H
 

Modified: trunk/gui_interface.c
===================================================================
--- trunk/gui_interface.c	2007-09-08 12:36:03 UTC (rev 89)
+++ trunk/gui_interface.c	2007-09-08 12:40:37 UTC (rev 90)
@@ -1,3 +1,24 @@
+/*
+
+    hmgen - Height Map Generator
+    Copyright (C) 2007 Ivo van Poorten
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+
+ */
+
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <unistd.h>

Modified: trunk/gui_interface.h
===================================================================
--- trunk/gui_interface.h	2007-09-08 12:36:03 UTC (rev 89)
+++ trunk/gui_interface.h	2007-09-08 12:40:37 UTC (rev 90)
@@ -1,3 +1,24 @@
+/*
+
+    hmgen - Height Map Generator
+    Copyright (C) 2007 Ivo van Poorten
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+
+ */
+
 #ifndef HMG_GUI_INTERFACE_H
 #define HMG_GUI_INTERFACE_H
 

Modified: trunk/gui_main.c
===================================================================
--- trunk/gui_main.c	2007-09-08 12:36:03 UTC (rev 89)
+++ trunk/gui_main.c	2007-09-08 12:40:37 UTC (rev 90)
@@ -1,3 +1,24 @@
+/*
+
+    hmgen - Height Map Generator
+    Copyright (C) 2007 Ivo van Poorten
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+
+ */
+
 #include <gtk/gtk.h>
 #include <locale.h>
 #include <stdlib.h>

Modified: trunk/gui_support.c
===================================================================
--- trunk/gui_support.c	2007-09-08 12:36:03 UTC (rev 89)
+++ trunk/gui_support.c	2007-09-08 12:40:37 UTC (rev 90)
@@ -1,3 +1,24 @@
+/*
+
+    hmgen - Height Map Generator
+    Copyright (C) 2007 Ivo van Poorten
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+
+ */
+
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <unistd.h>

Modified: trunk/gui_support.h
===================================================================
--- trunk/gui_support.h	2007-09-08 12:36:03 UTC (rev 89)
+++ trunk/gui_support.h	2007-09-08 12:40:37 UTC (rev 90)
@@ -1,3 +1,24 @@
+/*
+
+    hmgen - Height Map Generator
+    Copyright (C) 2007 Ivo van Poorten
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+
+ */
+
 #ifndef HMG_GUI_SUPPORT_H
 #define HMG_GUI_SUPPORT_H
 

Modified: trunk/lib_algo_ff.c
===================================================================
--- trunk/lib_algo_ff.c	2007-09-08 12:36:03 UTC (rev 89)
+++ trunk/lib_algo_ff.c	2007-09-08 12:40:37 UTC (rev 90)
@@ -1,3 +1,24 @@
+/*
+
+    hmgen - Height Map Generator
+    Copyright (C) 2007 Ivo van Poorten
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+
+ */
+
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>

Modified: trunk/lib_algo_mpd.c
===================================================================
--- trunk/lib_algo_mpd.c	2007-09-08 12:36:03 UTC (rev 89)
+++ trunk/lib_algo_mpd.c	2007-09-08 12:40:37 UTC (rev 90)
@@ -1,3 +1,24 @@
+/*
+
+    hmgen - Height Map Generator
+    Copyright (C) 2007 Ivo van Poorten
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+
+ */
+
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>

Modified: trunk/lib_export.c
===================================================================
--- trunk/lib_export.c	2007-09-08 12:36:03 UTC (rev 89)
+++ trunk/lib_export.c	2007-09-08 12:40:37 UTC (rev 90)
@@ -1,3 +1,24 @@
+/*
+
+    hmgen - Height Map Generator
+    Copyright (C) 2007 Ivo van Poorten
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+
+ */
+
 #include <stdio.h>
 #include "lib_hmgen.h"
 

Modified: trunk/lib_hmgen.c
===================================================================
--- trunk/lib_hmgen.c	2007-09-08 12:36:03 UTC (rev 89)
+++ trunk/lib_hmgen.c	2007-09-08 12:40:37 UTC (rev 90)
@@ -1,3 +1,24 @@
+/*
+
+    hmgen - Height Map Generator
+    Copyright (C) 2007 Ivo van Poorten
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+
+ */
+
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>

Modified: trunk/lib_hmgen.h
===================================================================
--- trunk/lib_hmgen.h	2007-09-08 12:36:03 UTC (rev 89)
+++ trunk/lib_hmgen.h	2007-09-08 12:40:37 UTC (rev 90)
@@ -1,3 +1,24 @@
+/*
+
+    hmgen - Height Map Generator
+    Copyright (C) 2007 Ivo van Poorten
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+
+ */
+
 #ifndef HMG_LIB_HMGEN_H
 #define HMG_LIB_HMGEN_H
 

Modified: trunk/lib_postproc.c
===================================================================
--- trunk/lib_postproc.c	2007-09-08 12:36:03 UTC (rev 89)
+++ trunk/lib_postproc.c	2007-09-08 12:40:37 UTC (rev 90)
@@ -1,3 +1,24 @@
+/*
+
+    hmgen - Height Map Generator
+    Copyright (C) 2007 Ivo van Poorten
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+
+ */
+
 #include <stdio.h>
 #include <math.h>
 #include <stdlib.h>

Modified: trunk/lib_util.c
===================================================================
--- trunk/lib_util.c	2007-09-08 12:36:03 UTC (rev 89)
+++ trunk/lib_util.c	2007-09-08 12:40:37 UTC (rev 90)
@@ -1,3 +1,24 @@
+/*
+
+    hmgen - Height Map Generator
+    Copyright (C) 2007 Ivo van Poorten
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
+
+ */
+
 #include <stdio.h>
 #include <stdlib.h>
 #include <math.h>



From ivop at mail.berlios.de  Sun Sep  9 13:25:46 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sun, 9 Sep 2007 13:25:46 +0200
Subject: [Hmgen-svnlog] r91 - trunk
Message-ID: <200709091125.l89BPk6S014453@sheep.berlios.de>

Author: ivop
Date: 2007-09-09 13:25:43 +0200 (Sun, 09 Sep 2007)
New Revision: 91

Modified:
   trunk/Makefile
Log:
increase portability


Modified: trunk/Makefile
===================================================================
--- trunk/Makefile	2007-09-08 12:40:37 UTC (rev 90)
+++ trunk/Makefile	2007-09-09 11:25:43 UTC (rev 91)
@@ -273,11 +273,11 @@
 
 config-define-svnrev: config-define-none
 	@svn_rev=`LC_ALL=C svn info * 2>/dev/null | grep ^Revision: \
-		| cut -d ' ' -f 2 | xargs -n 1 -I '{}' printf "%05i\n" '{}' \
+		| cut -d ' ' -f 2 | xargs -n 1 -iX printf "%05i\n" X \
 		| sort -r | head -n 1 | sed 's/^0//' | sed 's/^0//' \
 		| sed 's/^0//'` ; \
 	test $$svn_rev || svn_rev=`grep revision .svn/entries 2>/dev/null \
-		| cut -d '"' -f 2` | xargs -n 1 -I '{}' printf "%05i\n" '{}' \
+		| cut -d '"' -f 2` | xargs -n 1 -iX printf "%05i\n" X \
 		| sort -r | head -n 1 | sed 's/^0//' | sed 's/^0//' \
 		| sed 's/^0//' ; \
 	test $$svn_rev || svn_rev=`sed -n -e '/^dir$/{n;p;q;}' \



From ivop at mail.berlios.de  Sun Sep  9 13:27:04 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sun, 9 Sep 2007 13:27:04 +0200
Subject: [Hmgen-svnlog] r92 - trunk
Message-ID: <200709091127.l89BR4wC016119@sheep.berlios.de>

Author: ivop
Date: 2007-09-09 13:27:02 +0200 (Sun, 09 Sep 2007)
New Revision: 92

Modified:
   trunk/gui_callbacks.c
Log:
fix for mingw32


Modified: trunk/gui_callbacks.c
===================================================================
--- trunk/gui_callbacks.c	2007-09-09 11:25:43 UTC (rev 91)
+++ trunk/gui_callbacks.c	2007-09-09 11:27:02 UTC (rev 92)
@@ -211,14 +211,17 @@
     gdk_threads_leave();
 }
 
-static void activate_main_notebook(void *args, int to_2dview) {
+static void activate_main_notebook(void *args, int to_2dview HMG_ATTR_UNUSED) {
     GtkWidget *widget;
 
     gdk_threads_enter();
         widget = lookup_widget(GTK_WIDGET(args), "main_notebook");
         gtk_widget_set_sensitive (widget, TRUE);
+#ifndef __WIN32__
+        // this hangs under ming32 and probably other win32 environments
         if (to_2dview)
         gtk_notebook_set_current_page(GTK_NOTEBOOK(widget), 0);
+#endif
     gdk_threads_leave();
 }
 



From ivop at mail.berlios.de  Sun Sep  9 13:34:30 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sun, 9 Sep 2007 13:34:30 +0200
Subject: [Hmgen-svnlog] r93 - trunk
Message-ID: <200709091134.l89BYUeo021427@sheep.berlios.de>

Author: ivop
Date: 2007-09-09 13:34:30 +0200 (Sun, 09 Sep 2007)
New Revision: 93

Modified:
   trunk/README
Log:
mingw build


Modified: trunk/README
===================================================================
--- trunk/README	2007-09-09 11:27:02 UTC (rev 92)
+++ trunk/README	2007-09-09 11:34:30 UTC (rev 93)
@@ -42,3 +42,7 @@
     make CC=suncc configure
     or
     make CC=suncc all
+
+Building on MingW/MSYS:
+    make CC=gcc STRIP=true
+



From ivop at mail.berlios.de  Sun Sep  9 13:48:05 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sun, 9 Sep 2007 13:48:05 +0200
Subject: [Hmgen-svnlog] r94 - trunk
Message-ID: <200709091148.l89Bm5fu018131@sheep.berlios.de>

Author: ivop
Date: 2007-09-09 13:48:04 +0200 (Sun, 09 Sep 2007)
New Revision: 94

Modified:
   trunk/Makefile
Log:
configure system and system dependant ldflags


Modified: trunk/Makefile
===================================================================
--- trunk/Makefile	2007-09-09 11:34:30 UTC (rev 93)
+++ trunk/Makefile	2007-09-09 11:48:04 UTC (rev 94)
@@ -42,7 +42,7 @@
 .SUFFIXES: $(OBJSUF) .c
 
 DEF_CFLAGS = $(STD_FLAGS) $(WARN_FLAGS) $(OPT_FLAGS) $(DEBUG_FLAGS) $(DEFINES)
-DEF_LDFLAGS = -lm $(DEBUG_FLAGS)
+DEF_LDFLAGS = -lm $(DEBUG_FLAGS) $(SYS_LDFLAGS)
 
 CLI = hmgen$(EXESUF)
 CLIg = hmgen_g$(EXESUF)
@@ -285,12 +285,35 @@
 	test $$svn_rev || svn_rev=0 ; \
 	echo DEFINES=-DSVN_REVISION=$$svn_rev >> config.mak
 
+config-system:
+	@SYSTEM=`uname -s` ; \
+	SYSTEM=`echo $$SYSTEM | tr '[A-Z]' '[a-z]'` ; \
+	case "$$SYSTEM" in \
+		linux*)     SYSTEM=linux ;; \
+		mingw*)     SYSTEM=mingw ;; \
+		*)          SYSTEM="$$SYSTEM_untested" ;; \
+	esac ; \
+	echo SYSTEM=$$SYSTEM >> config.mak ; \
+	$(call config-print-result,system,$$SYSTEM) ;
+
+config-system-ldflags:
+	@SYS_LDFLAGS= ; \
+	if grep -q SYSTEM=mingw config.mak ; then \
+		if greq -q CC_VENDOR=gnu config.mak ; then \
+			SYS_LDFLAGS=-mwindows ; \
+		fi ; \
+	fi ; \
+	echo SYS_LDFLAGS=$$SYS_LDFLAGS >> config.mak ; \
+	$(call config-print-result,system ldflags,$$SYS_LDFLAGS) ;
+
 configure: clean-config.mak \
            config-cc-flags \
            config-gtk-flags \
            config-gthread-flags \
            config-suncc-flags-fix \
-           config-define-svnrev
+           config-define-svnrev \
+		   config-system \
+		   config-system-ldflags
 	@echo AR?=ar >> config.mak
 	@echo RANLIB?=ranlib >> config.mak
 	@echo STRIP?=strip >> config.mak



From ivop at mail.berlios.de  Sun Sep  9 13:56:26 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sun, 9 Sep 2007 13:56:26 +0200
Subject: [Hmgen-svnlog] r95 - trunk
Message-ID: <200709091156.l89BuQI6018484@sheep.berlios.de>

Author: ivop
Date: 2007-09-09 13:56:25 +0200 (Sun, 09 Sep 2007)
New Revision: 95

Modified:
   trunk/Makefile
Log:
check for exe suffix and don't print any output if the result is ""


Modified: trunk/Makefile
===================================================================
--- trunk/Makefile	2007-09-09 11:48:04 UTC (rev 94)
+++ trunk/Makefile	2007-09-09 11:56:25 UTC (rev 95)
@@ -139,7 +139,9 @@
 	else \
 		col="$(Bon)" ; \
 	fi ; \
-	printf "%-16s : $$col%s$(Boff)\n" "$(1)" "$(2)"
+	if test -n "$(2)" ; then \
+		printf "%-16s : $$col%s$(Boff)\n" "$(1)" "$(2)" ; \
+	fi
 endef
 
 clean-config.mak:
@@ -296,7 +298,7 @@
 	echo SYSTEM=$$SYSTEM >> config.mak ; \
 	$(call config-print-result,system,$$SYSTEM) ;
 
-config-system-ldflags:
+config-system-ldflags: config-system
 	@SYS_LDFLAGS= ; \
 	if grep -q SYSTEM=mingw config.mak ; then \
 		if greq -q CC_VENDOR=gnu config.mak ; then \
@@ -306,6 +308,14 @@
 	echo SYS_LDFLAGS=$$SYS_LDFLAGS >> config.mak ; \
 	$(call config-print-result,system ldflags,$$SYS_LDFLAGS) ;
 
+config-exe-suf: config-system
+	@EXESUF= ; \
+	if grep -q SYSTEM=mingw config.mak ; then \
+		EXESUF=.exe ; \
+	fi ; \
+	echo EXESUF=$$EXESUF >> config.mak ; \
+	$(call config-print-result,exe suffix,$$EXESUF) ;
+
 configure: clean-config.mak \
            config-cc-flags \
            config-gtk-flags \
@@ -313,11 +323,11 @@
            config-suncc-flags-fix \
            config-define-svnrev \
 		   config-system \
-		   config-system-ldflags
+		   config-system-ldflags \
+		   config-exe-suf
 	@echo AR?=ar >> config.mak
 	@echo RANLIB?=ranlib >> config.mak
 	@echo STRIP?=strip >> config.mak
-	@echo EXESUF= >> config.mak
 	@echo OBJSUF=.o >> config.mak
 	@echo AR_FLAGS=cru >> config.mak
 	@echo CONFIGURE_DONE=yes >> config.mak



From ivop at mail.berlios.de  Sun Sep  9 13:57:58 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sun, 9 Sep 2007 13:57:58 +0200
Subject: [Hmgen-svnlog] r96 - trunk
Message-ID: <200709091157.l89BvwpI018585@sheep.berlios.de>

Author: ivop
Date: 2007-09-09 13:57:58 +0200 (Sun, 09 Sep 2007)
New Revision: 96

Modified:
   trunk/Makefile
Log:
typo


Modified: trunk/Makefile
===================================================================
--- trunk/Makefile	2007-09-09 11:56:25 UTC (rev 95)
+++ trunk/Makefile	2007-09-09 11:57:58 UTC (rev 96)
@@ -301,7 +301,7 @@
 config-system-ldflags: config-system
 	@SYS_LDFLAGS= ; \
 	if grep -q SYSTEM=mingw config.mak ; then \
-		if greq -q CC_VENDOR=gnu config.mak ; then \
+		if grep -q CC_VENDOR=gnu config.mak ; then \
 			SYS_LDFLAGS=-mwindows ; \
 		fi ; \
 	fi ; \



From ivop at mail.berlios.de  Sun Sep  9 14:07:02 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sun, 9 Sep 2007 14:07:02 +0200
Subject: [Hmgen-svnlog] r97 - trunk
Message-ID: <200709091207.l89C72LJ019248@sheep.berlios.de>

Author: ivop
Date: 2007-09-09 14:07:02 +0200 (Sun, 09 Sep 2007)
New Revision: 97

Modified:
   trunk/README
Log:
mingw can strip now that exesuf is set properly


Modified: trunk/README
===================================================================
--- trunk/README	2007-09-09 11:57:58 UTC (rev 96)
+++ trunk/README	2007-09-09 12:07:02 UTC (rev 97)
@@ -44,5 +44,5 @@
     make CC=suncc all
 
 Building on MingW/MSYS:
-    make CC=gcc STRIP=true
+    make CC=gcc
 



From ivop at mail.berlios.de  Mon Sep 10 00:31:07 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Mon, 10 Sep 2007 00:31:07 +0200
Subject: [Hmgen-svnlog] r98 - trunk
Message-ID: <200709092231.l89MV7kb009747@sheep.berlios.de>

Author: ivop
Date: 2007-09-10 00:31:01 +0200 (Mon, 10 Sep 2007)
New Revision: 98

Added:
   trunk/build.sh
Log:
New experiment, make inside shell script


Added: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-09 12:07:02 UTC (rev 97)
+++ trunk/build.sh	2007-09-09 22:31:01 UTC (rev 98)
@@ -0,0 +1,246 @@
+#! /bin/sh
+
+# Experiment #2
+#
+# Instead of putting configure inside the Makefile, which is basically calling
+# sh all the time, put 'make' functionality inside configure :) The previous
+# experiment needed a POSIX environment anyway and on top of that, it depended
+# heavily on GNU make (which is bad) and recursive make (which is worse).
+# This experiment just needs a POSIX environment and nothing more.
+
+# ----------------------------------( INIT )-----------------------------------
+
+export LC_ALL=C
+if test "$NOCOLOR" ; then Bon= ; Boff= ; Red= ; Green=
+else Bon="[1m" ; Boff="[0m" ; Red="[31m" ; Green="[32m"
+fi
+test -z "$V" && V=0
+
+# --------------------------------( CONFIGURE )--------------------------------
+
+result() {
+    if test "$2" = "no" ; then      col="$Bon$Red"
+    elif test "$2" = "yes" ; then   col="$Bon$Green"
+    else                            col="$Bon"
+    fi
+    if test -n "$2" ; then
+        printf "%-16s : $col%s$Boff\n" "$1" "$2"
+    fi
+}
+
+my_pkg_config() {
+    RES=`pkg-config --atleast-version=$4 $1 2>/dev/null && echo yes || echo no`
+    result $1 $RES
+    if test "$RES" != "yes" ; then
+        echo "$1, at least version $4, not found."
+        echo "Perhaps you need to install the dev(el) packages?"
+        exit 1
+    fi
+    eval $2=\"`pkg-config --cflags $1 2>/dev/null`\"
+    eval $3=\"`pkg-config --static --libs $1 2>/dev/null`\"
+}
+
+configure() {
+    for i in $CC cc gcc suncc icc tcc ; do
+        if which $i 2>/dev/null 1>&2 ; then
+            break
+        fi
+    done
+    CC=$i
+    CC_DEP=$i
+    result compiler $CC
+
+    CC_VENDOR=`$CC --help 2>/dev/null | grep -q gcc && echo gnu`
+    if test "$CC_VENDOR" = "gnu" ; then
+        CC_VERSION=`$CC -dumpversion`
+    else
+        CC_VENDOR=`$CC -flags 2>/dev/null | grep -q sunperf && echo sun`
+        if test "$CC_VENDOR" = "sun" ; then
+            CC_VERSION=`echo | $CC -E - | grep ident | cut -d ' ' -f 5`
+        else
+            CC_VENDOR=unknown
+            CC_DEP=true
+        fi
+    fi
+    CC_VERSION_MAJOR=`echo $CC_VERSION | cut -d '.' -f 1`
+    CC_VERSION_MINOR=`echo $CC_VERSION | cut -d '.' -f 2`
+    CC_VERSION_SUBMINOR=`echo $CC_VERSION | cut -d '.' -f 3`
+    result vendor $CC_VENDOR
+    result version $CC_VERSION
+
+    if test "$CC_VENDOR" = gnu ; then
+        if test "$CC_VERSION_MAJOR" -le 2 ; then
+            echo "gcc version < 3.x is not supported"
+            exit 1
+        fi
+    fi
+
+    case $CC_VENDOR in
+        gnu)
+            WARN_FLAGS="-Wall -W"
+            OPT_FLAGS="-O3"
+            STD_FLAGS="-std=c99"
+            DEBUG_FLAGS="-g"
+            DEP_FLAGS="-MM"
+            OBJ_OUT_FLAG="-o"
+            DONT_LINK_FLAG="-c"
+            ;;
+        sun)
+            WARN_FLAGS=
+            OPT_FLAGS="-xO5"
+            STD_FLAGS="-Xc"
+            DEBUG_FLAGS="-g"
+            DEP_FLAGS="-xM"
+            OBJ_OUT_FLAG="-o"
+            DONT_LINK_FLAG="-c"
+            ;;
+        unknown)
+            WARN_FLAGS=
+            OPT_FLAGS="-O"
+            STD_FLAGS=
+            DEBUG_FLAGS="-g"
+            DEP_FLAGS=
+            OBJ_OUT_FLAG="-o"
+            DONT_LINK_FLAG="-c"
+            ;;
+    esac
+    result warnings $WARN_FLAGS
+    result optimize $OPT_FLAGS
+    result standards $STD_FLAGS
+    result debug $DEBUG_FLAGS
+    result dependencies $DEP_FLAGS
+    result "object out" $OBJ_OUT_FLAG
+    result "do not link" $DONT_LINK_FLAG
+
+    RES=`pkg-config --version 2>/dev/null 1>&2 && echo yes || echo no`
+    result pkg-config $RES
+    if test "$RES" != "yes" ; then
+        echo "pkg-config not found"
+        exit 1
+    fi
+
+    my_pkg_config gtk+-2.0 GTK_CFLAGS GTK_LDFLAGS 2.0
+    my_pkg_config gthread-2.0 GTHREAD_CFLAGS GTHREAD_LDFLAGS 2.0
+
+    if test "$CC_VENDOR" = "sun" ; then
+        GTHREAD_CFLAGS=`echo xXx $GTHREAD_CFLAGS | sed 's/-pthread//; s/^xXx//'`
+        GTHREAD_LDFLAGS=`echo xXx $GTHREAD_LDFLAGS | sed 's/-pthread//; s/^xXx//'`
+    fi
+
+    SVN_REV=`svn info * 2>/dev/null | grep ^Revision: \
+        | cut -d ' ' -f 2 | xargs -n 1 -iX printf "%05i\n" X \
+        | sort -r | head -n 1 | sed 's/^0//' | sed 's/^0//' \
+        | sed 's/^0//'`
+    test $SVN_REV || SVN_REV=`grep revision .svn/entries 2>/dev/null \
+        | cut -d '"' -f 2` | xargs -n 1 -iX printf "%05i\n" X \
+        | sort -r | head -n 1 | sed 's/^0//' | sed 's/^0//' \
+        | sed 's/^0//'
+    test $SVN_REV || SVN_REV=`sed -n -e '/^dir$/{n;p;q;}' \
+        .svn/entries 2>/dev/null`
+    test $SVN_REV || SVN_REV=0
+
+    SYSTEM=`uname -s`
+    SYSTEM=`echo $SYSTEM | tr '[A-Z]' '[a-z]'`
+    case "$SYSTEM" in
+        linux*)     SYSTEM=linux ;;
+        mingw*)     SYSTEM=mingw ;;
+        *)          SYSTEM="$$SYSTEM_untested" ;;
+    esac
+    result system $SYSTEM
+
+    SYS_LDFLAGS=
+    if test "$SYSTEM" = "mingw" ; then
+        if test "$CC_VENDOR" = "gnu" ; then
+            SYS_LDFLAGS=-mwindows
+        fi
+    fi
+    result "system ldflags" $SYS_LDFLAGS
+
+    EXESUF=
+    if test "$SYSTEM" = "mingw" ; then
+        EXESUF=.exe
+    fi
+    result "exe suffix" $EXESUF
+}
+
+output_build_config() {
+    cat >> build.config << __EOF__
+CC="$CC"
+CC_DEP="$CC_DEP"
+CC_VENDOR="$CC_VENDOR"
+CC_VERSION="$CC_VERSION"
+CC_VERSION_MAJOR="$CC_VERSION_MAJOR"
+CC_VERSION_MINOR="$CC_VERSION_MINOR"
+CC_VERSION_SUBMINOR="$CC_VERSION_SUBMINOR"
+WARN_FLAGS="$WARN_FLAGS"
+OPT_FLAGS="$OPT_FLAGS"
+STD_FLAGS="$STD_FLAGS"
+DEBUG_FLAGS="$DEBUG_FLAGS"
+DEP_FLAGS="$DEP_FLAGS"
+OBJ_OUT_FLAG="$OBJ_OUT_FLAG"
+DONT_LINK_FLAG="$DONT_LINK_FLAG"
+GTK_CFLAGS="$GTK_CFLAGS"
+GTK_LDFLAGS="$GTK_LDFLAGS"
+GTHREAD_CFLAGS="$GTHREAD_CFLAGS"
+GTHREAD_LDFLAGS="$GTHREAD_LDFLAGS"
+DEFINES=-DSVN_REVISION="$SVN_REV"
+SYSTEM="$SYSTEM"
+SYS_LDFLAGS="$SYS_LDFLAGS"
+EXESUF="$EXESUF"
+AR=ar
+RANLIB=ranlib
+STRIP=strip
+OBJSUF=.o
+AR_FLAGS=cru
+CONFIGURE_DONE=yes
+__EOF__
+}
+
+# ----------------------------------( MAKE )-----------------------------------
+
+make_init() {
+    DEF_CFLAGS="$STD_FLAGS $WARN_FLAGS $OPT_FLAGS $DEBUG_FLAGS $DEFINES"
+    DEF_LDFLAGS="-lm $DEBUG_FLAGS $SYS_LDFLAGS"
+    CFLAGS="$DEF_CFLAGS"
+    LDFLAGS="$DEF_LDFLAGS"
+}
+
+# make_exec "command" "short text" "short text argument"
+make_exec() {
+    if test "$V" = "0" ; then   printf "$Bon%s$Boff %s\n" "$2" "$3"
+    else                        echo "$1"
+    fi
+    eval "$1"
+}
+
+# make_c_to_o filename.o
+make_c_to_o() {
+    c=`basename $1 $OBJSUF`.c
+    make_exec "$CC $DONT_LINK_FLAG $OBJ_OUT_FLAG $1 $c $CFLAGS" \
+        "compile" "$c"
+}
+
+# make_link exefilename filename.o libraries ...
+make_link() {
+    exe=$1$EXESUF ; shift 1
+    make_exec "$CC $OBJ_OUT_FLAG $exe $@" "link" "$exe"
+}
+
+# make_o_to_a filename.a object ...
+make_o_to_a() {
+    a=$1 ; shift 1
+    make_exec "$AR $AR_FLAGS $a $@" "archive" "$a"
+}
+
+# ----------------------------------( MAIN )-----------------------------------
+
+if grep -q CONFIGURE_DONE=yes build.config 2>/dev/null ; then
+    . build.config
+else
+    >build.config
+    configure
+    output_build_config
+fi
+
+make_init
+


Property changes on: trunk/build.sh
___________________________________________________________________
Name: svn:executable
   + *



From ivop at mail.berlios.de  Mon Sep 10 00:37:41 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Mon, 10 Sep 2007 00:37:41 +0200
Subject: [Hmgen-svnlog] r99 - trunk
Message-ID: <200709092237.l89MbfMI031360@sheep.berlios.de>

Author: ivop
Date: 2007-09-10 00:37:40 +0200 (Mon, 10 Sep 2007)
New Revision: 99

Modified:
   trunk/
Log:
ignore build.sh cache file



Property changes on: trunk
___________________________________________________________________
Name: svn:ignore
   - hmgen
hmgengui
libhmgen.a
.depend
hmgen_g
hmgengui_g
config.mak
svn-commit.*

   + hmgen
hmgengui
libhmgen.a
.depend
hmgen_g
hmgengui_g
config.mak
svn-commit.*
build.config




From ivop at mail.berlios.de  Mon Sep 10 14:10:04 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Mon, 10 Sep 2007 14:10:04 +0200
Subject: [Hmgen-svnlog] r100 - trunk
Message-ID: <200709101210.l8ACA4MR028365@sheep.berlios.de>

Author: ivop
Date: 2007-09-10 14:10:04 +0200 (Mon, 10 Sep 2007)
New Revision: 100

Modified:
   trunk/build.sh
Log:
deps work, compilation works, todo: archiving and linking


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-09 22:37:40 UTC (rev 99)
+++ trunk/build.sh	2007-09-10 12:10:04 UTC (rev 100)
@@ -8,6 +8,8 @@
 # heavily on GNU make (which is bad) and recursive make (which is worse).
 # This experiment just needs a POSIX environment and nothing more.
 
+# FIXME head/tail -1/-n 1 stuff
+
 # ----------------------------------( INIT )-----------------------------------
 
 export LC_ALL=C
@@ -139,7 +141,7 @@
         .svn/entries 2>/dev/null`
     test $SVN_REV || SVN_REV=0
 
-    SYSTEM=`uname -s`
+    SYSTEM=`uname -s 2>/dev/null`
     SYSTEM=`echo $SYSTEM | tr '[A-Z]' '[a-z]'`
     case "$SYSTEM" in
         linux*)     SYSTEM=linux ;;
@@ -196,8 +198,52 @@
 __EOF__
 }
 
+# ----------------------------------( UTIL )-----------------------------------
+
+# unwrap lines --> sort --> uniq --> merge equal target lines and change syntax
+ccdeps_to_shdeps() {
+    awk '/[\\]$/ { $NF="" ; printf("%s",$0) ; next } { print }' |
+    sort |
+    uniq |
+    awk '
+        BEGIN { save="" }
+        {   if (save==$1) {
+                ORS="" ;
+                for (i=2; i <= NF; i++) {
+                    if (substr($i,1,1) != "/") { print " " $i }
+                }
+            } else {
+                if (save != "") { ORS="\"\n" ; print " " }
+                ORS="" ; save=$1
+                print "deps_"
+                for (i=1; i <= length($1) ; i++) {
+                    c=substr($1,i,1) ;
+                    if (c == ".") { c = "_" }
+                    if (c == "/") { c = "__" }
+                    if (c == ":") { c = "=\"" }
+                    print c
+                }
+                for (i=2; i <= NF; i++) {
+                    if (substr($i,1,1) != "/") { print " " $i }
+                }
+            }
+        }
+        END { if (save != "") { ORS="\"\n" ; print " " } }'
+}
+
 # ----------------------------------( MAKE )-----------------------------------
 
+# "docs":
+#
+# make_exec     "command"       "short text"    "short text argument"
+# make_c_to_o   filename.o
+# make_link     exefilename     filename.o      libraries ...
+# make_o_to_a   filename.a      object ...
+# addsuffix     suffix          basenames ...
+# up_to_date    target          deps ...
+#
+# make_init_object_deps objects ...
+
 make_init() {
     DEF_CFLAGS="$STD_FLAGS $WARN_FLAGS $OPT_FLAGS $DEBUG_FLAGS $DEFINES"
     DEF_LDFLAGS="-lm $DEBUG_FLAGS $SYS_LDFLAGS"
@@ -205,7 +251,6 @@
     LDFLAGS="$DEF_LDFLAGS"
 }
 
-# make_exec "command" "short text" "short text argument"
 make_exec() {
     if test "$V" = "0" ; then   printf "$Bon%s$Boff %s\n" "$2" "$3"
     else                        echo "$1"
@@ -213,34 +258,103 @@
     eval "$1"
 }
 
-# make_c_to_o filename.o
 make_c_to_o() {
     c=`basename $1 $OBJSUF`.c
-    make_exec "$CC $DONT_LINK_FLAG $OBJ_OUT_FLAG $1 $c $CFLAGS" \
-        "compile" "$c"
+    make_exec "$CC $DONT_LINK_FLAG $OBJ_OUT_FLAG $1 $c $CFLAGS" "compile" "$c"
 }
 
-# make_link exefilename filename.o libraries ...
 make_link() {
     exe=$1$EXESUF ; shift 1
     make_exec "$CC $OBJ_OUT_FLAG $exe $@" "link" "$exe"
 }
 
-# make_o_to_a filename.a object ...
 make_o_to_a() {
     a=$1 ; shift 1
     make_exec "$AR $AR_FLAGS $a $@" "archive" "$a"
 }
 
+addsuffix() {
+    suf=$1 ; shift 1
+    for i in $@ ; do
+        echo $i$suf
+    done
+}
+
+up_to_date() {
+    r=`ls -t1 $@ 2>/dev/null | head -1`
+    case $r in
+        $1) true ;;
+        *)  false ;;
+    esac
+}
+
+mangle() {
+    echo $1 | sed 's/\./_/g; s/\//__/g;' # change . and / into _ and __
+}
+
+make_init_object_deps() {
+    for i in $@ ; do
+        j=`mangle $i`
+        defdep=`basename $i $OBJSUF`.c
+        eval deps_$j=$defdep
+    done
+}
+
+make_check_objects() {
+    for i in $@ ; do
+        j=`mangle $i`
+        eval deps=\"\$deps_$j\"
+        if up_to_date $i $deps ; then
+            :
+        else
+            make_c_to_o $i
+        fi
+    done
+}
+
+make_dep() {
+    make_exec "$CC_DEP $DEP_FLAGS $DEF_CFLAGS $GTK_CFLAGS $GTHREAD_CFLAGS `echo $@` | ccdeps_to_shdeps >> build.dep" "ccdep" "build.dep"
+}
+
+make_init_project() {
+    libhmgen_basenames="lib_algo_ff lib_algo_mpd lib_algo_forge lib_postproc \
+                        lib_util lib_hmgen lib_export"
+    libhmgen_objs=`addsuffix $OBJSUF $libhmgen_basenames`
+    libhmgen_srcs=`addsuffix .c $libhmgen_basenames`
+
+    cli_basenames="cli_main"
+    cli_objs=`addsuffix $OBJSUF $cli_basenames`
+    cli_srcs=`addsuffix .c $cli_basenames`
+
+    gui_basenames="gui_main gui_callbacks gui_interface gui_support"
+    gui_objs=`addsuffix $OBJSUF $gui_basenames`
+    gui_srcs=`addsuffix .c $gui_basenames`
+
+    make_init_object_deps $libhmgen_objs $cli_objs $gui_objs
+}
+
 # ----------------------------------( MAIN )-----------------------------------
 
 if grep -q CONFIGURE_DONE=yes build.config 2>/dev/null ; then
+    result "previous config" "build.config"
     . build.config
 else
-    >build.config
+    > build.config
     configure
     output_build_config
 fi
 
 make_init
+make_init_project
 
+if ! grep -q deps_done=yes build.dep 2>/dev/null ; then
+    > build.dep
+    make_dep $libhmgen_srcs $cli_srcs $gui_srcs
+    echo "deps_done=yes" >> build.dep
+fi
+
+. build.dep
+
+make_check_objects $libhmgen_objs
+make_check_objects $cli_objs
+



From ivop at mail.berlios.de  Mon Sep 10 14:17:43 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Mon, 10 Sep 2007 14:17:43 +0200
Subject: [Hmgen-svnlog] r101 - trunk
Message-ID: <200709101217.l8ACHhNK028793@sheep.berlios.de>

Author: ivop
Date: 2007-09-10 14:17:43 +0200 (Mon, 10 Sep 2007)
New Revision: 101

Modified:
   trunk/build.sh
Log:
fix first build (OBJSUF was not set)


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-10 12:10:04 UTC (rev 100)
+++ trunk/build.sh	2007-09-10 12:17:43 UTC (rev 101)
@@ -163,6 +163,9 @@
         EXESUF=.exe
     fi
     result "exe suffix" $EXESUF
+
+    OBJSUF=.o
+    result "obj suffix" $OBJSUF
 }
 
 output_build_config() {
@@ -192,7 +195,7 @@
 AR=ar
 RANLIB=ranlib
 STRIP=strip
-OBJSUF=.o
+OBJSUF="$OBJSUF"
 AR_FLAGS=cru
 CONFIGURE_DONE=yes
 __EOF__



From ivop at mail.berlios.de  Mon Sep 10 14:21:18 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Mon, 10 Sep 2007 14:21:18 +0200
Subject: [Hmgen-svnlog] r102 - trunk
Message-ID: <200709101221.l8ACLIsD028969@sheep.berlios.de>

Author: ivop
Date: 2007-09-10 14:21:18 +0200 (Mon, 10 Sep 2007)
New Revision: 102

Modified:
   trunk/build.sh
Log:
fix the same problem for ar, ranlib, etc... on first call of build.sh


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-10 12:17:43 UTC (rev 101)
+++ trunk/build.sh	2007-09-10 12:21:18 UTC (rev 102)
@@ -166,6 +166,18 @@
 
     OBJSUF=.o
     result "obj suffix" $OBJSUF
+
+    AR=ar
+    result "ar" $AR
+
+    AR_FLAGS=cru
+    result "ar flags" $AR_FLAGS
+
+    RANLIB=ranlib
+    result "ranlib" $RANLIB
+
+    STRIP=strip
+    result "strip" $STRIP
 }
 
 output_build_config() {
@@ -192,11 +204,11 @@
 SYSTEM="$SYSTEM"
 SYS_LDFLAGS="$SYS_LDFLAGS"
 EXESUF="$EXESUF"
-AR=ar
-RANLIB=ranlib
-STRIP=strip
+AR="$AR"
+AR_FLAGS="$AR_FLAGS"
+RANLIB="$RANLIB"
+STRIP="$STRIP"
 OBJSUF="$OBJSUF"
-AR_FLAGS=cru
 CONFIGURE_DONE=yes
 __EOF__
 }



From ivop at mail.berlios.de  Mon Sep 10 14:29:35 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Mon, 10 Sep 2007 14:29:35 +0200
Subject: [Hmgen-svnlog] r103 - trunk
Message-ID: <200709101229.l8ACTZmU029691@sheep.berlios.de>

Author: ivop
Date: 2007-09-10 14:29:34 +0200 (Mon, 10 Sep 2007)
New Revision: 103

Modified:
   trunk/build.sh
Log:
faster up_to_date check


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-10 12:21:18 UTC (rev 102)
+++ trunk/build.sh	2007-09-10 12:29:34 UTC (rev 103)
@@ -297,10 +297,7 @@
 
 up_to_date() {
     r=`ls -t1 $@ 2>/dev/null | head -1`
-    case $r in
-        $1) true ;;
-        *)  false ;;
-    esac
+    test "$r" = "$1"
 }
 
 mangle() {



From ivop at mail.berlios.de  Tue Sep 11 14:53:07 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 11 Sep 2007 14:53:07 +0200
Subject: [Hmgen-svnlog] r104 - trunk
Message-ID: <200709111253.l8BCr74I018334@sheep.berlios.de>

Author: ivop
Date: 2007-09-11 14:53:07 +0200 (Tue, 11 Sep 2007)
New Revision: 104

Modified:
   trunk/build.sh
Log:
finish build procedure
up_to_date seems to fail on arhives and objects; save first, fix later


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-10 12:29:34 UTC (rev 103)
+++ trunk/build.sh	2007-09-11 12:53:07 UTC (rev 104)
@@ -280,12 +280,12 @@
 
 make_link() {
     exe=$1$EXESUF ; shift 1
-    make_exec "$CC $OBJ_OUT_FLAG $exe $@" "link" "$exe"
+    make_exec "$CC $OBJ_OUT_FLAG $exe `echo $@` $LDFLAGS" "link" "$exe"
 }
 
 make_o_to_a() {
     a=$1 ; shift 1
-    make_exec "$AR $AR_FLAGS $a $@" "archive" "$a"
+    make_exec "$AR $AR_FLAGS $a `echo $@`" "archive" "$a"
 }
 
 addsuffix() {
@@ -304,7 +304,7 @@
     echo $1 | sed 's/\./_/g; s/\//__/g;' # change . and / into _ and __
 }
 
-make_init_object_deps() {
+make_set_default_object_deps() {
     for i in $@ ; do
         j=`mangle $i`
         defdep=`basename $i $OBJSUF`.c
@@ -312,18 +312,48 @@
     done
 }
 
-make_check_objects() {
+make_set_deps() {
+    x=$1; shift 1
+    x=`mangle $x`
+    eval deps_$x=\"$@\"
+}
+
+make_objects() {
     for i in $@ ; do
         j=`mangle $i`
         eval deps=\"\$deps_$j\"
-        if up_to_date $i $deps ; then
-            :
-        else
+        if ! up_to_date $i $deps ; then
             make_c_to_o $i
         fi
     done
 }
 
+make_lib() {
+    lib=$1; shift
+    libm=`mangle $lib`
+    eval libdeps=\"\$deps_$libm\"
+    make_objects $libdeps
+    if ! up_to_date $lib $libdeps ; then
+        make_o_to_a $lib $libdeps
+    fi
+}
+
+make_exe() {
+    t=$1; shift
+    tm=`mangle $t`
+    eval exedeps=\"\$deps_$tm\"
+    for i in $exedeps ; do
+        case $i in
+            *$OBJSUF)   make_objects $i ;;
+            *.a)        make_lib $i ;;
+            *)          echo unknown dep $i !! ; exit 2 ;;
+        esac
+    done
+    if ! up_to_date $t $exedeps ; then
+        make_link $t $exedeps
+    fi
+}
+
 make_dep() {
     make_exec "$CC_DEP $DEP_FLAGS $DEF_CFLAGS $GTK_CFLAGS $GTHREAD_CFLAGS `echo $@` | ccdeps_to_shdeps >> build.dep" "ccdep" "build.dep"
 }
@@ -333,16 +363,22 @@
                         lib_util lib_hmgen lib_export"
     libhmgen_objs=`addsuffix $OBJSUF $libhmgen_basenames`
     libhmgen_srcs=`addsuffix .c $libhmgen_basenames`
+    libhmgen=libhmgen.a
 
     cli_basenames="cli_main"
     cli_objs=`addsuffix $OBJSUF $cli_basenames`
     cli_srcs=`addsuffix .c $cli_basenames`
+    cli_exe=hmgen_g$EXESUF
 
     gui_basenames="gui_main gui_callbacks gui_interface gui_support"
     gui_objs=`addsuffix $OBJSUF $gui_basenames`
     gui_srcs=`addsuffix .c $gui_basenames`
+    gui_exe=hmgengui_g$EXESUF
 
-    make_init_object_deps $libhmgen_objs $cli_objs $gui_objs
+    make_set_default_object_deps $libhmgen_objs $cli_objs $gui_objs
+    make_set_deps $libhmgen $libhmgen_objs
+    make_set_deps $cli_exe $cli_objs $libhmgen
+    make_set_deps $gui_exe $gui_objs $libhmgen
 }
 
 # ----------------------------------( MAIN )-----------------------------------
@@ -367,6 +403,10 @@
 
 . build.dep
 
-make_check_objects $libhmgen_objs
-make_check_objects $cli_objs
+make_exe $cli_exe
 
+CFLAGS="$DEF_CFLAGS $GTK_CFLAGS $GTHREAD_CFLAGS"
+LDFLAGS="$DEF_LDFLAGS $GTK_LDFLAGS $GTHREAD_LDFLAGS"
+make_exe $gui_exe
+
+echo "done"



From ivop at mail.berlios.de  Tue Sep 11 15:04:00 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 11 Sep 2007 15:04:00 +0200
Subject: [Hmgen-svnlog] r105 - trunk
Message-ID: <200709111304.l8BD40DS019183@sheep.berlios.de>

Author: ivop
Date: 2007-09-11 15:04:00 +0200 (Tue, 11 Sep 2007)
New Revision: 105

Modified:
   trunk/build.sh
Log:
touch archives to fix deps problem
stripping exe's at the end


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-11 12:53:07 UTC (rev 104)
+++ trunk/build.sh	2007-09-11 13:04:00 UTC (rev 105)
@@ -286,6 +286,7 @@
 make_o_to_a() {
     a=$1 ; shift 1
     make_exec "$AR $AR_FLAGS $a `echo $@`" "archive" "$a"
+    touch $a
 }
 
 addsuffix() {
@@ -409,4 +410,13 @@
 LDFLAGS="$DEF_LDFLAGS $GTK_LDFLAGS $GTHREAD_LDFLAGS"
 make_exe $gui_exe
 
+if ! up_to_date hmgen $cli_exe ; then
+    make_exec "cp $cli_exe hmgen" "copy" "$cli_exe hmgen"
+    make_exec "$STRIP hmgen" "strip" "hmgen"
+fi
+if ! up_to_date hmgengui $gui_exe ; then
+    make_exec "cp $gui_exe hmgengui" "copy" "$gui_exe hmgengui"
+    make_exec "$STRIP hmgengui" "strip" "hmgengui"
+fi
+
 echo "done"



From ivop at mail.berlios.de  Tue Sep 11 15:07:41 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 11 Sep 2007 15:07:41 +0200
Subject: [Hmgen-svnlog] r106 - trunk
Message-ID: <200709111307.l8BD7fuD019457@sheep.berlios.de>

Author: ivop
Date: 2007-09-11 15:07:41 +0200 (Tue, 11 Sep 2007)
New Revision: 106

Modified:
   trunk/build.sh
Log:
run ranlib on archives


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-11 13:04:00 UTC (rev 105)
+++ trunk/build.sh	2007-09-11 13:07:41 UTC (rev 106)
@@ -286,6 +286,7 @@
 make_o_to_a() {
     a=$1 ; shift 1
     make_exec "$AR $AR_FLAGS $a `echo $@`" "archive" "$a"
+    make_exec "$RANLIB $a" "ranlib" "$a"
     touch $a
 }
 



From ivop at mail.berlios.de  Tue Sep 11 15:28:44 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 11 Sep 2007 15:28:44 +0200
Subject: [Hmgen-svnlog] r107 - trunk
Message-ID: <200709111328.l8BDSiBO020720@sheep.berlios.de>

Author: ivop
Date: 2007-09-11 15:28:43 +0200 (Tue, 11 Sep 2007)
New Revision: 107

Modified:
   trunk/build.sh
Log:
if you depend on generated files (i.e. archives on objects, or executables
on archives and objects) the mod-times can be exactle the same.
apparently milliseconds are not accounted for (how does the real make do
this?). a sideeffect of that is that if you run build.sh two times in a row,
some stuff gets rearchived or relinked. to avoid that, we sleep 1s and touch
the target (.a or .exe) after creating it. this slows down the build process
and is a hack, but it has to do for now.


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-11 13:07:41 UTC (rev 106)
+++ trunk/build.sh	2007-09-11 13:28:43 UTC (rev 107)
@@ -281,13 +281,16 @@
 make_link() {
     exe=$1$EXESUF ; shift 1
     make_exec "$CC $OBJ_OUT_FLAG $exe `echo $@` $LDFLAGS" "link" "$exe"
+    sleep 1
+    touch -c $exe
 }
 
 make_o_to_a() {
     a=$1 ; shift 1
     make_exec "$AR $AR_FLAGS $a `echo $@`" "archive" "$a"
     make_exec "$RANLIB $a" "ranlib" "$a"
-    touch $a
+    sleep 1
+    touch -c $a
 }
 
 addsuffix() {



From ivop at mail.berlios.de  Tue Sep 11 15:30:19 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 11 Sep 2007 15:30:19 +0200
Subject: [Hmgen-svnlog] r108 - trunk
Message-ID: <200709111330.l8BDUJpe020846@sheep.berlios.de>

Author: ivop
Date: 2007-09-11 15:30:18 +0200 (Tue, 11 Sep 2007)
New Revision: 108

Modified:
   trunk/build.sh
Log:
EXESUF is already added during linking


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-11 13:28:43 UTC (rev 107)
+++ trunk/build.sh	2007-09-11 13:30:18 UTC (rev 108)
@@ -373,12 +373,12 @@
     cli_basenames="cli_main"
     cli_objs=`addsuffix $OBJSUF $cli_basenames`
     cli_srcs=`addsuffix .c $cli_basenames`
-    cli_exe=hmgen_g$EXESUF
+    cli_exe=hmgen_g
 
     gui_basenames="gui_main gui_callbacks gui_interface gui_support"
     gui_objs=`addsuffix $OBJSUF $gui_basenames`
     gui_srcs=`addsuffix .c $gui_basenames`
-    gui_exe=hmgengui_g$EXESUF
+    gui_exe=hmgengui_g
 
     make_set_default_object_deps $libhmgen_objs $cli_objs $gui_objs
     make_set_deps $libhmgen $libhmgen_objs



From ivop at mail.berlios.de  Tue Sep 11 15:31:09 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 11 Sep 2007 15:31:09 +0200
Subject: [Hmgen-svnlog] r109 - trunk
Message-ID: <200709111331.l8BDV9tg020907@sheep.berlios.de>

Author: ivop
Date: 2007-09-11 15:31:09 +0200 (Tue, 11 Sep 2007)
New Revision: 109

Modified:
   trunk/build.sh
Log:
reading config instead of previous config to be clear about what build.sh is
doing


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-11 13:30:18 UTC (rev 108)
+++ trunk/build.sh	2007-09-11 13:31:09 UTC (rev 109)
@@ -389,7 +389,7 @@
 # ----------------------------------( MAIN )-----------------------------------
 
 if grep -q CONFIGURE_DONE=yes build.config 2>/dev/null ; then
-    result "previous config" "build.config"
+    result "reading config" "build.config"
     . build.config
 else
     > build.config



From ivop at mail.berlios.de  Tue Sep 11 15:50:12 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 11 Sep 2007 15:50:12 +0200
Subject: [Hmgen-svnlog] r110 - trunk
Message-ID: <200709111350.l8BDoCON021933@sheep.berlios.de>

Author: ivop
Date: 2007-09-11 15:50:11 +0200 (Tue, 11 Sep 2007)
New Revision: 110

Modified:
   trunk/build.sh
Log:
remove half of stupid msdos eols


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-11 13:31:09 UTC (rev 109)
+++ trunk/build.sh	2007-09-11 13:50:11 UTC (rev 110)
@@ -217,6 +217,7 @@
 
 # unwrap lines --> sort --> uniq --> merge equal target lines and change syntax
 ccdeps_to_shdeps() {
+    tr -d '\015' |
     awk '/[\\]$/ { $NF="" ; printf("%s",$0) ; next } { print }' |
     sort |
     uniq |



From ivop at mail.berlios.de  Tue Sep 11 15:57:12 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 11 Sep 2007 15:57:12 +0200
Subject: [Hmgen-svnlog] r111 - trunk
Message-ID: <200709111357.l8BDvCNC022332@sheep.berlios.de>

Author: ivop
Date: 2007-09-11 15:57:12 +0200 (Tue, 11 Sep 2007)
New Revision: 111

Modified:
   trunk/build.sh
Log:
set exe suffixes in project and not during linking/stripping


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-11 13:50:11 UTC (rev 110)
+++ trunk/build.sh	2007-09-11 13:57:12 UTC (rev 111)
@@ -280,7 +280,7 @@
 }
 
 make_link() {
-    exe=$1$EXESUF ; shift 1
+    exe=$1 ; shift 1
     make_exec "$CC $OBJ_OUT_FLAG $exe `echo $@` $LDFLAGS" "link" "$exe"
     sleep 1
     touch -c $exe
@@ -374,17 +374,19 @@
     cli_basenames="cli_main"
     cli_objs=`addsuffix $OBJSUF $cli_basenames`
     cli_srcs=`addsuffix .c $cli_basenames`
-    cli_exe=hmgen_g
+    cli_g_exe=hmgen_g$EXESUF
+    cli_exe=hmgen$EXESUF
 
     gui_basenames="gui_main gui_callbacks gui_interface gui_support"
     gui_objs=`addsuffix $OBJSUF $gui_basenames`
     gui_srcs=`addsuffix .c $gui_basenames`
-    gui_exe=hmgengui_g
+    gui_g_exe=hmgengui_g$EXESUF
+    gui_exe=hmgengui$EXESUF
 
     make_set_default_object_deps $libhmgen_objs $cli_objs $gui_objs
     make_set_deps $libhmgen $libhmgen_objs
-    make_set_deps $cli_exe $cli_objs $libhmgen
-    make_set_deps $gui_exe $gui_objs $libhmgen
+    make_set_deps $cli_g_exe $cli_objs $libhmgen
+    make_set_deps $gui_g_exe $gui_objs $libhmgen
 }
 
 # ----------------------------------( MAIN )-----------------------------------
@@ -409,19 +411,19 @@
 
 . build.dep
 
-make_exe $cli_exe
+make_exe $cli_g_exe
 
 CFLAGS="$DEF_CFLAGS $GTK_CFLAGS $GTHREAD_CFLAGS"
 LDFLAGS="$DEF_LDFLAGS $GTK_LDFLAGS $GTHREAD_LDFLAGS"
-make_exe $gui_exe
+make_exe $gui_g_exe
 
-if ! up_to_date hmgen $cli_exe ; then
-    make_exec "cp $cli_exe hmgen" "copy" "$cli_exe hmgen"
-    make_exec "$STRIP hmgen" "strip" "hmgen"
+if ! up_to_date $cli_exe $cli_g_exe ; then
+    make_exec "cp $cli_g_exe $cli_exe" "copy" "$cli_g_exe $cli_exe"
+    make_exec "$STRIP $cli_exe" "strip" "$cli_exe"
 fi
-if ! up_to_date hmgengui $gui_exe ; then
-    make_exec "cp $gui_exe hmgengui" "copy" "$gui_exe hmgengui"
-    make_exec "$STRIP hmgengui" "strip" "hmgengui"
+if ! up_to_date $gui_exe $gui_g_exe ; then
+    make_exec "cp $gui_g_exe $gui_exe" "copy" "$gui_g_exe $gui_exe"
+    make_exec "$STRIP $gui_exe" "strip" "$gui_exe"
 fi
 
 echo "done"



From ivop at mail.berlios.de  Tue Sep 11 16:49:13 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 11 Sep 2007 16:49:13 +0200
Subject: [Hmgen-svnlog] r112 - trunk
Message-ID: <200709111449.l8BEnD0U025460@sheep.berlios.de>

Author: ivop
Date: 2007-09-11 16:49:12 +0200 (Tue, 11 Sep 2007)
New Revision: 112

Modified:
   trunk/build.sh
Log:
be more verbose about reading and writing build.* files


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-11 13:57:12 UTC (rev 111)
+++ trunk/build.sh	2007-09-11 14:49:12 UTC (rev 112)
@@ -181,6 +181,7 @@
 }
 
 output_build_config() {
+   echo writing build.config
     cat >> build.config << __EOF__
 CC="$CC"
 CC_DEP="$CC_DEP"
@@ -392,7 +393,7 @@
 # ----------------------------------( MAIN )-----------------------------------
 
 if grep -q CONFIGURE_DONE=yes build.config 2>/dev/null ; then
-    result "reading config" "build.config"
+    echo reading build.config
     . build.config
 else
     > build.config
@@ -409,6 +410,7 @@
     echo "deps_done=yes" >> build.dep
 fi
 
+echo reading build.dep
 . build.dep
 
 make_exe $cli_g_exe



From ivop at mail.berlios.de  Tue Sep 11 17:01:28 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 11 Sep 2007 17:01:28 +0200
Subject: [Hmgen-svnlog] r113 - trunk
Message-ID: <200709111501.l8BF1SBL026317@sheep.berlios.de>

Author: ivop
Date: 2007-09-11 17:01:28 +0200 (Tue, 11 Sep 2007)
New Revision: 113

Modified:
   trunk/build.sh
Log:
fix for mingw/msys, remove x:/paths


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-11 14:49:12 UTC (rev 112)
+++ trunk/build.sh	2007-09-11 15:01:28 UTC (rev 113)
@@ -227,7 +227,9 @@
         {   if (save==$1) {
                 ORS="" ;
                 for (i=2; i <= NF; i++) {
-                    if (substr($i,1,1) != "/") { print " " $i }
+                    if ((substr($i,1,1) != "/") && (substr($i,2,2) != ":/")) {
+                        print " " $i
+                    }
                 }
             } else {
                 if (save != "") { ORS="\"\n" ; print " " }
@@ -241,7 +243,9 @@
                     print c
                 }
                 for (i=2; i <= NF; i++) {
-                    if (substr($i,1,1) != "/") { print " " $i }
+                    if ((substr($i,1,1) != "/") && (substr($i,2,2) != ":/")) {
+                        print " " $i
+                    }
                 }
             }
         }



From ivop at mail.berlios.de  Tue Sep 11 17:09:25 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 11 Sep 2007 17:09:25 +0200
Subject: [Hmgen-svnlog] r114 - trunk
Message-ID: <200709111509.l8BF9P1j026799@sheep.berlios.de>

Author: ivop
Date: 2007-09-11 17:09:25 +0200 (Tue, 11 Sep 2007)
New Revision: 114

Modified:
   trunk/build.sh
Log:
fix svn revision define


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-11 15:01:28 UTC (rev 113)
+++ trunk/build.sh	2007-09-11 15:09:25 UTC (rev 114)
@@ -129,6 +129,7 @@
         GTHREAD_LDFLAGS=`echo xXx $GTHREAD_LDFLAGS | sed 's/-pthread//; s/^xXx//'`
     fi
 
+    DEFINES=
     SVN_REV=`svn info * 2>/dev/null | grep ^Revision: \
         | cut -d ' ' -f 2 | xargs -n 1 -iX printf "%05i\n" X \
         | sort -r | head -n 1 | sed 's/^0//' | sed 's/^0//' \
@@ -140,6 +141,7 @@
     test $SVN_REV || SVN_REV=`sed -n -e '/^dir$/{n;p;q;}' \
         .svn/entries 2>/dev/null`
     test $SVN_REV || SVN_REV=0
+    DEFINES="$DEFINES -DSVN_REVISION=$SVN_REV"
 
     SYSTEM=`uname -s 2>/dev/null`
     SYSTEM=`echo $SYSTEM | tr '[A-Z]' '[a-z]'`
@@ -201,7 +203,7 @@
 GTK_LDFLAGS="$GTK_LDFLAGS"
 GTHREAD_CFLAGS="$GTHREAD_CFLAGS"
 GTHREAD_LDFLAGS="$GTHREAD_LDFLAGS"
-DEFINES=-DSVN_REVISION="$SVN_REV"
+DEFINES="-DSVN_REVISION=$SVN_REV"
 SYSTEM="$SYSTEM"
 SYS_LDFLAGS="$SYS_LDFLAGS"
 EXESUF="$EXESUF"



From ivop at mail.berlios.de  Wed Sep 12 02:11:22 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 02:11:22 +0200
Subject: [Hmgen-svnlog] r115 - trunk
Message-ID: <200709120011.l8C0BM0w019042@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 02:11:21 +0200 (Wed, 12 Sep 2007)
New Revision: 115

Modified:
   trunk/build.sh
Log:
portable head/tail (-n) n


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-11 15:09:25 UTC (rev 114)
+++ trunk/build.sh	2007-09-12 00:11:21 UTC (rev 115)
@@ -8,8 +8,6 @@
 # heavily on GNU make (which is bad) and recursive make (which is worse).
 # This experiment just needs a POSIX environment and nothing more.
 
-# FIXME head/tail -1/-n 1 stuff
-
 # ----------------------------------( INIT )-----------------------------------
 
 export LC_ALL=C
@@ -18,6 +16,17 @@
 fi
 test -z "$V" && V=0
 
+if test "`(echo first ; echo last) | head -1 2>/dev/null`" = "first" ; then
+    _head() { head -$1 2>/dev/null ; }
+else
+    _head() { head -n $1 2>/dev/null ; }
+fi
+if test "`(echo first ; echo last) | tail -1 2>/dev/null`" = "last" ; then
+    _tail() { tail -$1 2>/dev/null ; }
+else
+    _tail() { tail -n $1 2>/dev/null ; }
+fi
+
 # --------------------------------( CONFIGURE )--------------------------------
 
 result() {
@@ -132,11 +141,11 @@
     DEFINES=
     SVN_REV=`svn info * 2>/dev/null | grep ^Revision: \
         | cut -d ' ' -f 2 | xargs -n 1 -iX printf "%05i\n" X \
-        | sort -r | head -n 1 | sed 's/^0//' | sed 's/^0//' \
+        | sort -r | _head 1 | sed 's/^0//' | sed 's/^0//' \
         | sed 's/^0//'`
     test $SVN_REV || SVN_REV=`grep revision .svn/entries 2>/dev/null \
         | cut -d '"' -f 2` | xargs -n 1 -iX printf "%05i\n" X \
-        | sort -r | head -n 1 | sed 's/^0//' | sed 's/^0//' \
+        | sort -r | _head 1 | sed 's/^0//' | sed 's/^0//' \
         | sed 's/^0//'
     test $SVN_REV || SVN_REV=`sed -n -e '/^dir$/{n;p;q;}' \
         .svn/entries 2>/dev/null`
@@ -309,7 +318,7 @@
 }
 
 up_to_date() {
-    r=`ls -t1 $@ 2>/dev/null | head -1`
+    r=`ls -t1 $@ 2>/dev/null | _head 1`
     test "$r" = "$1"
 }
 



From ivop at mail.berlios.de  Wed Sep 12 02:16:27 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 02:16:27 +0200
Subject: [Hmgen-svnlog] r116 - trunk
Message-ID: <200709120016.l8C0GR2v023971@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 02:16:18 +0200 (Wed, 12 Sep 2007)
New Revision: 116

Modified:
   trunk/build.sh
Log:
portable not operator for /bin/sh's that don't have !


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 00:11:21 UTC (rev 115)
+++ trunk/build.sh	2007-09-12 00:16:18 UTC (rev 116)
@@ -27,6 +27,11 @@
     _tail() { tail -n $1 2>/dev/null ; }
 fi
 
+not() {
+    eval "$@"
+    test $? -ne 0
+}
+
 # --------------------------------( CONFIGURE )--------------------------------
 
 result() {
@@ -344,7 +349,7 @@
     for i in $@ ; do
         j=`mangle $i`
         eval deps=\"\$deps_$j\"
-        if ! up_to_date $i $deps ; then
+        if not up_to_date $i $deps ; then
             make_c_to_o $i
         fi
     done
@@ -355,7 +360,7 @@
     libm=`mangle $lib`
     eval libdeps=\"\$deps_$libm\"
     make_objects $libdeps
-    if ! up_to_date $lib $libdeps ; then
+    if not up_to_date $lib $libdeps ; then
         make_o_to_a $lib $libdeps
     fi
 }
@@ -368,10 +373,10 @@
         case $i in
             *$OBJSUF)   make_objects $i ;;
             *.a)        make_lib $i ;;
-            *)          echo unknown dep $i !! ; exit 2 ;;
+            *)          echo unknown dep $i ; exit 2 ;;
         esac
     done
-    if ! up_to_date $t $exedeps ; then
+    if not up_to_date $t $exedeps ; then
         make_link $t $exedeps
     fi
 }
@@ -419,7 +424,7 @@
 make_init
 make_init_project
 
-if ! grep -q deps_done=yes build.dep 2>/dev/null ; then
+if not grep -q deps_done=yes build.dep 2>/dev/null ; then
     > build.dep
     make_dep $libhmgen_srcs $cli_srcs $gui_srcs
     echo "deps_done=yes" >> build.dep
@@ -434,11 +439,11 @@
 LDFLAGS="$DEF_LDFLAGS $GTK_LDFLAGS $GTHREAD_LDFLAGS"
 make_exe $gui_g_exe
 
-if ! up_to_date $cli_exe $cli_g_exe ; then
+if not up_to_date $cli_exe $cli_g_exe ; then
     make_exec "cp $cli_g_exe $cli_exe" "copy" "$cli_g_exe $cli_exe"
     make_exec "$STRIP $cli_exe" "strip" "$cli_exe"
 fi
-if ! up_to_date $gui_exe $gui_g_exe ; then
+if not up_to_date $gui_exe $gui_g_exe ; then
     make_exec "cp $gui_g_exe $gui_exe" "copy" "$gui_g_exe $gui_exe"
     make_exec "$STRIP $gui_exe" "strip" "$gui_exe"
 fi



From ivop at mail.berlios.de  Wed Sep 12 02:18:02 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 02:18:02 +0200
Subject: [Hmgen-svnlog] r117 - trunk
Message-ID: <200709120018.l8C0I2iB025595@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 02:18:01 +0200 (Wed, 12 Sep 2007)
New Revision: 117

Modified:
   trunk/build.sh
Log:
bla


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 00:16:18 UTC (rev 116)
+++ trunk/build.sh	2007-09-12 00:18:01 UTC (rev 117)
@@ -7,6 +7,7 @@
 # experiment needed a POSIX environment anyway and on top of that, it depended
 # heavily on GNU make (which is bad) and recursive make (which is worse).
 # This experiment just needs a POSIX environment and nothing more.
+# Or perhaps not not POSIX ;)
 
 # ----------------------------------( INIT )-----------------------------------
 



From ivop at mail.berlios.de  Wed Sep 12 02:22:41 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 02:22:41 +0200
Subject: [Hmgen-svnlog] r118 - trunk
Message-ID: <200709120022.l8C0Mffv029946@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 02:22:40 +0200 (Wed, 12 Sep 2007)
New Revision: 118

Modified:
   trunk/build.sh
Log:
sysv/bsd echo -n stuff (not used yet)


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 00:18:01 UTC (rev 117)
+++ trunk/build.sh	2007-09-12 00:22:40 UTC (rev 118)
@@ -33,6 +33,11 @@
     test $? -ne 0
 }
 
+case `echo -n` in
+    -n)     _echo_n=        _echo_c='\c'    ;; # SysV
+    *)      _echo_n='-n '   _echo_c=        ;; # BSD
+esac
+
 # --------------------------------( CONFIGURE )--------------------------------
 
 result() {



From ivop at mail.berlios.de  Wed Sep 12 11:10:15 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 11:10:15 +0200
Subject: [Hmgen-svnlog] r119 - trunk
Message-ID: <200709120910.l8C9AFCQ009822@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 11:10:15 +0200 (Wed, 12 Sep 2007)
New Revision: 119

Modified:
   trunk/build.sh
Log:
be a nice shell


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 00:22:40 UTC (rev 118)
+++ trunk/build.sh	2007-09-12 09:10:15 UTC (rev 119)
@@ -11,12 +11,25 @@
 
 # ----------------------------------( INIT )-----------------------------------
 
-export LC_ALL=C
-if test "$NOCOLOR" ; then Bon= ; Boff= ; Red= ; Green=
-else Bon="[1m" ; Boff="[0m" ; Red="[31m" ; Green="[32m"
+# Be a nice shell
+
+LC_ALL=C ; export LC_ALL
+if test -n "$ZSH_VERSION" && (emulate sh) 2>/dev/null 1>&2 ; then
+    emulate sh
+    NULLCMD=:
+else
+    case `(set -o) 2>/dev/null` in *posix*) set -o posix ;; esac
 fi
-test -z "$V" && V=0
+BIN_SH=xpg4 ; export BIN_SH
+DUALCASE=1 ; export DUALCASE
+unset ENV MAIL MAILPATH
+PS1='$ ' ; PS2='> ' ; PS4='+ '
+nl='
+'
+IFS=" 	$nl"
 
+# Portable functions
+
 if test "`(echo first ; echo last) | head -1 2>/dev/null`" = "first" ; then
     _head() { head -$1 2>/dev/null ; }
 else
@@ -38,6 +51,12 @@
     *)      _echo_n='-n '   _echo_c=        ;; # BSD
 esac
 
+test -z "$V" && V=0
+test -z "$C" && C=1
+if test "$C" -ne 1 ; then Bon= ; Boff= ; Red= ; Green=
+else Bon="[1m" ; Boff="[0m" ; Red="[31m" ; Green="[32m"
+fi
+
 # --------------------------------( CONFIGURE )--------------------------------
 
 result() {



From ivop at mail.berlios.de  Wed Sep 12 11:11:57 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 11:11:57 +0200
Subject: [Hmgen-svnlog] r120 - trunk
Message-ID: <200709120911.l8C9BvdR010004@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 11:11:57 +0200 (Wed, 12 Sep 2007)
New Revision: 120

Modified:
   trunk/build.sh
Log:
typo


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 09:10:15 UTC (rev 119)
+++ trunk/build.sh	2007-09-12 09:11:57 UTC (rev 120)
@@ -7,7 +7,7 @@
 # experiment needed a POSIX environment anyway and on top of that, it depended
 # heavily on GNU make (which is bad) and recursive make (which is worse).
 # This experiment just needs a POSIX environment and nothing more.
-# Or perhaps not not POSIX ;)
+# Or perhaps not even POSIX ;)
 
 # ----------------------------------( INIT )-----------------------------------
 



From ivop at mail.berlios.de  Wed Sep 12 13:01:54 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 13:01:54 +0200
Subject: [Hmgen-svnlog] r121 - trunk
Message-ID: <200709121101.l8CB1sYQ000114@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 13:01:54 +0200 (Wed, 12 Sep 2007)
New Revision: 121

Modified:
   trunk/build.sh
Log:
help message


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 09:11:57 UTC (rev 120)
+++ trunk/build.sh	2007-09-12 11:01:54 UTC (rev 121)
@@ -9,6 +9,36 @@
 # This experiment just needs a POSIX environment and nothing more.
 # Or perhaps not even POSIX ;)
 
+# ----------------------------------( USAGE )----------------------------------
+
+help() {
+    cat << __EOF__
+
+usage: ./build.sh [options] [actions]
+
+options:
+
+--cc=CC             specify C compiler
+--prefix=PREFIX     installation prefix [default: $prefix]
+--help              print this message
+
+actions:
+
+all                 build all
+cli                 build cli version only
+gui                 build gui version only
+lib                 build (static) library only
+install             install all programs
+install-cli         install cli version only
+install-gui         install gui version only
+configure           perform configure only
+deps                determine dependencies only
+clean               clean up
+distclean           cleaner up
+
+__EOF__
+}
+
 # ----------------------------------( INIT )-----------------------------------
 
 # Be a nice shell
@@ -57,6 +87,11 @@
 else Bon="[1m" ; Boff="[0m" ; Red="[31m" ; Green="[32m"
 fi
 
+# Defaults
+
+prefix=/usr/local
+CC=cc
+
 # --------------------------------( CONFIGURE )--------------------------------
 
 result() {
@@ -437,6 +472,10 @@
 
 # ----------------------------------( MAIN )-----------------------------------
 
+for i in $@ ; do
+    case "$i" in --help|-help|-h|-?) help ; exit ;; esac
+done
+
 if grep -q CONFIGURE_DONE=yes build.config 2>/dev/null ; then
     echo reading build.config
     . build.config



From ivop at mail.berlios.de  Wed Sep 12 13:11:36 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 13:11:36 +0200
Subject: [Hmgen-svnlog] r122 - trunk
Message-ID: <200709121111.l8CBBaNY015924@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 13:11:36 +0200 (Wed, 12 Sep 2007)
New Revision: 122

Modified:
   trunk/build.sh
Log:
move stuff to functions


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 11:01:54 UTC (rev 121)
+++ trunk/build.sh	2007-09-12 11:11:36 UTC (rev 122)
@@ -91,6 +91,7 @@
 
 prefix=/usr/local
 CC=cc
+action=
 
 # --------------------------------( CONFIGURE )--------------------------------
 
@@ -330,18 +331,7 @@
 
 # ----------------------------------( MAKE )-----------------------------------
 
-# "docs":
-#
-# make_exec     "command"       "short text"    "short text argument"
-# make_c_to_o   filename.o
-# make_link     exefilename     filename.o      libraries ...
-# make_o_to_a   filename.a      object ...
-# addsuffix     suffix          basenames ...
-# up_to_date    target          deps ...
-#
-# make_init_object_deps objects ...
-
-make_init() {
+make_init_default() {
     DEF_CFLAGS="$STD_FLAGS $WARN_FLAGS $OPT_FLAGS $DEBUG_FLAGS $DEFINES"
     DEF_LDFLAGS="-lm $DEBUG_FLAGS $SYS_LDFLAGS"
     CFLAGS="$DEF_CFLAGS"
@@ -472,44 +462,59 @@
 
 # ----------------------------------( MAIN )-----------------------------------
 
-for i in $@ ; do
-    case "$i" in --help|-help|-h|-?) help ; exit ;; esac
-done
+do_configure() {
+    if grep -q CONFIGURE_DONE=yes build.config 2>/dev/null ; then
+        echo reading build.config
+        . build.config
+    else
+        > build.config
+        configure
+        output_build_config
+    fi
+}
 
-if grep -q CONFIGURE_DONE=yes build.config 2>/dev/null ; then
-    echo reading build.config
-    . build.config
-else
-    > build.config
-    configure
-    output_build_config
-fi
+do_make_init() {
+    make_init_default
+    make_init_project
+}
 
-make_init
-make_init_project
+do_deps() {
+    if not grep -q deps_done=yes build.dep 2>/dev/null ; then
+        > build.dep
+        make_dep $libhmgen_srcs $cli_srcs $gui_srcs
+        echo "deps_done=yes" >> build.dep
+    fi
 
-if not grep -q deps_done=yes build.dep 2>/dev/null ; then
-    > build.dep
-    make_dep $libhmgen_srcs $cli_srcs $gui_srcs
-    echo "deps_done=yes" >> build.dep
-fi
+    echo reading build.dep
+    . build.dep
+}
 
-echo reading build.dep
-. build.dep
+do_make_cli() {
+    make_exe $cli_g_exe
+    if not up_to_date $cli_exe $cli_g_exe ; then
+        make_exec "cp $cli_g_exe $cli_exe" "copy" "$cli_g_exe $cli_exe"
+        make_exec "$STRIP $cli_exe" "strip" "$cli_exe"
+    fi
+}
 
-make_exe $cli_g_exe
+do_make_gui() {
+    CFLAGS="$DEF_CFLAGS $GTK_CFLAGS $GTHREAD_CFLAGS"
+    LDFLAGS="$DEF_LDFLAGS $GTK_LDFLAGS $GTHREAD_LDFLAGS"
+    make_exe $gui_g_exe
+    if not up_to_date $gui_exe $gui_g_exe ; then
+        make_exec "cp $gui_g_exe $gui_exe" "copy" "$gui_g_exe $gui_exe"
+        make_exec "$STRIP $gui_exe" "strip" "$gui_exe"
+    fi
+}
 
-CFLAGS="$DEF_CFLAGS $GTK_CFLAGS $GTHREAD_CFLAGS"
-LDFLAGS="$DEF_LDFLAGS $GTK_LDFLAGS $GTHREAD_LDFLAGS"
-make_exe $gui_g_exe
+for i in $@ ; do
+    case "$i" in --help|-help|-h|-?) help ; exit ;; esac
+done
 
-if not up_to_date $cli_exe $cli_g_exe ; then
-    make_exec "cp $cli_g_exe $cli_exe" "copy" "$cli_g_exe $cli_exe"
-    make_exec "$STRIP $cli_exe" "strip" "$cli_exe"
-fi
-if not up_to_date $gui_exe $gui_g_exe ; then
-    make_exec "cp $gui_g_exe $gui_exe" "copy" "$gui_g_exe $gui_exe"
-    make_exec "$STRIP $gui_exe" "strip" "$gui_exe"
-fi
+do_configure
+do_make_init
+do_deps
+do_make_cli
+do_make_gui
 
 echo "done"



From ivop at mail.berlios.de  Wed Sep 12 13:44:53 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 13:44:53 +0200
Subject: [Hmgen-svnlog] r123 - trunk
Message-ID: <200709121144.l8CBirIx004682@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 13:44:53 +0200 (Wed, 12 Sep 2007)
New Revision: 123

Modified:
   trunk/build.sh
Log:
move fairly generic make stuff to make section
split project section
options/actions loop


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 11:11:36 UTC (rev 122)
+++ trunk/build.sh	2007-09-12 11:44:53 UTC (rev 123)
@@ -92,6 +92,8 @@
 prefix=/usr/local
 CC=cc
 action=
+depsfile=build.deps
+configfile=build.config
 
 # --------------------------------( CONFIGURE )--------------------------------
 
@@ -258,8 +260,8 @@
 }
 
 output_build_config() {
-   echo writing build.config
-    cat >> build.config << __EOF__
+   echo writing $configfile
+    cat >> $configfile << __EOF__
 CC="$CC"
 CC_DEP="$CC_DEP"
 CC_VENDOR="$CC_VENDOR"
@@ -431,11 +433,37 @@
     fi
 }
 
-make_dep() {
-    make_exec "$CC_DEP $DEP_FLAGS $DEF_CFLAGS $GTK_CFLAGS $GTHREAD_CFLAGS `echo $@` | ccdeps_to_shdeps >> build.dep" "ccdep" "build.dep"
+_make_deps() {
+    make_exec "$CC_DEP $DEP_FLAGS $DEF_CFLAGS $GTK_CFLAGS $GTHREAD_CFLAGS `echo $@` 2>/dev/null | ccdeps_to_shdeps >> $depsfile" "ccdep" "$depsfile"
 }
 
+make_deps() {
+    if not grep -q deps_done=yes $depsfile 2>/dev/null ; then
+        > $depsfile
+        _make_deps $libhmgen_srcs $cli_srcs $gui_srcs
+        echo "deps_done=yes" >> $depsfile
+    fi
+
+    echo reading $depsfile
+    . $depsfile
+}
+
+make_configure() {
+    if grep -q CONFIGURE_DONE=yes $configfile 2>/dev/null ; then
+        echo reading $configfile
+        . $configfile
+    else
+        > $configfile
+        configure
+        output_build_config
+    fi
+}
+
+# ---------------------------------( PROJECT )---------------------------------
+
 make_init_project() {
+    make_init_default
+
     libhmgen_basenames="lib_algo_ff lib_algo_mpd lib_algo_forge lib_postproc \
                         lib_util lib_hmgen lib_export"
     libhmgen_objs=`addsuffix $OBJSUF $libhmgen_basenames`
@@ -460,36 +488,7 @@
     make_set_deps $gui_g_exe $gui_objs $libhmgen
 }
 
-# ----------------------------------( MAIN )-----------------------------------
-
-do_configure() {
-    if grep -q CONFIGURE_DONE=yes build.config 2>/dev/null ; then
-        echo reading build.config
-        . build.config
-    else
-        > build.config
-        configure
-        output_build_config
-    fi
-}
-
-do_make_init() {
-    make_init_default
-    make_init_project
-}
-
-do_deps() {
-    if not grep -q deps_done=yes build.dep 2>/dev/null ; then
-        > build.dep
-        make_dep $libhmgen_srcs $cli_srcs $gui_srcs
-        echo "deps_done=yes" >> build.dep
-    fi
-
-    echo reading build.dep
-    . build.dep
-}
-
-do_make_cli() {
+make_cli() {
     make_exe $cli_g_exe
     if not up_to_date $cli_exe $cli_g_exe ; then
         make_exec "cp $cli_g_exe $cli_exe" "copy" "$cli_g_exe $cli_exe"
@@ -497,7 +496,7 @@
     fi
 }
 
-do_make_gui() {
+make_gui() {
     CFLAGS="$DEF_CFLAGS $GTK_CFLAGS $GTHREAD_CFLAGS"
     LDFLAGS="$DEF_LDFLAGS $GTK_LDFLAGS $GTHREAD_LDFLAGS"
     make_exe $gui_g_exe
@@ -507,14 +506,72 @@
     fi
 }
 
+make_all() {
+    make_configure
+    make_init_project
+    make_deps
+    make_cli
+    make_gui
+}
+
+# ----------------------------------( MAIN )-----------------------------------
+
+optarg() {
+    echo $1 | cut -d '=' -f 2
+}
+
 for i in $@ ; do
     case "$i" in --help|-help|-h|-?) help ; exit ;; esac
 done
 
-do_configure
-do_make_init
-do_deps
-do_make_cli
-do_make_gui
+for i in $@ ; do
+    case "$i" in
+        --cc=*)         CC=`optarg $i`      ;;
+        --prefix=*)     prefix=`optarg $i`  ;;
+        configure)
+            action=1
+            >$configfile
+            make_configure
+            ;;
+        deps)
+            action=1
+            >$depsfile
+            make_configure
+            make_init_project
+            make_deps
+            ;;
+        cli)
+            action=1
+            make_configure
+            make_init_project
+            make_deps
+            make_cli
+            ;;
+        gui)
+            action=1
+            make_configure
+            make_init_project
+            make_deps
+            make_gui
+            ;;
+        lib)
+            action=1
+            make_configure
+            make_init_project
+            make_deps
+            make_lib $libhmgen
+            ;;
+        all)
+            action=1
+            make_all
+            ;;
+        --*)
+            echo unknown option ; exit 1 ;;
+        *)
+            echo unknown action ; exit 1 ;;
+    esac
+done
 
+if test -z "$action" ; then make_all ; fi
+
 echo "done"



From ivop at mail.berlios.de  Wed Sep 12 13:52:49 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 13:52:49 +0200
Subject: [Hmgen-svnlog] r124 - trunk
Message-ID: <200709121152.l8CBqnSe007090@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 13:52:49 +0200 (Wed, 12 Sep 2007)
New Revision: 124

Modified:
   trunk/build.sh
Log:
clean and distclean


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 11:44:53 UTC (rev 123)
+++ trunk/build.sh	2007-09-12 11:52:49 UTC (rev 124)
@@ -514,6 +514,16 @@
     make_gui
 }
 
+make_clean() {
+    rm -f $libhmgen_objs $cli_objs $gui_objs $libhmgen
+    rm -f $cli_g_exe $cli_exe $gui_g_exe $gui_exe
+    rm -f *~
+}
+
+make_distclean() {
+    make_clean
+    rm -f $configfile $depsfile
+}
 # ----------------------------------( MAIN )-----------------------------------
 
 optarg() {
@@ -565,6 +575,18 @@
             action=1
             make_all
             ;;
+        clean)
+            action=1
+            make_configure
+            make_init_project
+            make_clean
+            ;;
+        distclean)
+            action=1
+            make_configure
+            make_init_project
+            make_distclean
+            ;;
         --*)
             echo unknown option ; exit 1 ;;
         *)



From ivop at mail.berlios.de  Wed Sep 12 13:53:26 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 13:53:26 +0200
Subject: [Hmgen-svnlog] r125 - trunk
Message-ID: <200709121153.l8CBrQ91007178@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 13:53:26 +0200 (Wed, 12 Sep 2007)
New Revision: 125

Modified:
   trunk/README
Log:
move to build.sh


Modified: trunk/README
===================================================================
--- trunk/README	2007-09-12 11:52:49 UTC (rev 124)
+++ trunk/README	2007-09-12 11:53:26 UTC (rev 125)
@@ -15,34 +15,19 @@
 =========
 
 One-time build:
-    make all
+    ./build.sh
 
 To build without the GTK+-2.0 GUI, type:
-    make hmgen
+    ./build.sh cli
 
-Developer build:
-    make dep
-    make verbose
-    or
-    make dep
-    make hmgen-verbose
-    etc...
-
 Clean up:
-    make clean
+    ./build.sh clean
 
 Cleaner up:
-    make distclean
-    make mrproper
+    ./build.sh distclean
 
 Just configure:
-    make configure
+    ./build.sh configure
 
-Or specify a different C compiler:
-    make CC=suncc configure
-    or
-    make CC=suncc all
-
-Building on MingW/MSYS:
-    make CC=gcc
-
+Et cetera. For all build actions and options like --cc and --prefix:
+    ./build.sh --help



From ivop at mail.berlios.de  Wed Sep 12 14:06:04 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 14:06:04 +0200
Subject: [Hmgen-svnlog] r126 - trunk
Message-ID: <200709121206.l8CC64Cw008208@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 14:06:04 +0200 (Wed, 12 Sep 2007)
New Revision: 126

Modified:
   trunk/build.sh
Log:
verbose mode and nocolor mode


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 11:53:26 UTC (rev 125)
+++ trunk/build.sh	2007-09-12 12:06:04 UTC (rev 126)
@@ -20,6 +20,8 @@
 
 --cc=CC             specify C compiler
 --prefix=PREFIX     installation prefix [default: $prefix]
+--verbose           verbose compilation
+--nocolor           disable colors for terminals w/o VT100 capabilities
 --help              print this message
 
 actions:
@@ -83,10 +85,15 @@
 
 test -z "$V" && V=0
 test -z "$C" && C=1
-if test "$C" -ne 1 ; then Bon= ; Boff= ; Red= ; Green=
-else Bon="[1m" ; Boff="[0m" ; Red="[31m" ; Green="[32m"
-fi
 
+init_colors() {
+    if test "$C" -ne 1 ; then Bon= ; Boff= ; Red= ; Green=
+    else Bon="[1m" ; Boff="[0m" ; Red="[31m" ; Green="[32m"
+    fi
+}
+
+init_colors
+
 # Defaults
 
 prefix=/usr/local
@@ -538,6 +545,8 @@
     case "$i" in
         --cc=*)         CC=`optarg $i`      ;;
         --prefix=*)     prefix=`optarg $i`  ;;
+        --verbose)      V=1                 ;;
+        --nocolor)      C=0 ; init_colors   ;;
         configure)
             action=1
             >$configfile



From ivop at mail.berlios.de  Wed Sep 12 14:08:31 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 14:08:31 +0200
Subject: [Hmgen-svnlog] r127 - trunk
Message-ID: <200709121208.l8CC8VlT008451@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 14:08:30 +0200 (Wed, 12 Sep 2007)
New Revision: 127

Modified:
   trunk/Makefile
Log:
Remove old Makefile


Modified: trunk/Makefile
===================================================================
--- trunk/Makefile	2007-09-12 12:06:04 UTC (rev 126)
+++ trunk/Makefile	2007-09-12 12:08:30 UTC (rev 127)
@@ -1,345 +1,11 @@
+# Make is obsolete ;)
 
-# Makefile with built-in configure experiment
-# Needs GNU Make to run properly
+all:
+	@echo "This project does not use make. Use ./build.sh instead."
+	@echo "Type ./build.sh --help for details."
 
-ifeq ($(V),1)
-SILENT=no
-endif
-
-# ---------- COLORS ----------
-
-ifneq ($(colors),no)
-Bon = "[1m"
-Boff = "[0m"
-Red = "[31m"
-Green = "[32m"
-else
-Bon =
-Boff =
-Red =
-Green =
-endif
-
-# ---------- CONFIGURE PREAMBLE ----------
-
--include config.mak
-
-MAKEFLAGS += --no-print-directory
-
-ifneq ($(CONFIGURE_DONE),yes)
-DEFGOAL=$(filter-out all clean distclean configure, $(MAKECMDGOALS))
-$(DEFGOAL) all:
-	@make configure
-	@make $(MAKECMDGOALS)
-
 clean:
+	@./build.sh clean
 
-else
-
-# ---------- PROJECT ----------
-
-.SUFFIXES:
-.SUFFIXES: $(OBJSUF) .c
-
-DEF_CFLAGS = $(STD_FLAGS) $(WARN_FLAGS) $(OPT_FLAGS) $(DEBUG_FLAGS) $(DEFINES)
-DEF_LDFLAGS = -lm $(DEBUG_FLAGS) $(SYS_LDFLAGS)
-
-CLI = hmgen$(EXESUF)
-CLIg = hmgen_g$(EXESUF)
-CLI_BASENAMES = cli_main
-CLI_OBJS = $(addsuffix $(OBJSUF), $(CLI_BASENAMES))
-CLI_SRCS = $(addsuffix .c, $(CLI_BASENAMES))
-
-GUI = hmgengui$(EXESUF)
-GUIg = hmgengui_g$(EXESUF)
-GUI_BASENAMES = gui_main gui_callbacks gui_interface gui_support
-GUI_OBJS = $(addsuffix $(OBJSUF), $(GUI_BASENAMES))
-GUI_SRCS = $(addsuffix .c, $(GUI_BASENAMES))
-
-LIBHMGEN = libhmgen.a
-LIBHMGEN_BASENAMES = lib_algo_ff lib_algo_mpd lib_algo_forge \
-                     lib_postproc lib_util lib_hmgen lib_export
-LIBHMGEN_OBJS = $(addsuffix $(OBJSUF), $(LIBHMGEN_BASENAMES))
-LIBHMGEN_SRCS = $(addsuffix .c, $(LIBHMGEN_BASENAMES))
-
-build_pretty = printf "$(Bon)%s$(Boff) %s\n" "$(1)" "$(2)"
-SILENT ?= yes
-SILENT_EXEC = @test "$(SILENT)" = "yes" && $(call build_pretty,$(2),$(3)) \
-                                        || echo "$(1)"; $(1)
-
-all: $(GUI) $(CLI)
-
-verbose: SILENT=no
-verbose: all
-
-$(CLI)-verbose: SILENT=no
-$(CLI)-verbose: $(CLI)
-$(CLI): $(CLIg)
-	$(call SILENT_EXEC,cp $(CLIg) $@,copy,$(CLIg) $@)
-	$(call SILENT_EXEC,$(STRIP) $@,strip,$@)
-
-$(CLIg): CFLAGS = $(DEF_CFLAGS)
-$(CLIg): LDFLAGS = $(DEF_LDFLAGS)
-$(CLIg): $(LIBHMGEN) $(CLI_OBJS)
-	$(call SILENT_EXEC,$(CC) $(OBJ_OUT_FLAG) $@ $(CLI_OBJS) $(LIBHMGEN) \
-		$(LDFLAGS),link,$@)
-
-$(GUI)-verbose: SILENT=no
-$(GUI)-verbose: $(GUI)
-$(GUI): $(GUIg)
-	$(call SILENT_EXEC,cp $(GUIg) $@,copy,$(GUIg) $@)
-	$(call SILENT_EXEC,$(STRIP) $@,strip,$@)
-
-$(GUIg): CFLAGS = $(GTK_CFLAGS) $(GTHREAD_CFLAGS) $(DEF_CFLAGS)
-$(GUIg): LDFLAGS = $(GTK_LDFLAGS) $(GTHREAD_LDFLAGS) $(DEF_LDFLAGS)
-$(GUIg): $(LIBHMGEN) $(GUI_OBJS)
-	$(call SILENT_EXEC,$(CC) $(OBJ_OUT_FLAG) $@ $(GUI_OBJS) $(LIBHMGEN) \
-		$(LDFLAGS),link,$@)
-
-$(LIBHMGEN)-verbose: SILENT=no
-$(LIBHMGEN)-verbose: $(LIBHMGEN)
-$(LIBHMGEN): CFLAGS = $(DEF_CFLAGS)
-$(LIBHMGEN): LDFLAGS = $(DEF_LDFLAGS)
-$(LIBHMGEN): $(LIBHMGEN_OBJS)
-	$(call SILENT_EXEC,$(AR) $(AR_FLAGS) $@ $^,archive,$@)
-	$(call SILENT_EXEC,$(RANLIB) $@,ranlib,$@)
-
-.c.o:
-	$(call SILENT_EXEC,$(CC) $(DONT_LINK_FLAG) $(OBJ_OUT_FLAG) $@ $< $(CFLAGS)\
-		,compile,$<)
-
-depend-verbose dep-verbose: SILENT=no
-depend-verbose dep-verbose: dep
-depend dep: $(CLI_SRCS) $(LIBHMGEN_SRCS) $(GUI_SRCS)
-	$(call SILENT_EXEC,$(CC_DEP) $(DEP_FLAGS) $(DEF_CFLAGS) $(GTK_CFLAGS) $(GTHREAD_CFLAGS) $^ 1>.depend,ccdep,>.depend)
-
-size:
-	@wc -l *.[ch] Makefile *.mak | tail -1
-
-size-long:
-	@wc -l *.[ch] Makefile *.mak
-
-clean:
-	rm -f $(CLI) $(CLIg) $(CLI_OBJS)
-	rm -f $(LIBHMGEN) $(LIBHMGEN_OBJS)
-	rm -f $(GUI) $(GUIg) $(GUI_OBJS)
-
-.PHONY: all dep depend clean verbose $(CLI)-verbose size \
-        $(GUI)-verbose $(LIBHMGEN)-verbose depend-verbose dep-verbose size-long
-
-endif	# END CONFIGURE PREAMBLE
-
-# ---------- CONFIGURE ----------
-
-define config-print-result
-	if test "$(2)" = "no" ; then \
-		col="$(Bon)$(Red)" ; \
-	elif test "$(2)" = "yes" ; then \
-		col="$(Bon)$(Green)" ; \
-	else \
-		col="$(Bon)" ; \
-	fi ; \
-	if test -n "$(2)" ; then \
-		printf "%-16s : $$col%s$(Boff)\n" "$(1)" "$(2)" ; \
-	fi
-endef
-
-clean-config.mak:
-	@> config.mak
-
-config-cc:
-	@$(call config-print-result,compiler,$(CC))
-	@echo CC=$(CC) >> config.mak
-	@echo CC_DEP=$(CC) >> config.mak
-
-config-cc-vendor-and-version:	config-cc
-	@CC_VENDOR=`$(CC) --help 2>/dev/null | grep -q gcc && echo gnu` ; \
-	if test "$$CC_VENDOR" = "gnu" ; then \
-		CC_VERSION=`$(CC) -dumpversion` ; \
-	else \
-		CC_VENDOR=`$(CC) -flags 2>/dev/null | grep -q sunperf && echo sun` ; \
-		if test "$$CC_VENDOR" = "sun" ; then \
-			CC_VERSION=`echo | $(CC) -E - | grep ident | cut -d ' ' -f 5` ; \
-		else \
-			CC_VENDOR=unknown; \
-			echo CC_DEP=true >> config.mak; \
-		fi ; \
-	fi ; \
-	echo CC_VENDOR=$$CC_VENDOR >> config.mak ; \
-	echo CC_VERSION=$$CC_VERSION >> config.mak ; \
-	echo CC_VERSION_MAJOR=`echo $$CC_VERSION | cut -d '.' -f 1` \
-		>>config.mak ;\
-	echo CC_VERSION_MINOR=`echo $$CC_VERSION | cut -d '.' -f 2` \
-		>>config.mak ;\
-	echo CC_VERSION_SUBMINOR=`echo $$CC_VERSION | cut -d '.' -f 3` \
-		>>config.mak ;\
-	$(call config-print-result,vendor,$$CC_VENDOR) ; \
-	$(call config-print-result,version,$$CC_VERSION)
-
-config-cc-vendor-and-version-restrict:	config-cc-vendor-and-version
-	@. config.mak ; \
-	if test "$$CC_VENDOR" = gnu ; then \
-		if test "$$CC_VERSION_MAJOR" -le 2 ; then \
-			echo "gcc version < 3.x is not supported" ; \
-			exit 1 ; \
-		fi ; \
-	fi ;
-
-config-cc-flags: 	config-cc-vendor-and-version-restrict
-	@. config.mak ; \
-	case $$CC_VENDOR in \
-		gnu) \
-			WARN_FLAGS="-Wall -W" ; \
-			OPT_FLAGS="-O3" ; \
-			STD_FLAGS="-std=c99" ; \
-			DEBUG_FLAGS="-g" ; \
-			DEP_FLAGS="-MM" ; \
-			OBJ_OUT_FLAG="-o" ; \
-			DONT_LINK_FLAG="-c" ; \
-			;; \
-		sun) \
-			WARN_FLAGS= ; \
-			OPT_FLAGS="-xO5" ; \
-			STD_FLAGS="-Xc" ; \
-			DEBUG_FLAGS="-g" ; \
-			DEP_FLAGS="-xM" ; \
-			OBJ_OUT_FLAG="-o" ; \
-			DONT_LINK_FLAG="-c" ; \
-			;; \
-		unknown) \
-			WARN_FLAGS= ; \
-			OPT_FLAGS="-O" ; \
-			STD_FLAGS= ; \
-			DEBUG_FLAGS="-g" ; \
-			DEP_FLAGS= ; \
-			OBJ_OUT_FLAG="-o" ; \
-			DONT_LINK_FLAG="-c" ; \
-			;; \
-	esac ; \
-	echo WARN_FLAGS=$$WARN_FLAGS >> config.mak ; \
-	echo OPT_FLAGS=$$OPT_FLAGS >> config.mak ; \
-	echo STD_FLAGS=$$STD_FLAGS >> config.mak ; \
-	echo DEBUG_FLAGS=$$DEBUG_FLAGS >> config.mak ; \
-	echo DEP_FLAGS=$$DEP_FLAGS >> config.mak ; \
-	echo OBJ_OUT_FLAG=$$OBJ_OUT_FLAG >> config.mak ; \
-	echo DONT_LINK_FLAG=$$DONT_LINK_FLAG >> config.mak ; \
-	$(call config-print-result,warnings,$$WARN_FLAGS) ; \
-	$(call config-print-result,optimize,$$OPT_FLAGS) ; \
-	$(call config-print-result,standards,$$STD_FLAGS) ; \
-	$(call config-print-result,debug,$$DEBUG_FLAGS) ; \
-	$(call config-print-result,dependencies,$$DEP_FLAGS) ; \
-	$(call config-print-result,object out,$$OBJ_OUT_FLAG) ; \
-	$(call config-print-result,do not link,$$DONT_LINK_FLAG) ;
-
-config-pkg-config:
-	@TMP=`pkg-config --version 2>/dev/null 1>&2 && echo yes || echo no` ; \
-	$(call config-print-result,pkg-config,$$TMP) ; \
-	if test "$$TMP" != "yes" ; then \
-		echo "pkg-config not found" ; \
-		exit 1 ; \
-	fi ; \
-
-NOERR=2>/dev/null
-
-define CONFIG_PKG_CONFIG_PKG
-	@TMP=`pkg-config --atleast-version=$(4) $(1) $(NOERR) && \
-		echo yes || echo no` ;\
-	$(call config-print-result,$(1),$$TMP) ; \
-	if test "$$TMP" != "yes" ; then \
-		echo "$(1), at least version $(4), not found." ; \
-		echo "Perhaps you need to install the dev(el) packages?" ; \
-		exit 1 ; \
-	fi ; \
-	TVARC=`pkg-config --cflags $(1) $(NOERR)` ; \
-	TVARL=`pkg-config --static --libs $(1) $(NOERR)` ; \
-	echo $(2)=$$TVARC >> config.mak ; \
-	echo $(3)=$$TVARL >> config.mak ;
-endef
-
-config-gtk-flags: config-pkg-config
-	$(call CONFIG_PKG_CONFIG_PKG,gtk+-2.0,GTK_CFLAGS,GTK_LDFLAGS,2.0)
-
-config-gthread-flags: config-pkg-config
-	$(call CONFIG_PKG_CONFIG_PKG,gthread-2.0,GTHREAD_CFLAGS,GTHREAD_LDFLAGS,2.0)
-
-config-suncc-flags-fix: config-cc-vendor-and-version config-gthread-flags
-	@if grep -q CC_VENDOR=sun config.mak ; then \
-		GTHREAD_CFLAGS=`grep GTHREAD_CFLAGS= config.mak | sed 's/-pthread//'` ; \
-		GTHREAD_LDFLAGS=`grep GTHREAD_LDFLAGS= config.mak | sed 's/-pthread//'` ; \
-		echo $$GTHREAD_CFLAGS >> config.mak ; \
-		echo $$GTHREAD_LDFLAGS >> config.mak ; \
-	fi ;
-
-config-define-none:
-	@echo DEFINES= >> config.mak
-
-config-define-svnrev: config-define-none
-	@svn_rev=`LC_ALL=C svn info * 2>/dev/null | grep ^Revision: \
-		| cut -d ' ' -f 2 | xargs -n 1 -iX printf "%05i\n" X \
-		| sort -r | head -n 1 | sed 's/^0//' | sed 's/^0//' \
-		| sed 's/^0//'` ; \
-	test $$svn_rev || svn_rev=`grep revision .svn/entries 2>/dev/null \
-		| cut -d '"' -f 2` | xargs -n 1 -iX printf "%05i\n" X \
-		| sort -r | head -n 1 | sed 's/^0//' | sed 's/^0//' \
-		| sed 's/^0//' ; \
-	test $$svn_rev || svn_rev=`sed -n -e '/^dir$/{n;p;q;}' \
-		.svn/entries 2>/dev/null` ; \
-	test $$svn_rev || svn_rev=0 ; \
-	echo DEFINES=-DSVN_REVISION=$$svn_rev >> config.mak
-
-config-system:
-	@SYSTEM=`uname -s` ; \
-	SYSTEM=`echo $$SYSTEM | tr '[A-Z]' '[a-z]'` ; \
-	case "$$SYSTEM" in \
-		linux*)     SYSTEM=linux ;; \
-		mingw*)     SYSTEM=mingw ;; \
-		*)          SYSTEM="$$SYSTEM_untested" ;; \
-	esac ; \
-	echo SYSTEM=$$SYSTEM >> config.mak ; \
-	$(call config-print-result,system,$$SYSTEM) ;
-
-config-system-ldflags: config-system
-	@SYS_LDFLAGS= ; \
-	if grep -q SYSTEM=mingw config.mak ; then \
-		if grep -q CC_VENDOR=gnu config.mak ; then \
-			SYS_LDFLAGS=-mwindows ; \
-		fi ; \
-	fi ; \
-	echo SYS_LDFLAGS=$$SYS_LDFLAGS >> config.mak ; \
-	$(call config-print-result,system ldflags,$$SYS_LDFLAGS) ;
-
-config-exe-suf: config-system
-	@EXESUF= ; \
-	if grep -q SYSTEM=mingw config.mak ; then \
-		EXESUF=.exe ; \
-	fi ; \
-	echo EXESUF=$$EXESUF >> config.mak ; \
-	$(call config-print-result,exe suffix,$$EXESUF) ;
-
-configure: clean-config.mak \
-           config-cc-flags \
-           config-gtk-flags \
-           config-gthread-flags \
-           config-suncc-flags-fix \
-           config-define-svnrev \
-		   config-system \
-		   config-system-ldflags \
-		   config-exe-suf
-	@echo AR?=ar >> config.mak
-	@echo RANLIB?=ranlib >> config.mak
-	@echo STRIP?=strip >> config.mak
-	@echo OBJSUF=.o >> config.mak
-	@echo AR_FLAGS=cru >> config.mak
-	@echo CONFIGURE_DONE=yes >> config.mak
-
-mrproper distclean: clean
-	rm -f *~ .depend *.pgm *.ppm config.mak
-
-.PHONY: mrproper distclean clean-config.mak configure config-cc \
-        config-cc-vendor-and-version \
-        config-cc-flags config-cc-vendor-and-version-restrict \
-        config-pkg-config config-gtk-flags config-gthread-flags
-
-# ---------- DEPENDENCIES ----------
-
--include .depend
+distclean:
+	@./build.sh distclean



From ivop at mail.berlios.de  Wed Sep 12 18:16:48 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 18:16:48 +0200
Subject: [Hmgen-svnlog] r128 - trunk
Message-ID: <200709121616.l8CGGmS0025546@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 18:16:48 +0200 (Wed, 12 Sep 2007)
New Revision: 128

Modified:
   trunk/build.sh
Log:
cosmetics


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 12:08:30 UTC (rev 127)
+++ trunk/build.sh	2007-09-12 16:16:48 UTC (rev 128)
@@ -267,7 +267,7 @@
 }
 
 output_build_config() {
-   echo writing $configfile
+    echo writing $configfile
     cat >> $configfile << __EOF__
 CC="$CC"
 CC_DEP="$CC_DEP"



From ivop at mail.berlios.de  Wed Sep 12 18:21:26 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 18:21:26 +0200
Subject: [Hmgen-svnlog] r129 - trunk
Message-ID: <200709121621.l8CGLQtP025802@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 18:21:26 +0200 (Wed, 12 Sep 2007)
New Revision: 129

Modified:
   trunk/build.sh
Log:
shorter way of writing out build.config


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 16:16:48 UTC (rev 128)
+++ trunk/build.sh	2007-09-12 16:21:26 UTC (rev 129)
@@ -268,36 +268,14 @@
 
 output_build_config() {
     echo writing $configfile
-    cat >> $configfile << __EOF__
-CC="$CC"
-CC_DEP="$CC_DEP"
-CC_VENDOR="$CC_VENDOR"
-CC_VERSION="$CC_VERSION"
-CC_VERSION_MAJOR="$CC_VERSION_MAJOR"
-CC_VERSION_MINOR="$CC_VERSION_MINOR"
-CC_VERSION_SUBMINOR="$CC_VERSION_SUBMINOR"
-WARN_FLAGS="$WARN_FLAGS"
-OPT_FLAGS="$OPT_FLAGS"
-STD_FLAGS="$STD_FLAGS"
-DEBUG_FLAGS="$DEBUG_FLAGS"
-DEP_FLAGS="$DEP_FLAGS"
-OBJ_OUT_FLAG="$OBJ_OUT_FLAG"
-DONT_LINK_FLAG="$DONT_LINK_FLAG"
-GTK_CFLAGS="$GTK_CFLAGS"
-GTK_LDFLAGS="$GTK_LDFLAGS"
-GTHREAD_CFLAGS="$GTHREAD_CFLAGS"
-GTHREAD_LDFLAGS="$GTHREAD_LDFLAGS"
-DEFINES="-DSVN_REVISION=$SVN_REV"
-SYSTEM="$SYSTEM"
-SYS_LDFLAGS="$SYS_LDFLAGS"
-EXESUF="$EXESUF"
-AR="$AR"
-AR_FLAGS="$AR_FLAGS"
-RANLIB="$RANLIB"
-STRIP="$STRIP"
-OBJSUF="$OBJSUF"
-CONFIGURE_DONE=yes
-__EOF__
+    CONFIGURE_DONE=yes
+    for i in CC CC_DEP CC_VENDOR CC_VERSION CC_VERSION_MAJOR CC_VERSION_MINOR \
+        CC_VERSION_SUBMINOR WARN_FLAGS OPT_FLAGS STD_FLAGS DEBUG_FLAGS \
+        DEP_FLAGS OBJ_OUT_FLAG DONT_LINK_FLAG GTK_CFLAGS GTK_LDFLAGS \
+        GTHREAD_CFLAGS GTHREAD_LDFLAGS DEFINES SYSTEM SYS_LDFLAGS EXESUF AR \
+        AR_FLAGS RANLIB STRIP OBJSUF CONFIGURE_DONE ; do
+        eval echo "$i=\"\$$i\"" >> $configfile
+    done
 }
 
 # ----------------------------------( UTIL )-----------------------------------



From ivop at mail.berlios.de  Wed Sep 12 18:25:37 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 18:25:37 +0200
Subject: [Hmgen-svnlog] r130 - trunk
Message-ID: <200709121625.l8CGPbKT026008@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 18:25:37 +0200 (Wed, 12 Sep 2007)
New Revision: 130

Modified:
   trunk/build.sh
Log:
10l, extra "'s in build.config


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 16:21:26 UTC (rev 129)
+++ trunk/build.sh	2007-09-12 16:25:37 UTC (rev 130)
@@ -274,7 +274,7 @@
         DEP_FLAGS OBJ_OUT_FLAG DONT_LINK_FLAG GTK_CFLAGS GTK_LDFLAGS \
         GTHREAD_CFLAGS GTHREAD_LDFLAGS DEFINES SYSTEM SYS_LDFLAGS EXESUF AR \
         AR_FLAGS RANLIB STRIP OBJSUF CONFIGURE_DONE ; do
-        eval echo "$i=\"\$$i\"" >> $configfile
+        eval echo "$i=\\\"\$$i\\\"" >> $configfile
     done
 }
 
@@ -525,6 +525,8 @@
         --prefix=*)     prefix=`optarg $i`  ;;
         --verbose)      V=1                 ;;
         --nocolor)      C=0 ; init_colors   ;;
+        --configfile=*) configfile=`optarg $i`  ;;
+        --depsfile=*)   depsfile=`optarg $i`    ;;
         configure)
             action=1
             >$configfile



From ivop at mail.berlios.de  Wed Sep 12 18:27:05 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 18:27:05 +0200
Subject: [Hmgen-svnlog] r131 - trunk
Message-ID: <200709121627.l8CGR5q5026118@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 18:27:05 +0200 (Wed, 12 Sep 2007)
New Revision: 131

Modified:
   trunk/
Log:
update ignore list



Property changes on: trunk
___________________________________________________________________
Name: svn:ignore
   - hmgen
hmgengui
libhmgen.a
.depend
hmgen_g
hmgengui_g
config.mak
svn-commit.*
build.config

   + hmgen
hmgengui
libhmgen.a
hmgen_g
hmgengui_g
svn-commit.*
build.config
build.deps




From ivop at mail.berlios.de  Wed Sep 12 18:45:50 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 18:45:50 +0200
Subject: [Hmgen-svnlog] propchange - r130 svn:log
Message-ID: <200709121645.l8CGjoxm028541@sheep.berlios.de>

Author: ivop
Revision: 130
Property Name: svn:log

New Property Value:
10l, extra "'s in build.config
add options to specify your own config or depsfile




From ivop at mail.berlios.de  Wed Sep 12 20:27:39 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 20:27:39 +0200
Subject: [Hmgen-svnlog] r132 - trunk
Message-ID: <200709121827.l8CIRdNQ015842@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 20:27:39 +0200 (Wed, 12 Sep 2007)
New Revision: 132

Modified:
   trunk/build.sh
Log:
extend help() and add destdir for (future) install actions


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 16:27:05 UTC (rev 131)
+++ trunk/build.sh	2007-09-12 18:27:39 UTC (rev 132)
@@ -20,8 +20,11 @@
 
 --cc=CC             specify C compiler
 --prefix=PREFIX     installation prefix [default: $prefix]
+--destdir=DESTDIR   installation destination directory [default: $destdir]
 --verbose           verbose compilation
 --nocolor           disable colors for terminals w/o VT100 capabilities
+--configfile=FILE   specify alternative config file
+--depsfile=FILE     specify alternative dependencies file
 --help              print this message
 
 actions:
@@ -97,6 +100,7 @@
 # Defaults
 
 prefix=/usr/local
+destdir=/
 CC=cc
 action=
 depsfile=build.deps



From ivop at mail.berlios.de  Wed Sep 12 20:45:11 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 20:45:11 +0200
Subject: [Hmgen-svnlog] r133 - trunk
Message-ID: <200709121845.l8CIjBGI017398@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 20:45:11 +0200 (Wed, 12 Sep 2007)
New Revision: 133

Modified:
   trunk/build.sh
Log:
question/answer functions for tests that might take a little longer


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 18:27:39 UTC (rev 132)
+++ trunk/build.sh	2007-09-12 18:45:11 UTC (rev 133)
@@ -108,19 +108,27 @@
 
 # --------------------------------( CONFIGURE )--------------------------------
 
-result() {
-    if test "$2" = "no" ; then      col="$Bon$Red"
-    elif test "$2" = "yes" ; then   col="$Bon$Green"
+question() {
+    printf "%-16s : " "$1"
+}
+
+answer() {
+    if test "$1" = "no" ; then      col="$Bon$Red"
+    elif test "$1" = "yes" ; then   col="$Bon$Green"
     else                            col="$Bon"
     fi
-    if test -n "$2" ; then
-        printf "%-16s : $col%s$Boff\n" "$1" "$2"
-    fi
+    test -n "$1" && printf "$col%s$Boff\n" "$1" || printf "<none>\n"
 }
 
+result() {
+    question "$1"
+    answer "$2"
+}
+
 my_pkg_config() {
+    question $1
     RES=`pkg-config --atleast-version=$4 $1 2>/dev/null && echo yes || echo no`
-    result $1 $RES
+    answer $RES
     if test "$RES" != "yes" ; then
         echo "$1, at least version $4, not found."
         echo "Perhaps you need to install the dev(el) packages?"
@@ -131,6 +139,7 @@
 }
 
 configure() {
+    question compiler
     for i in $CC cc gcc suncc icc tcc ; do
         if which $i 2>/dev/null 1>&2 ; then
             break
@@ -138,8 +147,9 @@
     done
     CC=$i
     CC_DEP=$i
-    result compiler $CC
+    answer $CC
 
+    question vendor
     CC_VENDOR=`$CC --help 2>/dev/null | grep -q gcc && echo gnu`
     if test "$CC_VENDOR" = "gnu" ; then
         CC_VERSION=`$CC -dumpversion`
@@ -155,7 +165,7 @@
     CC_VERSION_MAJOR=`echo $CC_VERSION | cut -d '.' -f 1`
     CC_VERSION_MINOR=`echo $CC_VERSION | cut -d '.' -f 2`
     CC_VERSION_SUBMINOR=`echo $CC_VERSION | cut -d '.' -f 3`
-    result vendor $CC_VENDOR
+    answer $CC_VENDOR
     result version $CC_VERSION
 
     if test "$CC_VENDOR" = gnu ; then
@@ -202,8 +212,9 @@
     result "object out" $OBJ_OUT_FLAG
     result "do not link" $DONT_LINK_FLAG
 
+    question pkg-config
     RES=`pkg-config --version 2>/dev/null 1>&2 && echo yes || echo no`
-    result pkg-config $RES
+    answer $RES
     if test "$RES" != "yes" ; then
         echo "pkg-config not found"
         exit 1
@@ -217,6 +228,7 @@
         GTHREAD_LDFLAGS=`echo xXx $GTHREAD_LDFLAGS | sed 's/-pthread//; s/^xXx//'`
     fi
 
+    question "version info"
     DEFINES=
     SVN_REV=`svn info * 2>/dev/null | grep ^Revision: \
         | cut -d ' ' -f 2 | xargs -n 1 -iX printf "%05i\n" X \
@@ -230,6 +242,7 @@
         .svn/entries 2>/dev/null`
     test $SVN_REV || SVN_REV=0
     DEFINES="$DEFINES -DSVN_REVISION=$SVN_REV"
+    answer done
 
     SYSTEM=`uname -s 2>/dev/null`
     SYSTEM=`echo $SYSTEM | tr '[A-Z]' '[a-z]'`



From ivop at mail.berlios.de  Wed Sep 12 20:56:55 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 20:56:55 +0200
Subject: [Hmgen-svnlog] r134 - trunk
Message-ID: <200709121856.l8CIuth9018155@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 20:56:54 +0200 (Wed, 12 Sep 2007)
New Revision: 134

Modified:
   trunk/build.sh
Log:
more verbose about version information


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 18:45:11 UTC (rev 133)
+++ trunk/build.sh	2007-09-12 18:56:54 UTC (rev 134)
@@ -228,8 +228,12 @@
         GTHREAD_LDFLAGS=`echo xXx $GTHREAD_LDFLAGS | sed 's/-pthread//; s/^xXx//'`
     fi
 
-    question "version info"
+    question "hmgen version"
     DEFINES=
+    X="#define HMG_VERSION_MAJOR"
+    VERMAJ=`grep "$X" version.h | sed "s/$X//"`
+    X="#define HMG_VERSION_MINOR"
+    VERMIN=`grep "$X" version.h | sed "s/$X//"`
     SVN_REV=`svn info * 2>/dev/null | grep ^Revision: \
         | cut -d ' ' -f 2 | xargs -n 1 -iX printf "%05i\n" X \
         | sort -r | _head 1 | sed 's/^0//' | sed 's/^0//' \
@@ -242,7 +246,7 @@
         .svn/entries 2>/dev/null`
     test $SVN_REV || SVN_REV=0
     DEFINES="$DEFINES -DSVN_REVISION=$SVN_REV"
-    answer done
+    answer `echo $VERMAJ`.`echo $VERMIN`.$SVN_REV
 
     SYSTEM=`uname -s 2>/dev/null`
     SYSTEM=`echo $SYSTEM | tr '[A-Z]' '[a-z]'`



From ivop at mail.berlios.de  Wed Sep 12 21:05:46 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 21:05:46 +0200
Subject: [Hmgen-svnlog] r135 - trunk
Message-ID: <200709121905.l8CJ5k6w018727@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 21:05:46 +0200 (Wed, 12 Sep 2007)
New Revision: 135

Modified:
   trunk/build.sh
Log:
common die function


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 18:56:54 UTC (rev 134)
+++ trunk/build.sh	2007-09-12 19:05:46 UTC (rev 135)
@@ -108,6 +108,11 @@
 
 # --------------------------------( CONFIGURE )--------------------------------
 
+die() {
+    echo "$1" >&2
+    exit 1
+}
+
 question() {
     printf "%-16s : " "$1"
 }
@@ -129,18 +134,14 @@
     question $1
     RES=`pkg-config --atleast-version=$4 $1 2>/dev/null && echo yes || echo no`
     answer $RES
-    if test "$RES" != "yes" ; then
-        echo "$1, at least version $4, not found."
-        echo "Perhaps you need to install the dev(el) packages?"
-        exit 1
-    fi
+    test "$RES" != yes && die "at least version $4 not found"
     eval $2=\"`pkg-config --cflags $1 2>/dev/null`\"
     eval $3=\"`pkg-config --static --libs $1 2>/dev/null`\"
 }
 
 configure() {
     question compiler
-    for i in $CC cc gcc suncc icc tcc ; do
+    for i in $CC cc gcc suncc icc tcc NONE; do
         if which $i 2>/dev/null 1>&2 ; then
             break
         fi
@@ -149,6 +150,8 @@
     CC_DEP=$i
     answer $CC
 
+    test "$CC" = "NONE" && die "a c compiler is mandatory"
+
     question vendor
     CC_VENDOR=`$CC --help 2>/dev/null | grep -q gcc && echo gnu`
     if test "$CC_VENDOR" = "gnu" ; then
@@ -215,10 +218,7 @@
     question pkg-config
     RES=`pkg-config --version 2>/dev/null 1>&2 && echo yes || echo no`
     answer $RES
-    if test "$RES" != "yes" ; then
-        echo "pkg-config not found"
-        exit 1
-    fi
+    test "$RES" != "yes" && die "pkg-config is mandatory"
 
     my_pkg_config gtk+-2.0 GTK_CFLAGS GTK_LDFLAGS 2.0
     my_pkg_config gthread-2.0 GTHREAD_CFLAGS GTHREAD_LDFLAGS 2.0



From ivop at mail.berlios.de  Wed Sep 12 21:09:02 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 21:09:02 +0200
Subject: [Hmgen-svnlog] r136 - trunk
Message-ID: <200709121909.l8CJ92L1018961@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 21:08:57 +0200 (Wed, 12 Sep 2007)
New Revision: 136

Modified:
   trunk/build.sh
Log:
in case both question and answer are known (result()) do not print anything
if answer is empty


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 19:05:46 UTC (rev 135)
+++ trunk/build.sh	2007-09-12 19:08:57 UTC (rev 136)
@@ -126,8 +126,7 @@
 }
 
 result() {
-    question "$1"
-    answer "$2"
+    test -n "$2" && question "$1" && answer "$2"
 }
 
 my_pkg_config() {



From ivop at mail.berlios.de  Wed Sep 12 23:10:44 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 12 Sep 2007 23:10:44 +0200
Subject: [Hmgen-svnlog] r137 - trunk
Message-ID: <200709122110.l8CLAiHg028466@sheep.berlios.de>

Author: ivop
Date: 2007-09-12 23:10:43 +0200 (Wed, 12 Sep 2007)
New Revision: 137

Modified:
   trunk/build.sh
Log:
function to find available program(s)


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 19:08:57 UTC (rev 136)
+++ trunk/build.sh	2007-09-12 21:10:43 UTC (rev 137)
@@ -138,17 +138,21 @@
     eval $3=\"`pkg-config --static --libs $1 2>/dev/null`\"
 }
 
-configure() {
-    question compiler
-    for i in $CC cc gcc suncc icc tcc NONE; do
-        if which $i 2>/dev/null 1>&2 ; then
-            break
-        fi
+find_program() {
+    prog=$1; shift
+    var=$1; shift
+    question $prog
+    for i in $@ NONE ; do
+        if which $i 2>/dev/null 1>&2 ; then break ; fi
     done
-    CC=$i
-    CC_DEP=$i
-    answer $CC
+    eval $var=$i
+    answer $i
+}
 
+configure() {
+    find_program compiler CC $CC cc gcc suncc icc tcc
+    CC_DEP=$CC
+
     test "$CC" = "NONE" && die "a c compiler is mandatory"
 
     question vendor



From ivop at mail.berlios.de  Thu Sep 13 00:18:02 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 13 Sep 2007 00:18:02 +0200
Subject: [Hmgen-svnlog] r138 - trunk
Message-ID: <200709122218.l8CMI2A2007146@sheep.berlios.de>

Author: ivop
Date: 2007-09-13 00:18:02 +0200 (Thu, 13 Sep 2007)
New Revision: 138

Modified:
   trunk/build.sh
Log:
use find_program for strip, ranlib, ar, etc...
extra paramater optional/mandatory


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 21:10:43 UTC (rev 137)
+++ trunk/build.sh	2007-09-12 22:18:02 UTC (rev 138)
@@ -141,20 +141,20 @@
 find_program() {
     prog=$1; shift
     var=$1; shift
+    mand=$1; shift
     question $prog
     for i in $@ NONE ; do
         if which $i 2>/dev/null 1>&2 ; then break ; fi
     done
     eval $var=$i
     answer $i
+    test "$mand" = "mandatory" -a "$i" = "NONE" && die "$prog is $mand"
 }
 
 configure() {
-    find_program compiler CC $CC cc gcc suncc icc tcc
+    find_program compiler CC mandatory $CC cc gcc suncc icc tcc
     CC_DEP=$CC
 
-    test "$CC" = "NONE" && die "a c compiler is mandatory"
-
     question vendor
     CC_VENDOR=`$CC --help 2>/dev/null | grep -q gcc && echo gnu`
     if test "$CC_VENDOR" = "gnu" ; then
@@ -277,17 +277,14 @@
     OBJSUF=.o
     result "obj suffix" $OBJSUF
 
-    AR=ar
-    result "ar" $AR
+    find_program ar AR mandatory $AR ar gar
 
     AR_FLAGS=cru
     result "ar flags" $AR_FLAGS
 
-    RANLIB=ranlib
-    result "ranlib" $RANLIB
+    find_program ranlib RANLIB optional $RANLIB ranlib true
 
-    STRIP=strip
-    result "strip" $STRIP
+    find_program strip STRIP optional $STRIP strip true
 }
 
 output_build_config() {



From ivop at mail.berlios.de  Thu Sep 13 00:22:33 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 13 Sep 2007 00:22:33 +0200
Subject: [Hmgen-svnlog] r139 - trunk
Message-ID: <200709122222.l8CMMX0M007348@sheep.berlios.de>

Author: ivop
Date: 2007-09-13 00:22:33 +0200 (Thu, 13 Sep 2007)
New Revision: 139

Modified:
   trunk/build.sh
Log:
check pkg-config with find_program
fix grep for CONFIGURE_DONE


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 22:18:02 UTC (rev 138)
+++ trunk/build.sh	2007-09-12 22:22:33 UTC (rev 139)
@@ -218,10 +218,7 @@
     result "object out" $OBJ_OUT_FLAG
     result "do not link" $DONT_LINK_FLAG
 
-    question pkg-config
-    RES=`pkg-config --version 2>/dev/null 1>&2 && echo yes || echo no`
-    answer $RES
-    test "$RES" != "yes" && die "pkg-config is mandatory"
+    find_program pkg-config PKGCONFIG mandatory $PKGCONFIG pkg-config
 
     my_pkg_config gtk+-2.0 GTK_CFLAGS GTK_LDFLAGS 2.0
     my_pkg_config gthread-2.0 GTHREAD_CFLAGS GTHREAD_LDFLAGS 2.0
@@ -455,7 +452,7 @@
 }
 
 make_configure() {
-    if grep -q CONFIGURE_DONE=yes $configfile 2>/dev/null ; then
+    if grep -q CONFIGURE_DONE=\"yes\" $configfile 2>/dev/null ; then
         echo reading $configfile
         . $configfile
     else



From ivop at mail.berlios.de  Thu Sep 13 00:48:49 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 13 Sep 2007 00:48:49 +0200
Subject: [Hmgen-svnlog] r140 - trunk
Message-ID: <200709122248.l8CMmnLW013878@sheep.berlios.de>

Author: ivop
Date: 2007-09-13 00:48:48 +0200 (Thu, 13 Sep 2007)
New Revision: 140

Modified:
   trunk/build.sh
Log:
check for tools mandatory for correct operation of build.sh
find_program awk
cosmetics, align


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 22:22:33 UTC (rev 139)
+++ trunk/build.sh	2007-09-12 22:48:48 UTC (rev 140)
@@ -1,13 +1,8 @@
 #! /bin/sh
 
-# Experiment #2
-#
-# Instead of putting configure inside the Makefile, which is basically calling
-# sh all the time, put 'make' functionality inside configure :) The previous
-# experiment needed a POSIX environment anyway and on top of that, it depended
-# heavily on GNU make (which is bad) and recursive make (which is worse).
-# This experiment just needs a POSIX environment and nothing more.
-# Or perhaps not even POSIX ;)
+# Experimental configure/make script
+# Copyright (C) 2007 Ivo van Poorten
+# See LICENSE for licensing details
 
 # ----------------------------------( USAGE )----------------------------------
 
@@ -152,6 +147,13 @@
 }
 
 configure() {
+    echo $_echo_n"tools            : $_echo_c"
+    for i in which printf sed grep tr sort uniq cat test ; do
+        (which $i) 2>/dev/null 1>&2 || die "$i is mandatory"
+        echo $_echo_n"$i $_echo_c"
+    done
+    echo
+
     find_program compiler CC mandatory $CC cc gcc suncc icc tcc
     CC_DEP=$CC
 
@@ -279,9 +281,9 @@
     AR_FLAGS=cru
     result "ar flags" $AR_FLAGS
 
-    find_program ranlib RANLIB optional $RANLIB ranlib true
-
-    find_program strip STRIP optional $STRIP strip true
+    find_program ranlib RANLIB  optional $RANLIB    ranlib true
+    find_program strip  STRIP   optional $STRIP     strip true
+    find_program awk    AWK     optional $AWK       mawk gawk nawk awk true
 }
 
 output_build_config() {
@@ -301,10 +303,10 @@
 # unwrap lines --> sort --> uniq --> merge equal target lines and change syntax
 ccdeps_to_shdeps() {
     tr -d '\015' |
-    awk '/[\\]$/ { $NF="" ; printf("%s",$0) ; next } { print }' |
+    $AWK '/[\\]$/ { $NF="" ; printf("%s",$0) ; next } { print }' |
     sort |
     uniq |
-    awk '
+    $AWK '
         BEGIN { save="" }
         {   if (save==$1) {
                 ORS="" ;



From ivop at mail.berlios.de  Thu Sep 13 01:00:20 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 13 Sep 2007 01:00:20 +0200
Subject: [Hmgen-svnlog] r141 - trunk
Message-ID: <200709122300.l8CN0Kjo024911@sheep.berlios.de>

Author: ivop
Date: 2007-09-13 01:00:19 +0200 (Thu, 13 Sep 2007)
New Revision: 141

Modified:
   trunk/build.sh
Log:
write AWK to build.config
more portable continuing lines concattenating awk script


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 22:48:48 UTC (rev 140)
+++ trunk/build.sh	2007-09-12 23:00:19 UTC (rev 141)
@@ -293,7 +293,7 @@
         CC_VERSION_SUBMINOR WARN_FLAGS OPT_FLAGS STD_FLAGS DEBUG_FLAGS \
         DEP_FLAGS OBJ_OUT_FLAG DONT_LINK_FLAG GTK_CFLAGS GTK_LDFLAGS \
         GTHREAD_CFLAGS GTHREAD_LDFLAGS DEFINES SYSTEM SYS_LDFLAGS EXESUF AR \
-        AR_FLAGS RANLIB STRIP OBJSUF CONFIGURE_DONE ; do
+        AR_FLAGS RANLIB STRIP OBJSUF AWK CONFIGURE_DONE ; do
         eval echo "$i=\\\"\$$i\\\"" >> $configfile
     done
 }
@@ -303,7 +303,7 @@
 # unwrap lines --> sort --> uniq --> merge equal target lines and change syntax
 ccdeps_to_shdeps() {
     tr -d '\015' |
-    $AWK '/[\\]$/ { $NF="" ; printf("%s",$0) ; next } { print }' |
+    $AWK '/[\\]$/ { $NF="" ; ORS="" ; print ; next} { ORS="\n" ; print }' |
     sort |
     uniq |
     $AWK '



From ivop at mail.berlios.de  Thu Sep 13 01:05:33 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 13 Sep 2007 01:05:33 +0200
Subject: [Hmgen-svnlog] r142 - trunk
Message-ID: <200709122305.l8CN5XZo030586@sheep.berlios.de>

Author: ivop
Date: 2007-09-13 01:05:33 +0200 (Thu, 13 Sep 2007)
New Revision: 142

Modified:
   trunk/build.sh
Log:
proper PREFIX and DESTDIR handling


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 23:00:19 UTC (rev 141)
+++ trunk/build.sh	2007-09-12 23:05:33 UTC (rev 142)
@@ -94,8 +94,8 @@
 
 # Defaults
 
-prefix=/usr/local
-destdir=/
+PREFIX=/usr/local
+DESTDIR=
 CC=cc
 action=
 depsfile=build.deps
@@ -284,6 +284,9 @@
     find_program ranlib RANLIB  optional $RANLIB    ranlib true
     find_program strip  STRIP   optional $STRIP     strip true
     find_program awk    AWK     optional $AWK       mawk gawk nawk awk true
+
+    result "install prefix" "$PREFIX"
+    result "install destdir" "$DESTDIR"
 }
 
 output_build_config() {
@@ -293,7 +296,7 @@
         CC_VERSION_SUBMINOR WARN_FLAGS OPT_FLAGS STD_FLAGS DEBUG_FLAGS \
         DEP_FLAGS OBJ_OUT_FLAG DONT_LINK_FLAG GTK_CFLAGS GTK_LDFLAGS \
         GTHREAD_CFLAGS GTHREAD_LDFLAGS DEFINES SYSTEM SYS_LDFLAGS EXESUF AR \
-        AR_FLAGS RANLIB STRIP OBJSUF AWK CONFIGURE_DONE ; do
+        AR_FLAGS RANLIB STRIP OBJSUF AWK PREFIX DESTDIR CONFIGURE_DONE ; do
         eval echo "$i=\\\"\$$i\\\"" >> $configfile
     done
 }
@@ -542,7 +545,8 @@
 for i in $@ ; do
     case "$i" in
         --cc=*)         CC=`optarg $i`      ;;
-        --prefix=*)     prefix=`optarg $i`  ;;
+        --prefix=*)     PREFIX=`optarg $i`  ;;
+        --destdir=*)    DESTDIR=`optarg $i` ;;
         --verbose)      V=1                 ;;
         --nocolor)      C=0 ; init_colors   ;;
         --configfile=*) configfile=`optarg $i`  ;;



From ivop at mail.berlios.de  Thu Sep 13 01:09:05 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 13 Sep 2007 01:09:05 +0200
Subject: [Hmgen-svnlog] r143 - trunk
Message-ID: <200709122309.l8CN95Ds008084@sheep.berlios.de>

Author: ivop
Date: 2007-09-13 01:09:05 +0200 (Thu, 13 Sep 2007)
New Revision: 143

Modified:
   trunk/build.sh
Log:
test for cut


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 23:05:33 UTC (rev 142)
+++ trunk/build.sh	2007-09-12 23:09:05 UTC (rev 143)
@@ -148,7 +148,7 @@
 
 configure() {
     echo $_echo_n"tools            : $_echo_c"
-    for i in which printf sed grep tr sort uniq cat test ; do
+    for i in which printf sed grep tr sort uniq cat test cut ; do
         (which $i) 2>/dev/null 1>&2 || die "$i is mandatory"
         echo $_echo_n"$i $_echo_c"
     done



From ivop at mail.berlios.de  Thu Sep 13 12:46:54 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 13 Sep 2007 12:46:54 +0200
Subject: [Hmgen-svnlog] r144 - trunk
Message-ID: <200709131046.l8DAksBS019326@sheep.berlios.de>

Author: ivop
Date: 2007-09-13 12:46:53 +0200 (Thu, 13 Sep 2007)
New Revision: 144

Modified:
   trunk/build.sh
Log:
simplify


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-12 23:09:05 UTC (rev 143)
+++ trunk/build.sh	2007-09-13 10:46:53 UTC (rev 144)
@@ -523,6 +523,8 @@
 }
 
 make_clean() {
+    make_configure
+    make_init_project
     rm -f $libhmgen_objs $cli_objs $gui_objs $libhmgen
     rm -f $cli_g_exe $cli_exe $gui_g_exe $gui_exe
     rm -f *~
@@ -590,14 +592,10 @@
             ;;
         clean)
             action=1
-            make_configure
-            make_init_project
             make_clean
             ;;
         distclean)
             action=1
-            make_configure
-            make_init_project
             make_distclean
             ;;
         --*)



From ivop at mail.berlios.de  Thu Sep 13 12:47:27 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 13 Sep 2007 12:47:27 +0200
Subject: [Hmgen-svnlog] r145 - trunk
Message-ID: <200709131047.l8DAlRm2020214@sheep.berlios.de>

Author: ivop
Date: 2007-09-13 12:47:27 +0200 (Thu, 13 Sep 2007)
New Revision: 145

Modified:
   trunk/build.sh
Log:
also match -* as unknown options


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-13 10:46:53 UTC (rev 144)
+++ trunk/build.sh	2007-09-13 10:47:27 UTC (rev 145)
@@ -598,7 +598,7 @@
             action=1
             make_distclean
             ;;
-        --*)
+        -*)
             echo unknown option ; exit 1 ;;
         *)
             echo unknown action ; exit 1 ;;



From ivop at mail.berlios.de  Thu Sep 13 12:49:56 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 13 Sep 2007 12:49:56 +0200
Subject: [Hmgen-svnlog] r146 - trunk
Message-ID: <200709131049.l8DAnuQe021566@sheep.berlios.de>

Author: ivop
Date: 2007-09-13 12:49:56 +0200 (Thu, 13 Sep 2007)
New Revision: 146

Modified:
   trunk/build.sh
Log:
refactor


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-13 10:47:27 UTC (rev 145)
+++ trunk/build.sh	2007-09-13 10:49:56 UTC (rev 146)
@@ -496,6 +496,12 @@
     make_set_deps $gui_g_exe $gui_objs $libhmgen
 }
 
+make_conf_init_deps() {
+    make_configure
+    make_init_project
+    make_deps
+}
+
 make_cli() {
     make_exe $cli_g_exe
     if not up_to_date $cli_exe $cli_g_exe ; then
@@ -561,29 +567,21 @@
         deps)
             action=1
             >$depsfile
-            make_configure
-            make_init_project
-            make_deps
+            make_conf_init_deps
             ;;
         cli)
             action=1
-            make_configure
-            make_init_project
-            make_deps
+            make_conf_init_deps
             make_cli
             ;;
         gui)
             action=1
-            make_configure
-            make_init_project
-            make_deps
+            make_conf_init_deps
             make_gui
             ;;
         lib)
             action=1
-            make_configure
-            make_init_project
-            make_deps
+            make_conf_init_deps
             make_lib $libhmgen
             ;;
         all)



From ivop at mail.berlios.de  Thu Sep 13 13:00:11 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 13 Sep 2007 13:00:11 +0200
Subject: [Hmgen-svnlog] r147 - trunk
Message-ID: <200709131100.l8DB0Bhq029453@sheep.berlios.de>

Author: ivop
Date: 2007-09-13 13:00:10 +0200 (Thu, 13 Sep 2007)
New Revision: 147

Modified:
   trunk/build.sh
Log:
refactor some more
also, rename i to arg in main loop to avoid collision later on


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-13 10:49:56 UTC (rev 146)
+++ trunk/build.sh	2007-09-13 11:00:10 UTC (rev 147)
@@ -521,16 +521,12 @@
 }
 
 make_all() {
-    make_configure
-    make_init_project
-    make_deps
+    make_conf_init_deps
     make_cli
     make_gui
 }
 
 make_clean() {
-    make_configure
-    make_init_project
     rm -f $libhmgen_objs $cli_objs $gui_objs $libhmgen
     rm -f $cli_g_exe $cli_exe $gui_g_exe $gui_exe
     rm -f *~
@@ -550,15 +546,15 @@
     case "$i" in --help|-help|-h|-?) help ; exit ;; esac
 done
 
-for i in $@ ; do
-    case "$i" in
-        --cc=*)         CC=`optarg $i`      ;;
-        --prefix=*)     PREFIX=`optarg $i`  ;;
-        --destdir=*)    DESTDIR=`optarg $i` ;;
+for arg in $@ ; do
+    case "$arg" in
+        --cc=*)         CC=`optarg $arg`      ;;
+        --prefix=*)     PREFIX=`optarg $arg`  ;;
+        --destdir=*)    DESTDIR=`optarg $arg` ;;
         --verbose)      V=1                 ;;
         --nocolor)      C=0 ; init_colors   ;;
-        --configfile=*) configfile=`optarg $i`  ;;
-        --depsfile=*)   depsfile=`optarg $i`    ;;
+        --configfile=*) configfile=`optarg $arg`  ;;
+        --depsfile=*)   depsfile=`optarg $arg`    ;;
         configure)
             action=1
             >$configfile
@@ -569,33 +565,16 @@
             >$depsfile
             make_conf_init_deps
             ;;
-        cli)
-            action=1
-            make_conf_init_deps
-            make_cli
-            ;;
-        gui)
-            action=1
-            make_conf_init_deps
-            make_gui
-            ;;
         lib)
             action=1
             make_conf_init_deps
             make_lib $libhmgen
             ;;
-        all)
+        cli|gui|all|clean|distclean)
             action=1
-            make_all
+            make_conf_init_deps
+            make_$arg
             ;;
-        clean)
-            action=1
-            make_clean
-            ;;
-        distclean)
-            action=1
-            make_distclean
-            ;;
         -*)
             echo unknown option ; exit 1 ;;
         *)



From ivop at mail.berlios.de  Thu Sep 13 13:04:47 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 13 Sep 2007 13:04:47 +0200
Subject: [Hmgen-svnlog] r148 - trunk
Message-ID: <200709131104.l8DB4lYJ002569@sheep.berlios.de>

Author: ivop
Date: 2007-09-13 13:04:46 +0200 (Thu, 13 Sep 2007)
New Revision: 148

Modified:
   trunk/build.sh
Log:
exit if building a component fails


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-13 11:00:10 UTC (rev 147)
+++ trunk/build.sh	2007-09-13 11:04:46 UTC (rev 148)
@@ -352,7 +352,7 @@
     if test "$V" = "0" ; then   printf "$Bon%s$Boff %s\n" "$2" "$3"
     else                        echo "$1"
     fi
-    eval "$1"
+    eval "$1" || die "build failed"
 }
 
 make_c_to_o() {



From ivop at mail.berlios.de  Thu Sep 13 13:26:07 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 13 Sep 2007 13:26:07 +0200
Subject: [Hmgen-svnlog] r149 - trunk
Message-ID: <200709131126.l8DBQ7xD002715@sheep.berlios.de>

Author: ivop
Date: 2007-09-13 13:26:07 +0200 (Thu, 13 Sep 2007)
New Revision: 149

Modified:
   trunk/build.sh
Log:
install actions


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-13 11:04:46 UTC (rev 148)
+++ trunk/build.sh	2007-09-13 11:26:07 UTC (rev 149)
@@ -29,8 +29,8 @@
 gui                 build gui version only
 lib                 build (static) library only
 install             install all programs
-install-cli         install cli version only
-install-gui         install gui version only
+install_cli         install cli version only
+install_gui         install gui version only
 configure           perform configure only
 deps                determine dependencies only
 clean               clean up
@@ -355,6 +355,10 @@
     eval "$1" || die "build failed"
 }
 
+make_exec2() {
+    make_exec "$1" "$2" "$1"
+}
+
 make_c_to_o() {
     c=`basename $1 $OBJSUF`.c
     make_exec "$CC $DONT_LINK_FLAG $OBJ_OUT_FLAG $1 $c $CFLAGS" "compile" "$c"
@@ -536,6 +540,26 @@
     make_clean
     rm -f $configfile $depsfile
 }
+
+make_install_cli() {
+    make_cli
+    make_exec2 "mkdir -p \"$DESTDIR/$PREFIX/bin\"" "install:"
+    make_exec2 "cp $cli_exe \"$DESTDIR/$PREFIX/bin\"" "install:"
+    make_exec2 "chmod 755 \"$DESTDIR/$PREFIX/bin/$cli_exe\"" "install:"
+}
+
+make_install_gui() {
+    make_gui
+    make_exec2 "mkdir -p \"$DESTDIR/$PREFIX/bin\"" "install:"
+    make_exec2 "cp $gui_exe \"$DESTDIR/$PREFIX/bin\"" "install:"
+    make_exec2 "chmod 755 \"$DESTDIR/$PREFIX/bin/$gui_exe\"" "install:"
+}
+
+make_install() {
+    make_install_cli
+    make_install_gui
+}
+
 # ----------------------------------( MAIN )-----------------------------------
 
 optarg() {
@@ -570,7 +594,7 @@
             make_conf_init_deps
             make_lib $libhmgen
             ;;
-        cli|gui|all|clean|distclean)
+        cli|gui|all|clean|distclean|install_cli|install_gui|install)
             action=1
             make_conf_init_deps
             make_$arg



From ivop at mail.berlios.de  Thu Sep 13 13:28:00 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 13 Sep 2007 13:28:00 +0200
Subject: [Hmgen-svnlog] r150 - trunk
Message-ID: <200709131128.l8DBS0pT002800@sheep.berlios.de>

Author: ivop
Date: 2007-09-13 13:28:00 +0200 (Thu, 13 Sep 2007)
New Revision: 150

Modified:
   trunk/build.sh
Log:
avoid reading build.* twice for make_all


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-13 11:26:07 UTC (rev 149)
+++ trunk/build.sh	2007-09-13 11:28:00 UTC (rev 150)
@@ -525,7 +525,6 @@
 }
 
 make_all() {
-    make_conf_init_deps
     make_cli
     make_gui
 }
@@ -606,6 +605,6 @@
     esac
 done
 
-if test -z "$action" ; then make_all ; fi
+if test -z "$action" ; then make_conf_init_deps ; make_all ; fi
 
 echo "done"



From ivop at mail.berlios.de  Thu Sep 13 13:29:04 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 13 Sep 2007 13:29:04 +0200
Subject: [Hmgen-svnlog] r151 - trunk
Message-ID: <200709131129.l8DBT43C002882@sheep.berlios.de>

Author: ivop
Date: 2007-09-13 13:29:04 +0200 (Thu, 13 Sep 2007)
New Revision: 151

Modified:
   trunk/build.sh
Log:
more tools to check


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-13 11:28:00 UTC (rev 150)
+++ trunk/build.sh	2007-09-13 11:29:04 UTC (rev 151)
@@ -148,7 +148,7 @@
 
 configure() {
     echo $_echo_n"tools            : $_echo_c"
-    for i in which printf sed grep tr sort uniq cat test cut ; do
+    for i in which printf sed grep tr sort uniq cat test cut cp rm chmod ; do
         (which $i) 2>/dev/null 1>&2 || die "$i is mandatory"
         echo $_echo_n"$i $_echo_c"
     done



From ivop at mail.berlios.de  Thu Sep 13 17:51:32 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 13 Sep 2007 17:51:32 +0200
Subject: [Hmgen-svnlog] r152 - trunk
Message-ID: <200709131551.l8DFpW96025427@sheep.berlios.de>

Author: ivop
Date: 2007-09-13 17:51:30 +0200 (Thu, 13 Sep 2007)
New Revision: 152

Modified:
   trunk/build.sh
Log:
clarify usage information
one can specify multiple options with multiple actions interleaved, i.e.
./build.sh distclean --cc=suncc install-cli clean --cc=gcc install-gui


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-13 11:29:04 UTC (rev 151)
+++ trunk/build.sh	2007-09-13 15:51:30 UTC (rev 152)
@@ -9,7 +9,7 @@
 help() {
     cat << __EOF__
 
-usage: ./build.sh [options] [actions]
+usage: ./build.sh [option(s)] [action(s)] [option(s)] [action(s)] ...
 
 options:
 



From ivop at mail.berlios.de  Fri Sep 14 12:13:35 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 14 Sep 2007 12:13:35 +0200
Subject: [Hmgen-svnlog] r153 - trunk
Message-ID: <200709141013.l8EADZXx029756@sheep.berlios.de>

Author: ivop
Date: 2007-09-14 12:13:34 +0200 (Fri, 14 Sep 2007)
New Revision: 153

Modified:
   trunk/build.sh
Log:
prefix and destdir are uppercase now


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-13 15:51:30 UTC (rev 152)
+++ trunk/build.sh	2007-09-14 10:13:34 UTC (rev 153)
@@ -14,8 +14,8 @@
 options:
 
 --cc=CC             specify C compiler
---prefix=PREFIX     installation prefix [default: $prefix]
---destdir=DESTDIR   installation destination directory [default: $destdir]
+--prefix=PREFIX     installation prefix [default: $PREFIX]
+--destdir=DESTDIR   installation destination directory [default: $DESTDIR]
 --verbose           verbose compilation
 --nocolor           disable colors for terminals w/o VT100 capabilities
 --configfile=FILE   specify alternative config file



From ivop at mail.berlios.de  Fri Sep 14 12:15:06 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 14 Sep 2007 12:15:06 +0200
Subject: [Hmgen-svnlog] r154 - trunk
Message-ID: <200709141015.l8EAF60X029886@sheep.berlios.de>

Author: ivop
Date: 2007-09-14 12:15:06 +0200 (Fri, 14 Sep 2007)
New Revision: 154

Modified:
   trunk/build.sh
Log:
xargs is mandatory


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-14 10:13:34 UTC (rev 153)
+++ trunk/build.sh	2007-09-14 10:15:06 UTC (rev 154)
@@ -148,7 +148,7 @@
 
 configure() {
     echo $_echo_n"tools            : $_echo_c"
-    for i in which printf sed grep tr sort uniq cat test cut cp rm chmod ; do
+    for i in which printf sed grep tr sort uniq cat test cut cp rm chmod xargs ; do
         (which $i) 2>/dev/null 1>&2 || die "$i is mandatory"
         echo $_echo_n"$i $_echo_c"
     done



From ivop at mail.berlios.de  Fri Sep 14 12:39:59 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 14 Sep 2007 12:39:59 +0200
Subject: [Hmgen-svnlog] r155 - trunk
Message-ID: <200709141039.l8EAdxiU026775@sheep.berlios.de>

Author: ivop
Date: 2007-09-14 12:39:59 +0200 (Fri, 14 Sep 2007)
New Revision: 155

Modified:
   trunk/build.sh
Log:
move revision version retrieval to its own function
do not use xargs and printf for zero-padding


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-14 10:15:06 UTC (rev 154)
+++ trunk/build.sh	2007-09-14 10:39:59 UTC (rev 155)
@@ -146,9 +146,38 @@
     test "$mand" = "mandatory" -a "$i" = "NONE" && die "$prog is $mand"
 }
 
+pad_with_zeroes() {
+    while true; do
+        read A
+        case "$A" in
+            ?)      echo 0000$A ;;
+            ??)     echo 000$A  ;;
+            ???)    echo 00$A   ;;
+            ????)   echo 0$A    ;;
+            ?????)  echo $A     ;;
+            *)      break       ;;
+        esac
+    done
+}
+
+get_svn_revision() {
+    SVN_REV=`svn info * 2>/dev/null | grep ^Revision: \
+        | cut -d ' ' -f 2 | pad_with_zeroes \
+        | sort -r | _head 1 | sed 's/^0//' | sed 's/^0//' \
+        | sed 's/^0//'`
+    test $SVN_REV || SVN_REV=`grep revision .svn/entries 2>/dev/null \
+        | cut -d '"' -f 2` | pad_with_zeroes \
+        | sort -r | _head 1 | sed 's/^0//' | sed 's/^0//' \
+        | sed 's/^0//'
+    test $SVN_REV || SVN_REV=`sed -n -e '/^dir$/{n;p;q;}' \
+        .svn/entries 2>/dev/null`
+    test $SVN_REV || SVN_REV=0
+    echo $SVN_REV
+}
+
 configure() {
     echo $_echo_n"tools            : $_echo_c"
-    for i in which printf sed grep tr sort uniq cat test cut cp rm chmod xargs ; do
+    for i in which printf sed grep tr sort uniq cat test cut cp rm chmod ; do
         (which $i) 2>/dev/null 1>&2 || die "$i is mandatory"
         echo $_echo_n"$i $_echo_c"
     done
@@ -236,17 +265,7 @@
     VERMAJ=`grep "$X" version.h | sed "s/$X//"`
     X="#define HMG_VERSION_MINOR"
     VERMIN=`grep "$X" version.h | sed "s/$X//"`
-    SVN_REV=`svn info * 2>/dev/null | grep ^Revision: \
-        | cut -d ' ' -f 2 | xargs -n 1 -iX printf "%05i\n" X \
-        | sort -r | _head 1 | sed 's/^0//' | sed 's/^0//' \
-        | sed 's/^0//'`
-    test $SVN_REV || SVN_REV=`grep revision .svn/entries 2>/dev/null \
-        | cut -d '"' -f 2` | xargs -n 1 -iX printf "%05i\n" X \
-        | sort -r | _head 1 | sed 's/^0//' | sed 's/^0//' \
-        | sed 's/^0//'
-    test $SVN_REV || SVN_REV=`sed -n -e '/^dir$/{n;p;q;}' \
-        .svn/entries 2>/dev/null`
-    test $SVN_REV || SVN_REV=0
+    SVN_REV=`get_svn_revision`
     DEFINES="$DEFINES -DSVN_REVISION=$SVN_REV"
     answer `echo $VERMAJ`.`echo $VERMIN`.$SVN_REV
 



From ivop at mail.berlios.de  Fri Sep 14 12:43:52 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 14 Sep 2007 12:43:52 +0200
Subject: [Hmgen-svnlog] r156 - trunk
Message-ID: <200709141043.l8EAhqGn032137@sheep.berlios.de>

Author: ivop
Date: 2007-09-14 12:43:52 +0200 (Fri, 14 Sep 2007)
New Revision: 156

Modified:
   trunk/build.sh
Log:
remove two printf's ; one to go


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-14 10:39:59 UTC (rev 155)
+++ trunk/build.sh	2007-09-14 10:43:52 UTC (rev 156)
@@ -117,7 +117,7 @@
     elif test "$1" = "yes" ; then   col="$Bon$Green"
     else                            col="$Bon"
     fi
-    test -n "$1" && printf "$col%s$Boff\n" "$1" || printf "<none>\n"
+    test -n "$1" && echo "$col$1$Boff" || echo "<none>"
 }
 
 result() {
@@ -368,7 +368,7 @@
 }
 
 make_exec() {
-    if test "$V" = "0" ; then   printf "$Bon%s$Boff %s\n" "$2" "$3"
+    if test "$V" = "0" ; then   echo "$Bon$2$Boff $3"
     else                        echo "$1"
     fi
     eval "$1" || die "build failed"



From ivop at mail.berlios.de  Fri Sep 14 12:57:21 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 14 Sep 2007 12:57:21 +0200
Subject: [Hmgen-svnlog] r157 - trunk
Message-ID: <200709141057.l8EAvLHp011945@sheep.berlios.de>

Author: ivop
Date: 2007-09-14 12:57:20 +0200 (Fri, 14 Sep 2007)
New Revision: 157

Modified:
   trunk/build.sh
Log:
do not use printf at all. use older, more common unix tool 'col'


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-14 10:43:52 UTC (rev 156)
+++ trunk/build.sh	2007-09-14 10:57:20 UTC (rev 157)
@@ -77,8 +77,8 @@
 }
 
 case `echo -n` in
-    -n)     _echo_n=        _echo_c='\c'    ;; # SysV
-    *)      _echo_n='-n '   _echo_c=        ;; # BSD
+    -n)     _echo_n=        _echo_c='\c'    _echo_e=        ;; # SysV
+    *)      _echo_n='-n '   _echo_c=        _echo_e='-e '   ;; # BSD
 esac
 
 test -z "$V" && V=0
@@ -109,7 +109,8 @@
 }
 
 question() {
-    printf "%-16s : " "$1"
+    TMP=`echo $_echo_e"$1\r                 :" | col`
+    echo $_echo_n"$TMP $_echo_c"
 }
 
 answer() {
@@ -176,8 +177,8 @@
 }
 
 configure() {
-    echo $_echo_n"tools            : $_echo_c"
-    for i in which printf sed grep tr sort uniq cat test cut cp rm chmod ; do
+    question tools
+    for i in which col sed grep tr sort uniq cat test cut cp rm chmod ; do
         (which $i) 2>/dev/null 1>&2 || die "$i is mandatory"
         echo $_echo_n"$i $_echo_c"
     done



From ivop at mail.berlios.de  Fri Sep 14 12:58:57 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 14 Sep 2007 12:58:57 +0200
Subject: [Hmgen-svnlog] r158 - trunk
Message-ID: <200709141058.l8EAwv2E014654@sheep.berlios.de>

Author: ivop
Date: 2007-09-14 12:58:57 +0200 (Fri, 14 Sep 2007)
New Revision: 158

Modified:
   trunk/build.sh
Log:
cosmetics


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-14 10:57:20 UTC (rev 157)
+++ trunk/build.sh	2007-09-14 10:58:57 UTC (rev 158)
@@ -164,12 +164,10 @@
 get_svn_revision() {
     SVN_REV=`svn info * 2>/dev/null | grep ^Revision: \
         | cut -d ' ' -f 2 | pad_with_zeroes \
-        | sort -r | _head 1 | sed 's/^0//' | sed 's/^0//' \
-        | sed 's/^0//'`
+        | sort -r | _head 1 | sed 's/^0//' | sed 's/^0//' | sed 's/^0//'`
     test $SVN_REV || SVN_REV=`grep revision .svn/entries 2>/dev/null \
         | cut -d '"' -f 2` | pad_with_zeroes \
-        | sort -r | _head 1 | sed 's/^0//' | sed 's/^0//' \
-        | sed 's/^0//'
+        | sort -r | _head 1 | sed 's/^0//' | sed 's/^0//' | sed 's/^0//'
     test $SVN_REV || SVN_REV=`sed -n -e '/^dir$/{n;p;q;}' \
         .svn/entries 2>/dev/null`
     test $SVN_REV || SVN_REV=0



From ivop at mail.berlios.de  Fri Sep 14 13:21:13 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 14 Sep 2007 13:21:13 +0200
Subject: [Hmgen-svnlog] r159 - trunk
Message-ID: <200709141121.l8EBLD4T017171@sheep.berlios.de>

Author: ivop
Date: 2007-09-14 13:21:13 +0200 (Fri, 14 Sep 2007)
New Revision: 159

Modified:
   trunk/build.sh
Log:
increase portability
mingw has no col, but has printf
fallback to plain echo 


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-14 10:58:57 UTC (rev 158)
+++ trunk/build.sh	2007-09-14 11:21:13 UTC (rev 159)
@@ -92,6 +92,9 @@
 
 init_colors
 
+test `which col 2>/dev/null` && _col=yes
+test `which printf 2>/dev/null` && _printf=yes
+
 # Defaults
 
 PREFIX=/usr/local
@@ -109,8 +112,14 @@
 }
 
 question() {
-    TMP=`echo $_echo_e"$1\r                 :" | col`
-    echo $_echo_n"$TMP $_echo_c"
+    if test "$_col" = yes ; then
+        TMP=`echo $_echo_e"$1\r                 :" | col`
+        echo $_echo_n"$TMP $_echo_c"
+    elif test "$_printf" = yes ; then
+        printf "%-16s : " "$1"
+    else
+        echo $_echo_n"$1 : $_echo_c"
+    fi
 }
 
 answer() {
@@ -176,7 +185,7 @@
 
 configure() {
     question tools
-    for i in which col sed grep tr sort uniq cat test cut cp rm chmod ; do
+    for i in which sed grep tr sort uniq cat test cut cp rm chmod ; do
         (which $i) 2>/dev/null 1>&2 || die "$i is mandatory"
         echo $_echo_n"$i $_echo_c"
     done



From ivop at mail.berlios.de  Fri Sep 14 13:58:15 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 14 Sep 2007 13:58:15 +0200
Subject: [Hmgen-svnlog] r160 - trunk
Message-ID: <200709141158.l8EBwFSs020133@sheep.berlios.de>

Author: ivop
Date: 2007-09-14 13:58:14 +0200 (Fri, 14 Sep 2007)
New Revision: 160

Modified:
   trunk/build.sh
Log:
argh, stop with col, printf, etc... just plain shell here. a little bit more
code, but it should work everywhere and is faster on mingw/cygwin


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-14 11:21:13 UTC (rev 159)
+++ trunk/build.sh	2007-09-14 11:58:14 UTC (rev 160)
@@ -92,9 +92,6 @@
 
 init_colors
 
-test `which col 2>/dev/null` && _col=yes
-test `which printf 2>/dev/null` && _printf=yes
-
 # Defaults
 
 PREFIX=/usr/local
@@ -112,14 +109,24 @@
 }
 
 question() {
-    if test "$_col" = yes ; then
-        TMP=`echo $_echo_e"$1\r                 :" | col`
-        echo $_echo_n"$TMP $_echo_c"
-    elif test "$_printf" = yes ; then
-        printf "%-16s : " "$1"
-    else
-        echo $_echo_n"$1 : $_echo_c"
-    fi
+    case "$1" in
+        ?) echo $_echo_n"$1                : $_echo_c" ;;
+        ??) echo $_echo_n"$1               : $_echo_c" ;;
+        ???) echo $_echo_n"$1              : $_echo_c" ;;
+        ????) echo $_echo_n"$1             : $_echo_c" ;;
+        ?????) echo $_echo_n"$1            : $_echo_c" ;;
+        ??????) echo $_echo_n"$1           : $_echo_c" ;;
+        ???????) echo $_echo_n"$1          : $_echo_c" ;;
+        ????????) echo $_echo_n"$1         : $_echo_c" ;;
+        ?????????) echo $_echo_n"$1        : $_echo_c" ;;
+        ??????????) echo $_echo_n"$1       : $_echo_c" ;;
+        ???????????) echo $_echo_n"$1      : $_echo_c" ;;
+        ????????????) echo $_echo_n"$1     : $_echo_c" ;;
+        ?????????????) echo $_echo_n"$1    : $_echo_c" ;;
+        ??????????????) echo $_echo_n"$1   : $_echo_c" ;;
+        ???????????????) echo $_echo_n"$1  : $_echo_c" ;;
+        ???????????????*) echo $_echo_n"$1 : $_echo_c" ;;
+    esac
 }
 
 answer() {



From ivop at mail.berlios.de  Fri Sep 14 15:41:14 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 14 Sep 2007 15:41:14 +0200
Subject: [Hmgen-svnlog] r161 - trunk
Message-ID: <200709141341.l8EDfEW0025506@sheep.berlios.de>

Author: ivop
Date: 2007-09-14 15:41:14 +0200 (Fri, 14 Sep 2007)
New Revision: 161

Modified:
   trunk/build.sh
Log:
cosmetics


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-14 11:58:14 UTC (rev 160)
+++ trunk/build.sh	2007-09-14 13:41:14 UTC (rev 161)
@@ -71,10 +71,7 @@
     _tail() { tail -n $1 2>/dev/null ; }
 fi
 
-not() {
-    eval "$@"
-    test $? -ne 0
-}
+not() { eval "$@" ; test $? -ne 0 ; }
 
 case `echo -n` in
     -n)     _echo_n=        _echo_c='\c'    _echo_e=        ;; # SysV
@@ -89,7 +86,6 @@
     else Bon="[1m" ; Boff="[0m" ; Red="[31m" ; Green="[32m"
     fi
 }
-
 init_colors
 
 # Defaults
@@ -103,10 +99,7 @@
 
 # --------------------------------( CONFIGURE )--------------------------------
 
-die() {
-    echo "$1" >&2
-    exit 1
-}
+die() { echo "$1" >&2 ; exit 1 ; }
 
 question() {
     case "$1" in
@@ -130,16 +123,14 @@
 }
 
 answer() {
-    if test "$1" = "no" ; then      col="$Bon$Red"
+    if   test "$1" = "no" ;  then   col="$Bon$Red"
     elif test "$1" = "yes" ; then   col="$Bon$Green"
     else                            col="$Bon"
     fi
     test -n "$1" && echo "$col$1$Boff" || echo "<none>"
 }
 
-result() {
-    test -n "$2" && question "$1" && answer "$2"
-}
+result() { test -n "$2" && question "$1" && answer "$2" }
 
 my_pkg_config() {
     question $1
@@ -415,9 +406,7 @@
 
 addsuffix() {
     suf=$1 ; shift 1
-    for i in $@ ; do
-        echo $i$suf
-    done
+    for i in $@ ; do echo $i$suf ; done
 }
 
 up_to_date() {



From ivop at mail.berlios.de  Fri Sep 14 15:43:21 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Fri, 14 Sep 2007 15:43:21 +0200
Subject: [Hmgen-svnlog] r162 - trunk
Message-ID: <200709141343.l8EDhLv6025639@sheep.berlios.de>

Author: ivop
Date: 2007-09-14 15:43:20 +0200 (Fri, 14 Sep 2007)
New Revision: 162

Modified:
   trunk/build.sh
Log:
10l, missing ;


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-14 13:41:14 UTC (rev 161)
+++ trunk/build.sh	2007-09-14 13:43:20 UTC (rev 162)
@@ -130,7 +130,7 @@
     test -n "$1" && echo "$col$1$Boff" || echo "<none>"
 }
 
-result() { test -n "$2" && question "$1" && answer "$2" }
+result() { test -n "$2" && question "$1" && answer "$2" ; }
 
 my_pkg_config() {
     question $1



From ivop at mail.berlios.de  Sat Sep 15 00:26:17 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 15 Sep 2007 00:26:17 +0200
Subject: [Hmgen-svnlog] r163 - in trunk: . share
Message-ID: <200709142226.l8EMQHOZ010976@sheep.berlios.de>

Author: ivop
Date: 2007-09-15 00:26:17 +0200 (Sat, 15 Sep 2007)
New Revision: 163

Added:
   trunk/share/
   trunk/share/hmgen.png
Removed:
   trunk/hmgen.png
Log:
move image to share directory


Deleted: trunk/hmgen.png
===================================================================
(Binary files differ)

Copied: trunk/share/hmgen.png (from rev 130, trunk/hmgen.png)



From ivop at mail.berlios.de  Sat Sep 15 00:28:50 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 15 Sep 2007 00:28:50 +0200
Subject: [Hmgen-svnlog] r164 - in trunk/share: . hmgen
Message-ID: <200709142228.l8EMSo18011067@sheep.berlios.de>

Author: ivop
Date: 2007-09-15 00:28:50 +0200 (Sat, 15 Sep 2007)
New Revision: 164

Added:
   trunk/share/hmgen/
   trunk/share/hmgen/hmgen.png
Removed:
   trunk/share/hmgen.png
Log:
move again. tree will be:
PREFIX/bin/.
PREFIX/share/hmgen/.


Copied: trunk/share/hmgen/hmgen.png (from rev 163, trunk/share/hmgen.png)

Deleted: trunk/share/hmgen.png
===================================================================
(Binary files differ)



From ivop at mail.berlios.de  Sat Sep 15 00:31:58 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 15 Sep 2007 00:31:58 +0200
Subject: [Hmgen-svnlog] r165 - trunk
Message-ID: <200709142231.l8EMVwso015894@sheep.berlios.de>

Author: ivop
Date: 2007-09-15 00:31:57 +0200 (Sat, 15 Sep 2007)
New Revision: 165

Added:
   trunk/TODO
Log:
todolist


Added: trunk/TODO
===================================================================
--- trunk/TODO	2007-09-14 22:28:50 UTC (rev 164)
+++ trunk/TODO	2007-09-14 22:31:57 UTC (rev 165)
@@ -0,0 +1,12 @@
+CLI+GUI
+-------
+
+* More algorithms (circle formation, hills, et cetera)
+
+GUI
+---
+
+* Edit functions (draw roads, elevate lines, circles, squares, etc. )
+* Isometric 3D view
+* OpenGL 3D view, perhaps export as a mesh, manual texturing, etc.
+



From ivop at mail.berlios.de  Sat Sep 15 00:36:35 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 15 Sep 2007 00:36:35 +0200
Subject: [Hmgen-svnlog] r166 - trunk
Message-ID: <200709142236.l8EMaZc8032561@sheep.berlios.de>

Author: ivop
Date: 2007-09-15 00:36:34 +0200 (Sat, 15 Sep 2007)
New Revision: 166

Modified:
   trunk/gui_interface.c
   trunk/gui_main.c
Log:
move image filename to gui_main so it can be set according to the path of
the binary (image will be at ./share/hmgen/hmgen.png or
./share/hmgen/hmgen.png)


Modified: trunk/gui_interface.c
===================================================================
--- trunk/gui_interface.c	2007-09-14 22:31:57 UTC (rev 165)
+++ trunk/gui_interface.c	2007-09-14 22:36:34 UTC (rev 166)
@@ -31,6 +31,8 @@
 #include "gui_support.h"
 #include "version.h"
 
+extern char *about_image_filename;
+
 #define GLADE_HOOKUP_OBJECT(component,widget,name) \
   g_object_set_data_full (G_OBJECT (component), name, \
     gtk_widget_ref (widget), (GDestroyNotify) gtk_widget_unref)
@@ -1340,7 +1342,7 @@
   gtk_widget_show (vbox4);
   gtk_container_add (GTK_CONTAINER (main_notebook), vbox4);
 
-  image3 = create_pixmap (hmgengui, "hmgen.png");
+  image3 = create_pixmap (hmgengui, about_image_filename);
   gtk_widget_show (image3);
   gtk_box_pack_start (GTK_BOX (vbox4), image3, FALSE, FALSE, 64);
 

Modified: trunk/gui_main.c
===================================================================
--- trunk/gui_main.c	2007-09-14 22:31:57 UTC (rev 165)
+++ trunk/gui_main.c	2007-09-14 22:36:34 UTC (rev 166)
@@ -28,6 +28,8 @@
 #include "gui_support.h"
 #include "lib_hmgen.c"
 
+char *about_image_filename = "share/hmgen/hmgen.png";
+
 int main(int argc, char *argv[]) {
     GtkWidget *hmgengui;
     char *show_stderr;



From ivop at mail.berlios.de  Sat Sep 15 15:39:29 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 15 Sep 2007 15:39:29 +0200
Subject: [Hmgen-svnlog] r167 - trunk
Message-ID: <200709151339.l8FDdT5P003897@sheep.berlios.de>

Author: ivop
Date: 2007-09-15 15:39:29 +0200 (Sat, 15 Sep 2007)
New Revision: 167

Modified:
   trunk/build.sh
Log:
factor out cc configuration


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-14 22:36:34 UTC (rev 166)
+++ trunk/build.sh	2007-09-15 13:39:29 UTC (rev 167)
@@ -181,6 +181,16 @@
     echo $SVN_REV
 }
 
+cc_conf() {
+    WARN_FLAGS="$1"
+    OPT_FLAGS="$2"
+    STD_FLAGS="$3"
+    DEBUG_FLAGS="$4"
+    DEP_FLAGS="$5"
+    OBJ_OUT_FLAG="$6"
+    DONT_LINK_FLAG="$7"
+}
+
 configure() {
     question tools
     for i in which sed grep tr sort uniq cat test cut cp rm chmod ; do
@@ -219,33 +229,9 @@
     fi
 
     case $CC_VENDOR in
-        gnu)
-            WARN_FLAGS="-Wall -W"
-            OPT_FLAGS="-O3"
-            STD_FLAGS="-std=c99"
-            DEBUG_FLAGS="-g"
-            DEP_FLAGS="-MM"
-            OBJ_OUT_FLAG="-o"
-            DONT_LINK_FLAG="-c"
-            ;;
-        sun)
-            WARN_FLAGS=
-            OPT_FLAGS="-xO5"
-            STD_FLAGS="-Xc"
-            DEBUG_FLAGS="-g"
-            DEP_FLAGS="-xM"
-            OBJ_OUT_FLAG="-o"
-            DONT_LINK_FLAG="-c"
-            ;;
-        unknown)
-            WARN_FLAGS=
-            OPT_FLAGS="-O"
-            STD_FLAGS=
-            DEBUG_FLAGS="-g"
-            DEP_FLAGS=
-            OBJ_OUT_FLAG="-o"
-            DONT_LINK_FLAG="-c"
-            ;;
+        gnu)     cc_conf "-Wall -W" "-O3" "-std=c99" "-g" "-MM" "-o" "-c" ;;
+        sun)     cc_conf "" "-xO5" "-Xc" "-g" "-xM" "-o" "-c" ;;
+        unknown) cc_conf "" "-O" "" "-g" "" "-o" "-c" ;;
     esac
     result warnings $WARN_FLAGS
     result optimize $OPT_FLAGS



From ivop at mail.berlios.de  Sat Sep 15 15:39:53 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 15 Sep 2007 15:39:53 +0200
Subject: [Hmgen-svnlog] r168 - trunk
Message-ID: <200709151339.l8FDdrxw003930@sheep.berlios.de>

Author: ivop
Date: 2007-09-15 15:39:52 +0200 (Sat, 15 Sep 2007)
New Revision: 168

Modified:
   trunk/build.sh
Log:
VT100-->ANSI


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-15 13:39:29 UTC (rev 167)
+++ trunk/build.sh	2007-09-15 13:39:52 UTC (rev 168)
@@ -17,7 +17,7 @@
 --prefix=PREFIX     installation prefix [default: $PREFIX]
 --destdir=DESTDIR   installation destination directory [default: $DESTDIR]
 --verbose           verbose compilation
---nocolor           disable colors for terminals w/o VT100 capabilities
+--nocolor           disable colors for terminals w/o ANSI capabilities
 --configfile=FILE   specify alternative config file
 --depsfile=FILE     specify alternative dependencies file
 --help              print this message



From ivop at mail.berlios.de  Sat Sep 15 16:51:08 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 15 Sep 2007 16:51:08 +0200
Subject: [Hmgen-svnlog] r169 - trunk
Message-ID: <200709151451.l8FEp8M1006788@sheep.berlios.de>

Author: ivop
Date: 2007-09-15 16:51:08 +0200 (Sat, 15 Sep 2007)
New Revision: 169

Modified:
   trunk/build.sh
Log:
put flags inside "", there can be multiple flags


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-15 13:39:52 UTC (rev 168)
+++ trunk/build.sh	2007-09-15 14:51:08 UTC (rev 169)
@@ -233,13 +233,13 @@
         sun)     cc_conf "" "-xO5" "-Xc" "-g" "-xM" "-o" "-c" ;;
         unknown) cc_conf "" "-O" "" "-g" "" "-o" "-c" ;;
     esac
-    result warnings $WARN_FLAGS
-    result optimize $OPT_FLAGS
-    result standards $STD_FLAGS
-    result debug $DEBUG_FLAGS
-    result dependencies $DEP_FLAGS
-    result "object out" $OBJ_OUT_FLAG
-    result "do not link" $DONT_LINK_FLAG
+    result warnings "$WARN_FLAGS"
+    result optimize "$OPT_FLAGS"
+    result standards "$STD_FLAGS"
+    result debug "$DEBUG_FLAGS"
+    result dependencies "$DEP_FLAGS"
+    result "object out" "$OBJ_OUT_FLAG"
+    result "do not link" "$DONT_LINK_FLAG"
 
     find_program pkg-config PKGCONFIG mandatory $PKGCONFIG pkg-config
 



From ivop at mail.berlios.de  Sat Sep 15 16:54:24 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 15 Sep 2007 16:54:24 +0200
Subject: [Hmgen-svnlog] r170 - trunk
Message-ID: <200709151454.l8FEsOqw006944@sheep.berlios.de>

Author: ivop
Date: 2007-09-15 16:54:23 +0200 (Sat, 15 Sep 2007)
New Revision: 170

Modified:
   trunk/build.sh
Log:
print multiple results in one go


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-15 14:51:08 UTC (rev 169)
+++ trunk/build.sh	2007-09-15 14:54:23 UTC (rev 170)
@@ -132,6 +132,8 @@
 
 result() { test -n "$2" && question "$1" && answer "$2" ; }
 
+results() { while test -n "$1" ; do result "$1" "$2" ; shift 2 ; done ; }
+
 my_pkg_config() {
     question $1
     RES=`pkg-config --atleast-version=$4 $1 2>/dev/null && echo yes || echo no`
@@ -233,13 +235,9 @@
         sun)     cc_conf "" "-xO5" "-Xc" "-g" "-xM" "-o" "-c" ;;
         unknown) cc_conf "" "-O" "" "-g" "" "-o" "-c" ;;
     esac
-    result warnings "$WARN_FLAGS"
-    result optimize "$OPT_FLAGS"
-    result standards "$STD_FLAGS"
-    result debug "$DEBUG_FLAGS"
-    result dependencies "$DEP_FLAGS"
-    result "object out" "$OBJ_OUT_FLAG"
-    result "do not link" "$DONT_LINK_FLAG"
+    results warnings "$WARN_FLAGS" optimize "$OPT_FLAGS" standards "$STD_FLAGS"
+    result debug "$DEBUG_FLAGS" dependencies "$DEP_FLAGS"
+    result "object out" "$OBJ_OUT_FLAG" "do not link" "$DONT_LINK_FLAG"
 
     find_program pkg-config PKGCONFIG mandatory $PKGCONFIG pkg-config
 
@@ -296,8 +294,7 @@
     find_program strip  STRIP   optional $STRIP     strip true
     find_program awk    AWK     optional $AWK       mawk gawk nawk awk true
 
-    result "install prefix" "$PREFIX"
-    result "install destdir" "$DESTDIR"
+    result "install prefix" "$PREFIX" "install destdir" "$DESTDIR"
 }
 
 output_build_config() {



From ivop at mail.berlios.de  Sat Sep 15 16:58:50 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 15 Sep 2007 16:58:50 +0200
Subject: [Hmgen-svnlog] r171 - trunk
Message-ID: <200709151458.l8FEwoQg007103@sheep.berlios.de>

Author: ivop
Date: 2007-09-15 16:58:50 +0200 (Sat, 15 Sep 2007)
New Revision: 171

Modified:
   trunk/build.sh
Log:
typo's


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-15 14:54:23 UTC (rev 170)
+++ trunk/build.sh	2007-09-15 14:58:50 UTC (rev 171)
@@ -236,8 +236,8 @@
         unknown) cc_conf "" "-O" "" "-g" "" "-o" "-c" ;;
     esac
     results warnings "$WARN_FLAGS" optimize "$OPT_FLAGS" standards "$STD_FLAGS"
-    result debug "$DEBUG_FLAGS" dependencies "$DEP_FLAGS"
-    result "object out" "$OBJ_OUT_FLAG" "do not link" "$DONT_LINK_FLAG"
+    results debug "$DEBUG_FLAGS" dependencies "$DEP_FLAGS"
+    results "object out" "$OBJ_OUT_FLAG" "do not link" "$DONT_LINK_FLAG"
 
     find_program pkg-config PKGCONFIG mandatory $PKGCONFIG pkg-config
 
@@ -294,7 +294,7 @@
     find_program strip  STRIP   optional $STRIP     strip true
     find_program awk    AWK     optional $AWK       mawk gawk nawk awk true
 
-    result "install prefix" "$PREFIX" "install destdir" "$DESTDIR"
+    results "install prefix" "$PREFIX" "install destdir" "$DESTDIR"
 }
 
 output_build_config() {



From ivop at mail.berlios.de  Sat Sep 15 23:41:29 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sat, 15 Sep 2007 23:41:29 +0200
Subject: [Hmgen-svnlog] r172 - trunk
Message-ID: <200709152141.l8FLfT9s009440@sheep.berlios.de>

Author: ivop
Date: 2007-09-15 23:41:29 +0200 (Sat, 15 Sep 2007)
New Revision: 172

Modified:
   trunk/gui_main.c
Log:
make about_image_filename relative to called binary
this should also work for c:\Program Files\hmgen\bin\hmgengui


Modified: trunk/gui_main.c
===================================================================
--- trunk/gui_main.c	2007-09-15 14:58:50 UTC (rev 171)
+++ trunk/gui_main.c	2007-09-15 21:41:29 UTC (rev 172)
@@ -24,12 +24,46 @@
 #include <stdlib.h>
 #include <unistd.h>
 #include <fcntl.h>
+#include <string.h>
 #include "gui_interface.h"
 #include "gui_support.h"
 #include "lib_hmgen.c"
 
-char *about_image_filename = "share/hmgen/hmgen.png";
+char *about_image_filename = NULL; 
 
+static int malloced = 0;
+static const char * const about_img = "/share/hmgen/hmgen.png";
+
+static void assemble_about_image_filename(char *argv0) {
+    int x, y;
+    char *p;
+
+    x = strlen(argv0) - 1;
+
+    if (x<=0) {
+        about_image_filename = "nothing";
+        return;
+    }
+
+    while (x>0 && argv0[x] != '/' && argv0[x] != '\\') x--;
+
+    y = x - 1;
+    while (y>0 && argv0[y] != '/' && argv0[y] != '\\') y--;
+    if (y) y++;
+    if (!strncmp(&argv0[y], "bin", 3)) x = y;
+
+    p = malloc(x + strlen(about_img) + 1);
+    if (!p) {
+        fprintf(stderr, "out of memory\n");
+        exit(-1);
+    }
+
+    memcpy(p, argv0, x);
+    snprintf(p+x, strlen(about_img) + 1, about_img);
+    about_image_filename = p;
+    malloced = 1;
+}
+
 int main(int argc, char *argv[]) {
     GtkWidget *hmgengui;
     char *show_stderr;
@@ -45,6 +79,8 @@
     gtk_disable_setlocale();
     setlocale(LC_ALL, "C");
 
+    assemble_about_image_filename(argv[0]);
+
     hmg_init_colormap(NULL);
 
     g_thread_init(NULL);
@@ -61,5 +97,7 @@
     gtk_main ();
     gdk_threads_leave();
 
+    if (malloced) free(about_image_filename);
+
     return 0;
 }



From ivop at mail.berlios.de  Sun Sep 16 15:53:01 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sun, 16 Sep 2007 15:53:01 +0200
Subject: [Hmgen-svnlog] r173 - trunk
Message-ID: <200709161353.l8GDr1If002995@sheep.berlios.de>

Author: ivop
Date: 2007-09-16 15:53:01 +0200 (Sun, 16 Sep 2007)
New Revision: 173

Modified:
   trunk/gui_interface.c
   trunk/gui_main.c
Log:
set pixmap directory instead of hardcoded path of hmgen.png


Modified: trunk/gui_interface.c
===================================================================
--- trunk/gui_interface.c	2007-09-15 21:41:29 UTC (rev 172)
+++ trunk/gui_interface.c	2007-09-16 13:53:01 UTC (rev 173)
@@ -31,8 +31,6 @@
 #include "gui_support.h"
 #include "version.h"
 
-extern char *about_image_filename;
-
 #define GLADE_HOOKUP_OBJECT(component,widget,name) \
   g_object_set_data_full (G_OBJECT (component), name, \
     gtk_widget_ref (widget), (GDestroyNotify) gtk_widget_unref)
@@ -1342,7 +1340,7 @@
   gtk_widget_show (vbox4);
   gtk_container_add (GTK_CONTAINER (main_notebook), vbox4);
 
-  image3 = create_pixmap (hmgengui, about_image_filename);
+  image3 = create_pixmap (hmgengui, "hmgen.png");
   gtk_widget_show (image3);
   gtk_box_pack_start (GTK_BOX (vbox4), image3, FALSE, FALSE, 64);
 

Modified: trunk/gui_main.c
===================================================================
--- trunk/gui_main.c	2007-09-15 21:41:29 UTC (rev 172)
+++ trunk/gui_main.c	2007-09-16 13:53:01 UTC (rev 173)
@@ -29,19 +29,18 @@
 #include "gui_support.h"
 #include "lib_hmgen.c"
 
-char *about_image_filename = NULL; 
-
+static char *image_path = NULL; 
 static int malloced = 0;
-static const char * const about_img = "/share/hmgen/hmgen.png";
+static const char * const about_img = "/share/hmgen/";
 
-static void assemble_about_image_filename(char *argv0) {
+static void assemble_image_path(char *argv0) {
     int x, y;
     char *p;
 
     x = strlen(argv0) - 1;
 
     if (x<=0) {
-        about_image_filename = "nothing";
+        image_path = "nothing";
         return;
     }
 
@@ -60,7 +59,7 @@
 
     memcpy(p, argv0, x);
     snprintf(p+x, strlen(about_img) + 1, about_img);
-    about_image_filename = p;
+    image_path = p;
     malloced = 1;
 }
 
@@ -79,7 +78,7 @@
     gtk_disable_setlocale();
     setlocale(LC_ALL, "C");
 
-    assemble_about_image_filename(argv[0]);
+    assemble_image_path(argv[0]);
 
     hmg_init_colormap(NULL);
 
@@ -89,7 +88,7 @@
 
     gtk_init(&argc, &argv);
 
-    add_pixmap_directory (".");
+    add_pixmap_directory (image_path);
 
     hmgengui = create_hmgengui();
     gtk_widget_show(hmgengui);
@@ -97,7 +96,7 @@
     gtk_main ();
     gdk_threads_leave();
 
-    if (malloced) free(about_image_filename);
+    if (malloced) free(image_path);
 
     return 0;
 }



From ivop at mail.berlios.de  Sun Sep 16 16:14:35 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sun, 16 Sep 2007 16:14:35 +0200
Subject: [Hmgen-svnlog] r174 - trunk
Message-ID: <200709161414.l8GEEZna004864@sheep.berlios.de>

Author: ivop
Date: 2007-09-16 16:14:35 +0200 (Sun, 16 Sep 2007)
New Revision: 174

Modified:
   trunk/README
Log:
mingw/msys deployment


Modified: trunk/README
===================================================================
--- trunk/README	2007-09-16 13:53:01 UTC (rev 173)
+++ trunk/README	2007-09-16 14:14:35 UTC (rev 174)
@@ -31,3 +31,19 @@
 
 Et cetera. For all build actions and options like --cc and --prefix:
     ./build.sh --help
+
+
+Deployment on mingw/msys
+========================
+
+cd <root-of-sources>
+mkdir bin
+mkdir -p lib/gtk-2.0/2.10.0/loaders/
+cp -a /mingw/etc .
+
+./build --prefix=/ --destdir=`pwd` install
+
+copy libpixbufloader-png.dll to lib/gtk-2.0/2.10.0.loaders/
+copy all gtk+, pango and cairo DLL's to bin
+package bin, etc and lib with e.g. installjammer
+



From ivop at mail.berlios.de  Sun Sep 16 16:17:10 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sun, 16 Sep 2007 16:17:10 +0200
Subject: [Hmgen-svnlog] r175 - trunk
Message-ID: <200709161417.l8GEHAXw005034@sheep.berlios.de>

Author: ivop
Date: 2007-09-16 16:17:10 +0200 (Sun, 16 Sep 2007)
New Revision: 175

Modified:
   trunk/README
Log:
forgot to mention share


Modified: trunk/README
===================================================================
--- trunk/README	2007-09-16 14:14:35 UTC (rev 174)
+++ trunk/README	2007-09-16 14:17:10 UTC (rev 175)
@@ -45,5 +45,5 @@
 
 copy libpixbufloader-png.dll to lib/gtk-2.0/2.10.0.loaders/
 copy all gtk+, pango and cairo DLL's to bin
-package bin, etc and lib with e.g. installjammer
+package bin, share, etc and lib with e.g. installjammer
 



From ivop at mail.berlios.de  Sun Sep 16 20:42:55 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sun, 16 Sep 2007 20:42:55 +0200
Subject: [Hmgen-svnlog] r176 - trunk
Message-ID: <200709161842.l8GIgtgr006647@sheep.berlios.de>

Author: ivop
Date: 2007-09-16 20:42:54 +0200 (Sun, 16 Sep 2007)
New Revision: 176

Modified:
   trunk/build.sh
Log:
merge sed invocations; this is faster on slow-fork systems like win32


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-16 14:17:10 UTC (rev 175)
+++ trunk/build.sh	2007-09-16 18:42:54 UTC (rev 176)
@@ -173,10 +173,10 @@
 get_svn_revision() {
     SVN_REV=`svn info * 2>/dev/null | grep ^Revision: \
         | cut -d ' ' -f 2 | pad_with_zeroes \
-        | sort -r | _head 1 | sed 's/^0//' | sed 's/^0//' | sed 's/^0//'`
+        | sort -r | _head 1 | sed 's/^0//; s/^0//; s/^0//;'`
     test $SVN_REV || SVN_REV=`grep revision .svn/entries 2>/dev/null \
         | cut -d '"' -f 2` | pad_with_zeroes \
-        | sort -r | _head 1 | sed 's/^0//' | sed 's/^0//' | sed 's/^0//'
+        | sort -r | _head 1 | sed 's/^0//; s/^0//; s/^0//;'
     test $SVN_REV || SVN_REV=`sed -n -e '/^dir$/{n;p;q;}' \
         .svn/entries 2>/dev/null`
     test $SVN_REV || SVN_REV=0



From ivop at mail.berlios.de  Sun Sep 16 23:31:20 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sun, 16 Sep 2007 23:31:20 +0200
Subject: [Hmgen-svnlog] r177 - trunk
Message-ID: <200709162131.l8GLVKVP017151@sheep.berlios.de>

Author: ivop
Date: 2007-09-16 23:31:20 +0200 (Sun, 16 Sep 2007)
New Revision: 177

Modified:
   trunk/
Log:
ignore win32 build/package stuff



Property changes on: trunk
___________________________________________________________________
Name: svn:ignore
   - hmgen
hmgengui
libhmgen.a
hmgen_g
hmgengui_g
svn-commit.*
build.config
build.deps

   + hmgen
hmgengui
libhmgen.a
hmgen_g
hmgengui_g
svn-commit.*
build.config
build.deps
*.exe
bin
lib
etc




From ivop at mail.berlios.de  Sun Sep 16 23:37:47 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sun, 16 Sep 2007 23:37:47 +0200
Subject: [Hmgen-svnlog] r178 - trunk
Message-ID: <200709162137.l8GLblH6017380@sheep.berlios.de>

Author: ivop
Date: 2007-09-16 23:37:47 +0200 (Sun, 16 Sep 2007)
New Revision: 178

Modified:
   trunk/README
Log:
version numbering scheme


Modified: trunk/README
===================================================================
--- trunk/README	2007-09-16 21:31:20 UTC (rev 177)
+++ trunk/README	2007-09-16 21:37:47 UTC (rev 178)
@@ -47,3 +47,18 @@
 copy all gtk+, pango and cairo DLL's to bin
 package bin, share, etc and lib with e.g. installjammer
 
+
+Version numbering scheme
+========================
+
+0.8.x   alpha release(s)
+0.9.x   beta release(s)
+1.0.0   first stable release
+1.0.x
+1.1.0   second stable release
+et cetera
+
+For in-between, bug-fix releases, x will be < 10
+For Subversion builds, developer builds, unstable releases, x will be the
+subversion revision number.
+



From ivop at mail.berlios.de  Sun Sep 16 23:52:40 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sun, 16 Sep 2007 23:52:40 +0200
Subject: [Hmgen-svnlog] r179 - trunk
Message-ID: <200709162152.l8GLqeEb018020@sheep.berlios.de>

Author: ivop
Date: 2007-09-16 23:52:39 +0200 (Sun, 16 Sep 2007)
New Revision: 179

Modified:
   trunk/README
Log:
update win32 deployment instructions


Modified: trunk/README
===================================================================
--- trunk/README	2007-09-16 21:37:47 UTC (rev 178)
+++ trunk/README	2007-09-16 21:52:39 UTC (rev 179)
@@ -37,14 +37,14 @@
 ========================
 
 cd <root-of-sources>
-mkdir bin
-mkdir -p lib/gtk-2.0/2.10.0/loaders/
-cp -a /mingw/etc .
+mkdir -p destdir/bin
+mkdir -p destdir/lib/gtk-2.0/2.10.0/loaders/
+cp -a /mingw/etc destdir
 
-./build --prefix=/ --destdir=`pwd` install
+./build --prefix=/ --destdir=`pwd`/destdir install
 
-copy libpixbufloader-png.dll to lib/gtk-2.0/2.10.0.loaders/
-copy all gtk+, pango and cairo DLL's to bin
+copy libpixbufloader-png.dll to destdir/lib/gtk-2.0/2.10.0.loaders/
+copy all gtk+, pango and cairo DLL's to destdir/bin
 package bin, share, etc and lib with e.g. installjammer
 
 



From ivop at mail.berlios.de  Mon Sep 17 00:01:39 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Mon, 17 Sep 2007 00:01:39 +0200
Subject: [Hmgen-svnlog] r180 - trunk
Message-ID: <200709162201.l8GM1dC2018459@sheep.berlios.de>

Author: ivop
Date: 2007-09-17 00:01:39 +0200 (Mon, 17 Sep 2007)
New Revision: 180

Modified:
   trunk/build.sh
Log:
install share files


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-16 21:52:39 UTC (rev 179)
+++ trunk/build.sh	2007-09-16 22:01:39 UTC (rev 180)
@@ -558,6 +558,8 @@
     make_exec2 "mkdir -p \"$DESTDIR/$PREFIX/bin\"" "install:"
     make_exec2 "cp $gui_exe \"$DESTDIR/$PREFIX/bin\"" "install:"
     make_exec2 "chmod 755 \"$DESTDIR/$PREFIX/bin/$gui_exe\"" "install:"
+    make_exec2 "mkdir -p \"$DESTDIR/$PREFIX/share/hmgen\"" "install:"
+    make_exec2 "cp -a share/hmgen/* \"$DESTDIR/$PREFIX/share/hmgen\"" "install:"
 }
 
 make_install() {



From ivop at mail.berlios.de  Mon Sep 17 12:22:59 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Mon, 17 Sep 2007 12:22:59 +0200
Subject: [Hmgen-svnlog] r181 - trunk
Message-ID: <200709171022.l8HAMxOD024693@sheep.berlios.de>

Author: ivop
Date: 2007-09-17 12:22:58 +0200 (Mon, 17 Sep 2007)
New Revision: 181

Modified:
   trunk/TODO
Log:
more


Modified: trunk/TODO
===================================================================
--- trunk/TODO	2007-09-16 22:01:39 UTC (rev 180)
+++ trunk/TODO	2007-09-17 10:22:58 UTC (rev 181)
@@ -1,7 +1,8 @@
-CLI+GUI
--------
+LIB
+---
 
 * More algorithms (circle formation, hills, et cetera)
+* Importing of pre-generated maps
 
 GUI
 ---
@@ -9,4 +10,5 @@
 * Edit functions (draw roads, elevate lines, circles, squares, etc. )
 * Isometric 3D view
 * OpenGL 3D view, perhaps export as a mesh, manual texturing, etc.
+* POVray rendering
 



From ivop at mail.berlios.de  Wed Sep 19 12:27:04 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Wed, 19 Sep 2007 12:27:04 +0200
Subject: [Hmgen-svnlog] r182 - trunk
Message-ID: <200709191027.l8JAR4KC021174@sheep.berlios.de>

Author: ivop
Date: 2007-09-19 12:27:04 +0200 (Wed, 19 Sep 2007)
New Revision: 182

Modified:
   trunk/build.sh
Log:
ability to specify alternate strip, awk, ranlib, ar on command line


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-17 10:22:58 UTC (rev 181)
+++ trunk/build.sh	2007-09-19 10:27:04 UTC (rev 182)
@@ -20,6 +20,10 @@
 --nocolor           disable colors for terminals w/o ANSI capabilities
 --configfile=FILE   specify alternative config file
 --depsfile=FILE     specify alternative dependencies file
+--ar=AR             specify archiver
+--ranlib=RANLIB     specify ranlib
+--strip=STRIP       specify strip
+--awk=AWK           specify awk
 --help              print this message
 
 actions:
@@ -580,6 +584,10 @@
 for arg in $@ ; do
     case "$arg" in
         --cc=*)         CC=`optarg $arg`      ;;
+        --ar=*)         AR=`optarg $arg`      ;;
+        --ranlib=*)     RANLIB=`optarg $arg`  ;;
+        --strip=*)      STRIP=`optarg $arg`   ;;
+        --awk=*)        AWK=`optarg $arg`     ;;
         --prefix=*)     PREFIX=`optarg $arg`  ;;
         --destdir=*)    DESTDIR=`optarg $arg` ;;
         --verbose)      V=1                 ;;



From ivop at mail.berlios.de  Thu Sep 20 12:35:15 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Thu, 20 Sep 2007 12:35:15 +0200
Subject: [Hmgen-svnlog] r183 - trunk
Message-ID: <200709201035.l8KAZFvc007915@sheep.berlios.de>

Author: ivop
Date: 2007-09-20 12:35:14 +0200 (Thu, 20 Sep 2007)
New Revision: 183

Modified:
   trunk/build.sh
Log:
simplify


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-19 10:27:04 UTC (rev 182)
+++ trunk/build.sh	2007-09-20 10:35:14 UTC (rev 183)
@@ -183,8 +183,7 @@
         | sort -r | _head 1 | sed 's/^0//; s/^0//; s/^0//;'
     test $SVN_REV || SVN_REV=`sed -n -e '/^dir$/{n;p;q;}' \
         .svn/entries 2>/dev/null`
-    test $SVN_REV || SVN_REV=0
-    echo $SVN_REV
+    test $SVN_REV && echo $SVN_REV || echo 0
 }
 
 cc_conf() {



From ivop at mail.berlios.de  Tue Sep 25 21:28:54 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 25 Sep 2007 21:28:54 +0200
Subject: [Hmgen-svnlog] r184 - trunk
Message-ID: <200709251928.l8PJSsNO024917@sheep.berlios.de>

Author: ivop
Date: 2007-09-25 21:28:53 +0200 (Tue, 25 Sep 2007)
New Revision: 184

Modified:
   trunk/build.sh
Log:
add ./ to configfile and depsfile; fixes misbehaviour of pdksh


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-20 10:35:14 UTC (rev 183)
+++ trunk/build.sh	2007-09-25 19:28:53 UTC (rev 184)
@@ -98,8 +98,8 @@
 DESTDIR=
 CC=cc
 action=
-depsfile=build.deps
-configfile=build.config
+depsfile=./build.deps
+configfile=./build.config
 
 # --------------------------------( CONFIGURE )--------------------------------
 



From ivop at mail.berlios.de  Tue Sep 25 21:38:40 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 25 Sep 2007 21:38:40 +0200
Subject: [Hmgen-svnlog] r185 - trunk
Message-ID: <200709251938.l8PJce2B025690@sheep.berlios.de>

Author: ivop
Date: 2007-09-25 21:38:40 +0200 (Tue, 25 Sep 2007)
New Revision: 185

Modified:
   trunk/build.sh
Log:
tested with ksh and zsh


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-25 19:28:53 UTC (rev 184)
+++ trunk/build.sh	2007-09-25 19:38:40 UTC (rev 185)
@@ -3,6 +3,7 @@
 # Experimental configure/make script
 # Copyright (C) 2007 Ivo van Poorten
 # See LICENSE for licensing details
+# Tested with: bash 3.1.17, zsh 4.3.4 and pdksh 5.2.14
 
 # ----------------------------------( USAGE )----------------------------------
 



From ivop at mail.berlios.de  Tue Sep 25 21:58:34 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Tue, 25 Sep 2007 21:58:34 +0200
Subject: [Hmgen-svnlog] r186 - trunk
Message-ID: <200709251958.l8PJwY6X026639@sheep.berlios.de>

Author: ivop
Date: 2007-09-25 21:58:34 +0200 (Tue, 25 Sep 2007)
New Revision: 186

Modified:
   trunk/build.sh
Log:
do not use XSI extension of test (-a/-o) but use the shell's && and ||
fix for posh 0.5.7


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-25 19:38:40 UTC (rev 185)
+++ trunk/build.sh	2007-09-25 19:58:34 UTC (rev 186)
@@ -3,7 +3,7 @@
 # Experimental configure/make script
 # Copyright (C) 2007 Ivo van Poorten
 # See LICENSE for licensing details
-# Tested with: bash 3.1.17, zsh 4.3.4 and pdksh 5.2.14
+# Tested with: bash 3.1.17, zsh 4.3.4, pdksh 5.2.14, posh 0.5.7
 
 # ----------------------------------( USAGE )----------------------------------
 
@@ -158,7 +158,7 @@
     done
     eval $var=$i
     answer $i
-    test "$mand" = "mandatory" -a "$i" = "NONE" && die "$prog is $mand"
+    test "$mand" = "mandatory" && test "$i" = "NONE" && die "$prog is $mand"
 }
 
 pad_with_zeroes() {



From ivop at mail.berlios.de  Sun Sep 30 18:13:08 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sun, 30 Sep 2007 18:13:08 +0200
Subject: [Hmgen-svnlog] r187 - trunk
Message-ID: <200709301613.l8UGD8d1014243@sheep.berlios.de>

Author: ivop
Date: 2007-09-30 18:13:08 +0200 (Sun, 30 Sep 2007)
New Revision: 187

Modified:
   trunk/build.sh
Log:
fix for heirloom-sh


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-25 19:58:34 UTC (rev 186)
+++ trunk/build.sh	2007-09-30 16:13:08 UTC (rev 187)
@@ -176,7 +176,7 @@
 }
 
 get_svn_revision() {
-    SVN_REV=`svn info * 2>/dev/null | grep ^Revision: \
+    SVN_REV=`svn info * 2>/dev/null | grep '^Revision:' \
         | cut -d ' ' -f 2 | pad_with_zeroes \
         | sort -r | _head 1 | sed 's/^0//; s/^0//; s/^0//;'`
     test $SVN_REV || SVN_REV=`grep revision .svn/entries 2>/dev/null \



From ivop at mail.berlios.de  Sun Sep 30 18:14:18 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sun, 30 Sep 2007 18:14:18 +0200
Subject: [Hmgen-svnlog] r188 - trunk
Message-ID: <200709301614.l8UGEIM3014384@sheep.berlios.de>

Author: ivop
Date: 2007-09-30 18:14:17 +0200 (Sun, 30 Sep 2007)
New Revision: 188

Modified:
   trunk/build.sh
Log:
tested with heirloom-sh


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-30 16:13:08 UTC (rev 187)
+++ trunk/build.sh	2007-09-30 16:14:17 UTC (rev 188)
@@ -3,7 +3,8 @@
 # Experimental configure/make script
 # Copyright (C) 2007 Ivo van Poorten
 # See LICENSE for licensing details
-# Tested with: bash 3.1.17, zsh 4.3.4, pdksh 5.2.14, posh 0.5.7
+# Tested with:
+# bash 3.1.17, zsh 4.3.4, pdksh 5.2.14, posh 0.5.7, heirloom-sh-050706
 
 # ----------------------------------( USAGE )----------------------------------
 



From ivop at mail.berlios.de  Sun Sep 30 18:20:34 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sun, 30 Sep 2007 18:20:34 +0200
Subject: [Hmgen-svnlog] r189 - trunk
Message-ID: <200709301620.l8UGKYc0014884@sheep.berlios.de>

Author: ivop
Date: 2007-09-30 18:20:33 +0200 (Sun, 30 Sep 2007)
New Revision: 189

Modified:
   trunk/build.sh
Log:
tested with Brian's One True Awk


Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-30 16:14:17 UTC (rev 188)
+++ trunk/build.sh	2007-09-30 16:20:33 UTC (rev 189)
@@ -4,7 +4,8 @@
 # Copyright (C) 2007 Ivo van Poorten
 # See LICENSE for licensing details
 # Tested with:
-# bash 3.1.17, zsh 4.3.4, pdksh 5.2.14, posh 0.5.7, heirloom-sh-050706
+# Shells: bash 3.1.17, zsh 4.3.4, pdksh 5.2.14, posh 0.5.7, heirloom-sh-050706
+# Awk: gawk 3.1.5, bwk's One True Awk May 2007
 
 # ----------------------------------( USAGE )----------------------------------
 



From ivop at mail.berlios.de  Sun Sep 30 18:34:25 2007
From: ivop at mail.berlios.de (ivop at BerliOS)
Date: Sun, 30 Sep 2007 18:34:25 +0200
Subject: [Hmgen-svnlog] r190 - trunk
Message-ID: <200709301634.l8UGYPRR029718@sheep.berlios.de>

Author: ivop
Date: 2007-09-30 18:34:23 +0200 (Sun, 30 Sep 2007)
New Revision: 190

Modified:
   trunk/README
   trunk/build.sh
   trunk/version.h
Log:
revise version numbering


Modified: trunk/README
===================================================================
--- trunk/README	2007-09-30 16:20:33 UTC (rev 189)
+++ trunk/README	2007-09-30 16:34:23 UTC (rev 190)
@@ -51,14 +51,12 @@
 Version numbering scheme
 ========================
 
-0.8.x   alpha release(s)
-0.9.x   beta release(s)
+0.9.x   alpha/beta release(s)
 1.0.0   first stable release
-1.0.x
-1.1.0   second stable release
+1.0.x   bug fix releases
+1.1.0   first unstable release
+1.1.x   bug fix releases
+1.2.0   second stable release
 et cetera
 
-For in-between, bug-fix releases, x will be < 10
-For Subversion builds, developer builds, unstable releases, x will be the
-subversion revision number.
-
+Developer builds will have r<REV> postpended to the actual version number

Modified: trunk/build.sh
===================================================================
--- trunk/build.sh	2007-09-30 16:20:33 UTC (rev 189)
+++ trunk/build.sh	2007-09-30 16:34:23 UTC (rev 190)
@@ -261,9 +261,15 @@
     VERMAJ=`grep "$X" version.h | sed "s/$X//"`
     X="#define HMG_VERSION_MINOR"
     VERMIN=`grep "$X" version.h | sed "s/$X//"`
+    X="#define HMG_VERSION_MICRO"
+    VERMIC=`grep "$X" version.h | sed "s/$X//"`
     SVN_REV=`get_svn_revision`
     DEFINES="$DEFINES -DSVN_REVISION=$SVN_REV"
-    answer `echo $VERMAJ`.`echo $VERMIN`.$SVN_REV
+    if test "$SVN_REV" -ne 0 ; then
+        answer `echo $VERMAJ`.`echo $VERMIN`.`echo $VERMIC`r$SVN_REV
+    else
+        answer `echo $VERMAJ`.`echo $VERMIN`.`echo $VERMIC`r$SVN_REV
+    fi
 
     SYSTEM=`uname -s 2>/dev/null`
     SYSTEM=`echo $SYSTEM | tr '[A-Z]' '[a-z]'`

Modified: trunk/version.h
===================================================================
--- trunk/version.h	2007-09-30 16:20:33 UTC (rev 189)
+++ trunk/version.h	2007-09-30 16:34:23 UTC (rev 190)
@@ -5,14 +5,23 @@
 #define HMG_TOSTRING(s)     #s
 
 #define HMG_VERSION_MAJOR       0
-#define HMG_VERSION_MINOR       8
-#define HMG_VERSION_MICRO       SVN_REVISION
-#define HMG_VERSION_INT         ((HMG_VERSION_MAJOR<<8) + \
-                                 (HMG_VERSION_MINOR<<4) + \
-                                  HMG_VERSION_MICRO)
+#define HMG_VERSION_MINOR       9
+#define HMG_VERSION_MICRO       0
+#define HMG_VERSION_REV         SVN_REVISION
+#define HMG_VERSION_INT         ((HMG_VERSION_MAJOR<<24) + \
+                                 (HMG_VERSION_MINOR<<20) + \
+                                 (HMG_VERSION_MICRO<<16) + \
+                                  HMG_VERSION_REV)
+#if HMG_VERSION_REV > 100
 #define HMG_VERSION_STRING      "Version " HMG_STRINGIFY(HMG_VERSION_MAJOR) \
                                 "."        HMG_STRINGIFY(HMG_VERSION_MINOR) \
+                                "."        HMG_STRINGIFY(HMG_VERSION_MICRO) \
+                                "r"        HMG_STRINGIFY(HMG_VERSION_REV)
+#else
+#define HMG_VERSION_STRING      "Version " HMG_STRINGIFY(HMG_VERSION_MAJOR) \
+                                "."        HMG_STRINGIFY(HMG_VERSION_MINOR) \
                                 "."        HMG_STRINGIFY(HMG_VERSION_MICRO)
+#endif
 #define HMG_COPYRIGHT_STRING    "Copyright (C) 2007 Ivo van Poorten"
 
 #endif



